/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _array_like_to_array(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes(arr){if(Array.isArray(arr))return arr}function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return left instanceof right}}function _iterable_to_array(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterable_to_array_limit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array(arr,i){return _array_with_holes(arr)||_iterable_to_array_limit(arr,i)||_unsupported_iterable_to_array(arr,i)||_non_iterable_rest()}function _to_consumable_array(arr){return _array_without_holes(arr)||_iterable_to_array(arr)||_unsupported_iterable_to_array(arr)||_non_iterable_spread()}function _unsupported_iterable_to_array(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function _array_like_to_array$8(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes$4(arr){if(Array.isArray(arr))return arr}function _assert_this_initialized$3(self1){if(self1===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self1}function _class_call_check$6(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _construct$1(Parent,args,Class){if(_is_native_reflect_construct$3()){_construct$1=Reflect.construct}else{_construct$1=function construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_set_prototype_of$3(instance,Class.prototype);return instance}}return _construct$1.apply(null,arguments)}function _defineProperties$6(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$6(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$6(Constructor.prototype,protoProps);if(staticProps)_defineProperties$6(Constructor,staticProps);return Constructor}function _get_prototype_of$3(o){_get_prototype_of$3=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _get_prototype_of$3(o)}function _inherits$3(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_set_prototype_of$3(subClass,superClass)}function _is_native_function$1(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _iterable_to_array_limit$4(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest$4(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possible_constructor_return$3(self1,call){if(call&&(_type_of$3(call)==="object"||typeof call==="function")){return call}return _assert_this_initialized$3(self1)}function _set_prototype_of$3(o,p){_set_prototype_of$3=Object.setPrototypeOf||function setPrototypeOf(o,p){o.__proto__=p;return o};return _set_prototype_of$3(o,p)}function _sliced_to_array$4(arr,i){return _array_with_holes$4(arr)||_iterable_to_array_limit$4(arr,i)||_unsupported_iterable_to_array$8(arr,i)||_non_iterable_rest$4()}function _type_of$3(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array$8(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$8(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$8(o,minLen)}function _wrap_native_super$1(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrap_native_super$1=function wrapNativeSuper(Class){if(Class===null||!_is_native_function$1(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct$1(Class,arguments,_get_prototype_of$3(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of$3(Wrapper,Class)};return _wrap_native_super$1(Class)}function _is_native_reflect_construct$3(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super$3(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct$3();return function _createSuperInternal(){var Super=_get_prototype_of$3(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of$3(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possible_constructor_return$3(this,result)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var stringToByteArray$1=function stringToByteArray$1(str){var out=[];var p=0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c<128){out[p++]=c}else if(c<2048){out[p++]=c>>6|192;out[p++]=c&63|128}else if((c&64512)===55296&&i+1<str.length&&(str.charCodeAt(i+1)&64512)===56320){c=65536+((c&1023)<<10)+(str.charCodeAt(++i)&1023);out[p++]=c>>18|240;out[p++]=c>>12&63|128;out[p++]=c>>6&63|128;out[p++]=c&63|128}else{out[p++]=c>>12|224;out[p++]=c>>6&63|128;out[p++]=c&63|128}}return out};var byteArrayToString=function byteArrayToString(bytes){var out=[];var pos=0,c=0;while(pos<bytes.length){var c1=bytes[pos++];if(c1<128){out[c++]=String.fromCharCode(c1)}else if(c1>191&&c1<224){var c2=bytes[pos++];out[c++]=String.fromCharCode((c1&31)<<6|c2&63)}else if(c1>239&&c1<365){var c21=bytes[pos++];var c3=bytes[pos++];var c4=bytes[pos++];var u=((c1&7)<<18|(c21&63)<<12|(c3&63)<<6|c4&63)-65536;out[c++]=String.fromCharCode(55296+(u>>10));out[c++]=String.fromCharCode(56320+(u&1023))}else{var c22=bytes[pos++];var c31=bytes[pos++];out[c++]=String.fromCharCode((c1&15)<<12|(c22&63)<<6|c31&63)}}return out.join("")};var base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz"+"0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function encodeByteArray(input,webSafe){if(!Array.isArray(input)){throw Error("encodeByteArray takes an array as a parameter")}this.init_();var byteToCharMap=webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_;var output=[];for(var i=0;i<input.length;i+=3){var byte1=input[i];var haveByte2=i+1<input.length;var byte2=haveByte2?input[i+1]:0;var haveByte3=i+2<input.length;var byte3=haveByte3?input[i+2]:0;var outByte1=byte1>>2;var outByte2=(byte1&3)<<4|byte2>>4;var outByte3=(byte2&15)<<2|byte3>>6;var outByte4=byte3&63;if(!haveByte3){outByte4=64;if(!haveByte2){outByte3=64}}output.push(byteToCharMap[outByte1],byteToCharMap[outByte2],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join("")},encodeString:function encodeString(input,webSafe){if(this.HAS_NATIVE_SUPPORT&&!webSafe){return btoa(input)}return this.encodeByteArray(stringToByteArray$1(input),webSafe)},decodeString:function decodeString(input,webSafe){if(this.HAS_NATIVE_SUPPORT&&!webSafe){return atob(input)}return byteArrayToString(this.decodeStringToByteArray(input,webSafe))},decodeStringToByteArray:function decodeStringToByteArray(input,webSafe){this.init_();var charToByteMap=webSafe?this.charToByteMapWebSafe_:this.charToByteMap_;var output=[];for(var i=0;i<input.length;){var byte1=charToByteMap[input.charAt(i++)];var haveByte2=i<input.length;var byte2=haveByte2?charToByteMap[input.charAt(i)]:0;++i;var haveByte3=i<input.length;var byte3=haveByte3?charToByteMap[input.charAt(i)]:64;++i;var haveByte4=i<input.length;var byte4=haveByte4?charToByteMap[input.charAt(i)]:64;++i;if(byte1==null||byte2==null||byte3==null||byte4==null){throw new DecodeBase64StringError}var outByte1=byte1<<2|byte2>>4;output.push(outByte1);if(byte3!==64){var outByte2=byte2<<4&240|byte3>>2;output.push(outByte2);if(byte4!==64){var outByte3=byte3<<6&192|byte4;output.push(outByte3)}}}return output},init_:function init_(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(var i=0;i<this.ENCODED_VALS.length;i++){this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i);this.charToByteMap_[this.byteToCharMap_[i]]=i;this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i;if(i>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i}}}}};var DecodeBase64StringError=function(Error1){_inherits$3(DecodeBase64StringError,Error1);var _super=_create_super$3(DecodeBase64StringError);function DecodeBase64StringError(){_class_call_check$6(this,DecodeBase64StringError);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));_this.name="DecodeBase64StringError";return _this}return DecodeBase64StringError}(_wrap_native_super$1(Error));var base64Encode=function base64Encode(str){var utf8Bytes=stringToByteArray$1(str);return base64.encodeByteArray(utf8Bytes,true)};var base64urlEncodeWithoutPadding=function base64urlEncodeWithoutPadding(str){return base64Encode(str).replace(/\./g,"")};var base64Decode=function base64Decode(str){try{return base64.decodeString(str,true)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var getDefaultsFromGlobal=function getDefaultsFromGlobal(){return getGlobal().__FIREBASE_DEFAULTS__};var getDefaultsFromEnvVariable=function getDefaultsFromEnvVariable(){if(typeof process==="undefined"||typeof process.env==="undefined"){return}var defaultsJsonString=process.env.__FIREBASE_DEFAULTS__;if(defaultsJsonString){return JSON.parse(defaultsJsonString)}};var getDefaultsFromCookie=function getDefaultsFromCookie(){if(typeof document==="undefined"){return}var match;try{match=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var decoded=match&&base64Decode(match[1]);return decoded&&JSON.parse(decoded)};var getDefaults=function getDefaults(){try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(e){console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e));return}};var getDefaultEmulatorHost=function getDefaultEmulatorHost(productName){var _a,_b;return(_b=(_a=getDefaults())===null||_a===void 0?void 0:_a.emulatorHosts)===null||_b===void 0?void 0:_b[productName]};var getDefaultEmulatorHostnameAndPort=function getDefaultEmulatorHostnameAndPort(productName){var host=getDefaultEmulatorHost(productName);if(!host){return undefined}var separatorIndex=host.lastIndexOf(":");if(separatorIndex<=0||separatorIndex+1===host.length){throw new Error("Invalid host ".concat(host," with no separate hostname and port!"))}var port=parseInt(host.substring(separatorIndex+1),10);if(host[0]==="["){return[host.substring(1,separatorIndex-1),port]}else{return[host.substring(0,separatorIndex),port]}};var getDefaultAppConfig=function getDefaultAppConfig(){var _a;return(_a=getDefaults())===null||_a===void 0?void 0:_a.config};var getExperimentalSetting=function getExperimentalSetting(name){var _a;return(_a=getDefaults())===null||_a===void 0?void 0:_a["_".concat(name)]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Deferred=function(){function Deferred(){var _this=this;_class_call_check$6(this,Deferred);this.reject=function(){};this.resolve=function(){};this.promise=new Promise(function(resolve,reject){_this.resolve=resolve;_this.reject=reject})}_create_class$6(Deferred,[{key:"wrapCallback",value:function wrapCallback(callback){var _this=this;return function(error,value){if(error){_this.reject(error)}else{_this.resolve(value)}if(typeof callback==="function"){_this.promise.catch(function(){});if(callback.length===1){callback(error)}else{callback(error,value)}}}}}]);return Deferred}();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(token,projectId){if(token.uid){throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.')}var header={alg:"none",type:"JWT"};var project=projectId||"demo-project";var iat=token.iat||0;var sub=token.sub||token.user_id;if(!sub){throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}var payload=Object.assign({iss:"https://securetoken.google.com/".concat(project),aud:project,iat:iat,exp:iat+3600,auth_time:iat,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},token);var signature="";return[base64urlEncodeWithoutPadding(JSON.stringify(header)),base64urlEncodeWithoutPadding(JSON.stringify(payload)),signature].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}}function isMobileCordova(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isNode(){var _a;var forceEnvironment=(_a=getDefaults())===null||_a===void 0?void 0:_a.forceEnvironment;if(forceEnvironment==="node"){return true}else if(forceEnvironment==="browser"){return false}try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(e){return false}}function isBrowserExtension(){var runtime=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:undefined;return typeof runtime==="object"&&runtime.id!==undefined}function isReactNative(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"}function isIE(){var ua=getUA();return ua.indexOf("MSIE ")>=0||ua.indexOf("Trident/")>=0}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return typeof indexedDB==="object"}catch(e){return false}}function validateIndexedDBOpenable(){return new Promise(function(resolve,reject){try{var preExist=true;var DB_CHECK_NAME="validate-browser-context-for-indexeddb-analytics-module";var request=self.indexedDB.open(DB_CHECK_NAME);request.onsuccess=function(){request.result.close();if(!preExist){self.indexedDB.deleteDatabase(DB_CHECK_NAME)}resolve(true)};request.onupgradeneeded=function(){preExist=false};request.onerror=function(){var _a;reject(((_a=request.error)===null||_a===void 0?void 0:_a.message)||"")}}catch(error){reject(error)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ERROR_NAME="FirebaseError";var FirebaseError=function(Error1){_inherits$3(FirebaseError,Error1);var _super=_create_super$3(FirebaseError);function FirebaseError(code,message,customData){_class_call_check$6(this,FirebaseError);var _this;_this=_super.call(this,message);_this.code=code;_this.customData=customData;_this.name=ERROR_NAME;Object.setPrototypeOf(_assert_this_initialized$3(_this),FirebaseError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(_assert_this_initialized$3(_this),ErrorFactory.prototype.create)}return _this}return FirebaseError}(_wrap_native_super$1(Error));var ErrorFactory=function(){function ErrorFactory(service,serviceName,errors){_class_call_check$6(this,ErrorFactory);this.service=service;this.serviceName=serviceName;this.errors=errors}_create_class$6(ErrorFactory,[{key:"create",value:function create(code){for(var _len=arguments.length,data=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){data[_key-1]=arguments[_key]}var customData=data[0]||{};var fullCode="".concat(this.service,"/").concat(code);var template=this.errors[code];var message=template?replaceTemplate(template,customData):"Error";var fullMessage="".concat(this.serviceName,": ").concat(message," (").concat(fullCode,").");var error=new FirebaseError(fullCode,fullMessage,customData);return error}}]);return ErrorFactory}();function replaceTemplate(template,data){return template.replace(PATTERN,function(_,key){var value=data[key];return value!=null?String(value):"<".concat(key,"?>")})}var PATTERN=/\{\$([^}]+)}/g;function isEmpty$1(obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){return false}}return true}function deepEqual(a,b){if(a===b){return true}var aKeys=Object.keys(a);var bKeys=Object.keys(b);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=aKeys[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var k=_step.value;if(!bKeys.includes(k)){return false}var aProp=a[k];var bProp=b[k];if(isObject(aProp)&&isObject(bProp)){if(!deepEqual(aProp,bProp)){return false}}else if(aProp!==bProp){return false}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=bKeys[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var k1=_step1.value;if(!aKeys.includes(k1)){return false}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return true}function isObject(thing){return thing!==null&&typeof thing==="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(querystringParams){var params=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var _step_value=_sliced_to_array$4(_step.value,2),key=_step_value[0],value=_step_value[1];if(Array.isArray(value)){value.forEach(function(arrayVal){params.push(encodeURIComponent(key)+"="+encodeURIComponent(arrayVal))})}else{params.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}};for(var _iterator=Object.entries(querystringParams)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return params.length?"&"+params.join("&"):""}function querystringDecode(querystring){var obj={};var tokens=querystring.replace(/^\?/,"").split("&");tokens.forEach(function(token){if(token){var _token_split=_sliced_to_array$4(token.split("="),2),key=_token_split[0],value=_token_split[1];obj[decodeURIComponent(key)]=decodeURIComponent(value)}});return obj}function extractQuerystring(url){var queryStart=url.indexOf("?");if(!queryStart){return""}var fragmentStart=url.indexOf("#",queryStart);return url.substring(queryStart,fragmentStart>0?fragmentStart:undefined)}function createSubscribe(executor,onNoObservers){var proxy=new ObserverProxy(executor,onNoObservers);return proxy.subscribe.bind(proxy)}var ObserverProxy=function(){function ObserverProxy(executor,onNoObservers){var _this=this;_class_call_check$6(this,ObserverProxy);this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=onNoObservers;this.task.then(function(){executor(_this)}).catch(function(e){_this.error(e)})}_create_class$6(ObserverProxy,[{key:"next",value:function next(value){this.forEachObserver(function(observer){observer.next(value)})}},{key:"error",value:function error(error){this.forEachObserver(function(observer){observer.error(error)});this.close(error)}},{key:"complete",value:function complete(){this.forEachObserver(function(observer){observer.complete()});this.close()}},{key:"subscribe",value:function subscribe(nextOrObserver,error,complete){var _this=this;var observer;if(nextOrObserver===undefined&&error===undefined&&complete===undefined){throw new Error("Missing Observer.")}if(implementsAnyMethods(nextOrObserver,["next","error","complete"])){observer=nextOrObserver}else{observer={next:nextOrObserver,error:error,complete:complete}}if(observer.next===undefined){observer.next=noop}if(observer.error===undefined){observer.error=noop}if(observer.complete===undefined){observer.complete=noop}var unsub=this.unsubscribeOne.bind(this,this.observers.length);if(this.finalized){this.task.then(function(){try{if(_this.finalError){observer.error(_this.finalError)}else{observer.complete()}}catch(e){}return})}this.observers.push(observer);return unsub}},{key:"unsubscribeOne",value:function unsubscribeOne(i){if(this.observers===undefined||this.observers[i]===undefined){return}delete this.observers[i];this.observerCount-=1;if(this.observerCount===0&&this.onNoObservers!==undefined){this.onNoObservers(this)}}},{key:"forEachObserver",value:function forEachObserver(fn){if(this.finalized){return}for(var i=0;i<this.observers.length;i++){this.sendOne(i,fn)}}},{key:"sendOne",value:function sendOne(i,fn){var _this=this;this.task.then(function(){if(_this.observers!==undefined&&_this.observers[i]!==undefined){try{fn(_this.observers[i])}catch(e){if(typeof console!=="undefined"&&console.error){console.error(e)}}}})}},{key:"close",value:function close(err){var _this=this;if(this.finalized){return}this.finalized=true;if(err!==undefined){this.finalError=err}this.task.then(function(){_this.observers=undefined;_this.onNoObservers=undefined})}}]);return ObserverProxy}();function implementsAnyMethods(obj,methods){if(typeof obj!=="object"||obj===null){return false}var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=methods[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var method=_step.value;if(method in obj&&typeof obj[method]==="function"){return true}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return false}function noop(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(service){if(service&&service._delegate){return service._delegate}else{return service}}function _array_like_to_array$7(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes$3(arr){if(Array.isArray(arr))return arr}function _array_without_holes$6(arr){if(Array.isArray(arr))return _array_like_to_array$7(arr)}function asyncGeneratorStep$6(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$6(fn){return function(){var _$self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(_$self,args);function _next(value){asyncGeneratorStep$6(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$6(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _class_call_check$5(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties$5(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$5(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$5(Constructor.prototype,protoProps);if(staticProps)_defineProperties$5(Constructor,staticProps);return Constructor}function _iterable_to_array$6(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterable_to_array_limit$3(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest$3(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread$6(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array$3(arr,i){return _array_with_holes$3(arr)||_iterable_to_array_limit$3(arr,i)||_unsupported_iterable_to_array$7(arr,i)||_non_iterable_rest$3()}function _to_consumable_array$6(arr){return _array_without_holes$6(arr)||_iterable_to_array$6(arr)||_unsupported_iterable_to_array$7(arr)||_non_iterable_spread$6()}function _unsupported_iterable_to_array$7(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$7(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$7(o,minLen)}function _ts_generator$4(thisArg,body){var f,_$y,t,g,_={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,_$y&&(t=op[0]&2?_$y["return"]:op[0]?_$y["throw"]||((t=_$y["return"])&&t.call(_$y),0):_$y.next)&&!(t=t.call(_$y,op[1])).done)return t;if(_$y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;_$y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];_$y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}var Component=function(){function Component(name,instanceFactory,type){_class_call_check$5(this,Component);this.name=name;this.instanceFactory=instanceFactory;this.type=type;this.multipleInstances=false;this.serviceProps={};this.instantiationMode="LAZY";this.onInstanceCreated=null}_create_class$5(Component,[{key:"setInstantiationMode",value:function setInstantiationMode(mode){this.instantiationMode=mode;return this}},{key:"setMultipleInstances",value:function setMultipleInstances(multipleInstances){this.multipleInstances=multipleInstances;return this}},{key:"setServiceProps",value:function setServiceProps(props){this.serviceProps=props;return this}},{key:"setInstanceCreatedCallback",value:function setInstanceCreatedCallback(callback){this.onInstanceCreated=callback;return this}}]);return Component}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Provider=function(){function Provider(name,container){_class_call_check$5(this,Provider);this.name=name;this.container=container;this.component=null;this.instances=new Map;this.instancesDeferred=new Map;this.instancesOptions=new Map;this.onInitCallbacks=new Map}_create_class$5(Provider,[{key:"get",value:function get(identifier){var normalizedIdentifier=this.normalizeInstanceIdentifier(identifier);if(!this.instancesDeferred.has(normalizedIdentifier)){var deferred=new Deferred;this.instancesDeferred.set(normalizedIdentifier,deferred);if(this.isInitialized(normalizedIdentifier)||this.shouldAutoInitialize()){try{var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});if(instance){deferred.resolve(instance)}}catch(e){}}}return this.instancesDeferred.get(normalizedIdentifier).promise}},{key:"getImmediate",value:function getImmediate(options){var _a;var normalizedIdentifier=this.normalizeInstanceIdentifier(options===null||options===void 0?void 0:options.identifier);var optional=(_a=options===null||options===void 0?void 0:options.optional)!==null&&_a!==void 0?_a:false;if(this.isInitialized(normalizedIdentifier)||this.shouldAutoInitialize()){try{return this.getOrInitializeService({instanceIdentifier:normalizedIdentifier})}catch(e){if(optional){return null}else{throw e}}}else{if(optional){return null}else{throw Error("Service ".concat(this.name," is not available"))}}}},{key:"getComponent",value:function getComponent(){return this.component}},{key:"setComponent",value:function setComponent(component){if(component.name!==this.name){throw Error("Mismatching Component ".concat(component.name," for Provider ").concat(this.name,"."))}if(this.component){throw Error("Component for ".concat(this.name," has already been provided"))}this.component=component;if(!this.shouldAutoInitialize()){return}if(isComponentEager(component)){try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch(e){}}var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.instancesDeferred.entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step_value=_sliced_to_array$3(_step.value,2),instanceIdentifier=_step_value[0],instanceDeferred=_step_value[1];var normalizedIdentifier=this.normalizeInstanceIdentifier(instanceIdentifier);try{var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instanceDeferred.resolve(instance)}catch(e){}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"clearInstance",value:function clearInstance(){var identifier=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_ENTRY_NAME$1;this.instancesDeferred.delete(identifier);this.instancesOptions.delete(identifier);this.instances.delete(identifier)}},{key:"delete",value:function _delete(){var _this=this;return _async_to_generator$6(function(){var services;return _ts_generator$4(this,function(_state){switch(_state.label){case 0:services=Array.from(_this.instances.values());return[4,Promise.all(_to_consumable_array$6(services.filter(function(service){return"INTERNAL"in service}).map(function(service){return service.INTERNAL.delete()})).concat(_to_consumable_array$6(services.filter(function(service){return"_delete"in service}).map(function(service){return service._delete()}))))];case 1:_state.sent();return[2]}})})()}},{key:"isComponentSet",value:function isComponentSet(){return this.component!=null}},{key:"isInitialized",value:function isInitialized(){var identifier=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_ENTRY_NAME$1;return this.instances.has(identifier)}},{key:"getOptions",value:function getOptions(){var identifier=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_ENTRY_NAME$1;return this.instancesOptions.get(identifier)||{}}},{key:"initialize",value:function initialize(){var opts=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var _opts_options=opts.options,options=_opts_options===void 0?{}:_opts_options;var normalizedIdentifier=this.normalizeInstanceIdentifier(opts.instanceIdentifier);if(this.isInitialized(normalizedIdentifier)){throw Error("".concat(this.name,"(").concat(normalizedIdentifier,") has already been initialized"))}if(!this.isComponentSet()){throw Error("Component ".concat(this.name," has not been registered yet"))}var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier,options:options});var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.instancesDeferred.entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step_value=_sliced_to_array$3(_step.value,2),instanceIdentifier=_step_value[0],instanceDeferred=_step_value[1];var normalizedDeferredIdentifier=this.normalizeInstanceIdentifier(instanceIdentifier);if(normalizedIdentifier===normalizedDeferredIdentifier){instanceDeferred.resolve(instance)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return instance}},{key:"onInit",value:function onInit(callback,identifier){var _a;var normalizedIdentifier=this.normalizeInstanceIdentifier(identifier);var existingCallbacks=(_a=this.onInitCallbacks.get(normalizedIdentifier))!==null&&_a!==void 0?_a:new Set;existingCallbacks.add(callback);this.onInitCallbacks.set(normalizedIdentifier,existingCallbacks);var existingInstance=this.instances.get(normalizedIdentifier);if(existingInstance){callback(existingInstance,normalizedIdentifier)}return function(){existingCallbacks.delete(callback)}}},{key:"invokeOnInitCallbacks",value:function invokeOnInitCallbacks(instance,identifier){var callbacks=this.onInitCallbacks.get(identifier);if(!callbacks){return}var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=callbacks[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var callback=_step.value;try{callback(instance,identifier)}catch(_a){}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"getOrInitializeService",value:function getOrInitializeService(param){var instanceIdentifier=param.instanceIdentifier,_param_options=param.options,options=_param_options===void 0?{}:_param_options;var instance=this.instances.get(instanceIdentifier);if(!instance&&this.component){instance=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(instanceIdentifier),options:options});this.instances.set(instanceIdentifier,instance);this.instancesOptions.set(instanceIdentifier,options);this.invokeOnInitCallbacks(instance,instanceIdentifier);if(this.component.onInstanceCreated){try{this.component.onInstanceCreated(this.container,instanceIdentifier,instance)}catch(_a){}}}return instance||null}},{key:"normalizeInstanceIdentifier",value:function normalizeInstanceIdentifier(){var identifier=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_ENTRY_NAME$1;if(this.component){return this.component.multipleInstances?identifier:DEFAULT_ENTRY_NAME$1}else{return identifier}}},{key:"shouldAutoInitialize",value:function shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}]);return Provider}();function normalizeIdentifierForFactory(identifier){return identifier===DEFAULT_ENTRY_NAME$1?undefined:identifier}function isComponentEager(component){return component.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ComponentContainer=function(){function ComponentContainer(name){_class_call_check$5(this,ComponentContainer);this.name=name;this.providers=new Map}_create_class$5(ComponentContainer,[{key:"addComponent",value:function addComponent(component){var provider=this.getProvider(component.name);if(provider.isComponentSet()){throw new Error("Component ".concat(component.name," has already been registered with ").concat(this.name))}provider.setComponent(component)}},{key:"addOrOverwriteComponent",value:function addOrOverwriteComponent(component){var provider=this.getProvider(component.name);if(provider.isComponentSet()){this.providers.delete(component.name)}this.addComponent(component)}},{key:"getProvider",value:function getProvider(name){if(this.providers.has(name)){return this.providers.get(name)}var provider=new Provider(name,this);this.providers.set(name,provider);return provider}},{key:"getProviders",value:function getProviders(){return Array.from(this.providers.values())}}]);return ComponentContainer}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _array_like_to_array$6(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes$5(arr){if(Array.isArray(arr))return _array_like_to_array$6(arr)}function _class_call_check$4(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties$4(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$4(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$4(Constructor.prototype,protoProps);if(staticProps)_defineProperties$4(Constructor,staticProps);return Constructor}function _define_property$5(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _iterable_to_array$5(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _non_iterable_spread$5(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array$5(arr){return _array_without_holes$5(arr)||_iterable_to_array$5(arr)||_unsupported_iterable_to_array$6(arr)||_non_iterable_spread$5()}function _unsupported_iterable_to_array$6(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$6(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$6(o,minLen)}var LogLevel;(function(LogLevel){LogLevel[LogLevel["DEBUG"]=0]="DEBUG";LogLevel[LogLevel["VERBOSE"]=1]="VERBOSE";LogLevel[LogLevel["INFO"]=2]="INFO";LogLevel[LogLevel["WARN"]=3]="WARN";LogLevel[LogLevel["ERROR"]=4]="ERROR";LogLevel[LogLevel["SILENT"]=5]="SILENT"})(LogLevel||(LogLevel={}));var levelStringToEnum={"debug":LogLevel.DEBUG,"verbose":LogLevel.VERBOSE,"info":LogLevel.INFO,"warn":LogLevel.WARN,"error":LogLevel.ERROR,"silent":LogLevel.SILENT};var defaultLogLevel=LogLevel.INFO;var _obj$2;var ConsoleMethod=(_obj$2={},_define_property$5(_obj$2,LogLevel.DEBUG,"log"),_define_property$5(_obj$2,LogLevel.VERBOSE,"log"),_define_property$5(_obj$2,LogLevel.INFO,"info"),_define_property$5(_obj$2,LogLevel.WARN,"warn"),_define_property$5(_obj$2,LogLevel.ERROR,"error"),_obj$2);var defaultLogHandler=function defaultLogHandler(instance,logType){for(var _len=arguments.length,args=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){args[_key-2]=arguments[_key]}if(logType<instance.logLevel){return}var now=new Date().toISOString();var method=ConsoleMethod[logType];if(method){var _console;(_console=console)[method].apply(_console,["[".concat(now,"]  ").concat(instance.name,":")].concat(_to_consumable_array$5(args)))}else{throw new Error("Attempted to log a message with an invalid logType (value: ".concat(logType,")"))}};var Logger=function(){function Logger(name){_class_call_check$4(this,Logger);this.name=name;this._logLevel=defaultLogLevel;this._logHandler=defaultLogHandler;this._userLogHandler=null}_create_class$4(Logger,[{key:"logLevel",get:function get(){return this._logLevel},set:function set(val){if(!(val in LogLevel)){throw new TypeError('Invalid value "'.concat(val,'" assigned to `logLevel`'))}this._logLevel=val}},{key:"setLogLevel",value:function setLogLevel(val){this._logLevel=typeof val==="string"?levelStringToEnum[val]:val}},{key:"logHandler",get:function get(){return this._logHandler},set:function set(val){if(typeof val!=="function"){throw new TypeError("Value assigned to `logHandler` must be a function")}this._logHandler=val}},{key:"userLogHandler",get:function get(){return this._userLogHandler},set:function set(val){this._userLogHandler=val}},{key:"debug",value:function debug(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._userLogHandler&&this._userLogHandler.apply(this,[this,LogLevel.DEBUG].concat(_to_consumable_array$5(args)));this._logHandler.apply(this,[this,LogLevel.DEBUG].concat(_to_consumable_array$5(args)))}},{key:"log",value:function log(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._userLogHandler&&this._userLogHandler.apply(this,[this,LogLevel.VERBOSE].concat(_to_consumable_array$5(args)));this._logHandler.apply(this,[this,LogLevel.VERBOSE].concat(_to_consumable_array$5(args)))}},{key:"info",value:function info(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._userLogHandler&&this._userLogHandler.apply(this,[this,LogLevel.INFO].concat(_to_consumable_array$5(args)));this._logHandler.apply(this,[this,LogLevel.INFO].concat(_to_consumable_array$5(args)))}},{key:"warn",value:function warn(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._userLogHandler&&this._userLogHandler.apply(this,[this,LogLevel.WARN].concat(_to_consumable_array$5(args)));this._logHandler.apply(this,[this,LogLevel.WARN].concat(_to_consumable_array$5(args)))}},{key:"error",value:function error(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._userLogHandler&&this._userLogHandler.apply(this,[this,LogLevel.ERROR].concat(_to_consumable_array$5(args)));this._logHandler.apply(this,[this,LogLevel.ERROR].concat(_to_consumable_array$5(args)))}}]);return Logger}();function _array_like_to_array$5(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes$4(arr){if(Array.isArray(arr))return _array_like_to_array$5(arr)}function _instanceof$5(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _iterable_to_array$4(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _non_iterable_spread$4(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array$4(arr){return _array_without_holes$4(arr)||_iterable_to_array$4(arr)||_unsupported_iterable_to_array$5(arr)||_non_iterable_spread$4()}function _unsupported_iterable_to_array$5(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$5(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$5(o,minLen)}var instanceOfAny=function instanceOfAny(object,constructors){return constructors.some(function(c){return _instanceof$5(object,c)})};var idbProxyableTypes;var cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var cursorRequestMap=new WeakMap;var transactionDoneMap=new WeakMap;var transactionStoreNamesMap=new WeakMap;var transformCache=new WeakMap;var reverseTransformCache=new WeakMap;function promisifyRequest(request){var promise=new Promise(function(resolve,reject){var unlisten=function unlisten(){request.removeEventListener("success",success);request.removeEventListener("error",error)};var success=function success(){resolve(wrap(request.result));unlisten()};var error=function error(){reject(request.error);unlisten()};request.addEventListener("success",success);request.addEventListener("error",error)});promise.then(function(value){if(_instanceof$5(value,IDBCursor)){cursorRequestMap.set(value,request)}}).catch(function(){});reverseTransformCache.set(promise,request);return promise}function cacheDonePromiseForTransaction(tx){if(transactionDoneMap.has(tx))return;var done=new Promise(function(resolve,reject){var unlisten=function unlisten(){tx.removeEventListener("complete",complete);tx.removeEventListener("error",error);tx.removeEventListener("abort",error)};var complete=function complete(){resolve();unlisten()};var error=function error(){reject(tx.error||new DOMException("AbortError","AbortError"));unlisten()};tx.addEventListener("complete",complete);tx.addEventListener("error",error);tx.addEventListener("abort",error)});transactionDoneMap.set(tx,done)}var idbProxyTraps={get:function get(target,prop,receiver){if(_instanceof$5(target,IDBTransaction)){if(prop==="done")return transactionDoneMap.get(target);if(prop==="objectStoreNames"){return target.objectStoreNames||transactionStoreNamesMap.get(target)}if(prop==="store"){return receiver.objectStoreNames[1]?undefined:receiver.objectStore(receiver.objectStoreNames[0])}}return wrap(target[prop])},set:function set(target,prop,value){target[prop]=value;return true},has:function has(target,prop){if(_instanceof$5(target,IDBTransaction)&&(prop==="done"||prop==="store")){return true}return prop in target}};function replaceTraps(callback){idbProxyTraps=callback(idbProxyTraps)}function wrapFunction(func){if(func===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)){return function(storeNames){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var _func;var tx=(_func=func).call.apply(_func,[unwrap(this),storeNames].concat(_to_consumable_array$4(args)));transactionStoreNamesMap.set(tx,storeNames.sort?storeNames.sort():[storeNames]);return wrap(tx)}}if(getCursorAdvanceMethods().includes(func)){return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}func.apply(unwrap(this),args);return wrap(cursorRequestMap.get(this))}}return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return wrap(func.apply(unwrap(this),args))}}function transformCachableValue(value){if(typeof value==="function")return wrapFunction(value);if(_instanceof$5(value,IDBTransaction))cacheDonePromiseForTransaction(value);if(instanceOfAny(value,getIdbProxyableTypes()))return new Proxy(value,idbProxyTraps);return value}function wrap(value){if(_instanceof$5(value,IDBRequest))return promisifyRequest(value);if(transformCache.has(value))return transformCache.get(value);var newValue=transformCachableValue(value);if(newValue!==value){transformCache.set(value,newValue);reverseTransformCache.set(newValue,value)}return newValue}var unwrap=function unwrap(value){return reverseTransformCache.get(value)};function _array_like_to_array$4(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes$3(arr){if(Array.isArray(arr))return _array_like_to_array$4(arr)}function asyncGeneratorStep$5(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$5(fn){return function(){var _$self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(_$self,args);function _next(value){asyncGeneratorStep$5(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$5(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _define_property$4(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _instanceof$4(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _iterable_to_array$3(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _non_iterable_spread$3(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread$1(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_define_property$4(target,key,source[key])})}return target}function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _object_spread_props$1(target,source){source=source!=null?source:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys$1(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _to_consumable_array$3(arr){return _array_without_holes$3(arr)||_iterable_to_array$3(arr)||_unsupported_iterable_to_array$4(arr)||_non_iterable_spread$3()}function _unsupported_iterable_to_array$4(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$4(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$4(o,minLen)}function _ts_generator$3(thisArg,body){var f,_$y,t,g,_={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,_$y&&(t=op[0]&2?_$y["return"]:op[0]?_$y["throw"]||((t=_$y["return"])&&t.call(_$y),0):_$y.next)&&!(t=t.call(_$y,op[1])).done)return t;if(_$y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;_$y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];_$y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function openDB(name,version){var _ref=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},blocked=_ref.blocked,upgrade=_ref.upgrade,blocking=_ref.blocking,terminated=_ref.terminated;var request=indexedDB.open(name,version);var openPromise=wrap(request);if(upgrade){request.addEventListener("upgradeneeded",function(event){upgrade(wrap(request.result),event.oldVersion,event.newVersion,wrap(request.transaction),event)})}if(blocked){request.addEventListener("blocked",function(event){return blocked(event.oldVersion,event.newVersion,event)})}openPromise.then(function(db){if(terminated)db.addEventListener("close",function(){return terminated()});if(blocking){db.addEventListener("versionchange",function(event){return blocking(event.oldVersion,event.newVersion,event)})}}).catch(function(){});return openPromise}var readMethods=["get","getKey","getAll","getAllKeys","count"];var writeMethods=["put","add","delete","clear"];var cachedMethods=new Map;function getMethod(target,prop){if(!(_instanceof$4(target,IDBDatabase)&&!(prop in target)&&typeof prop==="string")){return}if(cachedMethods.get(prop))return cachedMethods.get(prop);var targetFuncName=prop.replace(/FromIndex$/,"");var useIndex=prop!==targetFuncName;var isWrite=writeMethods.includes(targetFuncName);if(!(targetFuncName in(useIndex?IDBIndex:IDBObjectStore).prototype)||!(isWrite||readMethods.includes(targetFuncName))){return}var method=function(){var _ref=_async_to_generator$5(function(storeName){var _len,args,_key,_target,tx,_$target;var _arguments=arguments;return _ts_generator$3(this,function(_state){switch(_state.label){case 0:for(_len=_arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=_arguments[_key]}tx=this.transaction(storeName,isWrite?"readwrite":"readonly");_$target=tx.store;if(useIndex)_$target=_$target.index(args.shift());return[4,Promise.all([(_target=_$target)[targetFuncName].apply(_target,_to_consumable_array$3(args)),isWrite&&tx.done])];case 1:return[2,_state.sent()[0]]}})});return function method(storeName){return _ref.apply(this,arguments)}}();cachedMethods.set(prop,method);return method}replaceTraps(function(oldTraps){return _object_spread_props$1(_object_spread$1({},oldTraps),{get:function get(target,prop,receiver){return getMethod(target,prop)||oldTraps.get(target,prop,receiver)},has:function has(target,prop){return!!getMethod(target,prop)||oldTraps.has(target,prop)}})});function _array_like_to_array$3(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes$2(arr){if(Array.isArray(arr))return _array_like_to_array$3(arr)}function asyncGeneratorStep$4(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$4(fn){return function(){var _$self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(_$self,args);function _next(value){asyncGeneratorStep$4(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$4(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _class_call_check$3(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties$3(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$3(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$3(Constructor.prototype,protoProps);if(staticProps)_defineProperties$3(Constructor,staticProps);return Constructor}function _define_property$3(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _instanceof$3(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _iterable_to_array$2(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _non_iterable_spread$2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array$2(arr){return _array_without_holes$2(arr)||_iterable_to_array$2(arr)||_unsupported_iterable_to_array$3(arr)||_non_iterable_spread$2()}function _unsupported_iterable_to_array$3(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$3(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$3(o,minLen)}function _ts_generator$2(thisArg,body){var f,_$y,t,g,_={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,_$y&&(t=op[0]&2?_$y["return"]:op[0]?_$y["throw"]||((t=_$y["return"])&&t.call(_$y),0):_$y.next)&&!(t=t.call(_$y,op[1])).done)return t;if(_$y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;_$y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];_$y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var PlatformLoggerServiceImpl=function(){function PlatformLoggerServiceImpl(container){_class_call_check$3(this,PlatformLoggerServiceImpl);this.container=container}_create_class$3(PlatformLoggerServiceImpl,[{key:"getPlatformInfoString",value:function getPlatformInfoString(){var providers=this.container.getProviders();return providers.map(function(provider){if(isVersionServiceProvider(provider)){var service=provider.getImmediate();return"".concat(service.library,"/").concat(service.version)}else{return null}}).filter(function(logString){return logString}).join(" ")}}]);return PlatformLoggerServiceImpl}();function isVersionServiceProvider(provider){var component=provider.getComponent();return(component===null||component===void 0?void 0:component.type)==="VERSION"}var name$o="@firebase/app";var version$1$1="0.9.27";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var logger=new Logger("@firebase/app");var name$n="@firebase/app-compat";var name$m="@firebase/analytics-compat";var name$l="@firebase/analytics";var name$k="@firebase/app-check-compat";var name$j="@firebase/app-check";var name$i="@firebase/auth";var name$h="@firebase/auth-compat";var name$g="@firebase/database";var name$f="@firebase/database-compat";var name$e="@firebase/functions";var name$d="@firebase/functions-compat";var name$c="@firebase/installations";var name$b="@firebase/installations-compat";var name$a="@firebase/messaging";var name$9="@firebase/messaging-compat";var name$8="@firebase/performance";var name$7="@firebase/performance-compat";var name$6="@firebase/remote-config";var name$5="@firebase/remote-config-compat";var name$4="@firebase/storage";var name$3="@firebase/storage-compat";var name$2="@firebase/firestore";var name$1$1="@firebase/firestore-compat";var name$p="firebase";var version$2="10.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DEFAULT_ENTRY_NAME="[DEFAULT]";var _obj$1;var PLATFORM_LOG_STRING=(_obj$1={},_define_property$3(_obj$1,name$o,"fire-core"),_define_property$3(_obj$1,name$n,"fire-core-compat"),_define_property$3(_obj$1,name$l,"fire-analytics"),_define_property$3(_obj$1,name$m,"fire-analytics-compat"),_define_property$3(_obj$1,name$j,"fire-app-check"),_define_property$3(_obj$1,name$k,"fire-app-check-compat"),_define_property$3(_obj$1,name$i,"fire-auth"),_define_property$3(_obj$1,name$h,"fire-auth-compat"),_define_property$3(_obj$1,name$g,"fire-rtdb"),_define_property$3(_obj$1,name$f,"fire-rtdb-compat"),_define_property$3(_obj$1,name$e,"fire-fn"),_define_property$3(_obj$1,name$d,"fire-fn-compat"),_define_property$3(_obj$1,name$c,"fire-iid"),_define_property$3(_obj$1,name$b,"fire-iid-compat"),_define_property$3(_obj$1,name$a,"fire-fcm"),_define_property$3(_obj$1,name$9,"fire-fcm-compat"),_define_property$3(_obj$1,name$8,"fire-perf"),_define_property$3(_obj$1,name$7,"fire-perf-compat"),_define_property$3(_obj$1,name$6,"fire-rc"),_define_property$3(_obj$1,name$5,"fire-rc-compat"),_define_property$3(_obj$1,name$4,"fire-gcs"),_define_property$3(_obj$1,name$3,"fire-gcs-compat"),_define_property$3(_obj$1,name$2,"fire-fst"),_define_property$3(_obj$1,name$1$1,"fire-fst-compat"),_define_property$3(_obj$1,"fire-js","fire-js"),_define_property$3(_obj$1,name$p,"fire-js-all"),_obj$1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _apps=new Map;var _components=new Map;function _addComponent(app,component){try{app.container.addComponent(component)}catch(e){logger.debug("Component ".concat(component.name," failed to register with FirebaseApp ").concat(app.name),e)}}function _registerComponent(component){var componentName=component.name;if(_components.has(componentName)){logger.debug("There were multiple attempts to register component ".concat(componentName,"."));return false}_components.set(componentName,component);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_apps.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var app=_step.value;_addComponent(app,component)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return true}function _getProvider(app,name){var heartbeatController=app.container.getProvider("heartbeat").getImmediate({optional:true});if(heartbeatController){void heartbeatController.triggerHeartbeat()}return app.container.getProvider(name)}var _obj1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ERRORS=(_obj1={},_define_property$3(_obj1,"no-app","No Firebase App '{$appName}' has been created - "+"call initializeApp() first"),_define_property$3(_obj1,"bad-app-name","Illegal App name: '{$appName}"),_define_property$3(_obj1,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),_define_property$3(_obj1,"app-deleted","Firebase App named '{$appName}' already deleted"),_define_property$3(_obj1,"no-options","Need to provide options, when not being deployed to hosting via source."),_define_property$3(_obj1,"invalid-app-argument","firebase.{$appName}() takes either no argument or a "+"Firebase App instance."),_define_property$3(_obj1,"invalid-log-argument","First argument to `onLog` must be null or a function."),_define_property$3(_obj1,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),_define_property$3(_obj1,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),_define_property$3(_obj1,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),_define_property$3(_obj1,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),_obj1);var ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FirebaseAppImpl=function(){function FirebaseAppImpl(options,config,container){var _this=this;_class_call_check$3(this,FirebaseAppImpl);this._isDeleted=false;this._options=Object.assign({},options);this._config=Object.assign({},config);this._name=config.name;this._automaticDataCollectionEnabled=config.automaticDataCollectionEnabled;this._container=container;this.container.addComponent(new Component("app",function(){return _this},"PUBLIC"))}_create_class$3(FirebaseAppImpl,[{key:"automaticDataCollectionEnabled",get:function get(){this.checkDestroyed();return this._automaticDataCollectionEnabled},set:function set(val){this.checkDestroyed();this._automaticDataCollectionEnabled=val}},{key:"name",get:function get(){this.checkDestroyed();return this._name}},{key:"options",get:function get(){this.checkDestroyed();return this._options}},{key:"config",get:function get(){this.checkDestroyed();return this._config}},{key:"container",get:function get(){return this._container}},{key:"isDeleted",get:function get(){return this._isDeleted},set:function set(val){this._isDeleted=val}},{key:"checkDestroyed",value:function checkDestroyed(){if(this.isDeleted){throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}}]);return FirebaseAppImpl}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SDK_VERSION=version$2;function initializeApp(_options){var rawConfig=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var options=_options;if(typeof rawConfig!=="object"){var name=rawConfig;rawConfig={name:name}}var config=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:false},rawConfig);var name1=config.name;if(typeof name1!=="string"||!name1){throw ERROR_FACTORY.create("bad-app-name",{appName:String(name1)})}options||(options=getDefaultAppConfig());if(!options){throw ERROR_FACTORY.create("no-options")}var existingApp=_apps.get(name1);if(existingApp){if(deepEqual(options,existingApp.options)&&deepEqual(config,existingApp.config)){return existingApp}else{throw ERROR_FACTORY.create("duplicate-app",{appName:name1})}}var container=new ComponentContainer(name1);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_components.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var component=_step.value;container.addComponent(component)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var newApp=new FirebaseAppImpl(options,config,container);_apps.set(name1,newApp);return newApp}function getApp(){var name=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_ENTRY_NAME;var app=_apps.get(name);if(!app&&name===DEFAULT_ENTRY_NAME&&getDefaultAppConfig()){return initializeApp()}if(!app){throw ERROR_FACTORY.create("no-app",{appName:name})}return app}function registerVersion(libraryKeyOrName,version,variant){var _a;var library=(_a=PLATFORM_LOG_STRING[libraryKeyOrName])!==null&&_a!==void 0?_a:libraryKeyOrName;if(variant){library+="-".concat(variant)}var libraryMismatch=library.match(/\s|\//);var versionMismatch=version.match(/\s|\//);if(libraryMismatch||versionMismatch){var warning=['Unable to register library "'.concat(library,'" with version "').concat(version,'":')];if(libraryMismatch){warning.push('library name "'.concat(library,'" contains illegal characters (whitespace or "/")'))}if(libraryMismatch&&versionMismatch){warning.push("and")}if(versionMismatch){warning.push('version name "'.concat(version,'" contains illegal characters (whitespace or "/")'))}logger.warn(warning.join(" "));return}_registerComponent(new Component("".concat(library,"-version"),function(){return{library:library,version:version}},"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DB_NAME$1="firebase-heartbeat-database";var DB_VERSION$1=1;var STORE_NAME="firebase-heartbeat-store";var dbPromise=null;function getDbPromise(){if(!dbPromise){dbPromise=openDB(DB_NAME$1,DB_VERSION$1,{upgrade:function upgrade(db,oldVersion){switch(oldVersion){case 0:try{db.createObjectStore(STORE_NAME)}catch(e){console.warn(e)}}}}).catch(function(e){throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:e.message})})}return dbPromise}function readHeartbeatsFromIndexedDB(app){return _readHeartbeatsFromIndexedDB.apply(this,arguments)}function _readHeartbeatsFromIndexedDB(){_readHeartbeatsFromIndexedDB=_async_to_generator$4(function(app){var db,tx,result,e,idbGetError;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);return[4,getDbPromise()];case 1:db=_state.sent();tx=db.transaction(STORE_NAME);return[4,tx.objectStore(STORE_NAME).get(computeKey(app))];case 2:result=_state.sent();return[4,tx.done];case 3:_state.sent();return[2,result];case 4:e=_state.sent();if(_instanceof$3(e,FirebaseError)){logger.warn(e.message)}else{idbGetError=ERROR_FACTORY.create("idb-get",{originalErrorMessage:e===null||e===void 0?void 0:e.message});logger.warn(idbGetError.message)}return[3,5];case 5:return[2]}})});return _readHeartbeatsFromIndexedDB.apply(this,arguments)}function writeHeartbeatsToIndexedDB(app,heartbeatObject){return _writeHeartbeatsToIndexedDB.apply(this,arguments)}function _writeHeartbeatsToIndexedDB(){_writeHeartbeatsToIndexedDB=_async_to_generator$4(function(app,heartbeatObject){var db,tx,objectStore,e,idbGetError;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);return[4,getDbPromise()];case 1:db=_state.sent();tx=db.transaction(STORE_NAME,"readwrite");objectStore=tx.objectStore(STORE_NAME);return[4,objectStore.put(heartbeatObject,computeKey(app))];case 2:_state.sent();return[4,tx.done];case 3:_state.sent();return[3,5];case 4:e=_state.sent();if(_instanceof$3(e,FirebaseError)){logger.warn(e.message)}else{idbGetError=ERROR_FACTORY.create("idb-set",{originalErrorMessage:e===null||e===void 0?void 0:e.message});logger.warn(idbGetError.message)}return[3,5];case 5:return[2]}})});return _writeHeartbeatsToIndexedDB.apply(this,arguments)}function computeKey(app){return"".concat(app.name,"!").concat(app.options.appId)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MAX_HEADER_BYTES=1024;var STORED_HEARTBEAT_RETENTION_MAX_MILLIS=30*24*60*60*1e3;var HeartbeatServiceImpl=function(){function HeartbeatServiceImpl(container){var _this=this;_class_call_check$3(this,HeartbeatServiceImpl);this.container=container;this._heartbeatsCache=null;var app=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(app);this._heartbeatsCachePromise=this._storage.read().then(function(result){_this._heartbeatsCache=result;return result})}_create_class$3(HeartbeatServiceImpl,[{key:"triggerHeartbeat",value:function triggerHeartbeat(){var _this=this;return _async_to_generator$4(function(){var _a,_b,platformLogger,agent,date;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:platformLogger=_this.container.getProvider("platform-logger").getImmediate();agent=platformLogger.getPlatformInfoString();date=getUTCDateString();if(!(((_a=_this._heartbeatsCache)===null||_a===void 0?void 0:_a.heartbeats)==null))return[3,2];return[4,_this._heartbeatsCachePromise];case 1:_this._heartbeatsCache=_state.sent();if(((_b=_this._heartbeatsCache)===null||_b===void 0?void 0:_b.heartbeats)==null){return[2]}_state.label=2;case 2:if(_this._heartbeatsCache.lastSentHeartbeatDate===date||_this._heartbeatsCache.heartbeats.some(function(singleDateHeartbeat){return singleDateHeartbeat.date===date})){return[2]}else{_this._heartbeatsCache.heartbeats.push({date:date,agent:agent})}_this._heartbeatsCache.heartbeats=_this._heartbeatsCache.heartbeats.filter(function(singleDateHeartbeat){var hbTimestamp=new Date(singleDateHeartbeat.date).valueOf();var now=Date.now();return now-hbTimestamp<=STORED_HEARTBEAT_RETENTION_MAX_MILLIS});return[2,_this._storage.overwrite(_this._heartbeatsCache)]}})})()}},{key:"getHeartbeatsHeader",value:function getHeartbeatsHeader(){var _this=this;return _async_to_generator$4(function(){var _a,date,_extractHeartbeatsForHeader,heartbeatsToSend,unsentEntries,headerString;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:if(!(_this._heartbeatsCache===null))return[3,2];return[4,_this._heartbeatsCachePromise];case 1:_state.sent();_state.label=2;case 2:if(((_a=_this._heartbeatsCache)===null||_a===void 0?void 0:_a.heartbeats)==null||_this._heartbeatsCache.heartbeats.length===0){return[2,""]}date=getUTCDateString();_extractHeartbeatsForHeader=extractHeartbeatsForHeader(_this._heartbeatsCache.heartbeats),heartbeatsToSend=_extractHeartbeatsForHeader.heartbeatsToSend,unsentEntries=_extractHeartbeatsForHeader.unsentEntries;headerString=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:heartbeatsToSend}));_this._heartbeatsCache.lastSentHeartbeatDate=date;if(!(unsentEntries.length>0))return[3,4];_this._heartbeatsCache.heartbeats=unsentEntries;return[4,_this._storage.overwrite(_this._heartbeatsCache)];case 3:_state.sent();return[3,5];case 4:_this._heartbeatsCache.heartbeats=[];void _this._storage.overwrite(_this._heartbeatsCache);_state.label=5;case 5:return[2,headerString]}})})()}}]);return HeartbeatServiceImpl}();function getUTCDateString(){var today=new Date;return today.toISOString().substring(0,10)}function extractHeartbeatsForHeader(heartbeatsCache){var maxSize=arguments.length>1&&arguments[1]!==void 0?arguments[1]:MAX_HEADER_BYTES;var heartbeatsToSend=[];var unsentEntries=heartbeatsCache.slice();var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var singleDateHeartbeat=_step.value;var heartbeatEntry=heartbeatsToSend.find(function(hb){return hb.agent===singleDateHeartbeat.agent});if(!heartbeatEntry){heartbeatsToSend.push({agent:singleDateHeartbeat.agent,dates:[singleDateHeartbeat.date]});if(countBytes(heartbeatsToSend)>maxSize){heartbeatsToSend.pop();return"break"}}else{heartbeatEntry.dates.push(singleDateHeartbeat.date);if(countBytes(heartbeatsToSend)>maxSize){heartbeatEntry.dates.pop();return"break"}}unsentEntries=unsentEntries.slice(1)};for(var _iterator=heartbeatsCache[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ret=_loop();if(_ret==="break")break}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return{heartbeatsToSend:heartbeatsToSend,unsentEntries:unsentEntries}}var HeartbeatStorageImpl=function(){function HeartbeatStorageImpl(app){_class_call_check$3(this,HeartbeatStorageImpl);this.app=app;this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}_create_class$3(HeartbeatStorageImpl,[{key:"runIndexedDBEnvironmentCheck",value:function runIndexedDBEnvironmentCheck(){return _async_to_generator$4(function(){return _ts_generator$2(this,function(_state){if(!isIndexedDBAvailable()){return[2,false]}else{return[2,validateIndexedDBOpenable().then(function(){return true}).catch(function(){return false})]}})})()}},{key:"read",value:function read(){var _this=this;return _async_to_generator$4(function(){var canUseIndexedDB,idbHeartbeatObject;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:return[4,_this._canUseIndexedDBPromise];case 1:canUseIndexedDB=_state.sent();if(!!canUseIndexedDB)return[3,2];return[2,{heartbeats:[]}];case 2:return[4,readHeartbeatsFromIndexedDB(_this.app)];case 3:idbHeartbeatObject=_state.sent();if(idbHeartbeatObject===null||idbHeartbeatObject===void 0?void 0:idbHeartbeatObject.heartbeats){return[2,idbHeartbeatObject]}else{return[2,{heartbeats:[]}]}case 4:return[2]}})})()}},{key:"overwrite",value:function overwrite(heartbeatsObject){var _this=this;return _async_to_generator$4(function(){var _a,canUseIndexedDB,existingHeartbeatsObject;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:return[4,_this._canUseIndexedDBPromise];case 1:canUseIndexedDB=_state.sent();if(!!canUseIndexedDB)return[3,2];return[2];case 2:return[4,_this.read()];case 3:existingHeartbeatsObject=_state.sent();return[2,writeHeartbeatsToIndexedDB(_this.app,{lastSentHeartbeatDate:(_a=heartbeatsObject.lastSentHeartbeatDate)!==null&&_a!==void 0?_a:existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:heartbeatsObject.heartbeats})];case 4:return[2]}})})()}},{key:"add",value:function add(heartbeatsObject){var _this=this;return _async_to_generator$4(function(){var _a,canUseIndexedDB,existingHeartbeatsObject;return _ts_generator$2(this,function(_state){switch(_state.label){case 0:return[4,_this._canUseIndexedDBPromise];case 1:canUseIndexedDB=_state.sent();if(!!canUseIndexedDB)return[3,2];return[2];case 2:return[4,_this.read()];case 3:existingHeartbeatsObject=_state.sent();return[2,writeHeartbeatsToIndexedDB(_this.app,{lastSentHeartbeatDate:(_a=heartbeatsObject.lastSentHeartbeatDate)!==null&&_a!==void 0?_a:existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:_to_consumable_array$2(existingHeartbeatsObject.heartbeats).concat(_to_consumable_array$2(heartbeatsObject.heartbeats))})];case 4:return[2]}})})()}}]);return HeartbeatStorageImpl}();function countBytes(heartbeatsCache){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:heartbeatsCache})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(variant){_registerComponent(new Component("platform-logger",function(container){return new PlatformLoggerServiceImpl(container)},"PRIVATE"));_registerComponent(new Component("heartbeat",function(container){return new HeartbeatServiceImpl(container)},"PRIVATE"));registerVersion(name$o,version$1$1,variant);registerVersion(name$o,version$1$1,"esm2017");registerVersion("fire-js","")}registerCoreComponents("");var name$1="firebase";var version$1="10.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");function _array_like_to_array$2(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes$2(arr){if(Array.isArray(arr))return arr}function _assert_this_initialized$2(self1){if(self1===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self1}function _class_call_check$2(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties$2(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$2(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$2(Constructor.prototype,protoProps);if(staticProps)_defineProperties$2(Constructor,staticProps);return Constructor}function _get$2(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get$2=Reflect.get}else{_get$2=function get(target,property,receiver){var base=_super_prop_base$2(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver||target)}return desc.value}}return _get$2(target,property,receiver||target)}function _get_prototype_of$2(o){_get_prototype_of$2=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _get_prototype_of$2(o)}function _inherits$2(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_set_prototype_of$2(subClass,superClass)}function _instanceof$2(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _iterable_to_array_limit$2(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest$2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possible_constructor_return$2(self1,call){if(call&&(_type_of$2(call)==="object"||typeof call==="function")){return call}return _assert_this_initialized$2(self1)}function _set_prototype_of$2(o,p){_set_prototype_of$2=Object.setPrototypeOf||function setPrototypeOf(o,p){o.__proto__=p;return o};return _set_prototype_of$2(o,p)}function _sliced_to_array$2(arr,i){return _array_with_holes$2(arr)||_iterable_to_array_limit$2(arr,i)||_unsupported_iterable_to_array$2(arr,i)||_non_iterable_rest$2()}function _super_prop_base$2(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_get_prototype_of$2(object);if(object===null)break}return object}function _type_of$2(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array$2(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$2(o,minLen)}function _is_native_reflect_construct$2(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super$2(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct$2();return function _createSuperInternal(){var Super=_get_prototype_of$2(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of$2(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possible_constructor_return$2(this,result)}}var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var k$1,goog=goog||{},l=commonjsGlobal||self;function aa(a){var b=typeof a==="undefined"?"undefined":_type_of$2(a);b="object"!=b?b:a?Array.isArray(a)?"array":b:"null";return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a==="undefined"?"undefined":_type_of$2(a);return"object"==b&&null!=a||"function"==b}function ba(a){return Object.prototype.hasOwnProperty.call(a,ca)&&a[ca]||(a[ca]=++da)}var ca="closure_uid_"+(1e9*Math.random()>>>0),da=0;function ea(a,b,c){return a.call.apply(a.bind,arguments)}function fa(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q$1(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?q$1=ea:q$1=fa;return q$1.apply(null,arguments)}function ha(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function r(a,b){function c(){}c.prototype=b.prototype;a.$=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.ac=function(d,e,f){for(var h=Array(arguments.length-2),n=2;n<arguments.length;n++)h[n-2]=arguments[n];return b.prototype[e].apply(d,h)}}function v$1(){this.s=this.s;this.o=this.o}var ia=0;v$1.prototype.s=!1;v$1.prototype.sa=function(){if(!this.s&&(this.s=!0,this.N(),0!=ia)){ba(this)}};v$1.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var ka=Array.prototype.indexOf?function ka(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function ka(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function ma(a){var b=a.length;if(0<b){var c=Array(b);for(var d=0;d<b;d++)c[d]=a[d];return c}return[]}function na(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(aa(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var h=0;h<f;h++)a[e+h]=d[h]}else a.push(d)}}function w$1(a,b){this.type=a;this.g=this.target=b;this.defaultPrevented=!1}w$1.prototype.h=function(){this.defaultPrevented=!0};var oa=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function get(){a=!0}});try{var c=function c(){};l.addEventListener("test",c,b);l.removeEventListener("test",c,b)}catch(c){}return a}();function x$1(a){return/^[\s\xa0]*$/.test(a)}function pa(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function y(a){return-1!=pa().indexOf(a)}function qa(a){qa[" "](a);return a}qa[" "]=function(){};function ra(a,b){var c=sa;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}var ta=y("Opera"),z$1=y("Trident")||y("MSIE"),ua=y("Edge"),va=ua||z$1,wa=y("Gecko")&&!(-1!=pa().toLowerCase().indexOf("webkit")&&!y("Edge"))&&!(y("Trident")||y("MSIE"))&&!y("Edge"),xa=-1!=pa().toLowerCase().indexOf("webkit")&&!y("Edge");function ya(){var a=l.document;return a?a.documentMode:void 0}var za;a:{var Aa="",Ba=function(){var a=pa();if(wa)return/rv:([^\);]+)(\)|;)/.exec(a);if(ua)return/Edge\/([\d\.]+)/.exec(a);if(z$1)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(xa)return/WebKit\/(\S+)/.exec(a);if(ta)return/(?:Version)[ \/]?(\S+)/.exec(a)}();Ba&&(Aa=Ba?Ba[1]:"");if(z$1){var Ca=ya();if(null!=Ca&&Ca>parseFloat(Aa)){za=String(Ca);break a}}za=Aa}var Da;if(l.document&&z$1){var Ea=ya();Da=Ea?Ea:parseInt(za,10)||void 0}else Da=void 0;var Fa=Da;function A(a,b){w$1.call(this,a?a.type:"");this.relatedTarget=this.g=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.i=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.g=b;if(b=a.relatedTarget){if(wa){a:{try{qa(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:Ga[a.pointerType]||"";this.state=a.state;this.i=a;a.defaultPrevented&&A.$.h.call(this)}}r(A,w$1);var Ga={2:"touch",3:"pen",4:"mouse"};A.prototype.h=function(){A.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ha="closure_listenable_"+(1e6*Math.random()|0);var Ia=0;function Ja(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.la=e;this.key=++Ia;this.fa=this.ia=!1}function Ma(a){a.fa=!0;a.listener=null;a.proxy=null;a.src=null;a.la=null}function Na(a,b,c){for(var d in a)b.call(c,a[d],d,a)}function Oa(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function Pa(a){var b={};for(var c in a)b[c]=a[c];return b}var Qa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ra(a,b){var c,d;for(var e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Qa.length;f++)c=Qa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Sa(a){this.src=a;this.g={};this.h=0}Sa.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.g[f];a||(a=this.g[f]=[],this.h++);var h=Ta(a,b,d,e);-1<h?(b=a[h],c||(b.ia=!1)):(b=new Ja(b,this.src,f,!!d,e),b.ia=c,a.push(b));return b};function Ua(a,b){var c=b.type;if(c in a.g){var d=a.g[c],e=ka(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Ma(b),0==a.g[c].length&&(delete a.g[c],a.h--))}}function Ta(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.fa&&f.listener==b&&f.capture==!!c&&f.la==d)return e}return-1}var Va="closure_lm_"+(1e6*Math.random()|0),Wa={};function Ya(a,b,c,d,e){if(d&&d.once)return Za(a,b,c,d,e);if(Array.isArray(b)){for(var f=0;f<b.length;f++)Ya(a,b[f],c,d,e);return null}c=$a(c);return a&&a[Ha]?a.O(b,c,p(d)?!!d.capture:!!d,e):ab(a,b,c,!1,d,e)}function ab(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var h=p(e)?!!e.capture:!!e,n=bb(a);n||(a[Va]=n=new Sa(a));c=n.add(b,c,d,h,f);if(c.proxy)return c;d=cb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)oa||(e=h),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(db$1(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function cb(){function a(c){return b.call(a.src,a.listener,c)}var b=eb;return a}function Za(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)Za(a,b[f],c,d,e);return null}c=$a(c);return a&&a[Ha]?a.P(b,c,p(d)?!!d.capture:!!d,e):ab(a,b,c,!0,d,e)}function fb(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)fb(a,b[f],c,d,e);else(d=p(d)?!!d.capture:!!d,c=$a(c),a&&a[Ha])?(a=a.i,b=String(b).toString(),b in a.g&&(f=a.g[b],c=Ta(f,c,d,e),-1<c&&(Ma(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.g[b],a.h--)))):a&&(a=bb(a))&&(b=a.g[b.toString()],a=-1,b&&(a=Ta(b,c,d,e)),(c=-1<a?b[a]:null)&&gb(c))}function gb(a){if("number"!==typeof a&&a&&!a.fa){var b=a.src;if(b&&b[Ha])Ua(b.i,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(db$1(c),d):b.addListener&&b.removeListener&&b.removeListener(d);(c=bb(b))?(Ua(c,a),0==c.h&&(c.src=null,b[Va]=null)):Ma(a)}}}function db$1(a){return a in Wa?Wa[a]:Wa[a]="on"+a}function eb(a,b){if(a.fa)a=!0;else{b=new A(b,this);var c=a.listener,d=a.la||a.src;a.ia&&gb(a);a=c.call(d,b)}return a}function bb(a){a=a[Va];return _instanceof$2(a,Sa)?a:null}var hb="__closure_events_fn_"+(1e9*Math.random()>>>0);function $a(a){if("function"===typeof a)return a;a[hb]||(a[hb]=function(b){return a.handleEvent(b)});return a[hb]}function B$1(){v$1.call(this);this.i=new Sa(this);this.S=this;this.J=null}r(B$1,v$1);B$1.prototype[Ha]=!0;B$1.prototype.removeEventListener=function(a,b,c,d){fb(this,a,b,c,d)};function C$1(a,b){var c,d=a.J;if(d)for(c=[];d;d=d.J)c.push(d);a=a.S;d=b.type||b;if("string"===typeof b)b=new w$1(b,a);else if(_instanceof$2(b,w$1))b.target=b.target||a;else{var e=b;b=new w$1(d,a);Ra(b,e)}e=!0;if(c)for(var f=c.length-1;0<=f;f--){var h=b.g=c[f];e=ib(h,d,!0,b)&&e}h=b.g=a;e=ib(h,d,!0,b)&&e;e=ib(h,d,!1,b)&&e;if(c)for(f=0;f<c.length;f++)h=b.g=c[f],e=ib(h,d,!1,b)&&e}B$1.prototype.N=function(){B$1.$.N.call(this);if(this.i){var a=this.i,c;for(c in a.g){for(var d=a.g[c],e=0;e<d.length;e++)Ma(d[e]);delete a.g[c];a.h--}}this.J=null};B$1.prototype.O=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)};B$1.prototype.P=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};function ib(a,b,c,d){b=a.i.g[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var h=b[f];if(h&&!h.fa&&h.capture==c){var n=h.listener,t=h.la||h.src;h.ia&&Ua(a.i,h);e=!1!==n.call(t,d)&&e}}return e&&!d.defaultPrevented}var jb=l.JSON.stringify;var kb=function(){function kb(a,b){_class_call_check$2(this,kb);this.i=a;this.j=b;this.h=0;this.g=null}_create_class$2(kb,[{key:"get",value:function get(){var a;0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i();return a}}]);return kb}();function lb(){var a=mb;var b=null;a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null);return b}var nb=function(){function nb(){_class_call_check$2(this,nb);this.h=this.g=null}_create_class$2(nb,[{key:"add",value:function add(a,b){var c=ob.get();c.set(a,b);this.h?this.h.next=c:this.g=c;this.h=c}}]);return nb}();var ob=new kb(function(){return new pb},function(a){return a.reset()});var pb=function(){function pb(){_class_call_check$2(this,pb);this.next=this.g=this.h=null}_create_class$2(pb,[{key:"set",value:function set(a,b){this.h=a;this.g=b;this.next=null}},{key:"reset",value:function reset(){this.next=this.g=this.h=null}}]);return pb}();function qb(a){var b=1;a=a.split(":");var c=[];for(;0<b&&a.length;)c.push(a.shift()),b--;a.length&&c.push(a.join(":"));return c}function rb(a){l.setTimeout(function(){throw a},0)}var sb,tb=!1,mb=new nb,vb=function vb(){var a=l.Promise.resolve(void 0);sb=function sb(){a.then(ub)}};var ub=function ub(){for(var a;a=lb();){try{a.h.call(a.g)}catch(c){rb(c)}var b=ob;b.j(a);100>b.h&&(b.h++,a.next=b.g,b.g=a)}tb=!1};function wb(a,b){B$1.call(this);this.h=a||1;this.g=b||l;this.j=q$1(this.qb,this);this.l=Date.now()}r(wb,B$1);k$1=wb.prototype;k$1.ga=!1;k$1.T=null;k$1.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),C$1(this,"tick"),this.ga&&(xb(this),this.start()))}};k$1.start=function(){this.ga=!0;this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function xb(a){a.ga=!1;a.T&&(a.g.clearTimeout(a.T),a.T=null)}k$1.N=function(){wb.$.N.call(this);xb(this);delete this.g};function yb(a,b,c){if("function"===typeof a)c&&(a=q$1(a,c));else if(a&&"function"==typeof a.handleEvent)a=q$1(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function zb(a){a.g=yb(function(){a.g=null;a.i&&(a.i=!1,zb(a))},a.j);var b=a.h;a.h=null;a.m.apply(null,b)}var Ab=function(v){_inherits$2(Ab,v);var _super=_create_super$2(Ab);function Ab(a,b){_class_call_check$2(this,Ab);var _this;_this=_super.call(this);_this.m=a;_this.j=b;_this.h=null;_this.i=!1;_this.g=null;return _this}_create_class$2(Ab,[{key:"l",value:function l(a){this.h=arguments;this.g?this.i=!0:zb(this)}},{key:"N",value:function N(){_get$2(_get_prototype_of$2(Ab.prototype),"N",this).call(this);this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]);return Ab}(v$1);function Bb(a){v$1.call(this);this.h=a;this.g={}}r(Bb,v$1);var Cb=[];function Eb(a,b,c,d){Array.isArray(c)||(c&&(Cb[0]=c.toString()),c=Cb);for(var e=0;e<c.length;e++){var f=Ya(b,c[e],d||a.handleEvent,!1,a.h||a);if(!f)break;a.g[f.key]=f}}function Fb(a){Na(a.g,function(b,c){this.g.hasOwnProperty(c)&&gb(b)},a);a.g={}}Bb.prototype.N=function(){Bb.$.N.call(this);Fb(this)};Bb.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Gb(){this.g=!0}Gb.prototype.Ea=function(){this.g=!1};function Hb(a,b,c,d,e,f){a.info(function(){if(a.g)if(f){var h="";for(var n=f.split("&"),t=0;t<n.length;t++){var m=n[t].split("=");if(1<m.length){var u=m[0];m=m[1];var L=u.split("_");h=2<=L.length&&"type"==L[1]?h+(u+"="+m+"&"):h+(u+"=redacted&")}}}else h=null;else h=f;return"XMLHTTP REQ ("+d+") [attempt "+e+"]: "+b+"\n"+c+"\n"+h})}function Ib(a,b,c,d,e,f,h){a.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+h})}function D$1(a,b,c,d){a.info(function(){return"XMLHTTP TEXT ("+b+"): "+Jb(a,c)+(d?" "+d:"")})}function Kb(a,b){a.info(function(){return"TIMEOUT: "+b})}Gb.prototype.info=function(){};function Jb(a,b){if(!a.g)return b;if(!b)return null;try{var c=JSON.parse(b);if(c){for(a=0;a<c.length;a++)if(Array.isArray(c[a])){var d=c[a];if(!(2>d.length)){var e=d[1];if(Array.isArray(e)&&!(1>e.length)){var f=e[0];if("noop"!=f&&"stop"!=f&&"close"!=f)for(var h=1;h<e.length;h++)e[h]=""}}}}return jb(c)}catch(n){return b}}var E={},Lb=null;function Mb(){return Lb=Lb||new B$1}E.Ta="serverreachability";function Nb(a){w$1.call(this,E.Ta,a)}r(Nb,w$1);function Ob(a){var b=Mb();C$1(b,new Nb(b))}E.STAT_EVENT="statevent";function Pb(a,b){w$1.call(this,E.STAT_EVENT,a);this.stat=b}r(Pb,w$1);function F$1(a){var b=Mb();C$1(b,new Pb(b,a))}E.Ua="timingevent";function Qb(a,b){w$1.call(this,E.Ua,a);this.size=b}r(Qb,w$1);function Rb(a,b){if("function"!==typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},b)}var Sb={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9};var Tb={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ub(){}Ub.prototype.h=null;function Vb(a){return a.h||(a.h=a.i())}function Wb(){}var Xb={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Yb(){w$1.call(this,"d")}r(Yb,w$1);function Zb(){w$1.call(this,"c")}r(Zb,w$1);var $b;function ac(){}r(ac,Ub);ac.prototype.g=function(){return new XMLHttpRequest};ac.prototype.i=function(){return{}};$b=new ac;function bc(a,b,c,d){this.l=a;this.j=b;this.m=c;this.W=d||1;this.U=new Bb(this);this.P=cc;a=va?125:void 0;this.V=new wb(a);this.I=null;this.i=!1;this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null;this.F=[];this.g=null;this.o=0;this.s=this.v=null;this.ca=-1;this.J=!1;this.O=0;this.M=null;this.ba=this.K=this.aa=this.S=!1;this.h=new dc}function dc(){this.i=null;this.g="";this.h=!1}var cc=45e3,ec={},fc={};k$1=bc.prototype;k$1.setTimeout=function(a){this.P=a};function gc(a,b,c){a.L=1;a.A=hc(G$1(b));a.u=c;a.S=!0;ic(a,null)}function ic(a,b){a.G=Date.now();jc(a);a.B=G$1(a.A);var c=a.B,d=a.W;Array.isArray(d)||(d=[String(d)]);kc(c.i,"t",d);a.o=0;c=a.l.J;a.h=new dc;a.g=lc(a.l,c?b:null,!a.u);0<a.O&&(a.M=new Ab(q$1(a.Pa,a,a.g),a.O));Eb(a.U,a.g,"readystatechange",a.nb);b=a.I?Pa(a.I):{};a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.B,a.v,a.u,b)):(a.v="GET",a.g.ha(a.B,a.v,null,b));Ob();Hb(a.j,a.v,a.B,a.m,a.W,a.u)}k$1.nb=function(a){a=a.target;var b=this.M;b&&3==H$1(a)?b.l():this.Pa(a)};k$1.Pa=function(a){try{if(a==this.g)a:{var u=H$1(this.g);var b=this.g.Ia();var L=this.g.da();if(!(3>u)&&(3!=u||va||this.g&&(this.h.h||this.g.ja()||mc(this.g)))){this.J||4!=u||7==b||(8==b||0>=L?Ob(3):Ob(2));nc(this);var c=this.g.da();this.ca=c;b:if(oc(this)){var d=mc(this.g);a="";var e=d.length,f=4==H$1(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){I(this);pc(this);var h="";break b}this.h.i=new l.TextDecoder}for(b=0;b<e;b++)this.h.h=!0,a+=this.h.i.decode(d[b],{stream:f&&b==e-1});d.length=0;this.h.g+=a;this.o=0;h=this.h.g}else h=this.g.ja();this.i=200==c;Ib(this.j,this.v,this.B,this.m,this.W,u,c);if(this.i){if(this.aa&&!this.K){b:{if(this.g){var n,t=this.g;if((n=t.g?t.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x$1(n)){var m=n;break b}}m=null}if(c=m)D$1(this.j,this.m,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qc(this,c);else{this.i=!1;this.s=3;F$1(12);I(this);pc(this);break a}}this.S?(rc(this,u,h),va&&this.i&&3==u&&(Eb(this.U,this.V,"tick",this.mb),this.V.start())):(D$1(this.j,this.m,h,null),qc(this,h));4==u&&I(this);this.i&&!this.J&&(4==u?sc(this.l,this):(this.i=!1,jc(this)))}else tc(this.g),400==c&&0<h.indexOf("Unknown SID")?(this.s=3,F$1(12)):(this.s=0,F$1(13)),I(this),pc(this)}}}catch(u){}finally{}};function oc(a){return a.g?"GET"==a.v&&2!=a.L&&a.l.Ha:!1}function rc(a,b,c){var d=!0,e;for(;!a.J&&a.o<c.length;)if(e=uc(a,c),e==fc){4==b&&(a.s=4,F$1(14),d=!1);D$1(a.j,a.m,null,"[Incomplete Response]");break}else if(e==ec){a.s=4;F$1(15);D$1(a.j,a.m,c,"[Invalid Chunk]");d=!1;break}else D$1(a.j,a.m,e,null),qc(a,e);oc(a)&&0!=a.o&&(a.h.g=a.h.g.slice(a.o),a.o=0);4!=b||0!=c.length||a.h.h||(a.s=1,F$1(16),d=!1);a.i=a.i&&d;d?0<c.length&&!a.ba&&(a.ba=!0,b=a.l,b.g==a&&b.ca&&!b.M&&(b.l.info("Great, no buffering proxy detected. Bytes received: "+c.length),vc(b),b.M=!0,F$1(11))):(D$1(a.j,a.m,c,"[Invalid Chunked Response]"),I(a),pc(a))}k$1.mb=function(){if(this.g){var a=H$1(this.g),b=this.g.ja();this.o<b.length&&(nc(this),rc(this,a,b),this.i&&4!=a&&jc(this))}};function uc(a,b){var c=a.o,d=b.indexOf("\n",c);if(-1==d)return fc;c=Number(b.substring(c,d));if(isNaN(c))return ec;d+=1;if(d+c>b.length)return fc;b=b.slice(d,d+c);a.o=d+c;return b}k$1.cancel=function(){this.J=!0;I(this)};function jc(a){a.Y=Date.now()+a.P;wc(a,a.P)}function wc(a,b){if(null!=a.C)throw Error("WatchDog timer not null");a.C=Rb(q$1(a.lb,a),b)}function nc(a){a.C&&(l.clearTimeout(a.C),a.C=null)}k$1.lb=function(){this.C=null;var a=Date.now();0<=a-this.Y?(Kb(this.j,this.B),2!=this.L&&(Ob(),F$1(17)),I(this),this.s=2,pc(this)):wc(this,this.Y-a)};function pc(a){0==a.l.H||a.J||sc(a.l,a)}function I(a){nc(a);var b=a.M;b&&"function"==typeof b.sa&&b.sa();a.M=null;xb(a.V);Fb(a.U);a.g&&(b=a.g,a.g=null,b.abort(),b.sa())}function qc(a,b){try{var c=a.l;if(0!=c.H&&(c.g==a||xc(c.i,a))){if(!a.K&&xc(c.i,a)&&3==c.H){try{var d=c.Ja.g.parse(b)}catch(m){d=null}if(Array.isArray(d)&&3==d.length){var e=d;if(0==e[0])a:{if(!c.u){if(c.g)if(c.g.G+3e3<a.G)yc(c),zc(c);else break a;Ac(c);F$1(18)}}else c.Fa=e[1],0<c.Fa-c.V&&37500>e[2]&&c.G&&0==c.A&&!c.v&&(c.v=Rb(q$1(c.ib,c),6e3));if(1>=Bc(c.i)&&c.oa){try{c.oa()}catch(m){}c.oa=void 0}}else J$1(c,11)}else if((a.K||c.g==a)&&yc(c),!x$1(b))for(e=c.Ja.g.parse(b),b=0;b<e.length;b++){var m=e[b];c.V=m[0];m=m[1];if(2==c.H)if("c"==m[0]){c.K=m[1];c.pa=m[2];var u=m[3];null!=u&&(c.ra=u,c.l.info("VER="+c.ra));var L=m[4];null!=L&&(c.Ga=L,c.l.info("SVER="+c.Ga));var Ka=m[5];null!=Ka&&"number"===typeof Ka&&0<Ka&&(d=1.5*Ka,c.L=d,c.l.info("backChannelRequestTimeoutMs_="+d));d=c;var la=a.g;if(la){var La=la.g?la.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(La){var f=d.i;f.g||-1==La.indexOf("spdy")&&-1==La.indexOf("quic")&&-1==La.indexOf("h2")||(f.j=f.l,f.g=new Set,f.h&&(Cc(f,f.h),f.h=null))}if(d.F){var Db=la.g?la.g.getResponseHeader("X-HTTP-Session-Id"):null;Db&&(d.Da=Db,K$1(d.I,d.F,Db))}}c.H=3;c.h&&c.h.Ba();c.ca&&(c.S=Date.now()-a.G,c.l.info("Handshake RTT: "+c.S+"ms"));d=c;var h=a;d.wa=Dc(d,d.J?d.pa:null,d.Y);if(h.K){Ec(d.i,h);var n=h,t=d.L;t&&n.setTimeout(t);n.C&&(nc(n),jc(n));d.g=h}else Fc(d);0<c.j.length&&Gc(c)}else"stop"!=m[0]&&"close"!=m[0]||J$1(c,7);else 3==c.H&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?J$1(c,7):Hc(c):"noop"!=m[0]&&c.h&&c.h.Aa(m),c.A=0)}}Ob(4)}catch(m){}}function Ic(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!==typeof Map&&_instanceof$2(a,Map)||"undefined"!==typeof Set&&_instanceof$2(a,Set))return Array.from(a.values());if("string"===typeof a)return a.split("");if(aa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}b=[];c=0;for(d in a)b[c++]=a[d];return b}function Jc(a){if(a.ta&&"function"==typeof a.ta)return a.ta();if(!a.Z||"function"!=typeof a.Z){if("undefined"!==typeof Map&&_instanceof$2(a,Map))return Array.from(a.keys());if(!("undefined"!==typeof Set&&_instanceof$2(a,Set))){if(aa(a)||"string"===typeof a){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}b=[];c=0;for(var d in a)b[c++]=d;return b}}}function Kc(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(aa(a)||"string"===typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var c=Jc(a),d=Ic(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}var Lc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mc(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}}function M$1(a){this.g=this.s=this.j="";this.m=null;this.o=this.l="";this.h=!1;if(_instanceof$2(a,M$1)){this.h=a.h;Nc(this,a.j);this.s=a.s;this.g=a.g;Oc(this,a.m);this.l=a.l;var b=a.i;var c=new Pc;c.i=b.i;b.g&&(c.g=new Map(b.g),c.h=b.h);Qc(this,c);this.o=a.o}else a&&(b=String(a).match(Lc))?(this.h=!1,Nc(this,b[1]||"",!0),this.s=Rc(b[2]||""),this.g=Rc(b[3]||"",!0),Oc(this,b[4]),this.l=Rc(b[5]||"",!0),Qc(this,b[6]||"",!0),this.o=Rc(b[7]||"")):(this.h=!1,this.i=new Pc(null,this.h))}M$1.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Sc(b,Tc,!0),":");var c=this.g;if(c||"file"==b)a.push("//"),(b=this.s)&&a.push(Sc(b,Tc,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.m,null!=c&&a.push(":",String(c));if(c=this.l)this.g&&"/"!=c.charAt(0)&&a.push("/"),a.push(Sc(c,"/"==c.charAt(0)?Uc:Vc,!0));(c=this.i.toString())&&a.push("?",c);(c=this.o)&&a.push("#",Sc(c,Wc));return a.join("")};function G$1(a){return new M$1(a)}function Nc(a,b,c){a.j=c?Rc(b,!0):b;a.j&&(a.j=a.j.replace(/:$/,""))}function Oc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Qc(a,b,c){_instanceof$2(b,Pc)?(a.i=b,Xc(a.i,a.h)):(c||(b=Sc(b,Yc)),a.i=new Pc(b,a.h))}function K$1(a,b,c){a.i.set(b,c)}function hc(a){K$1(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36));return a}function Rc(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Sc(a,b,c){return"string"===typeof a?(a=encodeURI(a).replace(b,Zc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Zc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Tc=/[#\/\?@]/g,Vc=/[#\?:]/g,Uc=/[#\?]/g,Yc=/[#\?@]/g,Wc=/#/g;function Pc(a,b){this.h=this.g=null;this.i=a||null;this.j=!!b}function N$1(a){a.g||(a.g=new Map,a.h=0,a.i&&Mc(a.i,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}k$1=Pc.prototype;k$1.add=function(a,b){N$1(this);this.i=null;a=O$1(this,a);var c=this.g.get(a);c||this.g.set(a,c=[]);c.push(b);this.h+=1;return this};function $c(a,b){N$1(a);b=O$1(a,b);a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function ad(a,b){N$1(a);b=O$1(a,b);return a.g.has(b)}k$1.forEach=function(a,b){N$1(this);this.g.forEach(function(c,d){c.forEach(function(e){a.call(b,e,d,this)},this)},this)};k$1.ta=function(){N$1(this);var a=Array.from(this.g.values()),b=Array.from(this.g.keys()),c=[];for(var d=0;d<b.length;d++){var e=a[d];for(var f=0;f<e.length;f++)c.push(b[d])}return c};k$1.Z=function(a){N$1(this);var b=[];if("string"===typeof a)ad(this,a)&&(b=b.concat(this.g.get(O$1(this,a))));else{a=Array.from(this.g.values());for(var c=0;c<a.length;c++)b=b.concat(a[c])}return b};k$1.set=function(a,b){N$1(this);this.i=null;a=O$1(this,a);ad(this,a)&&(this.h-=this.g.get(a).length);this.g.set(a,[b]);this.h+=1;return this};k$1.get=function(a,b){if(!a)return b;a=this.Z(a);return 0<a.length?String(a[0]):b};function kc(a,b,c){$c(a,b);0<c.length&&(a.i=null,a.g.set(O$1(a,b),ma(c)),a.h+=c.length)}k$1.toString=function(){if(this.i)return this.i;if(!this.g)return"";var a=[],b=Array.from(this.g.keys());for(var c=0;c<b.length;c++){var d=b[c];var f=encodeURIComponent(String(d)),h=this.Z(d);for(d=0;d<h.length;d++){var e=f;""!==h[d]&&(e+="="+encodeURIComponent(String(h[d])));a.push(e)}}return this.i=a.join("&")};function O$1(a,b){b=String(b);a.j&&(b=b.toLowerCase());return b}function Xc(a,b){b&&!a.j&&(N$1(a),a.i=null,a.g.forEach(function(c,d){var e=d.toLowerCase();d!=e&&($c(this,d),kc(this,e,c))},a));a.j=b}var bd=function bd(a,b){_class_call_check$2(this,bd);this.g=a;this.map=b};function cd(a){this.l=a||dd;l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol)):a=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().dc);this.j=a?this.l:1;this.g=null;1<this.j&&(this.g=new Set);this.h=null;this.i=[]}var dd=10;function ed(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Bc(a){return a.h?1:a.g?a.g.size:0}function xc(a,b){return a.h?a.h==b:a.g?a.g.has(b):!1}function Cc(a,b){a.g?a.g.add(b):a.h=b}function Ec(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}cd.prototype.cancel=function(){this.i=fd(this);if(this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.g.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var a=_step.value;a.cancel()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.g.clear()}};function fd(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){var b=a.i;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=a.g.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;b=b.concat(c.F)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return b}return ma(a.i)}var gd=function(){function gd(){_class_call_check$2(this,gd)}_create_class$2(gd,[{key:"stringify",value:function stringify(a){return l.JSON.stringify(a,void 0)}},{key:"parse",value:function parse(a){return l.JSON.parse(a,void 0)}}]);return gd}();function hd(){this.g=new gd}function id(a,b,c){var d=c||"";try{Kc(a,function(e,f){var h=e;p(e)&&(h=jb(e));b.push(d+f+"="+encodeURIComponent(h))})}catch(e){throw b.push(d+"type="+encodeURIComponent("_badmap")),e}}function jd(a,b){var c=new Gb;if(l.Image){var d=new Image;d.onload=ha(kd,c,d,"TestLoadImage: loaded",!0,b);d.onerror=ha(kd,c,d,"TestLoadImage: error",!1,b);d.onabort=ha(kd,c,d,"TestLoadImage: abort",!1,b);d.ontimeout=ha(kd,c,d,"TestLoadImage: timeout",!1,b);l.setTimeout(function(){if(d.ontimeout)d.ontimeout()},1e4);d.src=a}else b(!1)}function kd(a,b,c,d,e){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,e(d)}catch(f){}}function ld(a){this.l=a.ec||null;this.j=a.ob||!1}r(ld,Ub);ld.prototype.g=function(){return new md(this.l,this.j)};ld.prototype.i=function(a){return function(){return a}}({});function md(a,b){B$1.call(this);this.F=a;this.u=b;this.m=void 0;this.readyState=nd;this.status=0;this.responseType=this.responseText=this.response=this.statusText="";this.onreadystatechange=null;this.v=new Headers;this.h=null;this.C="GET";this.B="";this.g=!1;this.A=this.j=this.l=null}r(md,B$1);var nd=0;k$1=md.prototype;k$1.open=function(a,b){if(this.readyState!=nd)throw this.abort(),Error("Error reopening a connection");this.C=a;this.B=b;this.readyState=1;od(this)};k$1.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a);(this.F||l).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))};k$1.abort=function(){this.response=this.responseText="";this.v=new Headers;this.status=0;this.j&&this.j.cancel("Request was aborted.").catch(function(){});1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,pd(this));this.readyState=nd};k$1.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,od(this)),this.g&&(this.readyState=3,od(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof l.ReadableStream&&"body"in a){this.j=a.body.getReader();if(this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qd(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))};function qd(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}k$1.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);if(b=this.A.decode(b,{stream:!a.done}))this.response=this.responseText+=b}a.done?pd(this):od(this);3==this.readyState&&qd(this)}};k$1.Za=function(a){this.g&&(this.response=this.responseText=a,pd(this))};k$1.Ya=function(a){this.g&&(this.response=a,pd(this))};k$1.ka=function(){this.g&&pd(this)};function pd(a){a.readyState=4;a.l=null;a.j=null;a.A=null;od(a)}k$1.setRequestHeader=function(a,b){this.v.append(a,b)};k$1.getResponseHeader=function(a){return this.h?this.h.get(a.toLowerCase())||"":""};k$1.getAllResponseHeaders=function(){if(!this.h)return"";var a=[],b=this.h.entries();for(var c=b.next();!c.done;)c=c.value,a.push(c[0]+": "+c[1]),c=b.next();return a.join("\r\n")};function od(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(md.prototype,"withCredentials",{get:function get(){return"include"===this.m},set:function set(a){this.m=a?"include":"same-origin"}});var rd=l.JSON.parse;function P(a){B$1.call(this);this.headers=new Map;this.u=a||null;this.h=!1;this.C=this.g=null;this.I="";this.m=0;this.j="";this.l=this.G=this.v=this.F=!1;this.B=0;this.A=null;this.K=sd;this.L=this.M=!1}r(P,B$1);var sd="",td=/^https?$/i,ud=["POST","PUT"];k$1=P.prototype;k$1.Oa=function(a){this.M=a};k$1.ha=function(a,b,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET";this.I=a;this.j="";this.m=0;this.F=!1;this.h=!0;this.g=this.u?this.u.g():$b.g();this.C=this.u?Vb(this.u):Vb($b);this.g.onreadystatechange=q$1(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(f){vd(this,f);return}a=c||"";c=new Map(this.headers);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(d)if(Object.getPrototypeOf(d)===Object.prototype)for(var e in d)c.set(e,d[e]);else if("function"===typeof d.keys&&"function"===typeof d.get)try{for(var _iterator=d.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$f=_step.value;c.set(_$f,d.get(_$f))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(c.keys()).find(function(f){return"content-type"==f.toLowerCase()});e=l.FormData&&_instanceof$2(a,l.FormData);!(0<=ka(ud,b))||d||e||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=c[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var _step_value=_sliced_to_array$2(_step1.value,2),_$f1=_step_value[0],h=_step_value[1];this.g.setRequestHeader(_$f1,h)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}this.K&&(this.g.responseType=this.K);"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wd(this),0<this.B&&((this.L=xd(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q$1(this.ua,this)):this.A=yb(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(f){vd(this,f)}};function xd(a){return z$1&&"number"===typeof a.timeout&&void 0!==a.ontimeout}k$1.ua=function(){"undefined"!=typeof goog&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,C$1(this,"timeout"),this.abort(8))};function vd(a,b){a.h=!1;a.g&&(a.l=!0,a.g.abort(),a.l=!1);a.j=b;a.m=5;yd(a);zd(a)}function yd(a){a.F||(a.F=!0,C$1(a,"complete"),C$1(a,"error"))}k$1.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,C$1(this,"complete"),C$1(this,"abort"),zd(this))};k$1.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zd(this,!0));P.$.N.call(this)};k$1.La=function(){this.s||(this.G||this.v||this.l?Ad(this):this.kb())};k$1.kb=function(){Ad(this)};function Ad(a){if(a.h&&"undefined"!=typeof goog&&(!a.C[1]||4!=H$1(a)||2!=a.da())){if(a.v&&4==H$1(a))yb(a.La,0,a);else if(C$1(a,"readystatechange"),4==H$1(a)){a.h=!1;try{var h=a.da();a:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break a;default:b=!1}var c;if(!(c=b)){var d;if(d=0===h){var e=String(a.I).match(Lc)[1]||null;!e&&l.self&&l.self.location&&(e=l.self.location.protocol.slice(0,-1));d=!td.test(e?e.toLowerCase():"")}c=d}if(c)C$1(a,"complete"),C$1(a,"success");else{a.m=6;try{var f=2<H$1(a)?a.g.statusText:""}catch(n){f=""}a.j=f+" ["+a.da()+"]";yd(a)}}finally{zd(a)}}}}function zd(a,b){if(a.g){wd(a);var c=a.g,d=a.C[0]?function d(){}:null;a.g=null;a.C=null;b||C$1(a,"ready");try{c.onreadystatechange=d}catch(e){}}}function wd(a){a.g&&a.L&&(a.g.ontimeout=null);a.A&&(l.clearTimeout(a.A),a.A=null)}k$1.isActive=function(){return!!this.g};function H$1(a){return a.g?a.g.readyState:0}k$1.da=function(){try{return 2<H$1(this)?this.g.status:-1}catch(a){return-1}};k$1.ja=function(){try{return this.g?this.g.responseText:""}catch(a){return""}};k$1.Wa=function(a){if(this.g){var b=this.g.responseText;a&&0==b.indexOf(a)&&(b=b.substring(a.length));return rd(b)}};function mc(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case sd:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(b){return null}}function tc(a){var b={};a=(a.g&&2<=H$1(a)?a.g.getAllResponseHeaders()||"":"").split("\r\n");for(var d=0;d<a.length;d++){if(x$1(a[d]))continue;var c=qb(a[d]);var e=c[0];c=c[1];if("string"!==typeof c)continue;c=c.trim();var f=b[e]||[];b[e]=f;f.push(c)}Oa(b,function(d){return d.join(", ")})}k$1.Ia=function(){return this.m};k$1.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)};function Bd(a){var b="";Na(a,function(c,d){b+=d;b+=":";b+=c;b+="\r\n"});return b}function Cd(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}d||(c=Bd(c),"string"===typeof a?null!=c&&encodeURIComponent(String(c)):K$1(a,b,c))}function Dd(a,b,c){return c&&c.internalChannelParams?c.internalChannelParams[a]||b:b}function Ed(a){this.Ga=0;this.j=[];this.l=new Gb;this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null;this.fb=this.W=0;this.cb=Dd("failFast",!1,a);this.G=this.v=this.u=this.m=this.h=null;this.aa=!0;this.Fa=this.V=-1;this.ba=this.A=this.C=0;this.ab=Dd("baseRetryDelayMs",5e3,a);this.hb=Dd("retryDelaySeedMs",1e4,a);this.eb=Dd("forwardChannelMaxRetries",2,a);this.xa=Dd("forwardChannelRequestTimeoutMs",2e4,a);this.va=a&&a.xmlHttpFactory||void 0;this.Ha=a&&a.useFetchStreams||!1;this.L=void 0;this.J=a&&a.supportsCrossDomainXhr||!1;this.K="";this.i=new cd(a&&a.concurrentRequestLimit);this.Ja=new hd;this.P=a&&a.fastHandshake||!1;this.O=a&&a.encodeInitMessageHeaders||!1;this.P&&this.O&&(this.O=!1);this.bb=a&&a.bc||!1;a&&a.Ea&&this.l.Ea();a&&a.forceLongPolling&&(this.aa=!1);this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1;this.qa=void 0;a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.qa=a.longPollingTimeout);this.oa=void 0;this.S=0;this.M=!1;this.ma=this.B=null}k$1=Ed.prototype;k$1.ra=8;k$1.H=1;function Hc(a){Fd(a);if(3==a.H){var b=a.W++,c=G$1(a.I);K$1(c,"SID",a.K);K$1(c,"RID",b);K$1(c,"TYPE","terminate");Gd(a,c);b=new bc(a,a.l,b);b.L=2;b.A=hc(G$1(c));c=!1;if(l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(b.A.toString(),"")}catch(d){}!c&&l.Image&&((new Image).src=b.A,c=!0);c||(b.g=lc(b.l,null),b.g.ha(b.A));b.G=Date.now();jc(b)}Hd(a)}function zc(a){a.g&&(vc(a),a.g.cancel(),a.g=null)}function Fd(a){zc(a);a.u&&(l.clearTimeout(a.u),a.u=null);yc(a);a.i.cancel();a.m&&("number"===typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Gc(a){if(!ed(a.i)&&!a.m){a.m=!0;var b=a.Na;sb||vb();tb||(sb(),tb=!0);mb.add(b,a);a.C=0}}function Id(a,b){if(Bc(a.i)>=a.i.j-(a.m?1:0))return!1;if(a.m)return a.j=b.F.concat(a.j),!0;if(1==a.H||2==a.H||a.C>=(a.cb?0:a.eb))return!1;a.m=Rb(q$1(a.Na,a,b),Jd(a,a.C));a.C++;return!0}k$1.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random());a=this.W++;var e=new bc(this,this.l,a);var f=this.s;this.U&&(f?(f=Pa(f),Ra(f,this.U)):f=this.U);null!==this.o||this.O||(e.I=f,f=null);if(this.P)a:{var b=0;for(var c=0;c<this.j.length;c++){b:{var d=this.j[c];if("__data__"in d.map&&(d=d.map.__data__,"string"===typeof d)){d=d.length;break b}d=void 0}if(void 0===d)break;b+=d;if(4096<b){b=c;break a}if(4096===b||c===this.j.length-1){b=c+1;break a}}b=1e3}else b=1e3;b=Kd(this,e,b);c=G$1(this.I);K$1(c,"RID",a);K$1(c,"CVER",22);this.F&&K$1(c,"X-HTTP-Session-Id",this.F);Gd(this,c);f&&(this.O?b="headers="+encodeURIComponent(String(Bd(f)))+"&"+b:this.o&&Cd(c,this.o,f));Cc(this.i,e);this.bb&&K$1(c,"TYPE","init");this.P?(K$1(c,"$req",b),K$1(c,"SID","null"),e.aa=!0,gc(e,c,null)):gc(e,c,b);this.H=2}}else 3==this.H&&(a?Ld(this,a):0==this.j.length||ed(this.i)||Ld(this))};function Ld(a,b){var c;b?c=b.m:c=a.W++;var d=G$1(a.I);K$1(d,"SID",a.K);K$1(d,"RID",c);K$1(d,"AID",a.V);Gd(a,d);a.o&&a.s&&Cd(d,a.o,a.s);c=new bc(a,a.l,c,a.C+1);null===a.o&&(c.I=a.s);b&&(a.j=b.F.concat(a.j));b=Kd(a,c,1e3);c.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random()));Cc(a.i,c);gc(c,d,b)}function Gd(a,b){a.na&&Na(a.na,function(c,d){K$1(b,d,c)});a.h&&Kc({},function(c,d){K$1(b,d,c)})}function Kd(a,b,c){c=Math.min(a.j.length,c);var d=a.h?q$1(a.h.Va,a.h,a):null;a:{var e=a.j;var f=-1;for(;;){var h=["count="+c];-1==f?0<c?(f=e[0].g,h.push("ofs="+f)):f=0:h.push("ofs="+f);var n=!0;for(var t=0;t<c;t++){var m=e[t].g;var u=e[t].map;m-=f;if(0>m)f=Math.max(0,e[t].g-100),n=!1;else try{id(u,h,"req"+m+"_")}catch(L){d&&d(u)}}if(n){d=h.join("&");break a}}}a=a.j.splice(0,c);b.F=a;return d}function Fc(a){if(!a.g&&!a.u){a.ba=1;var b=a.Ma;sb||vb();tb||(sb(),tb=!0);mb.add(b,a);a.A=0}}function Ac(a){if(a.g||a.u||3<=a.A)return!1;a.ba++;a.u=Rb(q$1(a.Ma,a),Jd(a,a.A));a.A++;return!0}k$1.Ma=function(){this.u=null;Md(this);if(this.ca&&!(this.M||null==this.g||0>=this.S)){var a=2*this.S;this.l.info("BP detection timer enabled: "+a);this.B=Rb(q$1(this.jb,this),a)}};k$1.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,F$1(10),zc(this),Md(this))};function vc(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Md(a){a.g=new bc(a,a.l,"rpc",a.ba);null===a.o&&(a.g.I=a.s);a.g.O=0;var b=G$1(a.wa);K$1(b,"RID","rpc");K$1(b,"SID",a.K);K$1(b,"AID",a.V);K$1(b,"CI",a.G?"0":"1");!a.G&&a.qa&&K$1(b,"TO",a.qa);K$1(b,"TYPE","xmlhttp");Gd(a,b);a.o&&a.s&&Cd(b,a.o,a.s);a.L&&a.g.setTimeout(a.L);var c=a.g;a=a.pa;c.L=1;c.A=hc(G$1(b));c.u=null;c.S=!0;ic(c,a)}k$1.ib=function(){null!=this.v&&(this.v=null,zc(this),Ac(this),F$1(19))};function yc(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function sc(a,b){var c=null;if(a.g==b){yc(a);vc(a);a.g=null;var d=2}else if(xc(a.i,b))c=b.F,Ec(a.i,b),d=1;else return;if(0!=a.H){if(b.i)if(1==d){c=b.u?b.u.length:0;b=Date.now()-b.G;var e=a.C;d=Mb();C$1(d,new Qb(d,c));Gc(a)}else Fc(a);else if(e=b.s,3==e||0==e&&0<b.ca||!(1==d&&Id(a,b)||2==d&&Ac(a)))switch(c&&0<c.length&&(b=a.i,b.i=b.i.concat(c)),e){case 1:J$1(a,5);break;case 4:J$1(a,10);break;case 3:J$1(a,6);break;default:J$1(a,2)}}}function Jd(a,b){var c=a.ab+Math.floor(Math.random()*a.hb);a.isActive()||(c*=2);return c*b}function J$1(a,b){a.l.info("Error code "+b);if(2==b){var c=null;a.h&&(c=null);var d=q$1(a.pb,a);c||(c=new M$1("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Nc(c,"https"),hc(c));jd(c.toString(),d)}else F$1(2);a.H=0;a.h&&a.h.za(b);Hd(a);Fd(a)}k$1.pb=function(a){a?(this.l.info("Successfully pinged google.com"),F$1(2)):(this.l.info("Failed to ping google.com"),F$1(1))};function Hd(a){a.H=0;a.ma=[];if(a.h){var b=fd(a.i);if(0!=b.length||0!=a.j.length)na(a.ma,b),na(a.ma,a.j),a.i.i.length=0,ma(a.j),a.j.length=0;a.h.ya()}}function Dc(a,b,c){var d=_instanceof$2(c,M$1)?G$1(c):new M$1(c);if(""!=d.g)b&&(d.g=b+"."+d.g),Oc(d,d.m);else{var e=l.location;d=e.protocol;b=b?b+"."+e.hostname:e.hostname;e=+e.port;var f=new M$1(null);d&&Nc(f,d);b&&(f.g=b);e&&Oc(f,e);c&&(f.l=c);d=f}c=a.F;b=a.Da;c&&b&&K$1(d,c,b);K$1(d,"VER",a.ra);Gd(a,d);return d}function lc(a,b,c){if(b&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");b=a.Ha&&!a.va?new P(new ld({ob:c})):new P(a.va);b.Oa(a.J);return b}k$1.isActive=function(){return!!this.h&&this.h.isActive(this)};function Nd(){}k$1=Nd.prototype;k$1.Ba=function(){};k$1.Aa=function(){};k$1.za=function(){};k$1.ya=function(){};k$1.isActive=function(){return!0};k$1.Va=function(){};function Od(){if(z$1&&!(10<=Number(Fa)))throw Error("Environmental error: no available transport.")}Od.prototype.g=function(a,b){return new Q$1(a,b)};function Q$1(a,b){B$1.call(this);this.g=new Ed(b);this.l=a;this.h=b&&b.messageUrlParams||null;a=b&&b.messageHeaders||null;b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"});this.g.s=a;a=b&&b.initMessageHeaders||null;b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType});b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca});this.g.U=a;(a=b&&b.cc)&&!x$1(a)&&(this.g.o=a);this.A=b&&b.supportsCrossDomainXhr||!1;this.v=b&&b.sendRawJson||!1;(b=b&&b.httpSessionIdParam)&&!x$1(b)&&(this.g.F=b,a=this.h,null!==a&&b in a&&(a=this.h,b in a&&delete a[b]));this.j=new R(this)}r(Q$1,B$1);Q$1.prototype.m=function(){this.g.h=this.j;this.A&&(this.g.J=!0);var a=this.g,b=this.l,c=this.h||void 0;F$1(0);a.Y=b;a.na=c||{};a.G=a.aa;a.I=Dc(a,null,a.Y);Gc(a)};Q$1.prototype.close=function(){Hc(this.g)};Q$1.prototype.u=function(a){var b=this.g;if("string"===typeof a){var c={};c.__data__=a;a=c}else this.v&&(c={},c.__data__=jb(a),a=c);b.j.push(new bd(b.fb++,a));3==b.H&&Gc(b)};Q$1.prototype.N=function(){this.g.h=null;delete this.j;Hc(this.g);delete this.g;Q$1.$.N.call(this)};function Pd(a){Yb.call(this);a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){a:{for(var c in b){a=c;break a}a=void 0}if(this.i=a)a=this.i,b=null!==b&&a in b?b[a]:void 0;this.data=b}else this.data=a}r(Pd,Yb);function Qd(){Zb.call(this);this.status=1}r(Qd,Zb);function R(a){this.g=a}r(R,Nd);R.prototype.Ba=function(){C$1(this.g,"a")};R.prototype.Aa=function(a){C$1(this.g,new Pd(a))};R.prototype.za=function(a){C$1(this.g,new Qd)};R.prototype.ya=function(){C$1(this.g,"b")};function Rd(){this.blockSize=-1}function S$1(){this.blockSize=-1;this.blockSize=64;this.g=Array(4);this.m=Array(this.blockSize);this.i=this.h=0;this.reset()}r(S$1,Rd);S$1.prototype.reset=function(){this.g[0]=1732584193;this.g[1]=4023233417;this.g[2]=2562383102;this.g[3]=271733878;this.i=this.h=0};function Sd(a,b,c){c||(c=0);var d=Array(16);if("string"===typeof b)for(var e=0;16>e;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;16>e;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0];c=a.g[1];e=a.g[2];var f=a.g[3];var h=b+(f^c&(e^f))+d[0]+3614090360&4294967295;b=c+(h<<7&4294967295|h>>>25);h=f+(e^b&(c^e))+d[1]+3905402710&4294967295;f=b+(h<<12&4294967295|h>>>20);h=e+(c^f&(b^c))+d[2]+606105819&4294967295;e=f+(h<<17&4294967295|h>>>15);h=c+(b^e&(f^b))+d[3]+3250441966&4294967295;c=e+(h<<22&4294967295|h>>>10);h=b+(f^c&(e^f))+d[4]+4118548399&4294967295;b=c+(h<<7&4294967295|h>>>25);h=f+(e^b&(c^e))+d[5]+1200080426&4294967295;f=b+(h<<12&4294967295|h>>>20);h=e+(c^f&(b^c))+d[6]+2821735955&4294967295;e=f+(h<<17&4294967295|h>>>15);h=c+(b^e&(f^b))+d[7]+4249261313&4294967295;c=e+(h<<22&4294967295|h>>>10);h=b+(f^c&(e^f))+d[8]+1770035416&4294967295;b=c+(h<<7&4294967295|h>>>25);h=f+(e^b&(c^e))+d[9]+2336552879&4294967295;f=b+(h<<12&4294967295|h>>>20);h=e+(c^f&(b^c))+d[10]+4294925233&4294967295;e=f+(h<<17&4294967295|h>>>15);h=c+(b^e&(f^b))+d[11]+2304563134&4294967295;c=e+(h<<22&4294967295|h>>>10);h=b+(f^c&(e^f))+d[12]+1804603682&4294967295;b=c+(h<<7&4294967295|h>>>25);h=f+(e^b&(c^e))+d[13]+4254626195&4294967295;f=b+(h<<12&4294967295|h>>>20);h=e+(c^f&(b^c))+d[14]+2792965006&4294967295;e=f+(h<<17&4294967295|h>>>15);h=c+(b^e&(f^b))+d[15]+1236535329&4294967295;c=e+(h<<22&4294967295|h>>>10);h=b+(e^f&(c^e))+d[1]+4129170786&4294967295;b=c+(h<<5&4294967295|h>>>27);h=f+(c^e&(b^c))+d[6]+3225465664&4294967295;f=b+(h<<9&4294967295|h>>>23);h=e+(b^c&(f^b))+d[11]+643717713&4294967295;e=f+(h<<14&4294967295|h>>>18);h=c+(f^b&(e^f))+d[0]+3921069994&4294967295;c=e+(h<<20&4294967295|h>>>12);h=b+(e^f&(c^e))+d[5]+3593408605&4294967295;b=c+(h<<5&4294967295|h>>>27);h=f+(c^e&(b^c))+d[10]+38016083&4294967295;f=b+(h<<9&4294967295|h>>>23);h=e+(b^c&(f^b))+d[15]+3634488961&4294967295;e=f+(h<<14&4294967295|h>>>18);h=c+(f^b&(e^f))+d[4]+3889429448&4294967295;c=e+(h<<20&4294967295|h>>>12);h=b+(e^f&(c^e))+d[9]+568446438&4294967295;b=c+(h<<5&4294967295|h>>>27);h=f+(c^e&(b^c))+d[14]+3275163606&4294967295;f=b+(h<<9&4294967295|h>>>23);h=e+(b^c&(f^b))+d[3]+4107603335&4294967295;e=f+(h<<14&4294967295|h>>>18);h=c+(f^b&(e^f))+d[8]+1163531501&4294967295;c=e+(h<<20&4294967295|h>>>12);h=b+(e^f&(c^e))+d[13]+2850285829&4294967295;b=c+(h<<5&4294967295|h>>>27);h=f+(c^e&(b^c))+d[2]+4243563512&4294967295;f=b+(h<<9&4294967295|h>>>23);h=e+(b^c&(f^b))+d[7]+1735328473&4294967295;e=f+(h<<14&4294967295|h>>>18);h=c+(f^b&(e^f))+d[12]+2368359562&4294967295;c=e+(h<<20&4294967295|h>>>12);h=b+(c^e^f)+d[5]+4294588738&4294967295;b=c+(h<<4&4294967295|h>>>28);h=f+(b^c^e)+d[8]+2272392833&4294967295;f=b+(h<<11&4294967295|h>>>21);h=e+(f^b^c)+d[11]+1839030562&4294967295;e=f+(h<<16&4294967295|h>>>16);h=c+(e^f^b)+d[14]+4259657740&4294967295;c=e+(h<<23&4294967295|h>>>9);h=b+(c^e^f)+d[1]+2763975236&4294967295;b=c+(h<<4&4294967295|h>>>28);h=f+(b^c^e)+d[4]+1272893353&4294967295;f=b+(h<<11&4294967295|h>>>21);h=e+(f^b^c)+d[7]+4139469664&4294967295;e=f+(h<<16&4294967295|h>>>16);h=c+(e^f^b)+d[10]+3200236656&4294967295;c=e+(h<<23&4294967295|h>>>9);h=b+(c^e^f)+d[13]+681279174&4294967295;b=c+(h<<4&4294967295|h>>>28);h=f+(b^c^e)+d[0]+3936430074&4294967295;f=b+(h<<11&4294967295|h>>>21);h=e+(f^b^c)+d[3]+3572445317&4294967295;e=f+(h<<16&4294967295|h>>>16);h=c+(e^f^b)+d[6]+76029189&4294967295;c=e+(h<<23&4294967295|h>>>9);h=b+(c^e^f)+d[9]+3654602809&4294967295;b=c+(h<<4&4294967295|h>>>28);h=f+(b^c^e)+d[12]+3873151461&4294967295;f=b+(h<<11&4294967295|h>>>21);h=e+(f^b^c)+d[15]+530742520&4294967295;e=f+(h<<16&4294967295|h>>>16);h=c+(e^f^b)+d[2]+3299628645&4294967295;c=e+(h<<23&4294967295|h>>>9);h=b+(e^(c|~f))+d[0]+4096336452&4294967295;b=c+(h<<6&4294967295|h>>>26);h=f+(c^(b|~e))+d[7]+1126891415&4294967295;f=b+(h<<10&4294967295|h>>>22);h=e+(b^(f|~c))+d[14]+2878612391&4294967295;e=f+(h<<15&4294967295|h>>>17);h=c+(f^(e|~b))+d[5]+4237533241&4294967295;c=e+(h<<21&4294967295|h>>>11);h=b+(e^(c|~f))+d[12]+1700485571&4294967295;b=c+(h<<6&4294967295|h>>>26);h=f+(c^(b|~e))+d[3]+2399980690&4294967295;f=b+(h<<10&4294967295|h>>>22);h=e+(b^(f|~c))+d[10]+4293915773&4294967295;e=f+(h<<15&4294967295|h>>>17);h=c+(f^(e|~b))+d[1]+2240044497&4294967295;c=e+(h<<21&4294967295|h>>>11);h=b+(e^(c|~f))+d[8]+1873313359&4294967295;b=c+(h<<6&4294967295|h>>>26);h=f+(c^(b|~e))+d[15]+4264355552&4294967295;f=b+(h<<10&4294967295|h>>>22);h=e+(b^(f|~c))+d[6]+2734768916&4294967295;e=f+(h<<15&4294967295|h>>>17);h=c+(f^(e|~b))+d[13]+1309151649&4294967295;c=e+(h<<21&4294967295|h>>>11);h=b+(e^(c|~f))+d[4]+4149444226&4294967295;b=c+(h<<6&4294967295|h>>>26);h=f+(c^(b|~e))+d[11]+3174756917&4294967295;f=b+(h<<10&4294967295|h>>>22);h=e+(b^(f|~c))+d[2]+718787259&4294967295;e=f+(h<<15&4294967295|h>>>17);h=c+(f^(e|~b))+d[9]+3951481745&4294967295;a.g[0]=a.g[0]+b&4294967295;a.g[1]=a.g[1]+(e+(h<<21&4294967295|h>>>11))&4294967295;a.g[2]=a.g[2]+e&4294967295;a.g[3]=a.g[3]+f&4294967295}S$1.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var c=b-this.blockSize,d=this.m,e=this.h,f=0;f<b;){if(0==e)for(;f<=c;)Sd(this,a,f),f+=this.blockSize;if("string"===typeof a)for(;f<b;){if(d[e++]=a.charCodeAt(f++),e==this.blockSize){Sd(this,d);e=0;break}}else for(;f<b;)if(d[e++]=a[f++],e==this.blockSize){Sd(this,d);e=0;break}}this.h=e;this.i+=b};S$1.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var c=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=c&255,c/=256;this.j(a);a=Array(16);for(b=c=0;4>b;++b)for(var d=0;32>d;d+=8)a[c++]=this.g[b]>>>d&255;return a};function T(a,b){this.h=b;for(var c=[],d=!0,e=a.length-1;0<=e;e--){var f=a[e]|0;d&&f==b||(c[e]=f,d=!1)}this.g=c}var sa={};function Td(a){return-128<=a&&128>a?ra(a,function(b){return new T([b|0],0>b?-1:0)}):new T([a|0],0>a?-1:0)}function U$1(a){if(isNaN(a)||!isFinite(a))return V;if(0>a)return W$1(U$1(-a));for(var b=[],c=1,d=0;a>=c;d++)b[d]=a/c|0,c*=Ud;return new T(b,0)}function Vd(a,b){if(0==a.length)throw Error("number format error: empty string");b=b||10;if(2>b||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return W$1(Vd(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var c=U$1(Math.pow(b,8)),d=V,e=0;e<a.length;e+=8){var f=Math.min(8,a.length-e),h=parseInt(a.substring(e,e+f),b);8>f?(f=U$1(Math.pow(b,f)),d=d.R(f).add(U$1(h))):(d=d.R(c),d=d.add(U$1(h)))}return d}var Ud=4294967296,V=Td(0),Wd=Td(1),Xd=Td(16777216);k$1=T.prototype;k$1.ea=function(){if(X$1(this))return-W$1(this).ea();for(var a=0,b=1,c=0;c<this.g.length;c++){var d=this.D(c);a+=(0<=d?d:Ud+d)*b;b*=Ud}return a};k$1.toString=function(a){a=a||10;if(2>a||36<a)throw Error("radix out of range: "+a);if(Y$1(this))return"0";if(X$1(this))return"-"+W$1(this).toString(a);for(var b=U$1(Math.pow(a,6)),c=this,d="";;){var e=Yd(c,b).g;c=Zd(c,e.R(b));var f=((0<c.g.length?c.g[0]:c.h)>>>0).toString(a);c=e;if(Y$1(c))return f+d;for(;6>f.length;)f="0"+f;d=f+d}};k$1.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h};function Y$1(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function X$1(a){return-1==a.h}k$1.X=function(a){a=Zd(this,a);return X$1(a)?-1:Y$1(a)?0:1};function W$1(a){for(var b=a.g.length,c=[],d=0;d<b;d++)c[d]=~a.g[d];return new T(c,~a.h).add(Wd)}k$1.abs=function(){return X$1(this)?W$1(this):this};k$1.add=function(a){for(var b=Math.max(this.g.length,a.g.length),c=[],d=0,e=0;e<=b;e++){var f=d+(this.D(e)&65535)+(a.D(e)&65535),h=(f>>>16)+(this.D(e)>>>16)+(a.D(e)>>>16);d=h>>>16;f&=65535;h&=65535;c[e]=h<<16|f}return new T(c,c[c.length-1]&-2147483648?-1:0)};function Zd(a,b){return a.add(W$1(b))}k$1.R=function(a){if(Y$1(this)||Y$1(a))return V;if(X$1(this))return X$1(a)?W$1(this).R(W$1(a)):W$1(W$1(this).R(a));if(X$1(a))return W$1(this.R(W$1(a)));if(0>this.X(Xd)&&0>a.X(Xd))return U$1(this.ea()*a.ea());for(var b=this.g.length+a.g.length,c=[],d=0;d<2*b;d++)c[d]=0;for(d=0;d<this.g.length;d++)for(var e=0;e<a.g.length;e++){var f=this.D(d)>>>16,h=this.D(d)&65535,n=a.D(e)>>>16,t=a.D(e)&65535;c[2*d+2*e]+=h*t;$d(c,2*d+2*e);c[2*d+2*e+1]+=f*t;$d(c,2*d+2*e+1);c[2*d+2*e+1]+=h*n;$d(c,2*d+2*e+1);c[2*d+2*e+2]+=f*n;$d(c,2*d+2*e+2)}for(d=0;d<b;d++)c[d]=c[2*d+1]<<16|c[2*d];for(d=b;d<2*b;d++)c[d]=0;return new T(c,0)};function $d(a,b){for(;(a[b]&65535)!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function ae$1(a,b){this.g=a;this.h=b}function Yd(a,b){if(Y$1(b))throw Error("division by zero");if(Y$1(a))return new ae$1(V,V);if(X$1(a))return b=Yd(W$1(a),b),new ae$1(W$1(b.g),W$1(b.h));if(X$1(b))return b=Yd(a,W$1(b)),new ae$1(W$1(b.g),b.h);if(30<a.g.length){if(X$1(a)||X$1(b))throw Error("slowDivide_ only works with positive integers.");for(var c=Wd,d=b;0>=d.X(a);)c=be(c),d=be(d);var e=Z$1(c,1),f=Z$1(d,1);d=Z$1(d,2);for(c=Z$1(c,2);!Y$1(d);){var h=f.add(d);0>=h.X(a)&&(e=e.add(c),f=h);d=Z$1(d,1);c=Z$1(c,1)}b=Zd(a,e.R(b));return new ae$1(e,b)}for(e=V;0<=a.X(b);){c=Math.max(1,Math.floor(a.ea()/b.ea()));d=Math.ceil(Math.log(c)/Math.LN2);d=48>=d?1:Math.pow(2,d-48);f=U$1(c);for(h=f.R(b);X$1(h)||0<h.X(a);)c-=d,f=U$1(c),h=f.R(b);Y$1(f)&&(f=Wd);e=e.add(f);a=Zd(a,h)}return new ae$1(e,a)}k$1.gb=function(a){return Yd(this,a).h};k$1.and=function(a){for(var b=Math.max(this.g.length,a.g.length),c=[],d=0;d<b;d++)c[d]=this.D(d)&a.D(d);return new T(c,this.h&a.h)};k$1.or=function(a){for(var b=Math.max(this.g.length,a.g.length),c=[],d=0;d<b;d++)c[d]=this.D(d)|a.D(d);return new T(c,this.h|a.h)};k$1.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),c=[],d=0;d<b;d++)c[d]=this.D(d)^a.D(d);return new T(c,this.h^a.h)};function be(a){for(var b=a.g.length+1,c=[],d=0;d<b;d++)c[d]=a.D(d)<<1|a.D(d-1)>>>31;return new T(c,a.h)}function Z$1(a,b){var c=b>>5;b%=32;for(var d=a.g.length-c,e=[],f=0;f<d;f++)e[f]=0<b?a.D(f+c)>>>b|a.D(f+c+1)<<32-b:a.D(f+c);return new T(e,a.h)}Od.prototype.createWebChannel=Od.prototype.g;Q$1.prototype.send=Q$1.prototype.u;Q$1.prototype.open=Q$1.prototype.m;Q$1.prototype.close=Q$1.prototype.close;Sb.NO_ERROR=0;Sb.TIMEOUT=8;Sb.HTTP_ERROR=6;Tb.COMPLETE="complete";Wb.EventType=Xb;Xb.OPEN="a";Xb.CLOSE="b";Xb.ERROR="c";Xb.MESSAGE="d";B$1.prototype.listen=B$1.prototype.O;P.prototype.listenOnce=P.prototype.P;P.prototype.getLastError=P.prototype.Sa;P.prototype.getLastErrorCode=P.prototype.Ia;P.prototype.getStatus=P.prototype.da;P.prototype.getResponseJson=P.prototype.Wa;P.prototype.getResponseText=P.prototype.ja;P.prototype.send=P.prototype.ha;P.prototype.setWithCredentials=P.prototype.Oa;S$1.prototype.digest=S$1.prototype.l;S$1.prototype.reset=S$1.prototype.reset;S$1.prototype.update=S$1.prototype.j;T.prototype.add=T.prototype.add;T.prototype.multiply=T.prototype.R;T.prototype.modulo=T.prototype.gb;T.prototype.compare=T.prototype.X;T.prototype.toNumber=T.prototype.ea;T.prototype.toString=T.prototype.toString;T.prototype.getBits=T.prototype.D;T.fromNumber=U$1;T.fromString=Vd;var createWebChannelTransport=function createWebChannelTransport(){return new Od};var getStatEventTarget=function getStatEventTarget(){return Mb()};var ErrorCode=Sb;var EventType=Tb;var Event=E;var Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20};var WebChannel=Wb;var XhrIo=P;var Md5=S$1;var Integer=T;function _array_like_to_array$1(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes$1(arr){if(Array.isArray(arr))return arr}function _array_without_holes$1(arr){if(Array.isArray(arr))return _array_like_to_array$1(arr)}function _assert_this_initialized$1(self1){if(self1===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self1}function asyncGeneratorStep$3(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$3(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){asyncGeneratorStep$3(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$3(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _class_call_check$1(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _construct(Parent,args,Class){if(_is_native_reflect_construct$1()){_construct=Reflect.construct}else{_construct=function construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_set_prototype_of$1(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class$1(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$1(Constructor.prototype,protoProps);if(staticProps)_defineProperties$1(Constructor,staticProps);return Constructor}function _get$1(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get$1=Reflect.get}else{_get$1=function get(target,property,receiver){var base=_super_prop_base$1(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver||target)}return desc.value}}return _get$1(target,property,receiver||target)}function _get_prototype_of$1(o){_get_prototype_of$1=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _get_prototype_of$1(o)}function _inherits$1(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_set_prototype_of$1(subClass,superClass)}function _instanceof$1(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _is_native_function(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _iterable_to_array$1(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterable_to_array_limit$1(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possible_constructor_return$1(self1,call){if(call&&(_type_of$1(call)==="object"||typeof call==="function")){return call}return _assert_this_initialized$1(self1)}function _set_prototype_of$1(o,p){_set_prototype_of$1=Object.setPrototypeOf||function setPrototypeOf(o,p){o.__proto__=p;return o};return _set_prototype_of$1(o,p)}function _sliced_to_array$1(arr,i){return _array_with_holes$1(arr)||_iterable_to_array_limit$1(arr,i)||_unsupported_iterable_to_array$1(arr,i)||_non_iterable_rest$1()}function _super_prop_base$1(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_get_prototype_of$1(object);if(object===null)break}return object}function _to_consumable_array$1(arr){return _array_without_holes$1(arr)||_iterable_to_array$1(arr)||_unsupported_iterable_to_array$1(arr)||_non_iterable_spread$1()}function _type_of$1(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array$1(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array$1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array$1(o,minLen)}function _wrap_native_super(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrap_native_super=function wrapNativeSuper(Class){if(Class===null||!_is_native_function(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_get_prototype_of$1(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of$1(Wrapper,Class)};return _wrap_native_super(Class)}function _is_native_reflect_construct$1(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super$1(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct$1();return function _createSuperInternal(){var Super=_get_prototype_of$1(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of$1(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possible_constructor_return$1(this,result)}}function _ts_generator$1(thisArg,body){var f,_$y,t,g,_={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,_$y&&(t=op[0]&2?_$y["return"]:op[0]?_$y["throw"]||((t=_$y["return"])&&t.call(_$y),0):_$y.next)&&!(t=t.call(_$y,op[1])).done)return t;if(_$y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;_$y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];_$y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function _ts_values(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function next(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var w="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var User=function(){function User(e){_class_call_check$1(this,User);this.uid=e}_create_class$1(User,[{key:"isAuthenticated",value:function isAuthenticated(){return null!=this.uid}},{key:"toKey",value:function toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function isEqual(e){return e.uid===this.uid}}]);return User}();User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var S="10.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var b=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return b.logLevel}function __PRIVATE_logDebug(e){for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key]}if(b.logLevel<=LogLevel.DEBUG){var _b;var n=t.map(__PRIVATE_argToString);(_b=b).debug.apply(_b,["Firestore (".concat(S,"): ").concat(e)].concat(_to_consumable_array$1(n)))}}function __PRIVATE_logError(e){for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key]}if(b.logLevel<=LogLevel.ERROR){var _b;var n=t.map(__PRIVATE_argToString);(_b=b).error.apply(_b,["Firestore (".concat(S,"): ").concat(e)].concat(_to_consumable_array$1(n)))}}function __PRIVATE_logWarn(e){for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key]}if(b.logLevel<=LogLevel.WARN){var _b;var n=t.map(__PRIVATE_argToString);(_b=b).warn.apply(_b,["Firestore (".concat(S,"): ").concat(e)].concat(_to_consumable_array$1(n)))}}function __PRIVATE_argToString(e){if("string"==typeof e)return e;try{/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function __PRIVATE_formatJSON(e){return JSON.stringify(e)}(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fail(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Unexpected state";var t="FIRESTORE (".concat(S,") INTERNAL ASSERTION FAILED: ")+e;throw __PRIVATE_logError(t),new Error(t)}function __PRIVATE_hardAssert(e,t){e||fail()}function __PRIVATE_debugCast(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};var FirestoreError=function(FirebaseError){_inherits$1(FirestoreError,FirebaseError);var _super=_create_super$1(FirestoreError);function FirestoreError(e,t){_class_call_check$1(this,FirestoreError);var _this;_this=_super.call(this,e,t),_this.code=e,_this.message=t,_this.toString=function(){return"".concat(_this.name,": [code=").concat(_this.code,"]: ").concat(_this.message)};return _possible_constructor_return$1(_this)}return FirestoreError}(FirebaseError);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_Deferred=function __PRIVATE_Deferred(){var _this=this;_class_call_check$1(this,__PRIVATE_Deferred);this.promise=new Promise(function(e,t){_this.resolve=e,_this.reject=t})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_OAuthToken=function __PRIVATE_OAuthToken(e,t){_class_call_check$1(this,__PRIVATE_OAuthToken);this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))};var __PRIVATE_EmptyAuthCredentialsProvider=function(){function __PRIVATE_EmptyAuthCredentialsProvider(){_class_call_check$1(this,__PRIVATE_EmptyAuthCredentialsProvider)}_create_class$1(__PRIVATE_EmptyAuthCredentialsProvider,[{key:"getToken",value:function getToken(){return Promise.resolve(null)}},{key:"invalidateToken",value:function invalidateToken(){}},{key:"start",value:function start(e,t){e.enqueueRetryable(function(){return t(User.UNAUTHENTICATED)})}},{key:"shutdown",value:function shutdown(){}}]);return __PRIVATE_EmptyAuthCredentialsProvider}();var __PRIVATE_EmulatorAuthCredentialsProvider=function(){function __PRIVATE_EmulatorAuthCredentialsProvider(e){_class_call_check$1(this,__PRIVATE_EmulatorAuthCredentialsProvider);this.token=e,this.changeListener=null}_create_class$1(__PRIVATE_EmulatorAuthCredentialsProvider,[{key:"getToken",value:function getToken(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function invalidateToken(){}},{key:"start",value:function start(e,t){var _this=this;this.changeListener=t,e.enqueueRetryable(function(){return t(_this.token.user)})}},{key:"shutdown",value:function shutdown(){this.changeListener=null}}]);return __PRIVATE_EmulatorAuthCredentialsProvider}();var __PRIVATE_FirebaseAuthCredentialsProvider=function(){function __PRIVATE_FirebaseAuthCredentialsProvider(e){_class_call_check$1(this,__PRIVATE_FirebaseAuthCredentialsProvider);this.t=e,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}_create_class$1(__PRIVATE_FirebaseAuthCredentialsProvider,[{key:"start",value:function start(e,t){var _this=this;var n=this.i;var __PRIVATE_guardedChangeListener=function __PRIVATE_guardedChangeListener(e){return _this.i!==n?(n=_this.i,t(e)):Promise.resolve()};var _$r=new __PRIVATE_Deferred;this.o=function(){_this.i++,_this.currentUser=_this.u(),_$r.resolve(),_$r=new __PRIVATE_Deferred,e.enqueueRetryable(function(){return __PRIVATE_guardedChangeListener(_this.currentUser)})};var __PRIVATE_awaitNextToken=function __PRIVATE_awaitNextToken(){var t=_$r;var _this1=_this;e.enqueueRetryable(_async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,t.promise];case 1:_state.sent();return[4,__PRIVATE_guardedChangeListener(_this1.currentUser)];case 2:_state.sent();return[2]}})}))},__PRIVATE_registerAuth=function __PRIVATE_registerAuth(e){__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),_this.auth=e,_this.auth.addAuthTokenListener(_this.o),__PRIVATE_awaitNextToken()};this.t.onInit(function(e){return __PRIVATE_registerAuth(e)}),setTimeout(function(){if(!_this.auth){var e=_this.t.getImmediate({optional:!0});e?__PRIVATE_registerAuth(e):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),_$r.resolve(),_$r=new __PRIVATE_Deferred)}},0),__PRIVATE_awaitNextToken()}},{key:"getToken",value:function getToken(){var _this=this;var e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return _this.i!==e?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),_this.getToken()):t?(__PRIVATE_hardAssert("string"==typeof t.accessToken),new __PRIVATE_OAuthToken(t.accessToken,_this.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function invalidateToken(){this.forceRefresh=!0}},{key:"shutdown",value:function shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function u(){var e=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(null===e||"string"==typeof e),new User(e)}}]);return __PRIVATE_FirebaseAuthCredentialsProvider}();var __PRIVATE_FirstPartyToken=function(){function __PRIVATE_FirstPartyToken(e,t,n){_class_call_check$1(this,__PRIVATE_FirstPartyToken);this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=User.FIRST_PARTY,this.I=new Map}_create_class$1(__PRIVATE_FirstPartyToken,[{key:"T",value:function T(){return this.P?this.P():null}},{key:"headers",get:function get(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}]);return __PRIVATE_FirstPartyToken}();var __PRIVATE_FirstPartyAuthCredentialsProvider=function(){function __PRIVATE_FirstPartyAuthCredentialsProvider(e,t,n){_class_call_check$1(this,__PRIVATE_FirstPartyAuthCredentialsProvider);this.l=e,this.h=t,this.P=n}_create_class$1(__PRIVATE_FirstPartyAuthCredentialsProvider,[{key:"getToken",value:function getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.l,this.h,this.P))}},{key:"start",value:function start(e,t){e.enqueueRetryable(function(){return t(User.FIRST_PARTY)})}},{key:"shutdown",value:function shutdown(){}},{key:"invalidateToken",value:function invalidateToken(){}}]);return __PRIVATE_FirstPartyAuthCredentialsProvider}();var AppCheckToken=function AppCheckToken(e){_class_call_check$1(this,AppCheckToken);this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)};var __PRIVATE_FirebaseAppCheckTokenProvider=function(){function __PRIVATE_FirebaseAppCheckTokenProvider(e){_class_call_check$1(this,__PRIVATE_FirebaseAppCheckTokenProvider);this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}_create_class$1(__PRIVATE_FirebaseAppCheckTokenProvider,[{key:"start",value:function start(e,t){var _this=this;var onTokenChanged=function onTokenChanged(e){null!=e.error&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var n=e.token!==_this.R;return _this.R=e.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable(function(){return onTokenChanged(t)})};var __PRIVATE_registerAppCheck=function __PRIVATE_registerAppCheck(e){__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),_this.appCheck=e,_this.appCheck.addTokenListener(_this.o)};this.A.onInit(function(e){return __PRIVATE_registerAppCheck(e)}),setTimeout(function(){if(!_this.appCheck){var e=_this.A.getImmediate({optional:!0});e?__PRIVATE_registerAppCheck(e):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function getToken(){var _this=this;var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(function(e){return e?(__PRIVATE_hardAssert("string"==typeof e.token),_this.R=e.token,new AppCheckToken(e.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function invalidateToken(){this.forceRefresh=!0}},{key:"shutdown",value:function shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]);return __PRIVATE_FirebaseAppCheckTokenProvider}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_randomBytes(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var t1=0;t1<e;t1++)n[t1]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_AutoId=function(){function __PRIVATE_AutoId(){_class_call_check$1(this,__PRIVATE_AutoId)}_create_class$1(__PRIVATE_AutoId,null,[{key:"newId",value:function newId(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;var n="";for(;n.length<20;){var _$r=__PRIVATE_randomBytes(40);for(var i=0;i<_$r.length;++i)n.length<20&&_$r[i]<t&&(n+=e.charAt(_$r[i]%e.length))}return n}}]);return __PRIVATE_AutoId}();function __PRIVATE_primitiveComparator(e,t){return e<t?-1:e>t?1:0}function __PRIVATE_arrayEquals(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}function __PRIVATE_immediateSuccessor(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Timestamp=function(){function Timestamp(e,t){_class_call_check$1(this,Timestamp);if(this.seconds=e,this.nanoseconds=t,t<0)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new FirestoreError(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}_create_class$1(Timestamp,[{key:"toDate",value:function toDate(){return new Date(this.toMillis())}},{key:"toMillis",value:function toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function _compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}},{key:"isEqual",value:function isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function now(){return Timestamp.fromMillis(Date.now())}},{key:"fromDate",value:function fromDate(e){return Timestamp.fromMillis(e.getTime())}},{key:"fromMillis",value:function fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Timestamp(t,n)}}]);return Timestamp}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SnapshotVersion=function(){function SnapshotVersion(e){_class_call_check$1(this,SnapshotVersion);this.timestamp=e}_create_class$1(SnapshotVersion,[{key:"compareTo",value:function compareTo(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function isEqual(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function toTimestamp(){return this.timestamp}}],[{key:"fromTimestamp",value:function fromTimestamp(e){return new SnapshotVersion(e)}},{key:"min",value:function min(){return new SnapshotVersion(new Timestamp(0,0))}},{key:"max",value:function max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}}]);return SnapshotVersion}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var BasePath=function(){function BasePath(e,t,n){_class_call_check$1(this,BasePath);void 0===t?t=0:t>e.length&&fail(),void 0===n?n=e.length-t:n>e.length-t&&fail(),this.segments=e,this.offset=t,this.len=n}_create_class$1(BasePath,[{key:"length",get:function get(){return this.len}},{key:"isEqual",value:function isEqual(e){return 0===BasePath.comparator(this,e)}},{key:"child",value:function child(e){var t=this.segments.slice(this.offset,this.limit());return _instanceof$1(e,BasePath)?e.forEach(function(e){t.push(e)}):t.push(e),this.construct(t)}},{key:"limit",value:function limit(){return this.offset+this.length}},{key:"popFirst",value:function popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function popLast(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function firstSegment(){return this.segments[this.offset]}},{key:"lastSegment",value:function lastSegment(){return this.get(this.length-1)}},{key:"get",value:function get(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function isEmpty(){return 0===this.length}},{key:"isPrefixOf",value:function isPrefixOf(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function forEach(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function toArray(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function comparator(e,t){var n=Math.min(e.length,t.length);for(var _$r=0;_$r<n;_$r++){var n1=e.get(_$r),i=t.get(_$r);if(n1<i)return-1;if(n1>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]);return BasePath}();var ResourcePath=function(BasePath){_inherits$1(ResourcePath,BasePath);var _super=_create_super$1(ResourcePath);function ResourcePath(){_class_call_check$1(this,ResourcePath);return _super.apply(this,arguments)}_create_class$1(ResourcePath,[{key:"construct",value:function construct(e,t,n){return new ResourcePath(e,t,n)}},{key:"canonicalString",value:function canonicalString(){return this.toArray().join("/")}},{key:"toString",value:function toString(){return this.canonicalString()}},{key:"toUriEncodedString",value:function toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}}],[{key:"fromString",value:function fromString(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}var t=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;var _t;if(n.indexOf("//")>=0)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid segment (".concat(n,"). Paths must not contain // in them."));(_t=t).push.apply(_t,_to_consumable_array$1(n.split("/").filter(function(e){return e.length>0})))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new ResourcePath(t)}},{key:"emptyPath",value:function emptyPath(){return new ResourcePath([])}}]);return ResourcePath}(BasePath);var C=/^[_a-zA-Z][_a-zA-Z0-9]*$/;var FieldPath$1=function(BasePath){_inherits$1(FieldPath$1,BasePath);var _super=_create_super$1(FieldPath$1);function FieldPath$1(){_class_call_check$1(this,FieldPath$1);return _super.apply(this,arguments)}_create_class$1(FieldPath$1,[{key:"construct",value:function construct(e,t,n){return new FieldPath$1(e,t,n)}},{key:"canonicalString",value:function canonicalString(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function toString(){return this.canonicalString()}},{key:"isKeyField",value:function isKeyField(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function isValidIdentifier(e){return C.test(e)}},{key:"keyField",value:function keyField(){return new FieldPath$1(["__name__"])}},{key:"fromServerFormat",value:function fromServerFormat(e){var t=[];var n="",_$r=0;var __PRIVATE_addCurrentSegment=function __PRIVATE_addCurrentSegment(){if(0===n.length)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};var i=!1;for(;_$r<e.length;){var t1=e[_$r];if("\\"===t1){if(_$r+1===e.length)throw new FirestoreError(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var t2=e[_$r+1];if("\\"!==t2&&"."!==t2&&"`"!==t2)throw new FirestoreError(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t2,_$r+=2}else"`"===t1?(i=!i,_$r++):"."!==t1||i?(n+=t1,_$r++):(__PRIVATE_addCurrentSegment(),_$r++)}if(__PRIVATE_addCurrentSegment(),i)throw new FirestoreError(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FieldPath$1(t)}},{key:"emptyPath",value:function emptyPath(){return new FieldPath$1([])}}]);return FieldPath$1}(BasePath);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DocumentKey=function(){function DocumentKey(e){_class_call_check$1(this,DocumentKey);this.path=e}_create_class$1(DocumentKey,[{key:"collectionGroup",get:function get(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function getCollectionGroup(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function getCollectionPath(){return this.path.popLast()}},{key:"isEqual",value:function isEqual(e){return null!==e&&0===ResourcePath.comparator(this.path,e.path)}},{key:"toString",value:function toString(){return this.path.toString()}}],[{key:"fromPath",value:function fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}},{key:"fromName",value:function fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}},{key:"empty",value:function empty(){return new DocumentKey(ResourcePath.emptyPath())}},{key:"comparator",value:function comparator(e,t){return ResourcePath.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function isDocumentKey(e){return e.length%2==0}},{key:"fromSegments",value:function fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}]);return DocumentKey}();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FieldIndex=function FieldIndex(e,t,n,r){_class_call_check$1(this,FieldIndex);this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r};function __PRIVATE_fieldIndexGetArraySegment(e){return e.fields.find(function(e){return 2===e.kind})}function __PRIVATE_fieldIndexGetDirectionalSegments(e){return e.fields.filter(function(e){return 2!==e.kind})}FieldIndex.UNKNOWN_ID=-1;var IndexSegment=function IndexSegment(e,t){_class_call_check$1(this,IndexSegment);this.fieldPath=e,this.kind=t};var IndexState=function(){function IndexState(e,t){_class_call_check$1(this,IndexState);this.sequenceNumber=e,this.offset=t}_create_class$1(IndexState,null,[{key:"empty",value:function empty(){return new IndexState(0,IndexOffset.min())}}]);return IndexState}();function __PRIVATE_newIndexOffsetSuccessorFromReadTime(e,t){var n=e.toTimestamp().seconds,_$r=e.toTimestamp().nanoseconds+1,i=SnapshotVersion.fromTimestamp(1e9===_$r?new Timestamp(n+1,0):new Timestamp(n,_$r));return new IndexOffset(i,DocumentKey.empty(),t)}function __PRIVATE_newIndexOffsetFromDocument(e){return new IndexOffset(e.readTime,e.key,-1)}var IndexOffset=function(){function IndexOffset(e,t,n){_class_call_check$1(this,IndexOffset);this.readTime=e,this.documentKey=t,this.largestBatchId=n}_create_class$1(IndexOffset,null,[{key:"min",value:function min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),-1)}},{key:"max",value:function max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),-1)}}]);return IndexOffset}();function __PRIVATE_indexOffsetComparator(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=DocumentKey.comparator(e.documentKey,t.documentKey),0!==n?n:__PRIVATE_primitiveComparator(e.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var v="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";var PersistenceTransaction=function(){function PersistenceTransaction(){_class_call_check$1(this,PersistenceTransaction);this.onCommittedListeners=[]}_create_class$1(PersistenceTransaction,[{key:"addOnCommittedListener",value:function addOnCommittedListener(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function raiseOnCommittedEvent(){this.onCommittedListeners.forEach(function(e){return e()})}}]);return PersistenceTransaction}();function __PRIVATE_ignoreIfPrimaryLeaseLoss(e){return ___PRIVATE_ignoreIfPrimaryLeaseLoss.apply(this,arguments)}function ___PRIVATE_ignoreIfPrimaryLeaseLoss(){___PRIVATE_ignoreIfPrimaryLeaseLoss=/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$3(function(e){return _ts_generator$1(this,function(_state){if(e.code!==D.FAILED_PRECONDITION||e.message!==v)throw e;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease");return[2]})});return ___PRIVATE_ignoreIfPrimaryLeaseLoss.apply(this,arguments)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var PersistencePromise=function(){function PersistencePromise(e){var _this=this;_class_call_check$1(this,PersistencePromise);this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){_this.isDone=!0,_this.result=e,_this.nextCallback&&_this.nextCallback(e)},function(e){_this.isDone=!0,_this.error=e,_this.catchCallback&&_this.catchCallback(e)})}_create_class$1(PersistencePromise,[{key:"catch",value:function _catch(e){return this.next(void 0,e)}},{key:"next",value:function next(e,t){var _this=this;return this.callbackAttached&&fail(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new PersistencePromise(function(n,r){_this.nextCallback=function(t){_this.wrapSuccess(e,t).next(n,r)},_this.catchCallback=function(e){_this.wrapFailure(t,e).next(n,r)}})}},{key:"toPromise",value:function toPromise(){var _this=this;return new Promise(function(e,t){_this.next(e,t)})}},{key:"wrapUserFunction",value:function wrapUserFunction(e){try{var t=e();return _instanceof$1(t,PersistencePromise)?t:PersistencePromise.resolve(t)}catch(e){return PersistencePromise.reject(e)}}},{key:"wrapSuccess",value:function wrapSuccess(e,t){return e?this.wrapUserFunction(function(){return e(t)}):PersistencePromise.resolve(t)}},{key:"wrapFailure",value:function wrapFailure(e,t){return e?this.wrapUserFunction(function(){return e(t)}):PersistencePromise.reject(t)}}],[{key:"resolve",value:function resolve(e){return new PersistencePromise(function(t,n){t(e)})}},{key:"reject",value:function reject(e){return new PersistencePromise(function(t,n){n(e)})}},{key:"waitFor",value:function waitFor(e){return new PersistencePromise(function(t,n){var _$r=0,i=0,s=!1;e.forEach(function(e){++_$r,e.next(function(){++i,s&&i===_$r&&t()},function(e){return n(e)})}),s=!0,i===_$r&&t()})}},{key:"or",value:function or(e){var t=PersistencePromise.resolve(!1);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var n=_step.value;t=t.next(function(e){return e?PersistencePromise.resolve(e):n()})};for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t}},{key:"forEach",value:function forEach(e,t){var _this=this;var n=[];return e.forEach(function(e,r){n.push(t.call(_this,e,r))}),this.waitFor(n)}},{key:"mapArray",value:function mapArray(e,t){return new PersistencePromise(function(n,r){var _loop=function _loop(_){var a=_;t(e[a]).next(function(e){s[a]=e,++o,o===i&&n(s)},function(e){return r(e)})};var i=e.length,s=new Array(i);var o=0;for(var _=0;_<i;_++)_loop(_)})}},{key:"doWhile",value:function doWhile(e,t){return new PersistencePromise(function(n,r){var process1=function process11(){!0===e()?t().next(function(){process1()},r):n()};process1()})}}]);return PersistencePromise}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_SimpleDbTransaction=function(){function __PRIVATE_SimpleDbTransaction(e,t){var _this=this;_class_call_check$1(this,__PRIVATE_SimpleDbTransaction);this.action=e,this.transaction=t,this.aborted=!1,this.V=new __PRIVATE_Deferred,this.transaction.oncomplete=function(){_this.V.resolve()},this.transaction.onabort=function(){t.error?_this.V.reject(new __PRIVATE_IndexedDbTransactionError(e,t.error)):_this.V.resolve()},this.transaction.onerror=function(t){var n=__PRIVATE_checkForAndReportiOSError(t.target.error);_this.V.reject(new __PRIVATE_IndexedDbTransactionError(e,n))}}_create_class$1(__PRIVATE_SimpleDbTransaction,[{key:"m",get:function get(){return this.V.promise}},{key:"abort",value:function abort(e){e&&this.V.reject(e),this.aborted||(__PRIVATE_logDebug("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"g",value:function g(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function store(e){var t=this.transaction.objectStore(e);return new __PRIVATE_SimpleDbStore(t)}}],[{key:"open",value:function open(e,t,n,r){try{return new __PRIVATE_SimpleDbTransaction(t,e.transaction(r,n))}catch(e){throw new __PRIVATE_IndexedDbTransactionError(t,e)}}}]);return __PRIVATE_SimpleDbTransaction}();var __PRIVATE_SimpleDb=function(){function __PRIVATE_SimpleDb(e,t,n){_class_call_check$1(this,__PRIVATE_SimpleDb);this.name=e,this.version=t,this.p=n;12.2===__PRIVATE_SimpleDb.S(getUA())&&__PRIVATE_logError("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}_create_class$1(__PRIVATE_SimpleDb,[{key:"O",value:function O(e){var _this=this;return _async_to_generator$3(function(){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=_this.db;if(_tmp)return[3,2];__PRIVATE_logDebug("SimpleDb","Opening database:",_this.name);return[4,new Promise(function(t,n){var _$r=indexedDB.open(_this.name,_this.version);_$r.onsuccess=function(e){var n=e.target.result;t(n)},_$r.onblocked=function(){n(new __PRIVATE_IndexedDbTransactionError(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},_$r.onerror=function(t){var _$r=t.target.error;"VersionError"===_$r.name?n(new FirestoreError(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===_$r.name?n(new FirestoreError(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+_$r)):n(new __PRIVATE_IndexedDbTransactionError(e,_$r))},_$r.onupgradeneeded=function(e){__PRIVATE_logDebug("SimpleDb",'Database "'+_this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;_this.p.N(t,_$r.transaction,e.oldVersion,_this.version).next(function(){__PRIVATE_logDebug("SimpleDb","Database upgrade to version "+_this.version+" complete")})}})];case 1:_tmp=_this.db=_state.sent();_state.label=2;case 2:return[2,(_this.B&&(_this.db.onversionchange=function(e){return _this.B(e)}),_this.db)]}})})()}},{key:"L",value:function L(e){this.B=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function runTransaction(e,t,n,r){var _this=this;return _async_to_generator$3(function(){var _loop,i,s,_ret;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_loop=function _loop(){var _$t,s1,_tmp,e1,_$t1,_$n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:++s;_state.label=1;case 1:_state.trys.push([1,4,,5]);return[4,_this.O(e)];case 2:_this.db=_state.sent();_$t=__PRIVATE_SimpleDbTransaction.open(_this.db,e,i?"readonly":"readwrite",n),s1=r(_$t).next(function(e){return _$t.g(),e}).catch(function(e){return _$t.abort(e),PersistencePromise.reject(e)}).toPromise();_tmp={};s1.catch(function(){});return[4,_$t.m];case 3:return[2,(_tmp.v=(_state.sent(),s1),_tmp)];case 4:e1=_state.sent();_$t1=e1,_$n="FirebaseError"!==_$t1.name&&s<3;if(__PRIVATE_logDebug("SimpleDb","Transaction failed with error:",_$t1.message,"Retrying:",_$n),_this.close(),!_$n)return[2,{v:Promise.reject(_$t1)}];return[3,5];case 5:return[2]}})};i="readonly"===t;s=0;_state.label=1;case 1:return[5,_ts_values(_loop())];case 2:_ret=_state.sent();if(_type_of$1(_ret)==="object")return[2,_ret.v];_state.label=3;case 3:return[3,1];case 4:return[2]}})})()}},{key:"close",value:function close(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function _delete(e){return __PRIVATE_logDebug("SimpleDb","Removing database:",e),__PRIVATE_wrapRequest(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"D",value:function D(){if(!isIndexedDBAvailable())return!1;if(__PRIVATE_SimpleDb.C())return!0;var e=getUA(),t=__PRIVATE_SimpleDb.S(e),n=0<t&&t<10,_$r=__PRIVATE_SimpleDb.v(e),i=0<_$r&&_$r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}},{key:"C",value:function C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}},{key:"M",value:function M(e,t){return e.store(t)}},{key:"S",value:function S(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"v",value:function v(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]);return __PRIVATE_SimpleDb}();var __PRIVATE_IterationController=function(){function __PRIVATE_IterationController(e){_class_call_check$1(this,__PRIVATE_IterationController);this.k=e,this.q=!1,this.K=null}_create_class$1(__PRIVATE_IterationController,[{key:"isDone",get:function get(){return this.q}},{key:"$",get:function get(){return this.K}},{key:"cursor",set:function set(e){this.k=e}},{key:"done",value:function done(){this.q=!0}},{key:"U",value:function U(e){this.K=e}},{key:"delete",value:function _delete(){return __PRIVATE_wrapRequest(this.k.delete())}}]);return __PRIVATE_IterationController}();var __PRIVATE_IndexedDbTransactionError=function(FirestoreError){_inherits$1(__PRIVATE_IndexedDbTransactionError,FirestoreError);var _super=_create_super$1(__PRIVATE_IndexedDbTransactionError);function __PRIVATE_IndexedDbTransactionError(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbTransactionError);var _this;_this=_super.call(this,D.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(t)),_this.name="IndexedDbTransactionError";return _possible_constructor_return$1(_this)}return __PRIVATE_IndexedDbTransactionError}(FirestoreError);function __PRIVATE_isIndexedDbTransactionError(e){return"IndexedDbTransactionError"===e.name}var __PRIVATE_SimpleDbStore=function(){function __PRIVATE_SimpleDbStore(e){_class_call_check$1(this,__PRIVATE_SimpleDbStore);this.store=e}_create_class$1(__PRIVATE_SimpleDbStore,[{key:"put",value:function put(e,t){var n;return void 0!==t?(__PRIVATE_logDebug("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(__PRIVATE_logDebug("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),__PRIVATE_wrapRequest(n)}},{key:"add",value:function add(e){__PRIVATE_logDebug("SimpleDb","ADD",this.store.name,e,e);return __PRIVATE_wrapRequest(this.store.add(e))}},{key:"get",value:function get(e){var _this=this;return __PRIVATE_wrapRequest(this.store.get(e)).next(function(t){return void 0===t&&(t=null),__PRIVATE_logDebug("SimpleDb","GET",_this.store.name,e,t),t})}},{key:"delete",value:function _delete(e){__PRIVATE_logDebug("SimpleDb","DELETE",this.store.name,e);return __PRIVATE_wrapRequest(this.store.delete(e))}},{key:"count",value:function count(){__PRIVATE_logDebug("SimpleDb","COUNT",this.store.name);return __PRIVATE_wrapRequest(this.store.count())}},{key:"W",value:function W(e,t){var n=this.options(e,t),_$r=n.index?this.store.index(n.index):this.store;if("function"==typeof _$r.getAll){var _$e=_$r.getAll(n.range);return new PersistencePromise(function(t,n){_$e.onerror=function(e){n(e.target.error)},_$e.onsuccess=function(e){t(e.target.result)}})}{var _$e1=this.cursor(n),_$t=[];return this.G(_$e1,function(e,n){_$t.push(n)}).next(function(){return _$t})}}},{key:"j",value:function j(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new PersistencePromise(function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}})}},{key:"H",value:function H(e,t){__PRIVATE_logDebug("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.J=!1;var _$r=this.cursor(n);return this.G(_$r,function(e,t,n){return n.delete()})}},{key:"Y",value:function Y(e,t){var n;t?n=e:(n={},t=e);var _$r=this.cursor(n);return this.G(_$r,t)}},{key:"Z",value:function Z(e){var t=this.cursor({});return new PersistencePromise(function(n,r){t.onerror=function(e){var t=__PRIVATE_checkForAndReportiOSError(e.target.error);r(t)},t.onsuccess=function(t){var _$r=t.target.result;_$r?e(_$r.primaryKey,_$r.value).next(function(e){e?_$r.continue():n()}):n()}})}},{key:"G",value:function G(e,t){var n=[];return new PersistencePromise(function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(!i)return void r();var s=new __PRIVATE_IterationController(i),o=t(i.primaryKey,i.value,s);if(_instanceof$1(o,PersistencePromise)){var _$e=o.catch(function(e){return s.done(),PersistencePromise.reject(e)});n.push(_$e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}}).next(function(){return PersistencePromise.waitFor(n)})}},{key:"options",value:function options(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function cursor(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]);return __PRIVATE_SimpleDbStore}();function __PRIVATE_wrapRequest(e){return new PersistencePromise(function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=__PRIVATE_checkForAndReportiOSError(e.target.error);n(t)}})}var F=!1;function __PRIVATE_checkForAndReportiOSError(e){var t=__PRIVATE_SimpleDb.S(getUA());if(t>=12.2&&t<13){var t1="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t1)>=0){var _$e=new FirestoreError("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(t1,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return F||(F=!0,setTimeout(function(){throw _$e},0)),_$e}}return e}var __PRIVATE_IndexBackfillerScheduler=function(){function __PRIVATE_IndexBackfillerScheduler(e,t){_class_call_check$1(this,__PRIVATE_IndexBackfillerScheduler);this.asyncQueue=e,this.X=t,this.task=null}_create_class$1(__PRIVATE_IndexBackfillerScheduler,[{key:"start",value:function start(){this.ee(15e3)}},{key:"stop",value:function stop(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function get(){return null!==this.task}},{key:"ee",value:function ee(e){var _this=this;__PRIVATE_logDebug("IndexBackfiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,_async_to_generator$3(function(){var _tmp,_,_1,_$e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_this.task=null;_state.label=1;case 1:_state.trys.push([1,3,,7]);_tmp=["IndexBackfiller"];_1=(_="Documents written: ").concat;return[4,_this.X.te()];case 2:__PRIVATE_logDebug.apply(void 0,_tmp.concat([_1.apply(_,[_state.sent()])]));return[3,7];case 3:_$e=_state.sent();if(!__PRIVATE_isIndexedDbTransactionError(_$e))return[3,4];__PRIVATE_logDebug("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",_$e);return[3,6];case 4:return[4,__PRIVATE_ignoreIfPrimaryLeaseLoss(_$e)];case 5:_state.sent();_state.label=6;case 6:return[3,7];case 7:return[4,_this.ee(6e4)];case 8:_state.sent();return[2]}})}))}}]);return __PRIVATE_IndexBackfillerScheduler}();var __PRIVATE_IndexBackfiller=function(){function __PRIVATE_IndexBackfiller(e,t){_class_call_check$1(this,__PRIVATE_IndexBackfiller);this.localStore=e,this.persistence=t}_create_class$1(__PRIVATE_IndexBackfiller,[{key:"te",value:function te(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){return[2,_this.persistence.runTransaction("Backfill Indexes","readwrite-primary",function(t){return _this.ne(t,e)})]})})()}},{key:"ne",value:function ne(e,t){var _this=this;var n=new Set;var _$r=t,i=!0;return PersistencePromise.doWhile(function(){return!0===i&&_$r>0},function(){return _this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(function(t){if(null!==t&&!n.has(t))return __PRIVATE_logDebug("IndexBackfiller","Processing collection: ".concat(t)),_this.re(e,t,_$r).next(function(e){_$r-=e,n.add(t)});i=!1})}).next(function(){return t-_$r})}},{key:"re",value:function re(e,t,n){var _this=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(function(r){return _this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(function(n){var i=n.changes;return _this.localStore.indexManager.updateIndexEntries(e,i).next(function(){return _this.ie(r,n)}).next(function(n){return __PRIVATE_logDebug("IndexBackfiller","Updating offset: ".concat(n)),_this.localStore.indexManager.updateCollectionGroup(e,t,n)}).next(function(){return i.size})})})}},{key:"ie",value:function ie(e,t){var n=e;return t.changes.forEach(function(e,t){var _$r=__PRIVATE_newIndexOffsetFromDocument(t);__PRIVATE_indexOffsetComparator(_$r,n)>0&&(n=_$r)}),new IndexOffset(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]);return __PRIVATE_IndexBackfiller}();/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_ListenSequence=function(){function __PRIVATE_ListenSequence(e,t){var _this=this;_class_call_check$1(this,__PRIVATE_ListenSequence);this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return _this.se(e)},this.oe=function(e){return t.writeSequenceNumber(e)})}_create_class$1(__PRIVATE_ListenSequence,[{key:"se",value:function se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function next(){var e=++this.previousValue;return this.oe&&this.oe(e),e}}]);return __PRIVATE_ListenSequence}();__PRIVATE_ListenSequence._e=-1;function __PRIVATE_isNullOrUndefined(e){return null==e}function __PRIVATE_isNegativeZero(e){return 0===e&&1/e==-1/0}function isSafeInteger(e){return"number"==typeof e&&Number.isInteger(e)&&!__PRIVATE_isNegativeZero(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_encodeResourcePath(e){var t="";for(var n=0;n<e.length;n++)t.length>0&&(t=__PRIVATE_encodeSeparator(t)),t=__PRIVATE_encodeSegment(e.get(n),t);return __PRIVATE_encodeSeparator(t)}function __PRIVATE_encodeSegment(e,t){var n=t;var _$r=e.length;for(var _$t=0;_$t<_$r;_$t++){var r1=e.charAt(_$t);switch(r1){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r1}}return n}function __PRIVATE_encodeSeparator(e){return e+"\x01\x01"}function __PRIVATE_decodeResourcePath(e){var t=e.length;if(__PRIVATE_hardAssert(t>=2),2===t)return __PRIVATE_hardAssert("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ResourcePath.emptyPath();var __PRIVATE_lastReasonableEscapeIndex=t-2,n=[];var _$r="";for(var i=0;i<t;){var t1=e.indexOf("\x01",i);(t1<0||t1>__PRIVATE_lastReasonableEscapeIndex)&&fail();switch(e.charAt(t1+1)){case"\x01":var s=e.substring(i,t1);var o=void 0;0===_$r.length?o=s:(_$r+=s,o=_$r,_$r=""),n.push(o);break;case"\x10":_$r+=e.substring(i,t1),_$r+="\0";break;case"\x11":_$r+=e.substring(i,t1+1);break;default:fail()}i=t1+2}return new ResourcePath(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var M=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newDbDocumentMutationPrefixForPath(e,t){return[e,__PRIVATE_encodeResourcePath(t)]}function __PRIVATE_newDbDocumentMutationKey(e,t,n){return[e,__PRIVATE_encodeResourcePath(t),n]}var x={},O=["prefixPath","collectionGroup","readTime","documentId"],N=["prefixPath","collectionGroup","documentId"],B=["collectionGroup","readTime","prefixPath","documentId"],L=["canonicalId","targetId"],k=["targetId","path"],q=["path","targetId"],Q=["collectionId","parent"],K=["indexId","uid"],$=["uid","sequenceNumber"],U=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],W=["indexId","uid","orderedDocumentKey"],G=["userId","collectionPath","documentId"],z=["userId","collectionPath","largestBatchId"],j=["userId","collectionGroup","largestBatchId"],H=_to_consumable_array$1(_to_consumable_array$1(_to_consumable_array$1(_to_consumable_array$1(["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"]).concat(["clientMetadata"])).concat(["remoteDocumentGlobal"])).concat(["collectionParents"])).concat(["bundles","namedQueries"]),J=_to_consumable_array$1(H).concat(["documentOverlays"]),Y=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Z=Y,X=_to_consumable_array$1(Z).concat(["indexConfiguration","indexState","indexEntries"]);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbTransaction=function(PersistenceTransaction){_inherits$1(__PRIVATE_IndexedDbTransaction,PersistenceTransaction);var _super=_create_super$1(__PRIVATE_IndexedDbTransaction);function __PRIVATE_IndexedDbTransaction(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbTransaction);var _this;_this=_super.call(this),_this.ae=e,_this.currentSequenceNumber=t;return _possible_constructor_return$1(_this)}return __PRIVATE_IndexedDbTransaction}(PersistenceTransaction);function __PRIVATE_getStore(e,t){var n=__PRIVATE_debugCast(e);return __PRIVATE_SimpleDb.M(n.ae,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_objectSize(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function forEach(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function isEmpty(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SortedMap=function(){function SortedMap(e,t){_class_call_check$1(this,SortedMap);this.comparator=e,this.root=t||LLRBNode.EMPTY}_create_class$1(SortedMap,[{key:"insert",value:function insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}},{key:"remove",value:function remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}},{key:"get",value:function get(e){var t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function indexOf(e){var t=0,n=this.root;for(;!n.isEmpty();){var _$r=this.comparator(e,n.key);if(0===_$r)return t+n.left.size;_$r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function isEmpty(){return this.root.isEmpty()}},{key:"size",get:function get(){return this.root.size}},{key:"minKey",value:function minKey(){return this.root.minKey()}},{key:"maxKey",value:function maxKey(){return this.root.maxKey()}},{key:"inorderTraversal",value:function inorderTraversal(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function forEach(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:"toString",value:function toString(){var e=[];return this.inorderTraversal(function(t,n){return e.push("".concat(t,":").concat(n)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function reverseTraversal(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}]);return SortedMap}();var SortedMapIterator=function(){function SortedMapIterator(e,t,n,r){_class_call_check$1(this,SortedMapIterator);this.isReverse=r,this.nodeStack=[];var i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}_create_class$1(SortedMapIterator,[{key:"getNext",value:function getNext(){var e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function hasNext(){return this.nodeStack.length>0}},{key:"peek",value:function peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]);return SortedMapIterator}();var LLRBNode=function(){function LLRBNode(e,t,n,r,i){_class_call_check$1(this,LLRBNode);this.key=e,this.value=t,this.color=null!=n?n:LLRBNode.RED,this.left=null!=r?r:LLRBNode.EMPTY,this.right=null!=i?i:LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}_create_class$1(LLRBNode,[{key:"copy",value:function copy(e,t,n,r,i){return new LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}},{key:"isEmpty",value:function isEmpty(){return!1}},{key:"inorderTraversal",value:function inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function min(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function minKey(){return this.min().key}},{key:"maxKey",value:function maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function insert(e,t,n){var _$r=this;var i=n(e,_$r.key);return _$r=i<0?_$r.copy(null,null,null,_$r.left.insert(e,t,n),null):0===i?_$r.copy(null,t,null,null,null):_$r.copy(null,null,null,null,_$r.right.insert(e,t,n)),_$r.fixUp()}},{key:"removeMin",value:function removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}},{key:"remove",value:function remove(e,t){var n,_$r=this;if(t(e,_$r.key)<0)_$r.left.isEmpty()||_$r.left.isRed()||_$r.left.left.isRed()||(_$r=_$r.moveRedLeft()),_$r=_$r.copy(null,null,null,_$r.left.remove(e,t),null);else{if(_$r.left.isRed()&&(_$r=_$r.rotateRight()),_$r.right.isEmpty()||_$r.right.isRed()||_$r.right.left.isRed()||(_$r=_$r.moveRedRight()),0===t(e,_$r.key)){if(_$r.right.isEmpty())return LLRBNode.EMPTY;n=_$r.right.min(),_$r=_$r.copy(n.key,n.value,null,null,_$r.right.removeMin())}_$r=_$r.copy(null,null,null,null,_$r.right.remove(e,t))}return _$r.fixUp()}},{key:"isRed",value:function isRed(){return this.color}},{key:"fixUp",value:function fixUp(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function moveRedLeft(){var e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}},{key:"moveRedRight",value:function moveRedRight(){var e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}},{key:"rotateLeft",value:function rotateLeft(){var e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}},{key:"rotateRight",value:function rotateRight(){var e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}},{key:"colorFlip",value:function colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function check(){if(this.isRed()&&this.left.isRed())throw fail();if(this.right.isRed())throw fail();var e=this.left.check();if(e!==this.right.check())throw fail();return e+(this.isRed()?0:1)}}]);return LLRBNode}();LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;LLRBNode.EMPTY=new(function(){function LLRBEmptyNode(){_class_call_check$1(this,LLRBEmptyNode);this.size=0}_create_class$1(LLRBEmptyNode,[{key:"key",get:function get(){throw fail()}},{key:"value",get:function get(){throw fail()}},{key:"color",get:function get(){throw fail()}},{key:"left",get:function get(){throw fail()}},{key:"right",get:function get(){throw fail()}},{key:"copy",value:function copy(e,t,n,r,i){return this}},{key:"insert",value:function insert(e,t,n){return new LLRBNode(e,t)}},{key:"remove",value:function remove(e,t){return this}},{key:"isEmpty",value:function isEmpty(){return!0}},{key:"inorderTraversal",value:function inorderTraversal(e){return!1}},{key:"reverseTraversal",value:function reverseTraversal(e){return!1}},{key:"minKey",value:function minKey(){return null}},{key:"maxKey",value:function maxKey(){return null}},{key:"isRed",value:function isRed(){return!1}},{key:"checkMaxDepth",value:function checkMaxDepth(){return!0}},{key:"check",value:function check(){return 0}}]);return LLRBEmptyNode}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SortedSet=function(){function SortedSet(e){_class_call_check$1(this,SortedSet);this.comparator=e,this.data=new SortedMap(this.comparator)}_create_class$1(SortedSet,[{key:"has",value:function has(e){return null!==this.data.get(e)}},{key:"first",value:function first(){return this.data.minKey()}},{key:"last",value:function last(){return this.data.maxKey()}},{key:"size",get:function get(){return this.data.size}},{key:"indexOf",value:function indexOf(e){return this.data.indexOf(e)}},{key:"forEach",value:function forEach(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:"forEachInRange",value:function forEachInRange(e,t){var n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var _$r=n.getNext();if(this.comparator(_$r.key,e[1])>=0)return;t(_$r.key)}}},{key:"forEachWhile",value:function forEachWhile(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();){if(!e(n.getNext().key))return}}},{key:"firstAfterOrEqual",value:function firstAfterOrEqual(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function getIterator(){return new SortedSetIterator(this.data.getIterator())}},{key:"getIteratorFrom",value:function getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}},{key:"add",value:function add(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function _delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function isEmpty(){return this.data.isEmpty()}},{key:"unionWith",value:function unionWith(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:"isEqual",value:function isEqual(e){if(!_instanceof$1(e,SortedSet))return!1;if(this.size!==e.size)return!1;var t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){var _$e=t.getNext().key,_$r=n.getNext().key;if(0!==this.comparator(_$e,_$r))return!1}return!0}},{key:"toArray",value:function toArray(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:"toString",value:function toString(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function copy(e){var t=new SortedSet(this.comparator);return t.data=e,t}}]);return SortedSet}();var SortedSetIterator=function(){function SortedSetIterator(e){_class_call_check$1(this,SortedSetIterator);this.iter=e}_create_class$1(SortedSetIterator,[{key:"getNext",value:function getNext(){return this.iter.getNext().key}},{key:"hasNext",value:function hasNext(){return this.iter.hasNext()}}]);return SortedSetIterator}();function __PRIVATE_advanceIterator(e){return e.hasNext()?e.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FieldMask=function(){function FieldMask(e){_class_call_check$1(this,FieldMask);this.fields=e,e.sort(FieldPath$1.comparator)}_create_class$1(FieldMask,[{key:"unionWith",value:function unionWith(e){var t=new SortedSet(FieldPath$1.comparator);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.fields[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;t=t.add(_$e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=e[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var n=_step1.value;t=t.add(n)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return new FieldMask(t.toArray())}},{key:"covers",value:function covers(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.fields[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(t.isPrefixOf(e))return!0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!1}},{key:"isEqual",value:function isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}],[{key:"empty",value:function empty(){return new FieldMask([])}}]);return FieldMask}();/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_Base64DecodeError=function(Error1){_inherits$1(__PRIVATE_Base64DecodeError,Error1);var _super=_create_super$1(__PRIVATE_Base64DecodeError);function __PRIVATE_Base64DecodeError(){_class_call_check$1(this,__PRIVATE_Base64DecodeError);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments))),_this.name="Base64DecodeError";return _possible_constructor_return$1(_this)}return __PRIVATE_Base64DecodeError}(_wrap_native_super(Error));/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ByteString=function(){function ByteString(e){_class_call_check$1(this,ByteString);this.binaryString=e}_create_class$1(ByteString,[{key:Symbol.iterator,value:function value(){var _this=this;var e=0;return{next:function next(){return e<_this.binaryString.length?{value:_this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function toBase64(){return function __PRIVATE_encodeBase64(e){return btoa(e)}(this.binaryString)}},{key:"toUint8Array",value:function toUint8Array(){return function __PRIVATE_uint8ArrayFromBinaryString(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function approximateByteSize(){return 2*this.binaryString.length}},{key:"compareTo",value:function compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}},{key:"isEqual",value:function isEqual(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function fromBase64String(e){var t=function __PRIVATE_decodeBase64(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&_instanceof$1(e,DOMException)?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+e):e}}(e);return new ByteString(t)}},{key:"fromUint8Array",value:function fromUint8Array(e){var t=function __PRIVATE_binaryStringFromUint8Array(e){var t="";for(var n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ByteString(t)}}]);return ByteString}();ByteString.EMPTY_BYTE_STRING=new ByteString("");var ee=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(e){if(__PRIVATE_hardAssert(!!e),"string"==typeof e){var t=0;var n=ee.exec(e);if(__PRIVATE_hardAssert(!!n),n[1]){var _$e=n[1];_$e=(_$e+"000000000").substr(0,9),t=Number(_$e)}var _$r=new Date(e);return{seconds:Math.floor(_$r.getTime()/1e3),nanos:t}}return{seconds:__PRIVATE_normalizeNumber(e.seconds),nanos:__PRIVATE_normalizeNumber(e.nanos)}}function __PRIVATE_normalizeNumber(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function __PRIVATE_normalizeByteString(e){return"string"==typeof e?ByteString.fromBase64String(e):ByteString.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_isServerTimestamp(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function __PRIVATE_getPreviousValue(e){var t=e.mapValue.fields.__previous_value__;return __PRIVATE_isServerTimestamp(t)?__PRIVATE_getPreviousValue(t):t}function __PRIVATE_getLocalWriteTime(e){var t=__PRIVATE_normalizeTimestamp(e.mapValue.fields.__local_write_time__.timestampValue);return new Timestamp(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DatabaseInfo=function DatabaseInfo(e,t,n,r,i,s,o,_,a){_class_call_check$1(this,DatabaseInfo);this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=_,this.useFetchStreams=a};var DatabaseId=function(){function DatabaseId(e,t){_class_call_check$1(this,DatabaseId);this.projectId=e,this.database=t||"(default)"}_create_class$1(DatabaseId,[{key:"isDefaultDatabase",get:function get(){return"(default)"===this.database}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,DatabaseId)&&e.projectId===this.projectId&&e.database===this.database}}],[{key:"empty",value:function empty(){return new DatabaseId("","")}}]);return DatabaseId}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var te={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ne={nullValue:"NULL_VALUE"};function __PRIVATE_typeOrder(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?__PRIVATE_isServerTimestamp(e)?4:__PRIVATE_isMaxValue(e)?9007199254740991:10:fail()}function __PRIVATE_valueEquals(e,t){if(e===t)return!0;var n=__PRIVATE_typeOrder(e);if(n!==__PRIVATE_typeOrder(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(e).isEqual(__PRIVATE_getLocalWriteTime(t));case 3:return function __PRIVATE_timestampEquals(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=__PRIVATE_normalizeTimestamp(e.timestampValue),_$r=__PRIVATE_normalizeTimestamp(t.timestampValue);return n.seconds===_$r.seconds&&n.nanos===_$r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function __PRIVATE_blobEquals(e,t){return __PRIVATE_normalizeByteString(e.bytesValue).isEqual(__PRIVATE_normalizeByteString(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function __PRIVATE_geoPointEquals(e,t){return __PRIVATE_normalizeNumber(e.geoPointValue.latitude)===__PRIVATE_normalizeNumber(t.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(e.geoPointValue.longitude)===__PRIVATE_normalizeNumber(t.geoPointValue.longitude)}(e,t);case 2:return function __PRIVATE_numberEquals(e,t){if("integerValue"in e&&"integerValue"in t)return __PRIVATE_normalizeNumber(e.integerValue)===__PRIVATE_normalizeNumber(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=__PRIVATE_normalizeNumber(e.doubleValue),_$r=__PRIVATE_normalizeNumber(t.doubleValue);return n===_$r?__PRIVATE_isNegativeZero(n)===__PRIVATE_isNegativeZero(_$r):isNaN(n)&&isNaN(_$r)}return!1}(e,t);case 9:return __PRIVATE_arrayEquals(e.arrayValue.values||[],t.arrayValue.values||[],__PRIVATE_valueEquals);case 10:return function __PRIVATE_objectEquals(e,t){var n=e.mapValue.fields||{},_$r=t.mapValue.fields||{};if(__PRIVATE_objectSize(n)!==__PRIVATE_objectSize(_$r))return!1;for(var _$e in n)if(n.hasOwnProperty(_$e)&&(void 0===_$r[_$e]||!__PRIVATE_valueEquals(n[_$e],_$r[_$e])))return!1;return!0}(e,t);default:return fail()}}function __PRIVATE_arrayValueContains(e,t){return void 0!==(e.values||[]).find(function(e){return __PRIVATE_valueEquals(e,t)})}function __PRIVATE_valueCompare(e,t){if(e===t)return 0;var n=__PRIVATE_typeOrder(e),_$r=__PRIVATE_typeOrder(t);if(n!==_$r)return __PRIVATE_primitiveComparator(n,_$r);switch(n){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(e.booleanValue,t.booleanValue);case 2:return function __PRIVATE_compareNumbers(e,t){var n=__PRIVATE_normalizeNumber(e.integerValue||e.doubleValue),_$r=__PRIVATE_normalizeNumber(t.integerValue||t.doubleValue);return n<_$r?-1:n>_$r?1:n===_$r?0:isNaN(n)?isNaN(_$r)?0:-1:1}(e,t);case 3:return __PRIVATE_compareTimestamps(e.timestampValue,t.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(e),__PRIVATE_getLocalWriteTime(t));case 5:return __PRIVATE_primitiveComparator(e.stringValue,t.stringValue);case 6:return function __PRIVATE_compareBlobs(e,t){var n=__PRIVATE_normalizeByteString(e),_$r=__PRIVATE_normalizeByteString(t);return n.compareTo(_$r)}(e.bytesValue,t.bytesValue);case 7:return function __PRIVATE_compareReferences(e,t){var n=e.split("/"),_$r=t.split("/");for(var _$e=0;_$e<n.length&&_$e<_$r.length;_$e++){var _$t=__PRIVATE_primitiveComparator(n[_$e],_$r[_$e]);if(0!==_$t)return _$t}return __PRIVATE_primitiveComparator(n.length,_$r.length)}(e.referenceValue,t.referenceValue);case 8:return function __PRIVATE_compareGeoPoints(e,t){var n=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(t.latitude));if(0!==n)return n;return __PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e.longitude),__PRIVATE_normalizeNumber(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function __PRIVATE_compareArrays(e,t){var n=e.values||[],_$r=t.values||[];for(var _$e=0;_$e<n.length&&_$e<_$r.length;++_$e){var _$t=__PRIVATE_valueCompare(n[_$e],_$r[_$e]);if(_$t)return _$t}return __PRIVATE_primitiveComparator(n.length,_$r.length)}(e.arrayValue,t.arrayValue);case 10:return function __PRIVATE_compareMaps(e,t){if(e===te.mapValue&&t===te.mapValue)return 0;if(e===te.mapValue)return 1;if(t===te.mapValue)return-1;var n=e.fields||{},_$r=Object.keys(n),i=t.fields||{},s=Object.keys(i);_$r.sort(),s.sort();for(var _$e=0;_$e<_$r.length&&_$e<s.length;++_$e){var _$t=__PRIVATE_primitiveComparator(_$r[_$e],s[_$e]);if(0!==_$t)return _$t;var o=__PRIVATE_valueCompare(n[_$r[_$e]],i[s[_$e]]);if(0!==o)return o}return __PRIVATE_primitiveComparator(_$r.length,s.length)}(e.mapValue,t.mapValue);default:throw fail()}}function __PRIVATE_compareTimestamps(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return __PRIVATE_primitiveComparator(e,t);var n=__PRIVATE_normalizeTimestamp(e),_$r=__PRIVATE_normalizeTimestamp(t),i=__PRIVATE_primitiveComparator(n.seconds,_$r.seconds);return 0!==i?i:__PRIVATE_primitiveComparator(n.nanos,_$r.nanos)}function canonicalId(e){return __PRIVATE_canonifyValue(e)}function __PRIVATE_canonifyValue(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function __PRIVATE_canonifyTimestamp(e){var t=__PRIVATE_normalizeTimestamp(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function __PRIVATE_canonifyByteString(e){return __PRIVATE_normalizeByteString(e).toBase64()}(e.bytesValue):"referenceValue"in e?function __PRIVATE_canonifyReference(e){return DocumentKey.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function __PRIVATE_canonifyGeoPoint(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function __PRIVATE_canonifyArray(e){var t="[",n=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=(e.values||[])[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;n?n=!1:t+=",",t+=__PRIVATE_canonifyValue(_$r)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t+"]"}(e.arrayValue):"mapValue"in e?function __PRIVATE_canonifyMap(e){var t=Object.keys(e.fields||{}).sort();var n="{",_$r=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;_$r?_$r=!1:n+=",",n+="".concat(i,":").concat(__PRIVATE_canonifyValue(e.fields[i]))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return n+"}"}(e.mapValue):fail()}function __PRIVATE_estimateByteSize(e){switch(__PRIVATE_typeOrder(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=__PRIVATE_getPreviousValue(e);return t?16+__PRIVATE_estimateByteSize(t):16;case 5:return 2*e.stringValue.length;case 6:return __PRIVATE_normalizeByteString(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function __PRIVATE_estimateArrayByteSize(e){return(e.values||[]).reduce(function(e,t){return e+__PRIVATE_estimateByteSize(t)},0)}(e.arrayValue);case 10:return function __PRIVATE_estimateMapByteSize(e){var t=0;return forEach(e.fields,function(e,n){t+=e.length+__PRIVATE_estimateByteSize(n)}),t}(e.mapValue);default:throw fail()}}function __PRIVATE_refValue(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function isInteger(e){return!!e&&"integerValue"in e}function isArray(e){return!!e&&"arrayValue"in e}function __PRIVATE_isNullValue(e){return!!e&&"nullValue"in e}function __PRIVATE_isNanValue(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function __PRIVATE_isMapValue(e){return!!e&&"mapValue"in e}function __PRIVATE_deepClone(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return forEach(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=__PRIVATE_deepClone(n)}),t}if(e.arrayValue){var t1={arrayValue:{values:[]}};for(var n=0;n<(e.arrayValue.values||[]).length;++n)t1.arrayValue.values[n]=__PRIVATE_deepClone(e.arrayValue.values[n]);return t1}return Object.assign({},e)}function __PRIVATE_isMaxValue(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function __PRIVATE_valuesGetLowerBound(e){return"nullValue"in e?ne:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?__PRIVATE_refValue(DatabaseId.empty(),DocumentKey.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:fail()}function __PRIVATE_valuesGetUpperBound(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?__PRIVATE_refValue(DatabaseId.empty(),DocumentKey.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?te:fail()}function __PRIVATE_lowerBoundCompare(e,t){var n=__PRIVATE_valueCompare(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function __PRIVATE_upperBoundCompare(e,t){var n=__PRIVATE_valueCompare(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ObjectValue=function(){function ObjectValue(e){_class_call_check$1(this,ObjectValue);this.value=e}_create_class$1(ObjectValue,[{key:"field",value:function field(e){if(e.isEmpty())return this.value;{var t=this.value;for(var n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!__PRIVATE_isMapValue(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}},{key:"set",value:function set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}},{key:"setAll",value:function setAll(e){var _this=this;var t=FieldPath$1.emptyPath(),n={},_$r=[];e.forEach(function(e,i){if(!t.isImmediateParentOf(i)){var _$e=_this.getFieldsMap(t);_this.applyChanges(_$e,n,_$r),n={},_$r=[],t=i.popLast()}e?n[i.lastSegment()]=__PRIVATE_deepClone(e):_$r.push(i.lastSegment())});var i=this.getFieldsMap(t);this.applyChanges(i,n,_$r)}},{key:"delete",value:function _delete(e){var t=this.field(e.popLast());__PRIVATE_isMapValue(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}},{key:"getFieldsMap",value:function getFieldsMap(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var _$r=t.mapValue.fields[e.get(n)];__PRIVATE_isMapValue(_$r)&&_$r.mapValue.fields||(_$r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=_$r),t=_$r}return t.mapValue.fields}},{key:"applyChanges",value:function applyChanges(e,t,n){forEach(t,function(t,n){return e[t]=n});var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;delete e[_$t]}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"clone",value:function clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}],[{key:"empty",value:function empty(){return new ObjectValue({mapValue:{}})}}]);return ObjectValue}();function __PRIVATE_extractFieldMask(e){var t=[];return forEach(e.fields,function(e,n){var _$r=new FieldPath$1([e]);if(__PRIVATE_isMapValue(n)){var _$e=__PRIVATE_extractFieldMask(n.mapValue).fields;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(0===_$e.length)t.push(_$r);else try{for(var _iterator=_$e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$n=_step.value;t.push(_$r.child(_$n))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}else t.push(_$r)}),new FieldMask(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MutableDocument=function(){function MutableDocument(e,t,n,r,i,s,o){_class_call_check$1(this,MutableDocument);this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}_create_class$1(MutableDocument,[{key:"convertToFoundDocument",value:function convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function setHasCommittedMutations(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}},{key:"setReadTime",value:function setReadTime(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function get(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function get(){return 2===this.documentState}},{key:"hasPendingWrites",get:function get(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function isValidDocument(){return 0!==this.documentType}},{key:"isFoundDocument",value:function isFoundDocument(){return 1===this.documentType}},{key:"isNoDocument",value:function isNoDocument(){return 2===this.documentType}},{key:"isUnknownDocument",value:function isUnknownDocument(){return 3===this.documentType}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,MutableDocument)&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}},{key:"mutableCopy",value:function mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}},{key:"newFoundDocument",value:function newFoundDocument(e,t,n,r){return new MutableDocument(e,1,t,SnapshotVersion.min(),n,r,0)}},{key:"newNoDocument",value:function newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}},{key:"newUnknownDocument",value:function newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}}]);return MutableDocument}();/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bound=function Bound(e,t){_class_call_check$1(this,Bound);this.position=e,this.inclusive=t};function __PRIVATE_boundCompareToDocument(e,t,n){var _$r=0;for(var i=0;i<e.position.length;i++){var s=t[i],o=e.position[i];if(s.field.isKeyField())_$r=DocumentKey.comparator(DocumentKey.fromName(o.referenceValue),n.key);else{_$r=__PRIVATE_valueCompare(o,n.data.field(s.field))}if("desc"===s.dir&&(_$r*=-1),0!==_$r)break}return _$r}function __PRIVATE_boundEquals(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++){if(!__PRIVATE_valueEquals(e.position[n],t.position[n]))return!1}return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OrderBy=function OrderBy(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"asc";_class_call_check$1(this,OrderBy);this.field=e,this.dir=t};function __PRIVATE_orderByEquals(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Filter=function Filter(){_class_call_check$1(this,Filter)};var FieldFilter=function(Filter){_inherits$1(FieldFilter,Filter);var _super=_create_super$1(FieldFilter);function FieldFilter(e,t,n){_class_call_check$1(this,FieldFilter);var _this;_this=_super.call(this),_this.field=e,_this.op=t,_this.value=n;return _possible_constructor_return$1(_this)}_create_class$1(FieldFilter,[{key:"matches",value:function matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value)):null!==t&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(t)&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value))}},{key:"matchesComparison",value:function matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return fail()}}},{key:"isInequality",value:function isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function getFlattenedFilters(){return[this]}},{key:"getFilters",value:function getFilters(){return[this]}}],[{key:"create",value:function create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new __PRIVATE_KeyFieldFilter(e,t,n):"array-contains"===t?new __PRIVATE_ArrayContainsFilter(e,n):"in"===t?new __PRIVATE_InFilter(e,n):"not-in"===t?new __PRIVATE_NotInFilter(e,n):"array-contains-any"===t?new __PRIVATE_ArrayContainsAnyFilter(e,n):new FieldFilter(e,t,n)}},{key:"createKeyFieldInFilter",value:function createKeyFieldInFilter(e,t,n){return"in"===t?new __PRIVATE_KeyFieldInFilter(e,n):new __PRIVATE_KeyFieldNotInFilter(e,n)}}]);return FieldFilter}(Filter);var CompositeFilter=function(Filter){_inherits$1(CompositeFilter,Filter);var _super=_create_super$1(CompositeFilter);function CompositeFilter(e,t){_class_call_check$1(this,CompositeFilter);var _this;_this=_super.call(this),_this.filters=e,_this.op=t,_this.ue=null;return _possible_constructor_return$1(_this)}_create_class$1(CompositeFilter,[{key:"matches",value:function matches(e){return __PRIVATE_compositeFilterIsConjunction(this)?void 0===this.filters.find(function(t){return!t.matches(e)}):void 0!==this.filters.find(function(t){return t.matches(e)})}},{key:"getFlattenedFilters",value:function getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(function(e,t){return e.concat(t.getFlattenedFilters())},[])),this.ue}},{key:"getFilters",value:function getFilters(){return Object.assign([],this.filters)}}],[{key:"create",value:function create(e,t){return new CompositeFilter(e,t)}}]);return CompositeFilter}(Filter);function __PRIVATE_compositeFilterIsConjunction(e){return"and"===e.op}function __PRIVATE_compositeFilterIsDisjunction(e){return"or"===e.op}function __PRIVATE_compositeFilterIsFlatConjunction(e){return __PRIVATE_compositeFilterIsFlat(e)&&__PRIVATE_compositeFilterIsConjunction(e)}function __PRIVATE_compositeFilterIsFlat(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.filters[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(_instanceof$1(t,CompositeFilter))return!1}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!0}function __PRIVATE_canonifyFilter(e){if(_instanceof$1(e,FieldFilter))return e.field.canonicalString()+e.op.toString()+canonicalId(e.value);if(__PRIVATE_compositeFilterIsFlatConjunction(e))return e.filters.map(function(e){return __PRIVATE_canonifyFilter(e)}).join(",");{var t=e.filters.map(function(e){return __PRIVATE_canonifyFilter(e)}).join(",");return"".concat(e.op,"(").concat(t,")")}}function __PRIVATE_filterEquals(e,t){return _instanceof$1(e,FieldFilter)?function __PRIVATE_fieldFilterEquals(e,t){return _instanceof$1(t,FieldFilter)&&e.op===t.op&&e.field.isEqual(t.field)&&__PRIVATE_valueEquals(e.value,t.value)}(e,t):_instanceof$1(e,CompositeFilter)?function __PRIVATE_compositeFilterEquals(e,t){if(_instanceof$1(t,CompositeFilter)&&e.op===t.op&&e.filters.length===t.filters.length){return e.filters.reduce(function(e,n,r){return e&&__PRIVATE_filterEquals(n,t.filters[r])},!0)}return!1}(e,t):void fail()}function __PRIVATE_compositeFilterWithAddedFilters(e,t){var n=e.filters.concat(t);return CompositeFilter.create(n,e.op)}function __PRIVATE_stringifyFilter(e){return _instanceof$1(e,FieldFilter)?function __PRIVATE_stringifyFieldFilter(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(canonicalId(e.value))}(e):_instanceof$1(e,CompositeFilter)?function __PRIVATE_stringifyCompositeFilter(e){return e.op.toString()+" {"+e.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(e):"Filter"}var __PRIVATE_KeyFieldFilter=function(FieldFilter){_inherits$1(__PRIVATE_KeyFieldFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_KeyFieldFilter);function __PRIVATE_KeyFieldFilter(e,t,n){_class_call_check$1(this,__PRIVATE_KeyFieldFilter);var _this;_this=_super.call(this,e,t,n),_this.key=DocumentKey.fromName(n.referenceValue);return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_KeyFieldFilter,[{key:"matches",value:function matches(e){var t=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(t)}}]);return __PRIVATE_KeyFieldFilter}(FieldFilter);var __PRIVATE_KeyFieldInFilter=function(FieldFilter){_inherits$1(__PRIVATE_KeyFieldInFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_KeyFieldInFilter);function __PRIVATE_KeyFieldInFilter(e,t){_class_call_check$1(this,__PRIVATE_KeyFieldInFilter);var _this;_this=_super.call(this,e,"in",t),_this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t);return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_KeyFieldInFilter,[{key:"matches",value:function matches(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]);return __PRIVATE_KeyFieldInFilter}(FieldFilter);var __PRIVATE_KeyFieldNotInFilter=function(FieldFilter){_inherits$1(__PRIVATE_KeyFieldNotInFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_KeyFieldNotInFilter);function __PRIVATE_KeyFieldNotInFilter(e,t){_class_call_check$1(this,__PRIVATE_KeyFieldNotInFilter);var _this;_this=_super.call(this,e,"not-in",t),_this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t);return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_KeyFieldNotInFilter,[{key:"matches",value:function matches(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]);return __PRIVATE_KeyFieldNotInFilter}(FieldFilter);function __PRIVATE_extractDocumentKeysFromArrayValue(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return DocumentKey.fromName(e.referenceValue)})}var __PRIVATE_ArrayContainsFilter=function(FieldFilter){_inherits$1(__PRIVATE_ArrayContainsFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_ArrayContainsFilter);function __PRIVATE_ArrayContainsFilter(e,t){_class_call_check$1(this,__PRIVATE_ArrayContainsFilter);return _super.call(this,e,"array-contains",t)}_create_class$1(__PRIVATE_ArrayContainsFilter,[{key:"matches",value:function matches(e){var t=e.data.field(this.field);return isArray(t)&&__PRIVATE_arrayValueContains(t.arrayValue,this.value)}}]);return __PRIVATE_ArrayContainsFilter}(FieldFilter);var __PRIVATE_InFilter=function(FieldFilter){_inherits$1(__PRIVATE_InFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_InFilter);function __PRIVATE_InFilter(e,t){_class_call_check$1(this,__PRIVATE_InFilter);return _super.call(this,e,"in",t)}_create_class$1(__PRIVATE_InFilter,[{key:"matches",value:function matches(e){var t=e.data.field(this.field);return null!==t&&__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}]);return __PRIVATE_InFilter}(FieldFilter);var __PRIVATE_NotInFilter=function(FieldFilter){_inherits$1(__PRIVATE_NotInFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_NotInFilter);function __PRIVATE_NotInFilter(e,t){_class_call_check$1(this,__PRIVATE_NotInFilter);return _super.call(this,e,"not-in",t)}_create_class$1(__PRIVATE_NotInFilter,[{key:"matches",value:function matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}]);return __PRIVATE_NotInFilter}(FieldFilter);var __PRIVATE_ArrayContainsAnyFilter=function(FieldFilter){_inherits$1(__PRIVATE_ArrayContainsAnyFilter,FieldFilter);var _super=_create_super$1(__PRIVATE_ArrayContainsAnyFilter);function __PRIVATE_ArrayContainsAnyFilter(e,t){_class_call_check$1(this,__PRIVATE_ArrayContainsAnyFilter);return _super.call(this,e,"array-contains-any",t)}_create_class$1(__PRIVATE_ArrayContainsAnyFilter,[{key:"matches",value:function matches(e){var _this=this;var t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(e){return __PRIVATE_arrayValueContains(_this.value.arrayValue,e)})}}]);return __PRIVATE_ArrayContainsAnyFilter}(FieldFilter);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_TargetImpl=function __PRIVATE_TargetImpl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;_class_call_check$1(this,__PRIVATE_TargetImpl);this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=_$r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null};function __PRIVATE_newTarget(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;return new __PRIVATE_TargetImpl(e,t,n,_$r,i,s,o)}function __PRIVATE_canonifyTarget(e){var t=__PRIVATE_debugCast(e);if(null===t.ce){var _$e=t.path.canonicalString();null!==t.collectionGroup&&(_$e+="|cg:"+t.collectionGroup),_$e+="|f:",_$e+=t.filters.map(function(e){return __PRIVATE_canonifyFilter(e)}).join(","),_$e+="|ob:",_$e+=t.orderBy.map(function(e){return function __PRIVATE_canonifyOrderBy(e){return e.field.canonicalString()+e.dir}(e)}).join(","),__PRIVATE_isNullOrUndefined(t.limit)||(_$e+="|l:",_$e+=t.limit),t.startAt&&(_$e+="|lb:",_$e+=t.startAt.inclusive?"b:":"a:",_$e+=t.startAt.position.map(function(e){return canonicalId(e)}).join(",")),t.endAt&&(_$e+="|ub:",_$e+=t.endAt.inclusive?"a:":"b:",_$e+=t.endAt.position.map(function(e){return canonicalId(e)}).join(",")),t.ce=_$e}return t.ce}function __PRIVATE_targetEquals(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!__PRIVATE_orderByEquals(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var n1=0;n1<e.filters.length;n1++)if(!__PRIVATE_filterEquals(e.filters[n1],t.filters[n1]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!__PRIVATE_boundEquals(e.startAt,t.startAt)&&__PRIVATE_boundEquals(e.endAt,t.endAt)}function __PRIVATE_targetIsDocumentTarget(e){return DocumentKey.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function __PRIVATE_targetGetFieldFiltersForPath(e,t){return e.filters.filter(function(e){return _instanceof$1(e,FieldFilter)&&e.field.isEqual(t)})}function __PRIVATE_targetGetAscendingBound(e,t,n){var _$r=ne,i=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_targetGetFieldFiltersForPath(e,t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$n=_step.value;var _$e=ne,_$t=!0;switch(_$n.op){case"<":case"<=":_$e=__PRIVATE_valuesGetLowerBound(_$n.value);break;case"==":case"in":case">=":_$e=_$n.value;break;case">":_$e=_$n.value,_$t=!1;break;case"!=":case"not-in":_$e=ne}__PRIVATE_lowerBoundCompare({value:_$r,inclusive:i},{value:_$e,inclusive:_$t})<0&&(_$r=_$e,i=_$t)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(null!==n)for(var s=0;s<e.orderBy.length;++s){if(e.orderBy[s].field.isEqual(t)){var _$e1=n.position[s];__PRIVATE_lowerBoundCompare({value:_$r,inclusive:i},{value:_$e1,inclusive:n.inclusive})<0&&(_$r=_$e1,i=n.inclusive);break}}return{value:_$r,inclusive:i}}function __PRIVATE_targetGetDescendingBound(e,t,n){var _$r=te,i=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_targetGetFieldFiltersForPath(e,t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$n=_step.value;var _$e=te,_$t=!0;switch(_$n.op){case">=":case">":_$e=__PRIVATE_valuesGetUpperBound(_$n.value),_$t=!1;break;case"==":case"in":case"<=":_$e=_$n.value;break;case"<":_$e=_$n.value,_$t=!1;break;case"!=":case"not-in":_$e=te}__PRIVATE_upperBoundCompare({value:_$r,inclusive:i},{value:_$e,inclusive:_$t})>0&&(_$r=_$e,i=_$t)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(null!==n)for(var s=0;s<e.orderBy.length;++s){if(e.orderBy[s].field.isEqual(t)){var _$e1=n.position[s];__PRIVATE_upperBoundCompare({value:_$r,inclusive:i},{value:_$e1,inclusive:n.inclusive})>0&&(_$r=_$e1,i=n.inclusive);break}}return{value:_$r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_QueryImpl=function __PRIVATE_QueryImpl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"F",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,_=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;_class_call_check$1(this,__PRIVATE_QueryImpl);this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=_$r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=_,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt};function __PRIVATE_newQuery(e,t,n,r,i,s,o,_){return new __PRIVATE_QueryImpl(e,t,n,r,i,s,o,_)}function __PRIVATE_newQueryForPath(e){return new __PRIVATE_QueryImpl(e)}function __PRIVATE_queryMatchesAllDocuments(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(e){return null!==e.collectionGroup}function __PRIVATE_queryNormalizedOrderBy(e){var t=__PRIVATE_debugCast(e);if(null===t.le){t.le=[];var _$e=new Set;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t.explicitOrderBy[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;t.le.push(n),_$e.add(n.field.canonicalString())}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var n1=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",_$r=function __PRIVATE_getInequalityFilterFields(e){var t=new SortedSet(FieldPath$1.comparator);return e.filters.forEach(function(e){e.getFlattenedFilters().forEach(function(e){e.isInequality()&&(t=t.add(e.field))})}),t}(t);_$r.forEach(function(r){_$e.has(r.canonicalString())||r.isKeyField()||t.le.push(new OrderBy(r,n1))}),_$e.has(FieldPath$1.keyField().canonicalString())||t.le.push(new OrderBy(FieldPath$1.keyField(),n1))}return t.le}function __PRIVATE_queryToTarget(e){var t=__PRIVATE_debugCast(e);return t.he||(t.he=__PRIVATE__queryToTarget(t,__PRIVATE_queryNormalizedOrderBy(e))),t.he}function __PRIVATE__queryToTarget(e,t){if("F"===e.limitType)return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(function(e){var _$t="desc"===e.dir?"asc":"desc";return new OrderBy(e.field,_$t)});var n=e.endAt?new Bound(e.endAt.position,e.endAt.inclusive):null,_$r=e.startAt?new Bound(e.startAt.position,e.startAt.inclusive):null;return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,n,_$r)}}function __PRIVATE_queryWithAddedFilter(e,t){var n=e.filters.concat([t]);return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function __PRIVATE_queryWithLimit(e,t,n){return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function __PRIVATE_queryEquals(e,t){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(e),__PRIVATE_queryToTarget(t))&&e.limitType===t.limitType}function __PRIVATE_canonifyQuery(e){return"".concat(__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(e)),"|lt:").concat(e.limitType)}function __PRIVATE_stringifyQuery(e){return"Query(target=".concat(function __PRIVATE_stringifyTarget(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(function(e){return __PRIVATE_stringifyFilter(e)}).join(", "),"]")),__PRIVATE_isNullOrUndefined(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(function(e){return function __PRIVATE_stringifyOrderBy(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)}).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(function(e){return canonicalId(e)}).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(function(e){return canonicalId(e)}).join(",")),"Target(".concat(t,")")}(__PRIVATE_queryToTarget(e)),"; limitType=").concat(e.limitType,")")}function __PRIVATE_queryMatches(e,t){return t.isFoundDocument()&&function __PRIVATE_queryMatchesPathAndCollectionGroup(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):DocumentKey.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function __PRIVATE_queryMatchesOrderBy(e,t){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_queryNormalizedOrderBy(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!0}(e,t)&&function __PRIVATE_queryMatchesFilters(e,t){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.filters[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;if(!n.matches(t))return!1}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!0}(e,t)&&function __PRIVATE_queryMatchesBounds(e,t){if(e.startAt&&!function __PRIVATE_boundSortsBeforeDocument(e,t,n){var _$r=__PRIVATE_boundCompareToDocument(e,t,n);return e.inclusive?_$r<=0:_$r<0}(e.startAt,__PRIVATE_queryNormalizedOrderBy(e),t))return!1;if(e.endAt&&!function __PRIVATE_boundSortsAfterDocument(e,t,n){var _$r=__PRIVATE_boundCompareToDocument(e,t,n);return e.inclusive?_$r>=0:_$r>0}(e.endAt,__PRIVATE_queryNormalizedOrderBy(e),t))return!1;return!0}(e,t)}function __PRIVATE_queryCollectionGroup(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function __PRIVATE_newQueryComparator(e){return function(t,n){var _$r=!1;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_queryNormalizedOrderBy(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;var _$e=__PRIVATE_compareDocs(i,t,n);if(0!==_$e)return _$e;_$r=_$r||i.field.isKeyField()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return 0}}function __PRIVATE_compareDocs(e,t,n){var _$r=e.field.isKeyField()?DocumentKey.comparator(t.key,n.key):function __PRIVATE_compareDocumentsByField(e,t,n){var _$r=t.data.field(e),i=n.data.field(e);return null!==_$r&&null!==i?__PRIVATE_valueCompare(_$r,i):fail()}(e.field,t,n);switch(e.dir){case"asc":return _$r;case"desc":return-1*_$r;default:return fail()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ObjectMap=function(){function ObjectMap(e,t){_class_call_check$1(this,ObjectMap);this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}_create_class$1(ObjectMap,[{key:"get",value:function get(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step_value=_sliced_to_array$1(_step.value,2),t1=_step_value[0],_$r=_step_value[1];if(this.equalsFn(t1,e))return _$r}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}},{key:"has",value:function has(e){return void 0!==this.get(e)}},{key:"set",value:function set(e,t){var n=this.mapKeyFn(e),_$r=this.inner[n];if(void 0===_$r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var n1=0;n1<_$r.length;n1++)if(this.equalsFn(_$r[n1][0],e))return void(_$r[n1]=[e,t]);_$r.push([e,t]),this.innerSize++}},{key:"delete",value:function _delete(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var _$r=0;_$r<n.length;_$r++)if(this.equalsFn(n[_$r][0],e))return 1===n.length?delete this.inner[t]:n.splice(_$r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function forEach1(e){forEach(this.inner,function(t,n){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step_value=_sliced_to_array$1(_step.value,2),t1=_step_value[0],_$r=_step_value[1];e(t1,_$r)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}})}},{key:"isEmpty",value:function isEmpty1(){return isEmpty(this.inner)}},{key:"size",value:function size(){return this.innerSize}}]);return ObjectMap}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var re=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return re}var ie=new SortedMap(DocumentKey.comparator);function documentMap(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}var t=ie;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;t=t.insert(n.key,n)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(e){var t=ie;return e.forEach(function(e,n){return t=t.insert(e,n.overlayedDocument)}),t}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var se=new SortedMap(DocumentKey.comparator);var oe=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}var t=oe;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;t=t.add(n)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t}var _e=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return _e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_toDouble(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(t)?"-0":t}}function __PRIVATE_toInteger(e){return{integerValue:""+e}}function toNumber(e,t){return isSafeInteger(t)?__PRIVATE_toInteger(t):__PRIVATE_toDouble(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var TransformOperation=function TransformOperation(){_class_call_check$1(this,TransformOperation);this._=void 0};function __PRIVATE_applyTransformOperationToLocalView(e,t,n){return _instanceof$1(e,__PRIVATE_ServerTimestampTransform)?function serverTimestamp$1(e,t){var _$n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&__PRIVATE_isServerTimestamp(t)&&(t=__PRIVATE_getPreviousValue(t)),t&&(_$n.fields.__previous_value__=t),{mapValue:_$n}}(n,t):_instanceof$1(e,__PRIVATE_ArrayUnionTransformOperation)?__PRIVATE_applyArrayUnionTransformOperation(e,t):_instanceof$1(e,__PRIVATE_ArrayRemoveTransformOperation)?__PRIVATE_applyArrayRemoveTransformOperation(e,t):function __PRIVATE_applyNumericIncrementTransformOperationToLocalView(e,t){var _$n=__PRIVATE_computeTransformOperationBaseValue(e,t),_$r=asNumber(_$n)+asNumber(e.Ie);return isInteger(_$n)&&isInteger(e.Ie)?__PRIVATE_toInteger(_$r):__PRIVATE_toDouble(e.serializer,_$r)}(e,t)}function __PRIVATE_applyTransformOperationToRemoteDocument(e,t,n){return _instanceof$1(e,__PRIVATE_ArrayUnionTransformOperation)?__PRIVATE_applyArrayUnionTransformOperation(e,t):_instanceof$1(e,__PRIVATE_ArrayRemoveTransformOperation)?__PRIVATE_applyArrayRemoveTransformOperation(e,t):n}function __PRIVATE_computeTransformOperationBaseValue(e,t){return _instanceof$1(e,__PRIVATE_NumericIncrementTransformOperation)?function __PRIVATE_isNumber(e){return isInteger(e)||function __PRIVATE_isDouble(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}var __PRIVATE_ServerTimestampTransform=function(TransformOperation){_inherits$1(__PRIVATE_ServerTimestampTransform,TransformOperation);var _super=_create_super$1(__PRIVATE_ServerTimestampTransform);function __PRIVATE_ServerTimestampTransform(){_class_call_check$1(this,__PRIVATE_ServerTimestampTransform);return _super.apply(this,arguments)}return __PRIVATE_ServerTimestampTransform}(TransformOperation);var __PRIVATE_ArrayUnionTransformOperation=function(TransformOperation){_inherits$1(__PRIVATE_ArrayUnionTransformOperation,TransformOperation);var _super=_create_super$1(__PRIVATE_ArrayUnionTransformOperation);function __PRIVATE_ArrayUnionTransformOperation(e){_class_call_check$1(this,__PRIVATE_ArrayUnionTransformOperation);var _this;_this=_super.call(this),_this.elements=e;return _possible_constructor_return$1(_this)}return __PRIVATE_ArrayUnionTransformOperation}(TransformOperation);function __PRIVATE_applyArrayUnionTransformOperation(e,t){var n=__PRIVATE_coercedFieldValuesArray(t);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var _$t=_step.value;n.some(function(e){return __PRIVATE_valueEquals(e,_$t)})||n.push(_$t)};for(var _iterator=e.elements[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return{arrayValue:{values:n}}}var __PRIVATE_ArrayRemoveTransformOperation=function(TransformOperation){_inherits$1(__PRIVATE_ArrayRemoveTransformOperation,TransformOperation);var _super=_create_super$1(__PRIVATE_ArrayRemoveTransformOperation);function __PRIVATE_ArrayRemoveTransformOperation(e){_class_call_check$1(this,__PRIVATE_ArrayRemoveTransformOperation);var _this;_this=_super.call(this),_this.elements=e;return _possible_constructor_return$1(_this)}return __PRIVATE_ArrayRemoveTransformOperation}(TransformOperation);function __PRIVATE_applyArrayRemoveTransformOperation(e,t){var n=__PRIVATE_coercedFieldValuesArray(t);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var _$t=_step.value;n=n.filter(function(e){return!__PRIVATE_valueEquals(e,_$t)})};for(var _iterator=e.elements[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return{arrayValue:{values:n}}}var __PRIVATE_NumericIncrementTransformOperation=function(TransformOperation){_inherits$1(__PRIVATE_NumericIncrementTransformOperation,TransformOperation);var _super=_create_super$1(__PRIVATE_NumericIncrementTransformOperation);function __PRIVATE_NumericIncrementTransformOperation(e,t){_class_call_check$1(this,__PRIVATE_NumericIncrementTransformOperation);var _this;_this=_super.call(this),_this.serializer=e,_this.Ie=t;return _possible_constructor_return$1(_this)}return __PRIVATE_NumericIncrementTransformOperation}(TransformOperation);function asNumber(e){return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue)}function __PRIVATE_coercedFieldValuesArray(e){return isArray(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FieldTransform=function FieldTransform(e,t){_class_call_check$1(this,FieldTransform);this.field=e,this.transform=t};function __PRIVATE_fieldTransformEquals(e,t){return e.field.isEqual(t.field)&&function __PRIVATE_transformOperationEquals(e,t){return _instanceof$1(e,__PRIVATE_ArrayUnionTransformOperation)&&_instanceof$1(t,__PRIVATE_ArrayUnionTransformOperation)||_instanceof$1(e,__PRIVATE_ArrayRemoveTransformOperation)&&_instanceof$1(t,__PRIVATE_ArrayRemoveTransformOperation)?__PRIVATE_arrayEquals(e.elements,t.elements,__PRIVATE_valueEquals):_instanceof$1(e,__PRIVATE_NumericIncrementTransformOperation)&&_instanceof$1(t,__PRIVATE_NumericIncrementTransformOperation)?__PRIVATE_valueEquals(e.Ie,t.Ie):_instanceof$1(e,__PRIVATE_ServerTimestampTransform)&&_instanceof$1(t,__PRIVATE_ServerTimestampTransform)}(e.transform,t.transform)}var MutationResult=function MutationResult(e,t){_class_call_check$1(this,MutationResult);this.version=e,this.transformResults=t};var Precondition=function(){function Precondition(e,t){_class_call_check$1(this,Precondition);this.updateTime=e,this.exists=t}_create_class$1(Precondition,[{key:"isNone",get:function get(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function none(){return new Precondition}},{key:"exists",value:function exists(e){return new Precondition(void 0,e)}},{key:"updateTime",value:function updateTime(e){return new Precondition(e)}}]);return Precondition}();function __PRIVATE_preconditionIsValidForDocument(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Mutation=function Mutation(){_class_call_check$1(this,Mutation)};function __PRIVATE_calculateOverlayMutation(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new __PRIVATE_DeleteMutation(e.key,Precondition.none()):new __PRIVATE_SetMutation(e.key,e.data,Precondition.none());{var n=e.data,_$r=ObjectValue.empty();var i=new SortedSet(FieldPath$1.comparator);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t.fields[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;if(!i.has(_$e)){var _$t=n.field(_$e);null===_$t&&_$e.length>1&&(_$e=_$e.popLast(),_$t=n.field(_$e)),null===_$t?_$r.delete(_$e):_$r.set(_$e,_$t),i=i.add(_$e)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new __PRIVATE_PatchMutation(e.key,_$r,new FieldMask(i.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(e,t,n){_instanceof$1(e,__PRIVATE_SetMutation)?function __PRIVATE_setMutationApplyToRemoteDocument(e,t,n){var _$r=e.value.clone(),i=__PRIVATE_serverTransformResults(e.fieldTransforms,t,n.transformResults);_$r.setAll(i),t.convertToFoundDocument(n.version,_$r).setHasCommittedMutations()}(e,t,n):_instanceof$1(e,__PRIVATE_PatchMutation)?function __PRIVATE_patchMutationApplyToRemoteDocument(e,t,n){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return void t.convertToUnknownDocument(n.version);var _$r=__PRIVATE_serverTransformResults(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(__PRIVATE_getPatch(e)),i.setAll(_$r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function __PRIVATE_deleteMutationApplyToRemoteDocument(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function __PRIVATE_mutationApplyToLocalView(e,t,n,r){return _instanceof$1(e,__PRIVATE_SetMutation)?function __PRIVATE_setMutationApplyToLocalView(e,t,n,r){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return n;var i=e.value.clone(),s=__PRIVATE_localTransformResults(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):_instanceof$1(e,__PRIVATE_PatchMutation)?function __PRIVATE_patchMutationApplyToLocalView(e,t,n,r){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return n;var i=__PRIVATE_localTransformResults(e.fieldTransforms,r,t),s=t.data;if(s.setAll(__PRIVATE_getPatch(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)return null;return n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(function(e){return e.field}))}(e,t,n,r):function __PRIVATE_deleteMutationApplyToLocalView(e,t,n){if(__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return t.convertToNoDocument(t.version).setHasLocalMutations(),null;return n}(e,t,n)}function __PRIVATE_mutationExtractBaseValue(e,t){var n=null;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.fieldTransforms[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;var _$e=t.data.field(_$r.field),i=__PRIVATE_computeTransformOperationBaseValue(_$r.transform,_$e||null);null!=i&&(null===n&&(n=ObjectValue.empty()),n.set(_$r.field,i))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return n||null}function __PRIVATE_mutationEquals(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function __PRIVATE_fieldTransformsAreEqual(e,t){return void 0===e&&void 0===t||!(!e||!t)&&__PRIVATE_arrayEquals(e,t,function(e,t){return __PRIVATE_fieldTransformEquals(e,t)})}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var __PRIVATE_SetMutation=function(Mutation){_inherits$1(__PRIVATE_SetMutation,Mutation);var _super=_create_super$1(__PRIVATE_SetMutation);function __PRIVATE_SetMutation(e,t,n){var _$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];_class_call_check$1(this,__PRIVATE_SetMutation);var _this;_this=_super.call(this),_this.key=e,_this.value=t,_this.precondition=n,_this.fieldTransforms=_$r,_this.type=0;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_SetMutation,[{key:"getFieldMask",value:function getFieldMask(){return null}}]);return __PRIVATE_SetMutation}(Mutation);var __PRIVATE_PatchMutation=function(Mutation){_inherits$1(__PRIVATE_PatchMutation,Mutation);var _super=_create_super$1(__PRIVATE_PatchMutation);function __PRIVATE_PatchMutation(e,t,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[];_class_call_check$1(this,__PRIVATE_PatchMutation);var _this;_this=_super.call(this),_this.key=e,_this.data=t,_this.fieldMask=n,_this.precondition=r,_this.fieldTransforms=i,_this.type=1;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_PatchMutation,[{key:"getFieldMask",value:function getFieldMask(){return this.fieldMask}}]);return __PRIVATE_PatchMutation}(Mutation);function __PRIVATE_getPatch(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var _$r=e.data.field(n);t.set(n,_$r)}}),t}function __PRIVATE_serverTransformResults(e,t,n){var _$r=new Map;__PRIVATE_hardAssert(e.length===n.length);for(var i=0;i<n.length;i++){var s=e[i],o=s.transform,_=t.data.field(s.field);_$r.set(s.field,__PRIVATE_applyTransformOperationToRemoteDocument(o,_,n[i]))}return _$r}function __PRIVATE_localTransformResults(e,t,n){var _$r=new Map;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;var _$e=i.transform,s=n.data.field(i.field);_$r.set(i.field,__PRIVATE_applyTransformOperationToLocalView(_$e,s,t))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$r}var __PRIVATE_DeleteMutation=function(Mutation){_inherits$1(__PRIVATE_DeleteMutation,Mutation);var _super=_create_super$1(__PRIVATE_DeleteMutation);function __PRIVATE_DeleteMutation(e,t){_class_call_check$1(this,__PRIVATE_DeleteMutation);var _this;_this=_super.call(this),_this.key=e,_this.precondition=t,_this.type=2,_this.fieldTransforms=[];return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_DeleteMutation,[{key:"getFieldMask",value:function getFieldMask(){return null}}]);return __PRIVATE_DeleteMutation}(Mutation);var __PRIVATE_VerifyMutation=function(Mutation){_inherits$1(__PRIVATE_VerifyMutation,Mutation);var _super=_create_super$1(__PRIVATE_VerifyMutation);function __PRIVATE_VerifyMutation(e,t){_class_call_check$1(this,__PRIVATE_VerifyMutation);var _this;_this=_super.call(this),_this.key=e,_this.precondition=t,_this.type=3,_this.fieldTransforms=[];return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_VerifyMutation,[{key:"getFieldMask",value:function getFieldMask(){return null}}]);return __PRIVATE_VerifyMutation}(Mutation);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MutationBatch=function(){function MutationBatch(e,t,n,r){_class_call_check$1(this,MutationBatch);this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}_create_class$1(MutationBatch,[{key:"applyToRemoteDocument",value:function applyToRemoteDocument(e,t){var n=t.mutationResults;for(var _$t=0;_$t<this.mutations.length;_$t++){var _$r=this.mutations[_$t];if(_$r.key.isEqual(e.key)){__PRIVATE_mutationApplyToRemoteDocument(_$r,e,n[_$t])}}}},{key:"applyToLocalView",value:function applyToLocalView(e,t){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.baseMutations[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=this.mutations[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var n1=_step1.value;n1.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n1,e,t,this.localWriteTime))}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return t}},{key:"applyToLocalDocumentSet",value:function applyToLocalDocumentSet(e,t){var _this=this;var n=__PRIVATE_newMutationMap();return this.mutations.forEach(function(r){var i=e.get(r.key),s=i.overlayedDocument;var o=_this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;var _=__PRIVATE_calculateOverlayMutation(s,o);null!==_&&n.set(r.key,_),s.isValidDocument()||s.convertToNoDocument(SnapshotVersion.min())}),n}},{key:"keys",value:function keys(){return this.mutations.reduce(function(e,t){return e.add(t.key)},__PRIVATE_documentKeySet())}},{key:"isEqual",value:function isEqual(e){return this.batchId===e.batchId&&__PRIVATE_arrayEquals(this.mutations,e.mutations,function(e,t){return __PRIVATE_mutationEquals(e,t)})&&__PRIVATE_arrayEquals(this.baseMutations,e.baseMutations,function(e,t){return __PRIVATE_mutationEquals(e,t)})}}]);return MutationBatch}();var MutationBatchResult=function(){function MutationBatchResult(e,t,n,r){_class_call_check$1(this,MutationBatchResult);this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}_create_class$1(MutationBatchResult,null,[{key:"from",value:function from(e,t,n){__PRIVATE_hardAssert(e.mutations.length===n.length);var _$r=function __PRIVATE_documentVersionMap(){return se}();var i=e.mutations;for(var _$e=0;_$e<i.length;_$e++)_$r=_$r.insert(i[_$e].key,n[_$e].version);return new MutationBatchResult(e,t,n,_$r)}}]);return MutationBatchResult}();/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Overlay=function(){function Overlay(e,t){_class_call_check$1(this,Overlay);this.largestBatchId=e,this.mutation=t}_create_class$1(Overlay,[{key:"getKey",value:function getKey(){return this.mutation.key}},{key:"isEqual",value:function isEqual(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]);return Overlay}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ExistenceFilter=function ExistenceFilter(e,t){_class_call_check$1(this,ExistenceFilter);this.count=e,this.unchangedNames=t};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ae,ue;function __PRIVATE_isPermanentError(e){switch(e){default:return fail();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function __PRIVATE_mapCodeFromRpcCode(e){if(void 0===e)return __PRIVATE_logError("GRPC error has no .code"),D.UNKNOWN;switch(e){case ae.OK:return D.OK;case ae.CANCELLED:return D.CANCELLED;case ae.UNKNOWN:return D.UNKNOWN;case ae.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case ae.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case ae.INTERNAL:return D.INTERNAL;case ae.UNAVAILABLE:return D.UNAVAILABLE;case ae.UNAUTHENTICATED:return D.UNAUTHENTICATED;case ae.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case ae.NOT_FOUND:return D.NOT_FOUND;case ae.ALREADY_EXISTS:return D.ALREADY_EXISTS;case ae.PERMISSION_DENIED:return D.PERMISSION_DENIED;case ae.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case ae.ABORTED:return D.ABORTED;case ae.OUT_OF_RANGE:return D.OUT_OF_RANGE;case ae.UNIMPLEMENTED:return D.UNIMPLEMENTED;case ae.DATA_LOSS:return D.DATA_LOSS;default:return fail()}}(ue=ae||(ae={}))[ue.OK=0]="OK",ue[ue.CANCELLED=1]="CANCELLED",ue[ue.UNKNOWN=2]="UNKNOWN",ue[ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ue[ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ue[ue.NOT_FOUND=5]="NOT_FOUND",ue[ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",ue[ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",ue[ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",ue[ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ue[ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ue[ue.ABORTED=10]="ABORTED",ue[ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",ue[ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",ue[ue.INTERNAL=13]="INTERNAL",ue[ue.UNAVAILABLE=14]="UNAVAILABLE",ue[ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newTextEncoder(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(e){var t=__PRIVATE_newTextEncoder().encode(e),n=new Md5;return n.update(t),new Uint8Array(n.digest())}function __PRIVATE_get64BitUints(e){var t=new DataView(e.buffer),n=t.getUint32(0,!0),_$r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Integer([n,_$r],0),new Integer([i,s],0)]}var BloomFilter=function(){function BloomFilter(e,t,n){_class_call_check$1(this,BloomFilter);if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new __PRIVATE_BloomFilterError("Invalid padding: ".concat(t));if(n<0)throw new __PRIVATE_BloomFilterError("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new __PRIVATE_BloomFilterError("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new __PRIVATE_BloomFilterError("Invalid padding when bitmap length is 0: ".concat(t));this.Te=8*e.length-t,this.Ee=Integer.fromNumber(this.Te)}_create_class$1(BloomFilter,[{key:"de",value:function de(e,t,n){var _$r=e.add(t.multiply(Integer.fromNumber(n)));return 1===_$r.compare(le)&&(_$r=new Integer([_$r.getBits(0),_$r.getBits(1)],0)),_$r.modulo(this.Ee).toNumber()}},{key:"Ae",value:function Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"mightContain",value:function mightContain(e){if(0===this.Te)return!1;var t=__PRIVATE_getMd5HashValue(e),_$__PRIVATE_get64BitUints=_sliced_to_array$1(__PRIVATE_get64BitUints(t),2),n=_$__PRIVATE_get64BitUints[0],_$r=_$__PRIVATE_get64BitUints[1];for(var _$e=0;_$e<this.hashCount;_$e++){var t1=this.de(n,_$r,_$e);if(!this.Ae(t1))return!1}return!0}},{key:"insert",value:function insert(e){if(0===this.Te)return;var t=__PRIVATE_getMd5HashValue(e),_$__PRIVATE_get64BitUints=_sliced_to_array$1(__PRIVATE_get64BitUints(t),2),n=_$__PRIVATE_get64BitUints[0],_$r=_$__PRIVATE_get64BitUints[1];for(var _$e=0;_$e<this.hashCount;_$e++){var t1=this.de(n,_$r,_$e);this.Re(t1)}}},{key:"Re",value:function Re(e){var t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}],[{key:"create",value:function create(e,t,n){var _$r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new BloomFilter(i,_$r,t);return n.forEach(function(e){return s.insert(e)}),s}}]);return BloomFilter}();var __PRIVATE_BloomFilterError=function(Error1){_inherits$1(__PRIVATE_BloomFilterError,Error1);var _super=_create_super$1(__PRIVATE_BloomFilterError);function __PRIVATE_BloomFilterError(){_class_call_check$1(this,__PRIVATE_BloomFilterError);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments))),_this.name="BloomFilterError";return _possible_constructor_return$1(_this)}return __PRIVATE_BloomFilterError}(_wrap_native_super(Error));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var RemoteEvent=function(){function RemoteEvent(e,t,n,r,i){_class_call_check$1(this,RemoteEvent);this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}_create_class$1(RemoteEvent,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function createSynthesizedRemoteEventForCurrentChange(e,t,n){var _$r=new Map;return _$r.set(e,TargetChange.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new RemoteEvent(SnapshotVersion.min(),_$r,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}]);return RemoteEvent}();var TargetChange=function(){function TargetChange(e,t,n,r,i){_class_call_check$1(this,TargetChange);this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}_create_class$1(TargetChange,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function createSynthesizedTargetChangeForCurrentChange(e,t,n){return new TargetChange(n,t,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}]);return TargetChange}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_DocumentWatchChange=function __PRIVATE_DocumentWatchChange(e,t,n,r){_class_call_check$1(this,__PRIVATE_DocumentWatchChange);this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r};var __PRIVATE_ExistenceFilterChange=function __PRIVATE_ExistenceFilterChange(e,t){_class_call_check$1(this,__PRIVATE_ExistenceFilterChange);this.targetId=e,this.fe=t};var __PRIVATE_WatchTargetChange=function __PRIVATE_WatchTargetChange(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ByteString.EMPTY_BYTE_STRING,_$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;_class_call_check$1(this,__PRIVATE_WatchTargetChange);this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=_$r};var __PRIVATE_TargetState=function(){function __PRIVATE_TargetState(){_class_call_check$1(this,__PRIVATE_TargetState);this.ge=0,this.pe=__PRIVATE_snapshotChangesMap(),this.ye=ByteString.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}_create_class$1(__PRIVATE_TargetState,[{key:"current",get:function get(){return this.we}},{key:"resumeToken",get:function get(){return this.ye}},{key:"be",get:function get(){return 0!==this.ge}},{key:"De",get:function get(){return this.Se}},{key:"Ce",value:function Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}},{key:"ve",value:function ve(){var e=__PRIVATE_documentKeySet(),t=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.pe.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:fail()}}),new TargetChange(this.ye,this.we,e,t,n)}},{key:"Fe",value:function Fe(){this.Se=!1,this.pe=__PRIVATE_snapshotChangesMap()}},{key:"Me",value:function Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}},{key:"xe",value:function xe(e){this.Se=!0,this.pe=this.pe.remove(e)}},{key:"Oe",value:function Oe(){this.ge+=1}},{key:"Ne",value:function Ne(){this.ge-=1,__PRIVATE_hardAssert(this.ge>=0)}},{key:"Be",value:function Be(){this.Se=!0,this.we=!0}}]);return __PRIVATE_TargetState}();var __PRIVATE_WatchChangeAggregator=function(){function __PRIVATE_WatchChangeAggregator(e){_class_call_check$1(this,__PRIVATE_WatchChangeAggregator);this.Le=e,this.ke=new Map,this.qe=__PRIVATE_mutableDocumentMap(),this.Qe=__PRIVATE_documentTargetMap(),this.Ke=new SortedMap(__PRIVATE_primitiveComparator)}_create_class$1(__PRIVATE_WatchChangeAggregator,[{key:"$e",value:function $e(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.Ve[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=e.removedTargetIds[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var t1=_step1.value;this.We(t1,e.key,e.me)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}}},{key:"Ge",value:function Ge(e){var _this=this;this.forEachTarget(e,function(t){var n=_this.ze(t);switch(e.state){case 0:_this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||_this.removeTarget(t);break;case 3:_this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:_this.je(t)&&(_this.He(t),n.Ce(e.resumeToken));break;default:fail()}})}},{key:"forEachTarget",value:function forEachTarget(e,t){var _this=this;e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(function(e,n){_this.je(n)&&t(n)})}},{key:"Je",value:function Je(e){var t=e.targetId,n=e.fe.count,_$r=this.Ye(t);if(_$r){var i=_$r.target;if(__PRIVATE_targetIsDocumentTarget(i))if(0===n){var _$e=new DocumentKey(i.path);this.We(t,_$e,MutableDocument.newNoDocument(_$e,SnapshotVersion.min()))}else __PRIVATE_hardAssert(1===n);else{var r1=this.Ze(t);if(r1!==n){var n1=this.Xe(e),i1=n1?this.et(n1,e,r1):1;if(0!==i1){this.He(t);var _$e1=2===i1?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,_$e1)}null==ce||ce.tt(function __PRIVATE_createExistenceFilterMismatchInfoForTestingHooks(e,t,n,r,i){var s,o,_,a,u,c;var l={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;h&&(l.bloomFilter={applied:0===i,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===(_=null===(o=null==h?void 0:h.bits)||void 0===o?void 0:o.bitmap)||void 0===_?void 0:_.length)&&void 0!==a?a:0,padding:null!==(c=null===(u=null==h?void 0:h.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:function mightContain(e){var _$t;return null!==(_$t=null==r?void 0:r.mightContain(e))&&void 0!==_$t&&_$t}});return l}(r1,e.fe,this.Le.nt(),n1,i1))}}}}},{key:"Xe",value:function Xe(e){var t=e.fe.unchangedNames;if(!t||!t.bits)return null;var _t_bits=t.bits,tmp=_t_bits.bitmap,n=tmp===void 0?"":tmp,tmp1=_t_bits.padding,_$r=tmp1===void 0?0:tmp1,tmp2=t.hashCount,i=tmp2===void 0?0:tmp2;var s,o;try{s=__PRIVATE_normalizeByteString(n).toUint8Array()}catch(e){if(_instanceof$1(e,__PRIVATE_Base64DecodeError))return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new BloomFilter(s,_$r,i)}catch(e){return __PRIVATE_logWarn(_instanceof$1(e,__PRIVATE_BloomFilterError)?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}},{key:"et",value:function et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}},{key:"rt",value:function rt(e,t){var _this=this;var n=this.Le.getRemoteKeysForTarget(t);var _$r=0;return n.forEach(function(n){var i=_this.Le.nt(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(_this.We(t,n,null),_$r++)}),_$r}},{key:"it",value:function it(e){var _this=this;var t=new Map;this.ke.forEach(function(n,r){var i=_this.Ye(r);if(i){if(n.current&&__PRIVATE_targetIsDocumentTarget(i.target)){var t1=new DocumentKey(i.target.path);null!==_this.qe.get(t1)||_this.st(r,t1)||_this.We(r,t1,MutableDocument.newNoDocument(t1,e))}n.De&&(t.set(r,n.ve()),n.Fe())}});var n=__PRIVATE_documentKeySet();this.Qe.forEach(function(e,t){var _$r=!0;t.forEachWhile(function(e){var _$t=_this.Ye(e);return!_$t||"TargetPurposeLimboResolution"===_$t.purpose||(_$r=!1,!1)}),_$r&&(n=n.add(e))}),this.qe.forEach(function(t,n){return n.setReadTime(e)});var _$r=new RemoteEvent(e,t,this.Ke,this.qe,n);return this.qe=__PRIVATE_mutableDocumentMap(),this.Qe=__PRIVATE_documentTargetMap(),this.Ke=new SortedMap(__PRIVATE_primitiveComparator),_$r}},{key:"Ue",value:function Ue(e,t){if(!this.je(e))return;var n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}},{key:"We",value:function We(e,t,n){if(!this.je(e))return;var _$r=this.ze(e);this.st(e,t)?_$r.Me(t,1):_$r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}},{key:"removeTarget",value:function removeTarget(e){this.ke.delete(e)}},{key:"Ze",value:function Ze(e){var t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Oe",value:function Oe(e){this.ze(e).Oe()}},{key:"ze",value:function ze(e){var t=this.ke.get(e);return t||(t=new __PRIVATE_TargetState,this.ke.set(e,t)),t}},{key:"ot",value:function ot(e){var t=this.Qe.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.Qe=this.Qe.insert(e,t)),t}},{key:"je",value:function je(e){var t=null!==this.Ye(e);return t||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Ye",value:function Ye(e){var t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}},{key:"He",value:function He(e){var _this=this;this.ke.set(e,new __PRIVATE_TargetState);this.Le.getRemoteKeysForTarget(e).forEach(function(t){_this.We(e,t,null)})}},{key:"st",value:function st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}]);return __PRIVATE_WatchChangeAggregator}();function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}var he=function(){var e={asc:"ASCENDING",desc:"DESCENDING"};return e}(),Pe=function(){var e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return e}(),Ie=function(){var e={and:"AND",or:"OR"};return e}();var JsonProtoSerializer=function JsonProtoSerializer(e,t){_class_call_check$1(this,JsonProtoSerializer);this.databaseId=e,this.useProto3Json=t};function __PRIVATE_toInt32Proto(e,t){return e.useProto3Json||__PRIVATE_isNullOrUndefined(t)?t:{value:t}}function toTimestamp(e,t){if(e.useProto3Json){return"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z")}return{seconds:""+t.seconds,nanos:t.nanoseconds}}function __PRIVATE_toBytes(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function __PRIVATE_toVersion(e,t){return toTimestamp(e,t.toTimestamp())}function __PRIVATE_fromVersion(e){return __PRIVATE_hardAssert(!!e),SnapshotVersion.fromTimestamp(function fromTimestamp(e){var t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}(e))}function __PRIVATE_toResourceName(e,t){return __PRIVATE_toResourcePath(e,t).canonicalString()}function __PRIVATE_toResourcePath(e,t){var n=(function __PRIVATE_fullyQualifiedPrefixPath(e){return new ResourcePath(["projects",e.projectId,"databases",e.database])})(e).child("documents");return void 0===t?n:n.child(t)}function __PRIVATE_fromResourceName(e){var t=ResourcePath.fromString(e);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(t)),t}function __PRIVATE_toName(e,t){return __PRIVATE_toResourceName(e.databaseId,t.path)}function fromName(e,t){var n=__PRIVATE_fromResourceName(t);if(n.get(1)!==e.databaseId.projectId)throw new FirestoreError(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new FirestoreError(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(n))}function __PRIVATE_toQueryPath(e,t){return __PRIVATE_toResourceName(e.databaseId,t)}function __PRIVATE_fromQueryPath(e){var t=__PRIVATE_fromResourceName(e);return 4===t.length?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(t)}function __PRIVATE_getEncodedDatabaseId(e){return new ResourcePath(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(e){return __PRIVATE_hardAssert(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function __PRIVATE_toMutationDocument(e,t,n){return{name:__PRIVATE_toName(e,t),fields:n.value.mapValue.fields}}function __PRIVATE_fromDocument(e,t,n){var _$r=fromName(e,t.name),i=__PRIVATE_fromVersion(t.updateTime),s=t.createTime?__PRIVATE_fromVersion(t.createTime):SnapshotVersion.min(),o=new ObjectValue({mapValue:{fields:t.fields}}),_=MutableDocument.newFoundDocument(_$r,i,s,o);return n&&_.setHasCommittedMutations(),n?_.setHasCommittedMutations():_}function __PRIVATE_fromBatchGetDocumentsResponse(e,t){return"found"in t?function __PRIVATE_fromFound(e,t){__PRIVATE_hardAssert(!!t.found),t.found.name,t.found.updateTime;var n=fromName(e,t.found.name),_$r=__PRIVATE_fromVersion(t.found.updateTime),i=t.found.createTime?__PRIVATE_fromVersion(t.found.createTime):SnapshotVersion.min(),s=new ObjectValue({mapValue:{fields:t.found.fields}});return MutableDocument.newFoundDocument(n,_$r,i,s)}(e,t):"missing"in t?function __PRIVATE_fromMissing(e,t){__PRIVATE_hardAssert(!!t.missing),__PRIVATE_hardAssert(!!t.readTime);var n=fromName(e,t.missing),_$r=__PRIVATE_fromVersion(t.readTime);return MutableDocument.newNoDocument(n,_$r)}(e,t):fail()}function __PRIVATE_fromWatchChange(e,t){var n;if("targetChange"in t){t.targetChange;var _$r=function __PRIVATE_fromWatchTargetChangeState(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:fail()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function __PRIVATE_fromBytes(e,t){return e.useProto3Json?(__PRIVATE_hardAssert(void 0===t||"string"==typeof t),ByteString.fromBase64String(t||"")):(__PRIVATE_hardAssert(void 0===t||_instanceof$1(t,Uint8Array)),ByteString.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,_=o&&function __PRIVATE_fromRpcStatus(e){var _$t=void 0===e.code?D.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(e.code);return new FirestoreError(_$t,e.message||"")}(o);n=new __PRIVATE_WatchTargetChange(_$r,i,s,_||null)}else if("documentChange"in t){t.documentChange;var r1=t.documentChange;r1.document,r1.document.name,r1.document.updateTime;var i1=fromName(e,r1.document.name),s1=__PRIVATE_fromVersion(r1.document.updateTime),o1=r1.document.createTime?__PRIVATE_fromVersion(r1.document.createTime):SnapshotVersion.min(),_1=new ObjectValue({mapValue:{fields:r1.document.fields}}),a=MutableDocument.newFoundDocument(i1,s1,o1,_1),u=r1.targetIds||[],c=r1.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange(u,c,a.key,a)}else if("documentDelete"in t){t.documentDelete;var r2=t.documentDelete;r2.document;var i2=fromName(e,r2.document),s2=r2.readTime?__PRIVATE_fromVersion(r2.readTime):SnapshotVersion.min(),o2=MutableDocument.newNoDocument(i2,s2),_2=r2.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],_2,o2.key,o2)}else if("documentRemove"in t){t.documentRemove;var r3=t.documentRemove;r3.document;var i3=fromName(e,r3.document),s3=r3.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],s3,i3,null)}else{if(!("filter"in t))return fail();{t.filter;var _$e=t.filter;_$e.targetId;var tmp=_$e.count,r4=tmp===void 0?0:tmp,i4=_$e.unchangedNames,s4=new ExistenceFilter(r4,i4),o3=_$e.targetId;n=new __PRIVATE_ExistenceFilterChange(o3,s4)}}return n}function toMutation(e,t){var n;if(_instanceof$1(t,__PRIVATE_SetMutation))n={update:__PRIVATE_toMutationDocument(e,t.key,t.value)};else if(_instanceof$1(t,__PRIVATE_DeleteMutation))n={delete:__PRIVATE_toName(e,t.key)};else if(_instanceof$1(t,__PRIVATE_PatchMutation))n={update:__PRIVATE_toMutationDocument(e,t.key,t.data),updateMask:__PRIVATE_toDocumentMask(t.fieldMask)};else{if(!_instanceof$1(t,__PRIVATE_VerifyMutation))return fail();n={verify:__PRIVATE_toName(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function __PRIVATE_toFieldTransform(e,t){var n=t.transform;if(_instanceof$1(n,__PRIVATE_ServerTimestampTransform))return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_instanceof$1(n,__PRIVATE_ArrayUnionTransformOperation))return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(_instanceof$1(n,__PRIVATE_ArrayRemoveTransformOperation))return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(_instanceof$1(n,__PRIVATE_NumericIncrementTransformOperation))return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw fail()}(0,e)})),t.precondition.isNone||(n.currentDocument=function __PRIVATE_toPrecondition(e,t){return void 0!==t.updateTime?{updateTime:__PRIVATE_toVersion(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:fail()}(e,t.precondition)),n}function __PRIVATE_fromMutation(e,t){var n=t.currentDocument?function __PRIVATE_fromPrecondition(e){return void 0!==e.updateTime?Precondition.updateTime(__PRIVATE_fromVersion(e.updateTime)):void 0!==e.exists?Precondition.exists(e.exists):Precondition.none()}(t.currentDocument):Precondition.none(),_$r=t.updateTransforms?t.updateTransforms.map(function(t){return function __PRIVATE_fromFieldTransform(e,t){var n=null;if("setToServerValue"in t)__PRIVATE_hardAssert("REQUEST_TIME"===t.setToServerValue),n=new __PRIVATE_ServerTimestampTransform;else if("appendMissingElements"in t){var _$e=t.appendMissingElements.values||[];n=new __PRIVATE_ArrayUnionTransformOperation(_$e)}else if("removeAllFromArray"in t){var _$e1=t.removeAllFromArray.values||[];n=new __PRIVATE_ArrayRemoveTransformOperation(_$e1)}else"increment"in t?n=new __PRIVATE_NumericIncrementTransformOperation(e,t.increment):fail();var _$r=FieldPath$1.fromServerFormat(t.fieldPath);return new FieldTransform(_$r,n)}(e,t)}):[];if(t.update){t.update.name;var i=fromName(e,t.update.name),s=new ObjectValue({mapValue:{fields:t.update.fields}});if(t.updateMask){var _$e=function __PRIVATE_fromDocumentMask(e){var _$t=e.fieldPaths||[];return new FieldMask(_$t.map(function(e){return FieldPath$1.fromServerFormat(e)}))}(t.updateMask);return new __PRIVATE_PatchMutation(i,s,_$e,n,_$r)}return new __PRIVATE_SetMutation(i,s,n,_$r)}if(t.delete){var r1=fromName(e,t.delete);return new __PRIVATE_DeleteMutation(r1,n)}if(t.verify){var r2=fromName(e,t.verify);return new __PRIVATE_VerifyMutation(r2,n)}return fail()}function __PRIVATE_fromWriteResults(e,t){return e&&e.length>0?(__PRIVATE_hardAssert(void 0!==t),e.map(function(e){return function __PRIVATE_fromWriteResult(e,t){var n=e.updateTime?__PRIVATE_fromVersion(e.updateTime):__PRIVATE_fromVersion(t);return n.isEqual(SnapshotVersion.min())&&(n=__PRIVATE_fromVersion(t)),new MutationResult(n,e.transformResults||[])}(e,t)})):[]}function __PRIVATE_toDocumentsTarget(e,t){return{documents:[__PRIVATE_toQueryPath(e,t.path)]}}function __PRIVATE_toQueryTarget(e,t){var n={structuredQuery:{}},_$r=t.path;var i;null!==t.collectionGroup?(i=_$r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=_$r.popLast(),n.structuredQuery.from=[{collectionId:_$r.lastSegment()}]),n.parent=__PRIVATE_toQueryPath(e,i);var s=function __PRIVATE_toFilters(e){if(0===e.length)return;return __PRIVATE_toFilter(CompositeFilter.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);var o=function __PRIVATE_toOrder(e){if(0===e.length)return;return e.map(function(e){return function __PRIVATE_toPropertyOrder(e){return{field:__PRIVATE_toFieldPathReference(e.field),direction:__PRIVATE_toDirection(e.dir)}}(e)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var _=__PRIVATE_toInt32Proto(e,t.limit);return null!==_&&(n.structuredQuery.limit=_),t.startAt&&(n.structuredQuery.startAt=function __PRIVATE_toStartAtCursor(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function __PRIVATE_toEndAtCursor(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function __PRIVATE_convertQueryTargetToQuery(e){var t=__PRIVATE_fromQueryPath(e.parent);var n=e.structuredQuery,_$r=n.from?n.from.length:0;var i=null;if(_$r>0){__PRIVATE_hardAssert(1===_$r);var _$e=n.from[0];_$e.allDescendants?i=_$e.collectionId:t=t.child(_$e.collectionId)}var s=[];n.where&&(s=function __PRIVATE_fromFilters(e){var t=__PRIVATE_fromFilter(e);if(_instanceof$1(t,CompositeFilter)&&__PRIVATE_compositeFilterIsFlatConjunction(t))return t.getFilters();return[t]}(n.where));var o=[];n.orderBy&&(o=function __PRIVATE_fromOrder(e){return e.map(function(e){return function __PRIVATE_fromPropertyOrder(e){return new OrderBy(__PRIVATE_fromFieldPathReference(e.field),function __PRIVATE_fromDirection(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})}(n.orderBy));var _=null;n.limit&&(_=function __PRIVATE_fromInt32Proto(e){var t;return t="object"==typeof e?e.value:e,__PRIVATE_isNullOrUndefined(t)?null:t}(n.limit));var a=null;n.startAt&&(a=function __PRIVATE_fromStartAtCursor(e){var t=!!e.before,n=e.values||[];return new Bound(n,t)}(n.startAt));var u=null;return n.endAt&&(u=function __PRIVATE_fromEndAtCursor(e){var t=!e.before,n=e.values||[];return new Bound(n,t)}(n.endAt)),__PRIVATE_newQuery(t,i,o,s,_,"F",a,u)}function __PRIVATE_toListenRequestLabels(e,t){var n=function __PRIVATE_toLabel(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}function __PRIVATE_fromFilter(e){return void 0!==e.unaryFilter?function __PRIVATE_fromUnaryFilter(e){switch(e.unaryFilter.op){case"IS_NAN":var t=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var _$r=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(_$r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(i,"!=",{nullValue:"NULL_VALUE"});default:return fail()}}(e):void 0!==e.fieldFilter?function __PRIVATE_fromFieldFilter(e){return FieldFilter.create(__PRIVATE_fromFieldPathReference(e.fieldFilter.field),function __PRIVATE_fromOperatorName(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fail()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function __PRIVATE_fromCompositeFilter(e){return CompositeFilter.create(e.compositeFilter.filters.map(function(e){return __PRIVATE_fromFilter(e)}),function __PRIVATE_fromCompositeOperatorName(e){switch(e){case"AND":return"and";case"OR":return"or";default:return fail()}}(e.compositeFilter.op))}(e):fail()}function __PRIVATE_toDirection(e){return he[e]}function __PRIVATE_toOperatorName(e){return Pe[e]}function __PRIVATE_toCompositeOperatorName(e){return Ie[e]}function __PRIVATE_toFieldPathReference(e){return{fieldPath:e.canonicalString()}}function __PRIVATE_fromFieldPathReference(e){return FieldPath$1.fromServerFormat(e.fieldPath)}function __PRIVATE_toFilter(e){return _instanceof$1(e,FieldFilter)?function __PRIVATE_toUnaryOrFieldFilter(e){if("=="===e.op){if(__PRIVATE_isNanValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(__PRIVATE_isNanValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:__PRIVATE_toOperatorName(e.op),value:e.value}}}(e):_instanceof$1(e,CompositeFilter)?function __PRIVATE_toCompositeFilter(e){var t=e.getFilters().map(function(e){return __PRIVATE_toFilter(e)});if(1===t.length)return t[0];return{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(e.op),filters:t}}}(e):fail()}function __PRIVATE_toDocumentMask(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function __PRIVATE_isValidResourceName(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var TargetData=function(){function TargetData(e,t,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:SnapshotVersion.min(),s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:SnapshotVersion.min(),o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ByteString.EMPTY_BYTE_STRING,_=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;_class_call_check$1(this,TargetData);this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=_}_create_class$1(TargetData,[{key:"withSequenceNumber",value:function withSequenceNumber(e){return new TargetData(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function withResumeToken(e,t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}},{key:"withExpectedCount",value:function withExpectedCount(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}},{key:"withLastLimboFreeSnapshotVersion",value:function withLastLimboFreeSnapshotVersion(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}]);return TargetData}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_LocalSerializer=function __PRIVATE_LocalSerializer(e){_class_call_check$1(this,__PRIVATE_LocalSerializer);this.ct=e};function __PRIVATE_fromDbRemoteDocument(e,t){var n;if(t.document)n=__PRIVATE_fromDocument(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var _$e=DocumentKey.fromSegments(t.noDocument.path),_$r=__PRIVATE_fromDbTimestamp(t.noDocument.readTime);n=MutableDocument.newNoDocument(_$e,_$r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return fail();{var _$e1=DocumentKey.fromSegments(t.unknownDocument.path),r1=__PRIVATE_fromDbTimestamp(t.unknownDocument.version);n=MutableDocument.newUnknownDocument(_$e1,r1)}}return t.readTime&&n.setReadTime(function __PRIVATE_fromDbTimestampKey(e){var _$t=new Timestamp(e[0],e[1]);return SnapshotVersion.fromTimestamp(_$t)}(t.readTime)),n}function __PRIVATE_toDbRemoteDocument(e,t){var n=t.key,_$r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:__PRIVATE_toDbTimestampKey(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())_$r.document=function __PRIVATE_toDocument(e,t){return{name:__PRIVATE_toName(e,t.key),fields:t.data.value.mapValue.fields,updateTime:toTimestamp(e,t.version.toTimestamp()),createTime:toTimestamp(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())_$r.noDocument={path:n.path.toArray(),readTime:__PRIVATE_toDbTimestamp(t.version)};else{if(!t.isUnknownDocument())return fail();_$r.unknownDocument={path:n.path.toArray(),version:__PRIVATE_toDbTimestamp(t.version)}}return _$r}function __PRIVATE_toDbTimestampKey(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function __PRIVATE_toDbTimestamp(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function __PRIVATE_fromDbTimestamp(e){var t=new Timestamp(e.seconds,e.nanoseconds);return SnapshotVersion.fromTimestamp(t)}function __PRIVATE_fromDbMutationBatch(e,t){var n=(t.baseMutations||[]).map(function(t){return __PRIVATE_fromMutation(e.ct,t)});for(var e1=0;e1<t.mutations.length-1;++e1){var n1=t.mutations[e1];if(e1+1<t.mutations.length&&void 0!==t.mutations[e1+1].transform){var _$r=t.mutations[e1+1];n1.updateTransforms=_$r.transform.fieldTransforms,t.mutations.splice(e1+1,1),++e1}}var r1=t.mutations.map(function(t){return __PRIVATE_fromMutation(e.ct,t)}),i=Timestamp.fromMillis(t.localWriteTimeMs);return new MutationBatch(t.batchId,i,n,r1)}function __PRIVATE_fromDbTarget(e){var t=__PRIVATE_fromDbTimestamp(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?__PRIVATE_fromDbTimestamp(e.lastLimboFreeSnapshotVersion):SnapshotVersion.min();var _$r;return _$r=function __PRIVATE_isDocumentQuery(e){return void 0!==e.documents}(e.query)?function __PRIVATE_fromDocumentsTarget(e){return __PRIVATE_hardAssert(1===e.documents.length),__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(__PRIVATE_fromQueryPath(e.documents[0])))}(e.query):function __PRIVATE_fromQueryTarget(e){return __PRIVATE_queryToTarget(__PRIVATE_convertQueryTargetToQuery(e))}(e.query),new TargetData(_$r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,ByteString.fromBase64String(e.resumeToken))}function __PRIVATE_toDbTarget(e,t){var n=__PRIVATE_toDbTimestamp(t.snapshotVersion),_$r=__PRIVATE_toDbTimestamp(t.lastLimboFreeSnapshotVersion);var i;i=__PRIVATE_targetIsDocumentTarget(t.target)?__PRIVATE_toDocumentsTarget(e.ct,t.target):__PRIVATE_toQueryTarget(e.ct,t.target).ut;var s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:__PRIVATE_canonifyTarget(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:_$r,query:i}}function __PRIVATE_fromBundledQuery(e){var t=__PRIVATE_convertQueryTargetToQuery({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?__PRIVATE_queryWithLimit(t,t.limit,"L"):t}function __PRIVATE_fromDbDocumentOverlay(e,t){return new Overlay(t.largestBatchId,__PRIVATE_fromMutation(e.ct,t.overlayMutation))}function __PRIVATE_toDbDocumentOverlayKey(e,t){var n=t.path.lastSegment();return[e,__PRIVATE_encodeResourcePath(t.path.popLast()),n]}function __PRIVATE_toDbIndexState(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:__PRIVATE_toDbTimestamp(r.readTime),documentKey:__PRIVATE_encodeResourcePath(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbBundleCache=function(){function __PRIVATE_IndexedDbBundleCache(){_class_call_check$1(this,__PRIVATE_IndexedDbBundleCache)}_create_class$1(__PRIVATE_IndexedDbBundleCache,[{key:"getBundleMetadata",value:function getBundleMetadata(e,t){return __PRIVATE_bundlesStore(e).get(t).next(function(e){if(e)return function __PRIVATE_fromDbBundle(e){return{id:e.bundleId,createTime:__PRIVATE_fromDbTimestamp(e.createTime),version:e.version}}(e)})}},{key:"saveBundleMetadata",value:function saveBundleMetadata(e,t){return __PRIVATE_bundlesStore(e).put(function __PRIVATE_toDbBundle(e){return{bundleId:e.id,createTime:__PRIVATE_toDbTimestamp(__PRIVATE_fromVersion(e.createTime)),version:e.version}}(t))}},{key:"getNamedQuery",value:function getNamedQuery(e,t){return __PRIVATE_namedQueriesStore(e).get(t).next(function(e){if(e)return function __PRIVATE_fromDbNamedQuery(e){return{name:e.name,query:__PRIVATE_fromBundledQuery(e.bundledQuery),readTime:__PRIVATE_fromDbTimestamp(e.readTime)}}(e)})}},{key:"saveNamedQuery",value:function saveNamedQuery(e,t){return __PRIVATE_namedQueriesStore(e).put(function __PRIVATE_toDbNamedQuery(e){return{name:e.name,readTime:__PRIVATE_toDbTimestamp(__PRIVATE_fromVersion(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]);return __PRIVATE_IndexedDbBundleCache}();function __PRIVATE_bundlesStore(e){return __PRIVATE_getStore(e,"bundles")}function __PRIVATE_namedQueriesStore(e){return __PRIVATE_getStore(e,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbDocumentOverlayCache=function(){function __PRIVATE_IndexedDbDocumentOverlayCache(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbDocumentOverlayCache);this.serializer=e,this.userId=t}_create_class$1(__PRIVATE_IndexedDbDocumentOverlayCache,[{key:"getOverlay",value:function getOverlay(e,t){var _this=this;return __PRIVATE_documentOverlayStore(e).get(__PRIVATE_toDbDocumentOverlayKey(this.userId,t)).next(function(e){return e?__PRIVATE_fromDbDocumentOverlay(_this.serializer,e):null})}},{key:"getOverlays",value:function getOverlays(e,t){var _this=this;var n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,function(t){return _this.getOverlay(e,t).next(function(e){null!==e&&n.set(t,e)})}).next(function(){return n})}},{key:"saveOverlays",value:function saveOverlays(e,t,n){var _this=this;var _$r=[];return n.forEach(function(n,i){var s=new Overlay(t,i);_$r.push(_this.ht(e,s))}),PersistencePromise.waitFor(_$r)}},{key:"removeOverlaysForBatchId",value:function removeOverlaysForBatchId(e,t,n){var _this=this;var _$r=new Set;t.forEach(function(e){return _$r.add(__PRIVATE_encodeResourcePath(e.getCollectionPath()))});var i=[];return _$r.forEach(function(t){var _$r=IDBKeyRange.bound([_this.userId,t,n],[_this.userId,t,n+1],!1,!0);i.push(__PRIVATE_documentOverlayStore(e).H("collectionPathOverlayIndex",_$r))}),PersistencePromise.waitFor(i)}},{key:"getOverlaysForCollection",value:function getOverlaysForCollection(e,t,n){var _this=this;var _$r=__PRIVATE_newOverlayMap(),i=__PRIVATE_encodeResourcePath(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return __PRIVATE_documentOverlayStore(e).W("collectionPathOverlayIndex",s).next(function(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;var _$e=__PRIVATE_fromDbDocumentOverlay(_this.serializer,_$t);_$r.set(_$e.getKey(),_$e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$r})}},{key:"getOverlaysForCollectionGroup",value:function getOverlaysForCollectionGroup(e,t,n,r){var _this=this;var i=__PRIVATE_newOverlayMap();var s;var o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return __PRIVATE_documentOverlayStore(e).Y({index:"collectionGroupOverlayIndex",range:o},function(e,t,n){var o=__PRIVATE_fromDbDocumentOverlay(_this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()}).next(function(){return i})}},{key:"ht",value:function ht(e,t){return __PRIVATE_documentOverlayStore(e).put(function __PRIVATE_toDbDocumentOverlay(e,t,n){var _$__PRIVATE_toDbDocumentOverlayKey=_sliced_to_array$1(__PRIVATE_toDbDocumentOverlayKey(t,n.mutation.key),3);_$__PRIVATE_toDbDocumentOverlayKey[0];var i=_$__PRIVATE_toDbDocumentOverlayKey[1],s=_$__PRIVATE_toDbDocumentOverlayKey[2];return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:toMutation(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}],[{key:"lt",value:function lt(e,t){var n=t.uid||"";return new __PRIVATE_IndexedDbDocumentOverlayCache(e,n)}}]);return __PRIVATE_IndexedDbDocumentOverlayCache}();function __PRIVATE_documentOverlayStore(e){return __PRIVATE_getStore(e,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_FirestoreIndexValueWriter=function(){function __PRIVATE_FirestoreIndexValueWriter(){_class_call_check$1(this,__PRIVATE_FirestoreIndexValueWriter)}_create_class$1(__PRIVATE_FirestoreIndexValueWriter,[{key:"Pt",value:function Pt(e,t){this.It(e,t),t.Tt()}},{key:"It",value:function It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(__PRIVATE_normalizeNumber(e.integerValue));else if("doubleValue"in e){var n=__PRIVATE_normalizeNumber(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),__PRIVATE_isNegativeZero(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){var n1=e.timestampValue;this.Et(t,20),"string"==typeof n1?t.At(n1):(t.At("".concat(n1.seconds||"")),t.dt(n1.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(__PRIVATE_normalizeByteString(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){var n2=e.geoPointValue;this.Et(t,45),t.dt(n2.latitude||0),t.dt(n2.longitude||0)}else"mapValue"in e?__PRIVATE_isMaxValue(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):fail()}},{key:"Rt",value:function Rt(e,t){this.Et(t,25),this.St(e,t)}},{key:"St",value:function St(e,t){t.At(e)}},{key:"yt",value:function yt(e,t){var n=e.fields||{};this.Et(t,55);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=Object.keys(n)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;this.Rt(_$e,t),this.It(n[_$e],t)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"wt",value:function wt(e,t){var n=e.values||[];this.Et(t,50);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;this.It(_$e,t)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"gt",value:function gt(e,t){var _this=this;this.Et(t,37);DocumentKey.fromName(e).path.forEach(function(e){_this.Et(t,60),_this.St(e,t)})}},{key:"Et",value:function Et(e,t){e.dt(t)}},{key:"Vt",value:function Vt(e){e.dt(2)}}]);return __PRIVATE_FirestoreIndexValueWriter}();__PRIVATE_FirestoreIndexValueWriter.bt=new __PRIVATE_FirestoreIndexValueWriter;function __PRIVATE_numberOfLeadingZerosInByte(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function __PRIVATE_unsignedNumLength(e){var t=64-function __PRIVATE_numberOfLeadingZeros(e){var t=0;for(var n=0;n<8;++n){var _$r=__PRIVATE_numberOfLeadingZerosInByte(255&e[n]);if(t+=_$r,8!==_$r)break}return t}(e);return Math.ceil(t/8)}var __PRIVATE_OrderedCodeWriter=function(){function __PRIVATE_OrderedCodeWriter(){_class_call_check$1(this,__PRIVATE_OrderedCodeWriter);this.buffer=new Uint8Array(1024),this.position=0}_create_class$1(__PRIVATE_OrderedCodeWriter,[{key:"Dt",value:function Dt(e){var t=e[Symbol.iterator]();var n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}},{key:"Ft",value:function Ft(e){var t=e[Symbol.iterator]();var n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}},{key:"Ot",value:function Ot(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;var _$e=t.charCodeAt(0);if(_$e<128)this.Ct(_$e);else if(_$e<2048)this.Ct(960|_$e>>>6),this.Ct(128|63&_$e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|_$e>>>12),this.Ct(128|63&_$e>>>6),this.Ct(128|63&_$e);else{var _$e1=t.codePointAt(0);this.Ct(240|_$e1>>>18),this.Ct(128|63&_$e1>>>12),this.Ct(128|63&_$e1>>>6),this.Ct(128|63&_$e1)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.vt()}},{key:"Nt",value:function Nt(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;var _$e=t.charCodeAt(0);if(_$e<128)this.Mt(_$e);else if(_$e<2048)this.Mt(960|_$e>>>6),this.Mt(128|63&_$e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|_$e>>>12),this.Mt(128|63&_$e>>>6),this.Mt(128|63&_$e);else{var _$e1=t.codePointAt(0);this.Mt(240|_$e1>>>18),this.Mt(128|63&_$e1>>>12),this.Mt(128|63&_$e1>>>6),this.Mt(128|63&_$e1)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.xt()}},{key:"Bt",value:function Bt(e){var t=this.Lt(e),n=__PRIVATE_unsignedNumLength(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(var _$e=t.length-n;_$e<t.length;++_$e)this.buffer[this.position++]=255&t[_$e]}},{key:"qt",value:function qt(e){var t=this.Lt(e),n=__PRIVATE_unsignedNumLength(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(var _$e=t.length-n;_$e<t.length;++_$e)this.buffer[this.position++]=~(255&t[_$e])}},{key:"Qt",value:function Qt(){this.Kt(255),this.Kt(255)}},{key:"$t",value:function $t(){this.Ut(255),this.Ut(255)}},{key:"reset",value:function reset(){this.position=0}},{key:"seed",value:function seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Wt",value:function Wt(){return this.buffer.slice(0,this.position)}},{key:"Lt",value:function Lt(e){var t=function __PRIVATE_doubleToLongBits(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var _$e=1;_$e<t.length;++_$e)t[_$e]^=n?255:0;return t}},{key:"Ct",value:function Ct(e){var t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}},{key:"Mt",value:function Mt(e){var t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}},{key:"vt",value:function vt(){this.Kt(0),this.Kt(1)}},{key:"xt",value:function xt(){this.Ut(0),this.Ut(1)}},{key:"Kt",value:function Kt(e){this.kt(1),this.buffer[this.position++]=e}},{key:"Ut",value:function Ut(e){this.kt(1),this.buffer[this.position++]=~e}},{key:"kt",value:function kt(e){var t=e+this.position;if(t<=this.buffer.length)return;var n=2*this.buffer.length;n<t&&(n=t);var _$r=new Uint8Array(n);_$r.set(this.buffer),this.buffer=_$r}}]);return __PRIVATE_OrderedCodeWriter}();var __PRIVATE_AscendingIndexByteEncoder=function(){function __PRIVATE_AscendingIndexByteEncoder(e){_class_call_check$1(this,__PRIVATE_AscendingIndexByteEncoder);this.Gt=e}_create_class$1(__PRIVATE_AscendingIndexByteEncoder,[{key:"ft",value:function ft(e){this.Gt.Dt(e)}},{key:"At",value:function At(e){this.Gt.Ot(e)}},{key:"dt",value:function dt(e){this.Gt.Bt(e)}},{key:"Tt",value:function Tt(){this.Gt.Qt()}}]);return __PRIVATE_AscendingIndexByteEncoder}();var __PRIVATE_DescendingIndexByteEncoder=function(){function __PRIVATE_DescendingIndexByteEncoder(e){_class_call_check$1(this,__PRIVATE_DescendingIndexByteEncoder);this.Gt=e}_create_class$1(__PRIVATE_DescendingIndexByteEncoder,[{key:"ft",value:function ft(e){this.Gt.Ft(e)}},{key:"At",value:function At(e){this.Gt.Nt(e)}},{key:"dt",value:function dt(e){this.Gt.qt(e)}},{key:"Tt",value:function Tt(){this.Gt.$t()}}]);return __PRIVATE_DescendingIndexByteEncoder}();var __PRIVATE_IndexByteEncoder=function(){function __PRIVATE_IndexByteEncoder(){_class_call_check$1(this,__PRIVATE_IndexByteEncoder);this.Gt=new __PRIVATE_OrderedCodeWriter,this.zt=new __PRIVATE_AscendingIndexByteEncoder(this.Gt),this.jt=new __PRIVATE_DescendingIndexByteEncoder(this.Gt)}_create_class$1(__PRIVATE_IndexByteEncoder,[{key:"seed",value:function seed(e){this.Gt.seed(e)}},{key:"Ht",value:function Ht(e){return 0===e?this.zt:this.jt}},{key:"Wt",value:function Wt(){return this.Gt.Wt()}},{key:"reset",value:function reset(){this.Gt.reset()}}]);return __PRIVATE_IndexByteEncoder}();/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexEntry=function(){function __PRIVATE_IndexEntry(e,t,n,r){_class_call_check$1(this,__PRIVATE_IndexEntry);this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}_create_class$1(__PRIVATE_IndexEntry,[{key:"Jt",value:function Jt(){var e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new __PRIVATE_IndexEntry(this.indexId,this.documentKey,this.arrayValue,n)}}]);return __PRIVATE_IndexEntry}();function __PRIVATE_indexEntryComparator(e,t){var n=e.indexId-t.indexId;return 0!==n?n:(n=__PRIVATE_compareByteArrays(e.arrayValue,t.arrayValue),0!==n?n:(n=__PRIVATE_compareByteArrays(e.directionalValue,t.directionalValue),0!==n?n:DocumentKey.comparator(e.documentKey,t.documentKey)))}function __PRIVATE_compareByteArrays(e,t){for(var n=0;n<e.length&&n<t.length;++n){var _$r=e[n]-t[n];if(0!==_$r)return _$r}return e.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_TargetIndexMatcher=function(){function __PRIVATE_TargetIndexMatcher(e){_class_call_check$1(this,__PRIVATE_TargetIndexMatcher);this.Yt=new SortedSet(function(e,t){return FieldPath$1.comparator(e.field,t.field)}),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.filters[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;var _$e=t;_$e.isInequality()?this.Yt=this.Yt.add(_$e):this.Xt.push(_$e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}_create_class$1(__PRIVATE_TargetIndexMatcher,[{key:"en",get:function get(){return this.Yt.size>1}},{key:"tn",value:function tn(e){if(__PRIVATE_hardAssert(e.collectionGroup===this.collectionId),this.en)return!1;var t=__PRIVATE_fieldIndexGetArraySegment(e);if(void 0!==t&&!this.nn(t))return!1;var n=__PRIVATE_fieldIndexGetDirectionalSegments(e);var _$r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)_$r=_$r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){var _$e=this.Yt.getIterator().getNext();if(!_$r.has(_$e.field.canonicalString())){var t1=n[i];if(!this.rn(_$e,t1)||!this.sn(this.Zt[s++],t1))return!1}++i}for(;i<n.length;++i){var _$e1=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],_$e1))return!1}return!0}},{key:"on",value:function on(){if(this.en)return null;var e=new SortedSet(FieldPath$1.comparator);var t=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.Xt[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;if(n.field.isKeyField())continue;if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new IndexSegment(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new IndexSegment(n.field,0))}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=this.Zt[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var n1=_step1.value;n1.field.isKeyField()||e.has(n1.field)||(e=e.add(n1.field),t.push(new IndexSegment(n1.field,"asc"===n1.dir?0:1)))}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return new FieldIndex(FieldIndex.UNKNOWN_ID,this.collectionId,t,IndexState.empty())}},{key:"nn",value:function nn(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.Xt[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(this.rn(t,e))return!0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!1}},{key:"rn",value:function rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"sn",value:function sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]);return __PRIVATE_TargetIndexMatcher}();/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_computeInExpansion(e){var t,n;if(__PRIVATE_hardAssert(_instanceof$1(e,FieldFilter)||_instanceof$1(e,CompositeFilter)),_instanceof$1(e,FieldFilter)){if(_instanceof$1(e,__PRIVATE_InFilter)){var _$r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(function(t){return FieldFilter.create(e.field,"==",t)}))||[];return CompositeFilter.create(_$r,"or")}return e}var r1=e.filters.map(function(e){return __PRIVATE_computeInExpansion(e)});return CompositeFilter.create(r1,e.op)}function __PRIVATE_getDnfTerms(e){if(0===e.getFilters().length)return[];var t=__PRIVATE_computeDistributedNormalForm(__PRIVATE_computeInExpansion(e));return __PRIVATE_hardAssert(__PRIVATE_isDisjunctiveNormalForm(t)),__PRIVATE_isSingleFieldFilter(t)||__PRIVATE_isFlatConjunction(t)?[t]:t.getFilters()}function __PRIVATE_isSingleFieldFilter(e){return _instanceof$1(e,FieldFilter)}function __PRIVATE_isFlatConjunction(e){return _instanceof$1(e,CompositeFilter)&&__PRIVATE_compositeFilterIsFlatConjunction(e)}function __PRIVATE_isDisjunctiveNormalForm(e){return __PRIVATE_isSingleFieldFilter(e)||__PRIVATE_isFlatConjunction(e)||function __PRIVATE_isDisjunctionOfFieldFiltersAndFlatConjunctions(e){if(_instanceof$1(e,CompositeFilter)&&__PRIVATE_compositeFilterIsDisjunction(e)){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.getFilters()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(!__PRIVATE_isSingleFieldFilter(t)&&!__PRIVATE_isFlatConjunction(t))return!1}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!0}return!1}(e)}function __PRIVATE_computeDistributedNormalForm(e){if(__PRIVATE_hardAssert(_instanceof$1(e,FieldFilter)||_instanceof$1(e,CompositeFilter)),_instanceof$1(e,FieldFilter))return e;if(1===e.filters.length)return __PRIVATE_computeDistributedNormalForm(e.filters[0]);var t=e.filters.map(function(e){return __PRIVATE_computeDistributedNormalForm(e)});var n=CompositeFilter.create(t,e.op);return n=__PRIVATE_applyAssociation(n),__PRIVATE_isDisjunctiveNormalForm(n)?n:(__PRIVATE_hardAssert(_instanceof$1(n,CompositeFilter)),__PRIVATE_hardAssert(__PRIVATE_compositeFilterIsConjunction(n)),__PRIVATE_hardAssert(n.filters.length>1),n.filters.reduce(function(e,t){return __PRIVATE_applyDistribution(e,t)}))}function __PRIVATE_applyDistribution(e,t){var n;return __PRIVATE_hardAssert(_instanceof$1(e,FieldFilter)||_instanceof$1(e,CompositeFilter)),__PRIVATE_hardAssert(_instanceof$1(t,FieldFilter)||_instanceof$1(t,CompositeFilter)),n=_instanceof$1(e,FieldFilter)?_instanceof$1(t,FieldFilter)?function __PRIVATE_applyDistributionFieldFilters(e,t){return CompositeFilter.create([e,t],"and")}(e,t):__PRIVATE_applyDistributionFieldAndCompositeFilters(e,t):_instanceof$1(t,FieldFilter)?__PRIVATE_applyDistributionFieldAndCompositeFilters(t,e):function __PRIVATE_applyDistributionCompositeFilters(e,t){if(__PRIVATE_hardAssert(e.filters.length>0&&t.filters.length>0),__PRIVATE_compositeFilterIsConjunction(e)&&__PRIVATE_compositeFilterIsConjunction(t))return __PRIVATE_compositeFilterWithAddedFilters(e,t.getFilters());var n=__PRIVATE_compositeFilterIsDisjunction(e)?e:t,_$r=__PRIVATE_compositeFilterIsDisjunction(e)?t:e,i=n.filters.map(function(e){return __PRIVATE_applyDistribution(e,_$r)});return CompositeFilter.create(i,"or")}(e,t),__PRIVATE_applyAssociation(n)}function __PRIVATE_applyDistributionFieldAndCompositeFilters(e,t){if(__PRIVATE_compositeFilterIsConjunction(t))return __PRIVATE_compositeFilterWithAddedFilters(t,e.getFilters());{var n=t.filters.map(function(t){return __PRIVATE_applyDistribution(e,t)});return CompositeFilter.create(n,"or")}}function __PRIVATE_applyAssociation(e){if(__PRIVATE_hardAssert(_instanceof$1(e,FieldFilter)||_instanceof$1(e,CompositeFilter)),_instanceof$1(e,FieldFilter))return e;var t=e.getFilters();if(1===t.length)return __PRIVATE_applyAssociation(t[0]);if(__PRIVATE_compositeFilterIsFlat(e))return e;var n=t.map(function(e){return __PRIVATE_applyAssociation(e)}),_$r=[];return n.forEach(function(t){var _r;_instanceof$1(t,FieldFilter)?_$r.push(t):_instanceof$1(t,CompositeFilter)&&(t.op===e.op?(_r=_$r).push.apply(_r,_to_consumable_array$1(t.filters)):_$r.push(t))}),1===_$r.length?_$r[0]:CompositeFilter.create(_$r,e.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryIndexManager=function(){function __PRIVATE_MemoryIndexManager(){_class_call_check$1(this,__PRIVATE_MemoryIndexManager);this._n=new __PRIVATE_MemoryCollectionParentIndex}_create_class$1(__PRIVATE_MemoryIndexManager,[{key:"addToCollectionParentIndex",value:function addToCollectionParentIndex(e,t){return this._n.add(t),PersistencePromise.resolve()}},{key:"getCollectionParents",value:function getCollectionParents(e,t){return PersistencePromise.resolve(this._n.getEntries(t))}},{key:"addFieldIndex",value:function addFieldIndex(e,t){return PersistencePromise.resolve()}},{key:"deleteFieldIndex",value:function deleteFieldIndex(e,t){return PersistencePromise.resolve()}},{key:"deleteAllFieldIndexes",value:function deleteAllFieldIndexes(e){return PersistencePromise.resolve()}},{key:"createTargetIndexes",value:function createTargetIndexes(e,t){return PersistencePromise.resolve()}},{key:"getDocumentsMatchingTarget",value:function getDocumentsMatchingTarget(e,t){return PersistencePromise.resolve(null)}},{key:"getIndexType",value:function getIndexType(e,t){return PersistencePromise.resolve(0)}},{key:"getFieldIndexes",value:function getFieldIndexes(e,t){return PersistencePromise.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function getNextCollectionGroupToUpdate(e){return PersistencePromise.resolve(null)}},{key:"getMinOffset",value:function getMinOffset(e,t){return PersistencePromise.resolve(IndexOffset.min())}},{key:"getMinOffsetFromCollectionGroup",value:function getMinOffsetFromCollectionGroup(e,t){return PersistencePromise.resolve(IndexOffset.min())}},{key:"updateCollectionGroup",value:function updateCollectionGroup(e,t,n){return PersistencePromise.resolve()}},{key:"updateIndexEntries",value:function updateIndexEntries(e,t){return PersistencePromise.resolve()}}]);return __PRIVATE_MemoryIndexManager}();var __PRIVATE_MemoryCollectionParentIndex=function(){function __PRIVATE_MemoryCollectionParentIndex(){_class_call_check$1(this,__PRIVATE_MemoryCollectionParentIndex);this.index={}}_create_class$1(__PRIVATE_MemoryCollectionParentIndex,[{key:"add",value:function add(e){var t=e.lastSegment(),n=e.popLast(),_$r=this.index[t]||new SortedSet(ResourcePath.comparator),i=!_$r.has(n);return this.index[t]=_$r.add(n),i}},{key:"has",value:function has(e){var t=e.lastSegment(),n=e.popLast(),_$r=this.index[t];return _$r&&_$r.has(n)}},{key:"getEntries",value:function getEntries(e){return(this.index[e]||new SortedSet(ResourcePath.comparator)).toArray()}}]);return __PRIVATE_MemoryCollectionParentIndex}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Te=new Uint8Array(0);var __PRIVATE_IndexedDbIndexManager=function(){function __PRIVATE_IndexedDbIndexManager(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbIndexManager);this.databaseId=t,this.an=new __PRIVATE_MemoryCollectionParentIndex,this.un=new ObjectMap(function(e){return __PRIVATE_canonifyTarget(e)},function(e,t){return __PRIVATE_targetEquals(e,t)}),this.uid=e.uid||""}_create_class$1(__PRIVATE_IndexedDbIndexManager,[{key:"addToCollectionParentIndex",value:function addToCollectionParentIndex(e,t){var _this=this;if(!this.an.has(t)){var n=t.lastSegment(),_$r=t.popLast();e.addOnCommittedListener(function(){_this.an.add(t)});var i={collectionId:n,parent:__PRIVATE_encodeResourcePath(_$r)};return __PRIVATE_collectionParentsStore(e).put(i)}return PersistencePromise.resolve()}},{key:"getCollectionParents",value:function getCollectionParents(e,t){var n=[],_$r=IDBKeyRange.bound([t,""],[__PRIVATE_immediateSuccessor(t),""],!1,!0);return __PRIVATE_collectionParentsStore(e).W(_$r).next(function(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;if(_$r.collectionId!==t)break;n.push(__PRIVATE_decodeResourcePath(_$r.parent))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return n})}},{key:"addFieldIndex",value:function addFieldIndex(e,t){var _this=this;var n=__PRIVATE_indexConfigurationStore(e),_$r=function __PRIVATE_toDbIndexConfiguration(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(function(e){return[e.fieldPath.canonicalString(),e.kind]})}}(t);delete _$r.indexId;var i=n.add(_$r);if(t.indexState){var n1=__PRIVATE_indexStateStore(e);return i.next(function(e){n1.put(__PRIVATE_toDbIndexState(e,_this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}},{key:"deleteFieldIndex",value:function deleteFieldIndex(e,t){var n=__PRIVATE_indexConfigurationStore(e),_$r=__PRIVATE_indexStateStore(e),i=__PRIVATE_indexEntriesStore(e);return n.delete(t.indexId).next(function(){return _$r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}).next(function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})}},{key:"deleteAllFieldIndexes",value:function deleteAllFieldIndexes(e){var t=__PRIVATE_indexConfigurationStore(e),n=__PRIVATE_indexEntriesStore(e),_$r=__PRIVATE_indexStateStore(e);return t.H().next(function(){return n.H()}).next(function(){return _$r.H()})}},{key:"createTargetIndexes",value:function createTargetIndexes(e,t){var _this=this;return PersistencePromise.forEach(this.cn(t),function(t){return _this.getIndexType(e,t).next(function(n){if(0===n||1===n){var _$n=new __PRIVATE_TargetIndexMatcher(t).on();if(null!=_$n)return _this.addFieldIndex(e,_$n)}})})}},{key:"getDocumentsMatchingTarget",value:function getDocumentsMatchingTarget(e,t){var _this=this;var n=__PRIVATE_indexEntriesStore(e);var _$r=!0;var i=new Map;return PersistencePromise.forEach(this.cn(t),function(t){return _this.ln(e,t).next(function(e){_$r&&(_$r=!!e),i.set(t,e)})}).next(function(){if(_$r){var _$e=__PRIVATE_documentKeySet();var r1=[];return PersistencePromise.forEach(i,function(i,s){__PRIVATE_logDebug("IndexedDbIndexManager","Using index ".concat(function __PRIVATE_fieldIndexToString(e){return"id=".concat(e.indexId,"|cg=").concat(e.collectionGroup,"|f=").concat(e.fields.map(function(e){return"".concat(e.fieldPath,":").concat(e.kind)}).join(","))}(i)," to execute ").concat(__PRIVATE_canonifyTarget(t)));var o=function __PRIVATE_targetGetArrayValues(e,t){var n=__PRIVATE_fieldIndexGetArraySegment(t);if(void 0===n)return null;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_targetGetFieldFiltersForPath(e,n.fieldPath)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;switch(_$t.op){case"array-contains-any":return _$t.value.arrayValue.values||[];case"array-contains":return[_$t.value]}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}(s,i),_=function __PRIVATE_targetGetNotInValues(e,t){var n=new Map;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined,_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator=__PRIVATE_fieldIndexGetDirectionalSegments(t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion1=(_step=_iterator.next()).done);_iteratorNormalCompletion1=true){var _$r=_step.value;try{for(var _iterator1=__PRIVATE_targetGetFieldFiltersForPath(e,_$r.fieldPath)[Symbol.iterator](),_step1;!(_iteratorNormalCompletion=(_step1=_iterator1.next()).done);_iteratorNormalCompletion=true){var _$t=_step1.value;switch(_$t.op){case"==":case"in":n.set(_$r.fieldPath.canonicalString(),_$t.value);break;case"not-in":case"!=":return n.set(_$r.fieldPath.canonicalString(),_$t.value),Array.from(n.values())}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return null}(s,i),a=function __PRIVATE_targetGetLowerBound(e,t){var n=[];var _$r=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_fieldIndexGetDirectionalSegments(t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$i=_step.value;var _$t=0===_$i.kind?__PRIVATE_targetGetAscendingBound(e,_$i.fieldPath,e.startAt):__PRIVATE_targetGetDescendingBound(e,_$i.fieldPath,e.startAt);n.push(_$t.value),_$r&&(_$r=_$t.inclusive)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new Bound(n,_$r)}(s,i),u=function __PRIVATE_targetGetUpperBound(e,t){var n=[];var _$r=!0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_fieldIndexGetDirectionalSegments(t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$i=_step.value;var _$t=0===_$i.kind?__PRIVATE_targetGetDescendingBound(e,_$i.fieldPath,e.endAt):__PRIVATE_targetGetAscendingBound(e,_$i.fieldPath,e.endAt);n.push(_$t.value),_$r&&(_$r=_$t.inclusive)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new Bound(n,_$r)}(s,i),c=_this.hn(i,s,a),l=_this.hn(i,s,u),h=_this.Pn(i,s,_),_$P=_this.In(i.indexId,o,c,a.inclusive,l,u.inclusive,h);return PersistencePromise.forEach(_$P,function(i){return n.j(i,t.limit).next(function(t){t.forEach(function(t){var n=DocumentKey.fromSegments(t.documentKey);_$e.has(n)||(_$e=_$e.add(n),r1.push(n))})})})}).next(function(){return r1})}return PersistencePromise.resolve(null)})}},{key:"cn",value:function cn(e){var t=this.un.get(e);if(t)return t;if(0===e.filters.length)t=[e];else{t=__PRIVATE_getDnfTerms(CompositeFilter.create(e.filters,"and")).map(function(t){return __PRIVATE_newTarget(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)})}return this.un.set(e,t),t}},{key:"In",value:function In(e,t,n,r,i,s,o){var _this=this,_loop=function _loop(c){var _u;var _=t?_this.Tn(t[c/a]):Te,l=_this.En(e,_,n[c%a],r),h=_this.dn(e,_,i[c%a],s),_$P=o.map(function(t){return _this1.En(e,_,t,!0)});(_u=u).push.apply(_u,_to_consumable_array$1(_this.createRange(l,h,_$P)))};var _this1=this;var _=(null!=t?t.length:1)*Math.max(n.length,i.length),a=_/(null!=t?t.length:1),u=[];for(var c=0;c<_;++c)_loop(c);return u}},{key:"En",value:function En(e,t,n,r){var i=new __PRIVATE_IndexEntry(e,DocumentKey.empty(),t,n);return r?i:i.Jt()}},{key:"dn",value:function dn(e,t,n,r){var i=new __PRIVATE_IndexEntry(e,DocumentKey.empty(),t,n);return r?i.Jt():i}},{key:"ln",value:function ln(e,t){var n=new __PRIVATE_TargetIndexMatcher(t),_$r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,_$r).next(function(e){var _$t=null;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;n.tn(_$r)&&(!_$t||_$r.fields.length>_$t.fields.length)&&(_$t=_$r)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$t})}},{key:"getIndexType",value:function getIndexType(e,t){var _this=this;var n=2;var _$r=this.cn(t);return PersistencePromise.forEach(_$r,function(t){return _this.ln(e,t).next(function(e){e?0!==n&&e.fields.length<function __PRIVATE_targetGetSegmentCount(e){var _$t=new SortedSet(FieldPath$1.comparator),n=!1;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined,_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator=e.filters[Symbol.iterator](),_step;!(_iteratorNormalCompletion1=(_step=_iterator.next()).done);_iteratorNormalCompletion1=true){var _$r=_step.value;try{for(var _iterator1=_$r.getFlattenedFilters()[Symbol.iterator](),_step1;!(_iteratorNormalCompletion=(_step1=_iterator1.next()).done);_iteratorNormalCompletion=true){var _$e=_step1.value;_$e.field.isKeyField()||("array-contains"===_$e.op||"array-contains-any"===_$e.op?n=!0:_$t=_$t.add(_$e.field))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}var _iteratorNormalCompletion2=true,_didIteratorError2=false,_iteratorError2=undefined;try{for(var _iterator2=e.orderBy[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var n1=_step2.value;n1.field.isKeyField()||(_$t=_$t.add(n1.field))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return!=null){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return _$t.size+(n?1:0)}(t)&&(n=1):n=0})}).next(function(){return function __PRIVATE_targetHasLimit(e){return null!==e.limit}(t)&&_$r.length>1&&2===n?1:n})}},{key:"An",value:function An(e,t){var n=new __PRIVATE_IndexByteEncoder;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_fieldIndexGetDirectionalSegments(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;var _$e=t.data.field(_$r.fieldPath);if(null==_$e)return null;var i=n.Ht(_$r.kind);__PRIVATE_FirestoreIndexValueWriter.bt.Pt(_$e,i)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return n.Wt()}},{key:"Tn",value:function Tn(e){var t=new __PRIVATE_IndexByteEncoder;return __PRIVATE_FirestoreIndexValueWriter.bt.Pt(e,t.Ht(0)),t.Wt()}},{key:"Rn",value:function Rn(e,t){var n=new __PRIVATE_IndexByteEncoder;return __PRIVATE_FirestoreIndexValueWriter.bt.Pt(__PRIVATE_refValue(this.databaseId,t),n.Ht(function __PRIVATE_fieldIndexGetKeyOrder(e){var _$t=__PRIVATE_fieldIndexGetDirectionalSegments(e);return 0===_$t.length?0:_$t[_$t.length-1].kind}(e))),n.Wt()}},{key:"Pn",value:function Pn(e,t,n){if(null===n)return[];var _$r=[];_$r.push(new __PRIVATE_IndexByteEncoder);var i=0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_fieldIndexGetDirectionalSegments(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var s=_step.value;var _$e=n[i++];var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=_$r[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var _$n=_step1.value;if(this.Vn(t,s.fieldPath)&&isArray(_$e))_$r=this.mn(_$r,s,_$e);else{var _$t=_$n.Ht(s.kind);__PRIVATE_FirestoreIndexValueWriter.bt.Pt(_$e,_$t)}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this.fn(_$r)}},{key:"hn",value:function hn(e,t,n){return this.Pn(e,t,n.position)}},{key:"fn",value:function fn(e){var t=[];for(var n=0;n<e.length;++n)t[n]=e[n].Wt();return t}},{key:"mn",value:function mn(e,t,n){var _$r=_to_consumable_array$1(e),i=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined,_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator=(n.arrayValue.values||[])[Symbol.iterator](),_step;!(_iteratorNormalCompletion1=(_step=_iterator.next()).done);_iteratorNormalCompletion1=true){var _$e=_step.value;try{for(var _iterator1=_$r[Symbol.iterator](),_step1;!(_iteratorNormalCompletion=(_step1=_iterator1.next()).done);_iteratorNormalCompletion=true){var _$n=_step1.value;var r1=new __PRIVATE_IndexByteEncoder;r1.seed(_$n.Wt()),__PRIVATE_FirestoreIndexValueWriter.bt.Pt(_$e,r1.Ht(t.kind)),i.push(r1)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return i}},{key:"Vn",value:function Vn(e,t){return!!e.filters.find(function(e){return _instanceof$1(e,FieldFilter)&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)})}},{key:"getFieldIndexes",value:function getFieldIndexes(e,t){var _this=this;var n=__PRIVATE_indexConfigurationStore(e),_$r=__PRIVATE_indexStateStore(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(function(e){var _$t=[];return PersistencePromise.forEach(e,function(e){return _$r.get([e.indexId,_this.uid]).next(function(n){_$t.push(function __PRIVATE_fromDbIndexConfiguration(e,t){var _$n=t?new IndexState(t.sequenceNumber,new IndexOffset(__PRIVATE_fromDbTimestamp(t.readTime),new DocumentKey(__PRIVATE_decodeResourcePath(t.documentKey)),t.largestBatchId)):IndexState.empty(),_$r=e.fields.map(function(param){var _param=_sliced_to_array$1(param,2),_$e=_param[0],_$t=_param[1];return new IndexSegment(FieldPath$1.fromServerFormat(_$e),_$t)});return new FieldIndex(e.indexId,e.collectionGroup,_$r,_$n)}(e,n))})}).next(function(){return _$t})})}},{key:"getNextCollectionGroupToUpdate",value:function getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(function(e){return 0===e.length?null:(e.sort(function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:__PRIVATE_primitiveComparator(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup)})}},{key:"updateCollectionGroup",value:function updateCollectionGroup(e,t,n){var _this=this;var _$r=__PRIVATE_indexConfigurationStore(e),i=__PRIVATE_indexStateStore(e);return this.gn(e).next(function(e){return _$r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(function(t){return PersistencePromise.forEach(t,function(t){return i.put(__PRIVATE_toDbIndexState(t.indexId,_this.uid,e,n))})})})}},{key:"updateIndexEntries",value:function updateIndexEntries(e,t){var _this=this;var n=new Map;return PersistencePromise.forEach(t,function(t,r){var i=n.get(t.collectionGroup);return(i?PersistencePromise.resolve(i):_this.getFieldIndexes(e,t.collectionGroup)).next(function(i){return n.set(t.collectionGroup,i),PersistencePromise.forEach(i,function(n){return _this.pn(e,t,n).next(function(t){var _$i=_this.yn(r,n);return t.isEqual(_$i)?PersistencePromise.resolve():_this.wn(e,r,n,t,_$i)})})})})}},{key:"Sn",value:function Sn(e,t,n,r){return __PRIVATE_indexEntriesStore(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}},{key:"bn",value:function bn(e,t,n,r){return __PRIVATE_indexEntriesStore(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}},{key:"pn",value:function pn(e,t,n){var _$r=__PRIVATE_indexEntriesStore(e);var i=new SortedSet(__PRIVATE_indexEntryComparator);return _$r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},function(e,r){i=i.add(new __PRIVATE_IndexEntry(n.indexId,t,r.arrayValue,r.directionalValue))}).next(function(){return i})}},{key:"yn",value:function yn(e,t){var n=new SortedSet(__PRIVATE_indexEntryComparator);var _$r=this.An(t,e);if(null==_$r)return n;var i=__PRIVATE_fieldIndexGetArraySegment(t);if(null!=i){var s=e.data.field(i.fieldPath);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(isArray(s))try{for(var _iterator=(s.arrayValue.values||[])[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i1=_step.value;n=n.add(new __PRIVATE_IndexEntry(t.indexId,e.key,this.Tn(i1),_$r))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}else n=n.add(new __PRIVATE_IndexEntry(t.indexId,e.key,Te,_$r));return n}},{key:"wn",value:function wn(e,t,n,r,i){var _this=this;__PRIVATE_logDebug("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var s=[];return function __PRIVATE_diffSortedSets(e,t,n,r,i){var s=e.getIterator(),o=t.getIterator();var _=__PRIVATE_advanceIterator(s),a=__PRIVATE_advanceIterator(o);for(;_||a;){var _$e=!1,_$t=!1;if(_&&a){var _$r=n(_,a);_$r<0?_$t=!0:_$r>0&&(_$e=!0)}else null!=_?_$t=!0:_$e=!0;_$e?(r(a),a=__PRIVATE_advanceIterator(o)):_$t?(i(_),_=__PRIVATE_advanceIterator(s)):(_=__PRIVATE_advanceIterator(s),a=__PRIVATE_advanceIterator(o))}}(r,i,__PRIVATE_indexEntryComparator,function(r){s.push(_this.Sn(e,t,n,r))},function(r){s.push(_this.bn(e,t,n,r))}),PersistencePromise.waitFor(s)}},{key:"gn",value:function gn(e){var t=1;return __PRIVATE_indexStateStore(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},function(e,n,r){r.done(),t=n.sequenceNumber+1}).next(function(){return t})}},{key:"createRange",value:function createRange(e,t,n){n=n.sort(function(e,t){return __PRIVATE_indexEntryComparator(e,t)}).filter(function(e,t,n){return!t||0!==__PRIVATE_indexEntryComparator(e,n[t-1])});var _$r=[];_$r.push(e);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;var _$n=__PRIVATE_indexEntryComparator(i,e),s=__PRIVATE_indexEntryComparator(i,t);if(0===_$n)_$r[0]=e.Jt();else if(_$n>0&&s<0)_$r.push(i),_$r.push(i.Jt());else if(s>0)break}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_$r.push(t);var i1=[];for(var _$e=0;_$e<_$r.length;_$e+=2){if(this.Dn(_$r[_$e],_$r[_$e+1]))return[];var _$t=[_$r[_$e].indexId,this.uid,_$r[_$e].arrayValue,_$r[_$e].directionalValue,Te,[]],_$n1=[_$r[_$e+1].indexId,this.uid,_$r[_$e+1].arrayValue,_$r[_$e+1].directionalValue,Te,[]];i1.push(IDBKeyRange.bound(_$t,_$n1))}return i1}},{key:"Dn",value:function Dn(e,t){return __PRIVATE_indexEntryComparator(e,t)>0}},{key:"getMinOffsetFromCollectionGroup",value:function getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(__PRIVATE_getMinOffsetFromFieldIndexes)}},{key:"getMinOffset",value:function getMinOffset(e,t){var _this=this;return PersistencePromise.mapArray(this.cn(t),function(t){return _this.ln(e,t).next(function(e){return e||fail()})}).next(__PRIVATE_getMinOffsetFromFieldIndexes)}}]);return __PRIVATE_IndexedDbIndexManager}();function __PRIVATE_collectionParentsStore(e){return __PRIVATE_getStore(e,"collectionParents")}function __PRIVATE_indexEntriesStore(e){return __PRIVATE_getStore(e,"indexEntries")}function __PRIVATE_indexConfigurationStore(e){return __PRIVATE_getStore(e,"indexConfiguration")}function __PRIVATE_indexStateStore(e){return __PRIVATE_getStore(e,"indexState")}function __PRIVATE_getMinOffsetFromFieldIndexes(e){__PRIVATE_hardAssert(0!==e.length);var t=e[0].indexState.offset,n=t.largestBatchId;for(var _$r=1;_$r<e.length;_$r++){var i=e[_$r].indexState.offset;__PRIVATE_indexOffsetComparator(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new IndexOffset(t.readTime,t.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};var LruParams=function(){function LruParams(e,t,n){_class_call_check$1(this,LruParams);this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}_create_class$1(LruParams,null,[{key:"withCacheSize",value:function withCacheSize(e){return new LruParams(e,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]);return LruParams}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function removeMutationBatch(e,t,n){var _$r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);var _=0;var a=_$r.Y({range:o},function(e,t,n){return _++,n.delete()});s.push(a.next(function(){__PRIVATE_hardAssert(1===_)}));var u=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n.mutations[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;var r1=__PRIVATE_newDbDocumentMutationKey(t,_$e.key.path,n.batchId);s.push(i.delete(r1)),u.push(_$e.key)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return PersistencePromise.waitFor(s).next(function(){return u})}function __PRIVATE_dbDocumentSize(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw fail();t=e.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(41943040,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);var __PRIVATE_IndexedDbMutationQueue=function(){function __PRIVATE_IndexedDbMutationQueue(e,t,n,r){_class_call_check$1(this,__PRIVATE_IndexedDbMutationQueue);this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}_create_class$1(__PRIVATE_IndexedDbMutationQueue,[{key:"checkEmpty",value:function checkEmpty(e){var t=!0;var n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return __PRIVATE_mutationsStore(e).Y({index:"userMutationsIndex",range:n},function(e,n,r){t=!1,r.done()}).next(function(){return t})}},{key:"addMutationBatch",value:function addMutationBatch(e,t,n,r){var _this=this;var i=__PRIVATE_documentMutationsStore(e),s=__PRIVATE_mutationsStore(e);return s.add({}).next(function(o){__PRIVATE_hardAssert("number"==typeof o);var _=new MutationBatch(o,t,n,r),a=function __PRIVATE_toDbMutationBatch(e,t,n){var _$r=n.baseMutations.map(function(t){return toMutation(e.ct,t)}),i=n.mutations.map(function(t){return toMutation(e.ct,t)});return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:_$r,mutations:i}}(_this.serializer,_this.userId,_),u=[];var c=new SortedSet(function(e,t){return __PRIVATE_primitiveComparator(e.canonicalString(),t.canonicalString())});var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=r[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;var _$t=__PRIVATE_newDbDocumentMutationKey(_this.userId,_$e.key.path,o);c=c.add(_$e.key.path.popLast()),u.push(s.put(a)),u.push(i.put(_$t,x))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return c.forEach(function(t){u.push(_this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(function(){_this.Cn[o]=_.keys()}),PersistencePromise.waitFor(u).next(function(){return _})})}},{key:"lookupMutationBatch",value:function lookupMutationBatch(e,t){var _this=this;return __PRIVATE_mutationsStore(e).get(t).next(function(e){return e?(__PRIVATE_hardAssert(e.userId===_this.userId),__PRIVATE_fromDbMutationBatch(_this.serializer,e)):null})}},{key:"vn",value:function vn(e,t){var _this=this;return this.Cn[t]?PersistencePromise.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(function(e){if(e){var n=e.keys();return _this.Cn[t]=n,n}return null})}},{key:"getNextMutationBatchAfterBatchId",value:function getNextMutationBatchAfterBatchId(e,t){var _this=this;var n=t+1,_$r=IDBKeyRange.lowerBound([this.userId,n]);var i=null;return __PRIVATE_mutationsStore(e).Y({index:"userMutationsIndex",range:_$r},function(e,t,r){t.userId===_this.userId&&(__PRIVATE_hardAssert(t.batchId>=n),i=__PRIVATE_fromDbMutationBatch(_this.serializer,t)),r.done()}).next(function(){return i})}},{key:"getHighestUnacknowledgedBatchId",value:function getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);var n=-1;return __PRIVATE_mutationsStore(e).Y({index:"userMutationsIndex",range:t,reverse:!0},function(e,t,r){n=t.batchId,r.done()}).next(function(){return n})}},{key:"getAllMutationBatches",value:function getAllMutationBatches(e){var _this=this;var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return __PRIVATE_mutationsStore(e).W("userMutationsIndex",t).next(function(e){return e.map(function(e){return __PRIVATE_fromDbMutationBatch(_this.serializer,e)})})}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function getAllMutationBatchesAffectingDocumentKey(e,t){var _this=this;var n=__PRIVATE_newDbDocumentMutationPrefixForPath(this.userId,t.path),_$r=IDBKeyRange.lowerBound(n),i=[];return __PRIVATE_documentMutationsStore(e).Y({range:_$r},function(n,r,s){var _n=_sliced_to_array$1(n,3),o=_n[0],_=_n[1],a=_n[2],u=__PRIVATE_decodeResourcePath(_);if(o===_this.userId&&t.path.isEqual(u))return __PRIVATE_mutationsStore(e).get(a).next(function(e){if(!e)throw fail();__PRIVATE_hardAssert(e.userId===_this.userId),i.push(__PRIVATE_fromDbMutationBatch(_this.serializer,e))});s.done()}).next(function(){return i})}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function getAllMutationBatchesAffectingDocumentKeys(e,t){var _this=this;var n=new SortedSet(__PRIVATE_primitiveComparator);var _$r=[];return t.forEach(function(t){var i=__PRIVATE_newDbDocumentMutationPrefixForPath(_this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=__PRIVATE_documentMutationsStore(e).Y({range:s},function(e,r,i){var _e=_sliced_to_array$1(e,3),s=_e[0],o=_e[1],_=_e[2],a=__PRIVATE_decodeResourcePath(o);s===_this.userId&&t.path.isEqual(a)?n=n.add(_):i.done()});_$r.push(o)}),PersistencePromise.waitFor(_$r).next(function(){return _this.Fn(e,n)})}},{key:"getAllMutationBatchesAffectingQuery",value:function getAllMutationBatchesAffectingQuery(e,t){var _this=this;var n=t.path,_$r=n.length+1,i=__PRIVATE_newDbDocumentMutationPrefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);var o=new SortedSet(__PRIVATE_primitiveComparator);return __PRIVATE_documentMutationsStore(e).Y({range:s},function(e,t,i){var _e=_sliced_to_array$1(e,3),s=_e[0],_=_e[1],a=_e[2],u=__PRIVATE_decodeResourcePath(_);s===_this.userId&&n.isPrefixOf(u)?u.length===_$r&&(o=o.add(a)):i.done()}).next(function(){return _this.Fn(e,o)})}},{key:"Fn",value:function Fn(e,t){var _this=this;var n=[],_$r=[];return t.forEach(function(t){_$r.push(__PRIVATE_mutationsStore(e).get(t).next(function(e){if(null===e)throw fail();__PRIVATE_hardAssert(e.userId===_this.userId),n.push(__PRIVATE_fromDbMutationBatch(_this.serializer,e))}))}),PersistencePromise.waitFor(_$r).next(function(){return n})}},{key:"removeMutationBatch",value:function removeMutationBatch1(e,t){var _this=this;return removeMutationBatch(e.ae,this.userId,t).next(function(n){return e.addOnCommittedListener(function(){_this.Mn(t.batchId)}),PersistencePromise.forEach(n,function(t){return _this.referenceDelegate.markPotentiallyOrphaned(e,t)})})}},{key:"Mn",value:function Mn(e){delete this.Cn[e]}},{key:"performConsistencyCheck",value:function performConsistencyCheck(e){var _this=this;return this.checkEmpty(e).next(function(t){if(!t)return PersistencePromise.resolve();var n=IDBKeyRange.lowerBound(function __PRIVATE_newDbDocumentMutationPrefixForUser(e){return[e]}(_this.userId)),_$r=[];return __PRIVATE_documentMutationsStore(e).Y({range:n},function(e,t,n){if(e[0]===_this.userId){var _$t=__PRIVATE_decodeResourcePath(e[1]);_$r.push(_$t)}else n.done()}).next(function(){__PRIVATE_hardAssert(0===_$r.length)})})}},{key:"containsKey",value:function containsKey(e,t){return __PRIVATE_mutationQueueContainsKey(e,this.userId,t)}},{key:"xn",value:function xn(e){var _this=this;return __PRIVATE_mutationQueuesStore(e).get(this.userId).next(function(e){return e||{userId:_this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}})}}],[{key:"lt",value:function lt(e,t,n,r){__PRIVATE_hardAssert(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new __PRIVATE_IndexedDbMutationQueue(i,t,n,r)}}]);return __PRIVATE_IndexedDbMutationQueue}();function __PRIVATE_mutationQueueContainsKey(e,t,n){var _$r=__PRIVATE_newDbDocumentMutationPrefixForPath(t,n.path),i=_$r[1],s=IDBKeyRange.lowerBound(_$r);var o=!1;return __PRIVATE_documentMutationsStore(e).Y({range:s,J:!0},function(e,n,r){var _e=_sliced_to_array$1(e,3),s=_e[0],_=_e[1];_e[2];s===t&&_===i&&(o=!0),r.done()}).next(function(){return o})}function __PRIVATE_mutationsStore(e){return __PRIVATE_getStore(e,"mutations")}function __PRIVATE_documentMutationsStore(e){return __PRIVATE_getStore(e,"documentMutations")}function __PRIVATE_mutationQueuesStore(e){return __PRIVATE_getStore(e,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_TargetIdGenerator=function(){function __PRIVATE_TargetIdGenerator(e){_class_call_check$1(this,__PRIVATE_TargetIdGenerator);this.On=e}_create_class$1(__PRIVATE_TargetIdGenerator,[{key:"next",value:function next(){return this.On+=2,this.On}}],[{key:"Nn",value:function Nn(){return new __PRIVATE_TargetIdGenerator(0)}},{key:"Bn",value:function Bn(){return new __PRIVATE_TargetIdGenerator(-1)}}]);return __PRIVATE_TargetIdGenerator}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbTargetCache=function(){function __PRIVATE_IndexedDbTargetCache(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbTargetCache);this.referenceDelegate=e,this.serializer=t}_create_class$1(__PRIVATE_IndexedDbTargetCache,[{key:"allocateTargetId",value:function allocateTargetId(e){var _this=this;return this.Ln(e).next(function(t){var n=new __PRIVATE_TargetIdGenerator(t.highestTargetId);return t.highestTargetId=n.next(),_this.kn(e,t).next(function(){return t.highestTargetId})})}},{key:"getLastRemoteSnapshotVersion",value:function getLastRemoteSnapshotVersion(e){return this.Ln(e).next(function(e){return SnapshotVersion.fromTimestamp(new Timestamp(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})}},{key:"getHighestSequenceNumber",value:function getHighestSequenceNumber(e){return this.Ln(e).next(function(e){return e.highestListenSequenceNumber})}},{key:"setTargetsMetadata",value:function setTargetsMetadata(e,t,n){var _this=this;return this.Ln(e).next(function(r){return r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),_this.kn(e,r)})}},{key:"addTargetData",value:function addTargetData(e,t){var _this=this;return this.qn(e,t).next(function(){return _this.Ln(e).next(function(n){return n.targetCount+=1,_this.Qn(t,n),_this.kn(e,n)})})}},{key:"updateTargetData",value:function updateTargetData(e,t){return this.qn(e,t)}},{key:"removeTargetData",value:function removeTargetData(e,t){var _this=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return __PRIVATE_targetsStore(e).delete(t.targetId)}).next(function(){return _this.Ln(e)}).next(function(t){return __PRIVATE_hardAssert(t.targetCount>0),t.targetCount-=1,_this.kn(e,t)})}},{key:"removeTargets",value:function removeTargets(e,t,n){var _this=this;var _$r=0;var i=[];return __PRIVATE_targetsStore(e).Y(function(s,o){var _=__PRIVATE_fromDbTarget(o);_.sequenceNumber<=t&&null===n.get(_.targetId)&&(_$r++,i.push(_this.removeTargetData(e,_)))}).next(function(){return PersistencePromise.waitFor(i)}).next(function(){return _$r})}},{key:"forEachTarget",value:function forEachTarget(e,t){return __PRIVATE_targetsStore(e).Y(function(e,n){var _$r=__PRIVATE_fromDbTarget(n);t(_$r)})}},{key:"Ln",value:function Ln(e){return __PRIVATE_globalTargetStore(e).get("targetGlobalKey").next(function(e){return __PRIVATE_hardAssert(null!==e),e})}},{key:"kn",value:function kn(e,t){return __PRIVATE_globalTargetStore(e).put("targetGlobalKey",t)}},{key:"qn",value:function qn(e,t){return __PRIVATE_targetsStore(e).put(__PRIVATE_toDbTarget(this.serializer,t))}},{key:"Qn",value:function Qn(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function getTargetCount(e){return this.Ln(e).next(function(e){return e.targetCount})}},{key:"getTargetData",value:function getTargetData(e,t){var n=__PRIVATE_canonifyTarget(t),_$r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);var i=null;return __PRIVATE_targetsStore(e).Y({range:_$r,index:"queryTargetsIndex"},function(e,n,r){var s=__PRIVATE_fromDbTarget(n);__PRIVATE_targetEquals(t,s.target)&&(i=s,r.done())}).next(function(){return i})}},{key:"addMatchingKeys",value:function addMatchingKeys(e,t,n){var _this=this;var _$r=[],i=__PRIVATE_documentTargetStore(e);return t.forEach(function(t){var s=__PRIVATE_encodeResourcePath(t.path);_$r.push(i.put({targetId:n,path:s})),_$r.push(_this.referenceDelegate.addReference(e,n,t))}),PersistencePromise.waitFor(_$r)}},{key:"removeMatchingKeys",value:function removeMatchingKeys(e,t,n){var _this=this;var _$r=__PRIVATE_documentTargetStore(e);return PersistencePromise.forEach(t,function(t){var i=__PRIVATE_encodeResourcePath(t.path);return PersistencePromise.waitFor([_$r.delete([n,i]),_this.referenceDelegate.removeReference(e,n,t)])})}},{key:"removeMatchingKeysForTargetId",value:function removeMatchingKeysForTargetId(e,t){var n=__PRIVATE_documentTargetStore(e),_$r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(_$r)}},{key:"getMatchingKeysForTargetId",value:function getMatchingKeysForTargetId(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),_$r=__PRIVATE_documentTargetStore(e);var i=__PRIVATE_documentKeySet();return _$r.Y({range:n,J:!0},function(e,t,n){var _$r=__PRIVATE_decodeResourcePath(e[1]),s=new DocumentKey(_$r);i=i.add(s)}).next(function(){return i})}},{key:"containsKey",value:function containsKey(e,t){var n=__PRIVATE_encodeResourcePath(t.path),_$r=IDBKeyRange.bound([n],[__PRIVATE_immediateSuccessor(n)],!1,!0);var i=0;return __PRIVATE_documentTargetStore(e).Y({index:"documentTargetsIndex",J:!0,range:_$r},function(param,n,r){var _param=_sliced_to_array$1(param,2),_$e=_param[0];_param[1];0!==_$e&&(i++,r.done())}).next(function(){return i>0})}},{key:"_t",value:function _t(e,t){return __PRIVATE_targetsStore(e).get(t).next(function(e){return e?__PRIVATE_fromDbTarget(e):null})}}]);return __PRIVATE_IndexedDbTargetCache}();function __PRIVATE_targetsStore(e){return __PRIVATE_getStore(e,"targets")}function __PRIVATE_globalTargetStore(e){return __PRIVATE_getStore(e,"targetGlobal")}function __PRIVATE_documentTargetStore(e){return __PRIVATE_getStore(e,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_bufferEntryComparator(param,param1){var _param=_sliced_to_array$1(param,2),e=_param[0],t=_param[1],_param1=_sliced_to_array$1(param1,2),n=_param1[0],_$r=_param1[1];var i=__PRIVATE_primitiveComparator(e,n);return 0===i?__PRIVATE_primitiveComparator(t,_$r):i}var __PRIVATE_RollingSequenceNumberBuffer=function(){function __PRIVATE_RollingSequenceNumberBuffer(e){_class_call_check$1(this,__PRIVATE_RollingSequenceNumberBuffer);this.Kn=e,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.$n=0}_create_class$1(__PRIVATE_RollingSequenceNumberBuffer,[{key:"Un",value:function Un(){return++this.$n}},{key:"Wn",value:function Wn(e){var t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{var _$e=this.buffer.last();__PRIVATE_bufferEntryComparator(t,_$e)<0&&(this.buffer=this.buffer.delete(_$e).add(t))}}},{key:"maxValue",get:function get(){return this.buffer.last()[0]}}]);return __PRIVATE_RollingSequenceNumberBuffer}();var __PRIVATE_LruScheduler=function(){function __PRIVATE_LruScheduler(e,t,n){_class_call_check$1(this,__PRIVATE_LruScheduler);this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}_create_class$1(__PRIVATE_LruScheduler,[{key:"start",value:function start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}},{key:"stop",value:function stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}},{key:"started",get:function get(){return null!==this.Gn}},{key:"zn",value:function zn(e){var _this=this;__PRIVATE_logDebug("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,_async_to_generator$3(function(){var _$e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_this.Gn=null;_state.label=1;case 1:_state.trys.push([1,3,,7]);return[4,_this.localStore.collectGarbage(_this.garbageCollector)];case 2:_state.sent();return[3,7];case 3:_$e=_state.sent();if(!__PRIVATE_isIndexedDbTransactionError(_$e))return[3,4];__PRIVATE_logDebug("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",_$e);return[3,6];case 4:return[4,__PRIVATE_ignoreIfPrimaryLeaseLoss(_$e)];case 5:_state.sent();_state.label=6;case 6:return[3,7];case 7:return[4,_this.zn(3e5)];case 8:_state.sent();return[2]}})}))}}]);return __PRIVATE_LruScheduler}();var __PRIVATE_LruGarbageCollectorImpl=function(){function __PRIVATE_LruGarbageCollectorImpl(e,t){_class_call_check$1(this,__PRIVATE_LruGarbageCollectorImpl);this.jn=e,this.params=t}_create_class$1(__PRIVATE_LruGarbageCollectorImpl,[{key:"calculateTargetCount",value:function calculateTargetCount(e,t){return this.jn.Hn(e).next(function(e){return Math.floor(t/100*e)})}},{key:"nthSequenceNumber",value:function nthSequenceNumber(e,t){var _this=this;if(0===t)return PersistencePromise.resolve(__PRIVATE_ListenSequence._e);var n=new __PRIVATE_RollingSequenceNumberBuffer(t);return this.jn.forEachTarget(e,function(e){return n.Wn(e.sequenceNumber)}).next(function(){return _this.jn.Jn(e,function(e){return n.Wn(e)})}).next(function(){return n.maxValue})}},{key:"removeTargets",value:function removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}},{key:"collect",value:function collect(e,t){var _this=this;return-1===this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(Ee)):this.getCacheSize(e).next(function(n){return n<_this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(_this.params.cacheSizeCollectionThreshold)),Ee):_this.Yn(e,t)})}},{key:"getCacheSize",value:function getCacheSize(e){return this.jn.getCacheSize(e)}},{key:"Yn",value:function Yn(e,t){var _this=this;var n,_$r,i,s,o,a,u;var c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return t>_this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(_this.params.maximumSequenceNumbersToCollect," from ").concat(t)),_$r=_this.params.maximumSequenceNumbersToCollect):_$r=t,s=Date.now(),_this.nthSequenceNumber(e,_$r)}).next(function(r){return n=r,o=Date.now(),_this.removeTargets(e,n,t)}).next(function(t){return i=t,a=Date.now(),_this.removeOrphanedDocuments(e,n)}).next(function(e){if(u=Date.now(),__PRIVATE_getLogLevel()<=LogLevel.DEBUG){__PRIVATE_logDebug("LruGarbageCollector","LRU Garbage Collection\n	Counted targets in ".concat(s-c,"ms\n	Determined least recently used ").concat(_$r," in ")+(o-s)+"ms\n"+"	Removed ".concat(i," targets in ")+(a-o)+"ms\n"+"	Removed ".concat(e," documents in ")+(u-a)+"ms\n"+"Total Duration: ".concat(u-c,"ms"))}return PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:_$r,targetsRemoved:i,documentsRemoved:e})})}}]);return __PRIVATE_LruGarbageCollectorImpl}();function __PRIVATE_newLruGarbageCollector(e,t){return new __PRIVATE_LruGarbageCollectorImpl(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbLruDelegateImpl=function(){function __PRIVATE_IndexedDbLruDelegateImpl(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbLruDelegateImpl);this.db=e,this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}_create_class$1(__PRIVATE_IndexedDbLruDelegateImpl,[{key:"Hn",value:function Hn(e){var t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:"Zn",value:function Zn(e){var t=0;return this.Jn(e,function(e){t++}).next(function(){return t})}},{key:"forEachTarget",value:function forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Jn",value:function Jn(e,t){return this.Xn(e,function(e,n){return t(n)})}},{key:"addReference",value:function addReference(e,t,n){return __PRIVATE_writeSentinelKey(e,n)}},{key:"removeReference",value:function removeReference(e,t,n){return __PRIVATE_writeSentinelKey(e,n)}},{key:"removeTargets",value:function removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function markPotentiallyOrphaned(e,t){return __PRIVATE_writeSentinelKey(e,t)}},{key:"er",value:function er(e,t){return function __PRIVATE_mutationQueuesContainKey(e,t){var n=!1;return __PRIVATE_mutationQueuesStore(e).Z(function(r){return __PRIVATE_mutationQueueContainsKey(e,r,t).next(function(e){return e&&(n=!0),PersistencePromise.resolve(!e)})}).next(function(){return n})}(e,t)}},{key:"removeOrphanedDocuments",value:function removeOrphanedDocuments(e,t){var _this=this;var n=this.db.getRemoteDocumentCache().newChangeBuffer(),_$r=[];var i=0;return this.Xn(e,function(s,o){if(o<=t){var _$t=_this.er(e,s).next(function(t){if(!t)return i++,n.getEntry(e,s).next(function(){return n.removeEntry(s,SnapshotVersion.min()),__PRIVATE_documentTargetStore(e).delete(function __PRIVATE_sentinelKey$1(e){return[0,__PRIVATE_encodeResourcePath(e.path)]}(s))})});_$r.push(_$t)}}).next(function(){return PersistencePromise.waitFor(_$r)}).next(function(){return n.apply(e)}).next(function(){return i})}},{key:"removeTarget",value:function removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function updateLimboDocument(e,t){return __PRIVATE_writeSentinelKey(e,t)}},{key:"Xn",value:function Xn(e,t){var n=__PRIVATE_documentTargetStore(e);var _$r,i=__PRIVATE_ListenSequence._e;return n.Y({index:"documentTargetsIndex"},function(param,param1){var _param=_sliced_to_array$1(param,2),_$e=_param[0];_param[1];var s=param1.path,o=param1.sequenceNumber;0===_$e?(i!==__PRIVATE_ListenSequence._e&&t(new DocumentKey(__PRIVATE_decodeResourcePath(_$r)),i),i=o,_$r=s):i=__PRIVATE_ListenSequence._e}).next(function(){i!==__PRIVATE_ListenSequence._e&&t(new DocumentKey(__PRIVATE_decodeResourcePath(_$r)),i)})}},{key:"getCacheSize",value:function getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}]);return __PRIVATE_IndexedDbLruDelegateImpl}();function __PRIVATE_writeSentinelKey(e,t){return __PRIVATE_documentTargetStore(e).put(function __PRIVATE_sentinelRow(e,t){return{targetId:0,path:__PRIVATE_encodeResourcePath(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var RemoteDocumentChangeBuffer=function(){function RemoteDocumentChangeBuffer(){_class_call_check$1(this,RemoteDocumentChangeBuffer);this.changes=new ObjectMap(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}_create_class$1(RemoteDocumentChangeBuffer,[{key:"addEntry",value:function addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,MutableDocument.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?PersistencePromise.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function getEntries(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function assertNotApplied(){}}]);return RemoteDocumentChangeBuffer}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_IndexedDbRemoteDocumentCacheImpl=function(){function __PRIVATE_IndexedDbRemoteDocumentCacheImpl(e){_class_call_check$1(this,__PRIVATE_IndexedDbRemoteDocumentCacheImpl);this.serializer=e}_create_class$1(__PRIVATE_IndexedDbRemoteDocumentCacheImpl,[{key:"setIndexManager",value:function setIndexManager(e){this.indexManager=e}},{key:"addEntry",value:function addEntry(e,t,n){return __PRIVATE_remoteDocumentsStore(e).put(n)}},{key:"removeEntry",value:function removeEntry(e,t,n){return __PRIVATE_remoteDocumentsStore(e).delete(function __PRIVATE_dbReadTimeKey(e,t){var _$n=e.path.toArray();return[_$n.slice(0,_$n.length-2),_$n[_$n.length-2],__PRIVATE_toDbTimestampKey(t),_$n[_$n.length-1]]}(t,n))}},{key:"updateMetadata",value:function updateMetadata(e,t){var _this=this;return this.getMetadata(e).next(function(n){return n.byteSize+=t,_this.tr(e,n)})}},{key:"getEntry",value:function getEntry(e,t){var _this=this;var n=MutableDocument.newInvalidDocument(t);return __PRIVATE_remoteDocumentsStore(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(__PRIVATE_dbKey(t))},function(e,r){n=_this.nr(t,r)}).next(function(){return n})}},{key:"rr",value:function rr(e,t){var _this=this;var n={size:0,document:MutableDocument.newInvalidDocument(t)};return __PRIVATE_remoteDocumentsStore(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(__PRIVATE_dbKey(t))},function(e,r){n={document:_this.nr(t,r),size:__PRIVATE_dbDocumentSize(r)}}).next(function(){return n})}},{key:"getEntries",value:function getEntries(e,t){var _this=this;var n=__PRIVATE_mutableDocumentMap();return this.ir(e,t,function(e,t){var _$r=_this.nr(e,t);n=n.insert(e,_$r)}).next(function(){return n})}},{key:"sr",value:function sr(e,t){var _this=this;var n=__PRIVATE_mutableDocumentMap(),_$r=new SortedMap(DocumentKey.comparator);return this.ir(e,t,function(e,t){var i=_this.nr(e,t);n=n.insert(e,i),_$r=_$r.insert(e,__PRIVATE_dbDocumentSize(t))}).next(function(){return{documents:n,_r:_$r}})}},{key:"ir",value:function ir(e,t,n){if(t.isEmpty())return PersistencePromise.resolve();var _$r=new SortedSet(__PRIVATE_dbKeyComparator);t.forEach(function(e){return _$r=_$r.add(e)});var i=IDBKeyRange.bound(__PRIVATE_dbKey(_$r.first()),__PRIVATE_dbKey(_$r.last())),s=_$r.getIterator();var o=s.getNext();return __PRIVATE_remoteDocumentsStore(e).Y({index:"documentKeyIndex",range:i},function(e,t,r){var i=DocumentKey.fromSegments(_to_consumable_array$1(t.prefixPath).concat([t.collectionGroup,t.documentId]));for(;o&&__PRIVATE_dbKeyComparator(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.U(__PRIVATE_dbKey(o)):r.done()}).next(function(){for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}},{key:"getDocumentsMatchingQuery",value:function getDocumentsMatchingQuery(e,t,n,r,i){var _this=this;var s=t.path,o=[s.popLast().toArray(),s.lastSegment(),__PRIVATE_toDbTimestampKey(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],_=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return __PRIVATE_remoteDocumentsStore(e).W(IDBKeyRange.bound(o,_,!0)).next(function(e){null==i||i.incrementDocumentReadCount(e.length);var _$n=__PRIVATE_mutableDocumentMap();var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$i=_step.value;var _$e=_this.nr(DocumentKey.fromSegments(_$i.prefixPath.concat(_$i.collectionGroup,_$i.documentId)),_$i);_$e.isFoundDocument()&&(__PRIVATE_queryMatches(t,_$e)||r.has(_$e.key))&&(_$n=_$n.insert(_$e.key,_$e))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$n})}},{key:"getAllFromCollectionGroup",value:function getAllFromCollectionGroup(e,t,n,r){var _this=this;var i=__PRIVATE_mutableDocumentMap();var s=__PRIVATE_dbCollectionGroupKey(t,n),o=__PRIVATE_dbCollectionGroupKey(t,IndexOffset.max());return __PRIVATE_remoteDocumentsStore(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},function(e,t,n){var s=_this.nr(DocumentKey.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()}).next(function(){return i})}},{key:"newChangeBuffer",value:function newChangeBuffer(e){return new __PRIVATE_IndexedDbRemoteDocumentChangeBuffer(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function getSize(e){return this.getMetadata(e).next(function(e){return e.byteSize})}},{key:"getMetadata",value:function getMetadata(e){return __PRIVATE_documentGlobalStore(e).get("remoteDocumentGlobalKey").next(function(e){return __PRIVATE_hardAssert(!!e),e})}},{key:"tr",value:function tr(e,t){return __PRIVATE_documentGlobalStore(e).put("remoteDocumentGlobalKey",t)}},{key:"nr",value:function nr(e,t){if(t){var _$e=__PRIVATE_fromDbRemoteDocument(this.serializer,t);if(!(_$e.isNoDocument()&&_$e.version.isEqual(SnapshotVersion.min())))return _$e}return MutableDocument.newInvalidDocument(e)}}]);return __PRIVATE_IndexedDbRemoteDocumentCacheImpl}();function __PRIVATE_newIndexedDbRemoteDocumentCache(e){return new __PRIVATE_IndexedDbRemoteDocumentCacheImpl(e)}var __PRIVATE_IndexedDbRemoteDocumentChangeBuffer=function(RemoteDocumentChangeBuffer){_inherits$1(__PRIVATE_IndexedDbRemoteDocumentChangeBuffer,RemoteDocumentChangeBuffer);var _super=_create_super$1(__PRIVATE_IndexedDbRemoteDocumentChangeBuffer);function __PRIVATE_IndexedDbRemoteDocumentChangeBuffer(e,t){_class_call_check$1(this,__PRIVATE_IndexedDbRemoteDocumentChangeBuffer);var _this;_this=_super.call(this),_this.ar=e,_this.trackRemovals=t,_this.ur=new ObjectMap(function(e){return e.toString()},function(e,t){return e.isEqual(t)});return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_IndexedDbRemoteDocumentChangeBuffer,[{key:"applyChanges",value:function applyChanges(e){var _this=this;var t=[];var n=0,_$r=new SortedSet(function(e,t){return __PRIVATE_primitiveComparator(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(i,s){var o=_this.ur.get(i);if(t.push(_this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){var _=__PRIVATE_toDbRemoteDocument(_this.ar.serializer,s);_$r=_$r.add(i.path.popLast());var a=__PRIVATE_dbDocumentSize(_);n+=a-o.size,t.push(_this.ar.addEntry(e,i,_))}else if(n-=o.size,_this.trackRemovals){var n1=__PRIVATE_toDbRemoteDocument(_this.ar.serializer,s.convertToNoDocument(SnapshotVersion.min()));t.push(_this.ar.addEntry(e,i,n1))}}),_$r.forEach(function(n){t.push(_this.ar.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.ar.updateMetadata(e,n)),PersistencePromise.waitFor(t)}},{key:"getFromCache",value:function getFromCache(e,t){var _this=this;return this.ar.rr(e,t).next(function(e){return _this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document})}},{key:"getAllFromCache",value:function getAllFromCache(e,t){var _this=this;return this.ar.sr(e,t).next(function(param){var _$e=param.documents,_$t=param._r;return _$t.forEach(function(t,n){_this.ur.set(t,{size:n,readTime:_$e.get(t).readTime})}),_$e})}}]);return __PRIVATE_IndexedDbRemoteDocumentChangeBuffer}(RemoteDocumentChangeBuffer);function __PRIVATE_documentGlobalStore(e){return __PRIVATE_getStore(e,"remoteDocumentGlobal")}function __PRIVATE_remoteDocumentsStore(e){return __PRIVATE_getStore(e,"remoteDocumentsV14")}function __PRIVATE_dbKey(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function __PRIVATE_dbCollectionGroupKey(e,t){var n=t.documentKey.path.toArray();return[e,__PRIVATE_toDbTimestampKey(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function __PRIVATE_dbKeyComparator(e,t){var n=e.path.toArray(),_$r=t.path.toArray();var i=0;for(var _$e=0;_$e<n.length-2&&_$e<_$r.length-2;++_$e)if(i=__PRIVATE_primitiveComparator(n[_$e],_$r[_$e]),i)return i;return i=__PRIVATE_primitiveComparator(n.length,_$r.length),i||(i=__PRIVATE_primitiveComparator(n[n.length-2],_$r[_$r.length-2]),i||__PRIVATE_primitiveComparator(n[n.length-1],_$r[_$r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OverlayedDocument=function OverlayedDocument(e,t){_class_call_check$1(this,OverlayedDocument);this.overlayedDocument=e,this.mutatedFields=t};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LocalDocumentsView=function(){function LocalDocumentsView(e,t,n,r){_class_call_check$1(this,LocalDocumentsView);this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}_create_class$1(LocalDocumentsView,[{key:"getDocument",value:function getDocument(e,t){var _this=this;var n=null;return this.documentOverlayCache.getOverlay(e,t).next(function(r){return n=r,_this.remoteDocumentCache.getEntry(e,t)}).next(function(e){return null!==n&&__PRIVATE_mutationApplyToLocalView(n.mutation,e,FieldMask.empty(),Timestamp.now()),e})}},{key:"getDocuments",value:function getDocuments(e,t){var _this=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return _this.getLocalViewOfDocuments(e,t,__PRIVATE_documentKeySet()).next(function(){return t})})}},{key:"getLocalViewOfDocuments",value:function getLocalViewOfDocuments(e,t){var _this=this;var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:__PRIVATE_documentKeySet();var _$r=__PRIVATE_newOverlayMap();return this.populateOverlays(e,_$r,t).next(function(){return _this.computeViews(e,t,_$r,n).next(function(e){var _$t=documentMap();return e.forEach(function(e,n){_$t=_$t.insert(e,n.overlayedDocument)}),_$t})})}},{key:"getOverlayedDocuments",value:function getOverlayedDocuments(e,t){var _this=this;var n=__PRIVATE_newOverlayMap();return this.populateOverlays(e,n,t).next(function(){return _this.computeViews(e,t,n,__PRIVATE_documentKeySet())})}},{key:"populateOverlays",value:function populateOverlays(e,t,n){var _$r=[];return n.forEach(function(e){t.has(e)||_$r.push(e)}),this.documentOverlayCache.getOverlays(e,_$r).next(function(e){e.forEach(function(e,n){t.set(e,n)})})}},{key:"computeViews",value:function computeViews(e,t,n,r){var i=__PRIVATE_mutableDocumentMap();var s=__PRIVATE_newDocumentKeyMap(),o=function __PRIVATE_newOverlayedDocumentMap(){return __PRIVATE_newDocumentKeyMap()}();return t.forEach(function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||_instanceof$1(o.mutation,__PRIVATE_PatchMutation))?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(o.mutation,t,o.mutation.getFieldMask(),Timestamp.now())):s.set(t.key,FieldMask.empty())}),this.recalculateAndSaveOverlays(e,i).next(function(e){return e.forEach(function(e,t){return s.set(e,t)}),t.forEach(function(e,t){var n;return o.set(e,new OverlayedDocument(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o})}},{key:"recalculateAndSaveOverlays",value:function recalculateAndSaveOverlays(e,t){var _this=this;var n=__PRIVATE_newDocumentKeyMap();var _$r=new SortedMap(function(e,t){return e-t}),i=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function _loop(){var i=_step.value;i.keys().forEach(function(e){var s=t.get(e);if(null===s)return;var o=n.get(e)||FieldMask.empty();o=i.applyToLocalView(s,o),n.set(e,o);var _=(_$r.get(i.batchId)||__PRIVATE_documentKeySet()).add(e);_$r=_$r.insert(i.batchId,_)})};for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}).next(function(){var _loop=function _loop(){var _$r=o.getNext(),_=_$r.key,a=_$r.value,u=__PRIVATE_newMutationMap();a.forEach(function(e){if(!i.has(e)){var _$r=__PRIVATE_calculateOverlayMutation(t.get(e),n.get(e));null!==_$r&&u.set(e,_$r),i=i.add(e)}}),s.push(_this.documentOverlayCache.saveOverlays(e,_,u))};var s=[],o=_$r.getReverseIterator();for(;o.hasNext();)_loop();return PersistencePromise.waitFor(s)}).next(function(){return n})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function recalculateAndSaveOverlaysForDocumentKeys(e,t){var _this=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return _this.recalculateAndSaveOverlays(e,t)})}},{key:"getDocumentsMatchingQuery",value:function getDocumentsMatchingQuery(e,t,n,r){return function __PRIVATE_isDocumentQuery$1(e){return DocumentKey.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):__PRIVATE_isCollectionGroupQuery(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}},{key:"getNextDocuments",value:function getNextDocuments(e,t,n,r){var _this=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(function(i){var s=r-i.size>0?_this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());var o=-1,_=i;return s.next(function(t){return PersistencePromise.forEach(t,function(t,n){return o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?PersistencePromise.resolve():_this.remoteDocumentCache.getEntry(e,t).next(function(e){_=_.insert(t,e)})}).next(function(){return _this.populateOverlays(e,t,i)}).next(function(){return _this.computeViews(e,_,t,__PRIVATE_documentKeySet())}).next(function(e){return{batchId:o,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(e)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new DocumentKey(t)).next(function(e){var _$t=documentMap();return e.isFoundDocument()&&(_$t=_$t.insert(e.key,e)),_$t})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function getDocumentsMatchingCollectionGroupQuery(e,t,n,r){var _this=this;var i=t.collectionGroup;var s=documentMap();return this.indexManager.getCollectionParents(e,i).next(function(o){return PersistencePromise.forEach(o,function(o){var _=function __PRIVATE_asCollectionQueryAtPath(e,t){return new __PRIVATE_QueryImpl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return _this.getDocumentsMatchingCollectionQuery(e,_,n,r).next(function(e){e.forEach(function(e,t){s=s.insert(e,t)})})}).next(function(){return s})})}},{key:"getDocumentsMatchingCollectionQuery",value:function getDocumentsMatchingCollectionQuery(e,t,n,r){var _this=this;var i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(function(s){return i=s,_this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)}).next(function(e){i.forEach(function(t,n){var _$r=n.getKey();null===e.get(_$r)&&(e=e.insert(_$r,MutableDocument.newInvalidDocument(_$r)))});var _$n=documentMap();return e.forEach(function(e,r){var s=i.get(e);void 0!==s&&__PRIVATE_mutationApplyToLocalView(s.mutation,r,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(t,r)&&(_$n=_$n.insert(e,r))}),_$n})}}]);return LocalDocumentsView}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryBundleCache=function(){function __PRIVATE_MemoryBundleCache(e){_class_call_check$1(this,__PRIVATE_MemoryBundleCache);this.serializer=e,this.cr=new Map,this.lr=new Map}_create_class$1(__PRIVATE_MemoryBundleCache,[{key:"getBundleMetadata",value:function getBundleMetadata(e,t){return PersistencePromise.resolve(this.cr.get(t))}},{key:"saveBundleMetadata",value:function saveBundleMetadata(e,t){return this.cr.set(t.id,function __PRIVATE_fromBundleMetadata(e){return{id:e.id,version:e.version,createTime:__PRIVATE_fromVersion(e.createTime)}}(t)),PersistencePromise.resolve()}},{key:"getNamedQuery",value:function getNamedQuery(e,t){return PersistencePromise.resolve(this.lr.get(t))}},{key:"saveNamedQuery",value:function saveNamedQuery(e,t){return this.lr.set(t.name,function __PRIVATE_fromProtoNamedQuery(e){return{name:e.name,query:__PRIVATE_fromBundledQuery(e.bundledQuery),readTime:__PRIVATE_fromVersion(e.readTime)}}(t)),PersistencePromise.resolve()}}]);return __PRIVATE_MemoryBundleCache}();/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryDocumentOverlayCache=function(){function __PRIVATE_MemoryDocumentOverlayCache(){_class_call_check$1(this,__PRIVATE_MemoryDocumentOverlayCache);this.overlays=new SortedMap(DocumentKey.comparator),this.hr=new Map}_create_class$1(__PRIVATE_MemoryDocumentOverlayCache,[{key:"getOverlay",value:function getOverlay(e,t){return PersistencePromise.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function getOverlays(e,t){var _this=this;var n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,function(t){return _this.getOverlay(e,t).next(function(e){null!==e&&n.set(t,e)})}).next(function(){return n})}},{key:"saveOverlays",value:function saveOverlays(e,t,n){var _this=this;return n.forEach(function(n,r){_this.ht(e,t,r)}),PersistencePromise.resolve()}},{key:"removeOverlaysForBatchId",value:function removeOverlaysForBatchId(e,t,n){var _this=this;var _$r=this.hr.get(n);return void 0!==_$r&&(_$r.forEach(function(e){return _this.overlays=_this.overlays.remove(e)}),this.hr.delete(n)),PersistencePromise.resolve()}},{key:"getOverlaysForCollection",value:function getOverlaysForCollection(e,t,n){var _$r=__PRIVATE_newOverlayMap(),i=t.length+1,s=new DocumentKey(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){var e1=o.getNext().value,s1=e1.getKey();if(!t.isPrefixOf(s1.path))break;s1.path.length===i&&e1.largestBatchId>n&&_$r.set(e1.getKey(),e1)}return PersistencePromise.resolve(_$r)}},{key:"getOverlaysForCollectionGroup",value:function getOverlaysForCollectionGroup(e,t,n,r){var i=new SortedMap(function(e,t){return e-t});var s=this.overlays.getIterator();for(;s.hasNext();){var e1=s.getNext().value;if(e1.getKey().getCollectionGroup()===t&&e1.largestBatchId>n){var _$t=i.get(e1.largestBatchId);null===_$t&&(_$t=__PRIVATE_newOverlayMap(),i=i.insert(e1.largestBatchId,_$t)),_$t.set(e1.getKey(),e1)}}var o=__PRIVATE_newOverlayMap(),_=i.getIterator();for(;_.hasNext();){if(_.getNext().value.forEach(function(e,t){return o.set(e,t)}),o.size()>=r)break}return PersistencePromise.resolve(o)}},{key:"ht",value:function ht(e,t,n){var _$r=this.overlays.get(n.key);if(null!==_$r){var e1=this.hr.get(_$r.largestBatchId).delete(n.key);this.hr.set(_$r.largestBatchId,e1)}this.overlays=this.overlays.insert(n.key,new Overlay(t,n));var i=this.hr.get(t);void 0===i&&(i=__PRIVATE_documentKeySet(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}]);return __PRIVATE_MemoryDocumentOverlayCache}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_ReferenceSet=function(){function __PRIVATE_ReferenceSet(){_class_call_check$1(this,__PRIVATE_ReferenceSet);this.Pr=new SortedSet(__PRIVATE_DocReference.Ir),this.Tr=new SortedSet(__PRIVATE_DocReference.Er)}_create_class$1(__PRIVATE_ReferenceSet,[{key:"isEmpty",value:function isEmpty(){return this.Pr.isEmpty()}},{key:"addReference",value:function addReference(e,t){var n=new __PRIVATE_DocReference(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}},{key:"dr",value:function dr(e,t){var _this=this;e.forEach(function(e){return _this.addReference(e,t)})}},{key:"removeReference",value:function removeReference(e,t){this.Ar(new __PRIVATE_DocReference(e,t))}},{key:"Rr",value:function Rr(e,t){var _this=this;e.forEach(function(e){return _this.removeReference(e,t)})}},{key:"Vr",value:function Vr(e){var _this=this;var t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),_$r=new __PRIVATE_DocReference(t,e+1),i=[];return this.Tr.forEachInRange([n,_$r],function(e){_this.Ar(e),i.push(e.key)}),i}},{key:"mr",value:function mr(){var _this=this;this.Pr.forEach(function(e){return _this.Ar(e)})}},{key:"Ar",value:function Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}},{key:"gr",value:function gr(e){var t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),_$r=new __PRIVATE_DocReference(t,e+1);var i=__PRIVATE_documentKeySet();return this.Tr.forEachInRange([n,_$r],function(e){i=i.add(e.key)}),i}},{key:"containsKey",value:function containsKey(e){var t=new __PRIVATE_DocReference(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]);return __PRIVATE_ReferenceSet}();var __PRIVATE_DocReference=function(){function __PRIVATE_DocReference(e,t){_class_call_check$1(this,__PRIVATE_DocReference);this.key=e,this.pr=t}_create_class$1(__PRIVATE_DocReference,null,[{key:"Ir",value:function Ir(e,t){return DocumentKey.comparator(e.key,t.key)||__PRIVATE_primitiveComparator(e.pr,t.pr)}},{key:"Er",value:function Er(e,t){return __PRIVATE_primitiveComparator(e.pr,t.pr)||DocumentKey.comparator(e.key,t.key)}}]);return __PRIVATE_DocReference}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryMutationQueue=function(){function __PRIVATE_MemoryMutationQueue(e,t){_class_call_check$1(this,__PRIVATE_MemoryMutationQueue);this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new SortedSet(__PRIVATE_DocReference.Ir)}_create_class$1(__PRIVATE_MemoryMutationQueue,[{key:"checkEmpty",value:function checkEmpty(e){return PersistencePromise.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function addMutationBatch(e,t,n,r){var i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var s=new MutationBatch(i,t,n,r);this.mutationQueue.push(s);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=r[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;this.wr=this.wr.add(new __PRIVATE_DocReference(_$t.key,i)),this.indexManager.addToCollectionParentIndex(e,_$t.key.path.popLast())}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return PersistencePromise.resolve(s)}},{key:"lookupMutationBatch",value:function lookupMutationBatch(e,t){return PersistencePromise.resolve(this.Sr(t))}},{key:"getNextMutationBatchAfterBatchId",value:function getNextMutationBatchAfterBatchId(e,t){var n=t+1,_$r=this.br(n),i=_$r<0?0:_$r;return PersistencePromise.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(0===this.mutationQueue.length?-1:this.yr-1)}},{key:"getAllMutationBatches",value:function getAllMutationBatches(e){return PersistencePromise.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function getAllMutationBatchesAffectingDocumentKey(e,t){var _this=this;var n=new __PRIVATE_DocReference(t,0),_$r=new __PRIVATE_DocReference(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,_$r],function(e){var _$t=_this.Sr(e.pr);i.push(_$t)}),PersistencePromise.resolve(i)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function getAllMutationBatchesAffectingDocumentKeys(e,t){var _this=this;var n=new SortedSet(__PRIVATE_primitiveComparator);return t.forEach(function(e){var _$t=new __PRIVATE_DocReference(e,0),_$r=new __PRIVATE_DocReference(e,Number.POSITIVE_INFINITY);_this.wr.forEachInRange([_$t,_$r],function(e){n=n.add(e.pr)})}),PersistencePromise.resolve(this.Dr(n))}},{key:"getAllMutationBatchesAffectingQuery",value:function getAllMutationBatchesAffectingQuery(e,t){var n=t.path,_$r=n.length+1;var i=n;DocumentKey.isDocumentKey(i)||(i=i.child(""));var s=new __PRIVATE_DocReference(new DocumentKey(i),0);var o=new SortedSet(__PRIVATE_primitiveComparator);return this.wr.forEachWhile(function(e){var _$t=e.key.path;return!!n.isPrefixOf(_$t)&&(_$t.length===_$r&&(o=o.add(e.pr)),!0)},s),PersistencePromise.resolve(this.Dr(o))}},{key:"Dr",value:function Dr(e){var _this=this;var t=[];return e.forEach(function(e){var n=_this.Sr(e);null!==n&&t.push(n)}),t}},{key:"removeMutationBatch",value:function removeMutationBatch(e,t){var _this=this;__PRIVATE_hardAssert(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();var n=this.wr;return PersistencePromise.forEach(t.mutations,function(r){var i=new __PRIVATE_DocReference(r.key,t.batchId);return n=n.delete(i),_this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(function(){_this.wr=n})}},{key:"Mn",value:function Mn(e){}},{key:"containsKey",value:function containsKey(e,t){var n=new __PRIVATE_DocReference(t,0),_$r=this.wr.firstAfterOrEqual(n);return PersistencePromise.resolve(t.isEqual(_$r&&_$r.key))}},{key:"performConsistencyCheck",value:function performConsistencyCheck(e){return this.mutationQueue.length,PersistencePromise.resolve()}},{key:"Cr",value:function Cr(e,t){return this.br(e)}},{key:"br",value:function br(e){if(0===this.mutationQueue.length)return 0;return e-this.mutationQueue[0].batchId}},{key:"Sr",value:function Sr(e){var t=this.br(e);if(t<0||t>=this.mutationQueue.length)return null;return this.mutationQueue[t]}}]);return __PRIVATE_MemoryMutationQueue}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryRemoteDocumentCacheImpl=function(){function __PRIVATE_MemoryRemoteDocumentCacheImpl(e){_class_call_check$1(this,__PRIVATE_MemoryRemoteDocumentCacheImpl);this.vr=e,this.docs=function __PRIVATE_documentEntryMap(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}_create_class$1(__PRIVATE_MemoryRemoteDocumentCacheImpl,[{key:"setIndexManager",value:function setIndexManager(e){this.indexManager=e}},{key:"addEntry",value:function addEntry(e,t){var n=t.key,_$r=this.docs.get(n),i=_$r?_$r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function getEntry(e,t){var n=this.docs.get(t);return PersistencePromise.resolve(n?n.document.mutableCopy():MutableDocument.newInvalidDocument(t))}},{key:"getEntries",value:function getEntries(e,t){var _this=this;var n=__PRIVATE_mutableDocumentMap();return t.forEach(function(e){var _$t=_this.docs.get(e);n=n.insert(e,_$t?_$t.document.mutableCopy():MutableDocument.newInvalidDocument(e))}),PersistencePromise.resolve(n)}},{key:"getDocumentsMatchingQuery",value:function getDocumentsMatchingQuery(e,t,n,r){var i=__PRIVATE_mutableDocumentMap();var s=t.path,o=new DocumentKey(s.child("")),_=this.docs.getIteratorFrom(o);for(;_.hasNext();){var __getNext=_.getNext(),e1=__getNext.key,__getNext_value=__getNext.value,o1=__getNext_value.document;if(!s.isPrefixOf(e1.path))break;e1.path.length>s.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(o1),n)<=0||(r.has(o1.key)||__PRIVATE_queryMatches(t,o1))&&(i=i.insert(o1.key,o1.mutableCopy()))}return PersistencePromise.resolve(i)}},{key:"getAllFromCollectionGroup",value:function getAllFromCollectionGroup(e,t,n,r){fail()}},{key:"Fr",value:function Fr(e,t){return PersistencePromise.forEach(this.docs,function(e){return t(e)})}},{key:"newChangeBuffer",value:function newChangeBuffer(e){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}},{key:"getSize",value:function getSize(e){return PersistencePromise.resolve(this.size)}}]);return __PRIVATE_MemoryRemoteDocumentCacheImpl}();var __PRIVATE_MemoryRemoteDocumentChangeBuffer=function(RemoteDocumentChangeBuffer){_inherits$1(__PRIVATE_MemoryRemoteDocumentChangeBuffer,RemoteDocumentChangeBuffer);var _super=_create_super$1(__PRIVATE_MemoryRemoteDocumentChangeBuffer);function __PRIVATE_MemoryRemoteDocumentChangeBuffer(e){_class_call_check$1(this,__PRIVATE_MemoryRemoteDocumentChangeBuffer);var _this;_this=_super.call(this),_this.ar=e;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_MemoryRemoteDocumentChangeBuffer,[{key:"applyChanges",value:function applyChanges(e){var _this=this;var t=[];return this.changes.forEach(function(n,r){r.isValidDocument()?t.push(_this.ar.addEntry(e,r)):_this.ar.removeEntry(n)}),PersistencePromise.waitFor(t)}},{key:"getFromCache",value:function getFromCache(e,t){return this.ar.getEntry(e,t)}},{key:"getAllFromCache",value:function getAllFromCache(e,t){return this.ar.getEntries(e,t)}}]);return __PRIVATE_MemoryRemoteDocumentChangeBuffer}(RemoteDocumentChangeBuffer);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryTargetCache=function(){function __PRIVATE_MemoryTargetCache(e){_class_call_check$1(this,__PRIVATE_MemoryTargetCache);this.persistence=e,this.Mr=new ObjectMap(function(e){return __PRIVATE_canonifyTarget(e)},__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.Or=0,this.Nr=new __PRIVATE_ReferenceSet,this.targetCount=0,this.Br=__PRIVATE_TargetIdGenerator.Nn()}_create_class$1(__PRIVATE_MemoryTargetCache,[{key:"forEachTarget",value:function forEachTarget(e,t){return this.Mr.forEach(function(e,n){return t(n)}),PersistencePromise.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function getLastRemoteSnapshotVersion(e){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function getHighestSequenceNumber(e){return PersistencePromise.resolve(this.Or)}},{key:"allocateTargetId",value:function allocateTargetId(e){return this.highestTargetId=this.Br.next(),PersistencePromise.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),PersistencePromise.resolve()}},{key:"qn",value:function qn(e){this.Mr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Br=new __PRIVATE_TargetIdGenerator(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}},{key:"addTargetData",value:function addTargetData(e,t){return this.qn(t),this.targetCount+=1,PersistencePromise.resolve()}},{key:"updateTargetData",value:function updateTargetData(e,t){return this.qn(t),PersistencePromise.resolve()}},{key:"removeTargetData",value:function removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,PersistencePromise.resolve()}},{key:"removeTargets",value:function removeTargets(e,t,n){var _this=this;var _$r=0;var i=[];return this.Mr.forEach(function(s,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(_this.Mr.delete(s),i.push(_this.removeMatchingKeysForTargetId(e,o.targetId)),_$r++)}),PersistencePromise.waitFor(i).next(function(){return _$r})}},{key:"getTargetCount",value:function getTargetCount(e){return PersistencePromise.resolve(this.targetCount)}},{key:"getTargetData",value:function getTargetData(e,t){var n=this.Mr.get(t)||null;return PersistencePromise.resolve(n)}},{key:"addMatchingKeys",value:function addMatchingKeys(e,t,n){return this.Nr.dr(t,n),PersistencePromise.resolve()}},{key:"removeMatchingKeys",value:function removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);var _$r=this.persistence.referenceDelegate,i=[];return _$r&&t.forEach(function(t){i.push(_$r.markPotentiallyOrphaned(e,t))}),PersistencePromise.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),PersistencePromise.resolve()}},{key:"getMatchingKeysForTargetId",value:function getMatchingKeysForTargetId(e,t){var n=this.Nr.gr(t);return PersistencePromise.resolve(n)}},{key:"containsKey",value:function containsKey(e,t){return PersistencePromise.resolve(this.Nr.containsKey(t))}}]);return __PRIVATE_MemoryTargetCache}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_MemoryPersistence=function(){function __PRIVATE_MemoryPersistence(e,t){var _this=this;_class_call_check$1(this,__PRIVATE_MemoryPersistence);this.Lr={},this.overlays={},this.kr=new __PRIVATE_ListenSequence(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new __PRIVATE_MemoryTargetCache(this);this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function __PRIVATE_newMemoryRemoteDocumentCache(e){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(e)}(function(e){return _this.referenceDelegate.Kr(e)}),this.serializer=new __PRIVATE_LocalSerializer(t),this.$r=new __PRIVATE_MemoryBundleCache(this.serializer)}_create_class$1(__PRIVATE_MemoryPersistence,[{key:"start",value:function start(){return Promise.resolve()}},{key:"shutdown",value:function shutdown(){return this.qr=!1,Promise.resolve()}},{key:"started",get:function get(){return this.qr}},{key:"setDatabaseDeletedListener",value:function setDatabaseDeletedListener(){}},{key:"setNetworkEnabled",value:function setNetworkEnabled(){}},{key:"getIndexManager",value:function getIndexManager(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function getDocumentOverlayCache(e){var t=this.overlays[e.toKey()];return t||(t=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function getMutationQueue(e,t){var n=this.Lr[e.toKey()];return n||(n=new __PRIVATE_MemoryMutationQueue(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}},{key:"getTargetCache",value:function getTargetCache(){return this.Qr}},{key:"getRemoteDocumentCache",value:function getRemoteDocumentCache(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function getBundleCache(){return this.$r}},{key:"runTransaction",value:function runTransaction(e,t,n){var _this=this;__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",e);var _$r=new __PRIVATE_MemoryTransaction(this.kr.next());return this.referenceDelegate.Ur(),n(_$r).next(function(e){return _this.referenceDelegate.Wr(_$r).next(function(){return e})}).toPromise().then(function(e){return _$r.raiseOnCommittedEvent(),e})}},{key:"Gr",value:function Gr(e,t){return PersistencePromise.or(Object.values(this.Lr).map(function(n){return function(){return n.containsKey(e,t)}}))}}]);return __PRIVATE_MemoryPersistence}();var __PRIVATE_MemoryTransaction=function(PersistenceTransaction){_inherits$1(__PRIVATE_MemoryTransaction,PersistenceTransaction);var _super=_create_super$1(__PRIVATE_MemoryTransaction);function __PRIVATE_MemoryTransaction(e){_class_call_check$1(this,__PRIVATE_MemoryTransaction);var _this;_this=_super.call(this),_this.currentSequenceNumber=e;return _possible_constructor_return$1(_this)}return __PRIVATE_MemoryTransaction}(PersistenceTransaction);var __PRIVATE_MemoryEagerDelegate=function(){function __PRIVATE_MemoryEagerDelegate(e){_class_call_check$1(this,__PRIVATE_MemoryEagerDelegate);this.persistence=e,this.zr=new __PRIVATE_ReferenceSet,this.jr=null}_create_class$1(__PRIVATE_MemoryEagerDelegate,[{key:"Jr",get:function get(){if(this.jr)return this.jr;throw fail()}},{key:"addReference",value:function addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),PersistencePromise.resolve()}},{key:"removeReference",value:function removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),PersistencePromise.resolve()}},{key:"markPotentiallyOrphaned",value:function markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),PersistencePromise.resolve()}},{key:"removeTarget",value:function removeTarget(e,t){var _this=this;this.zr.Vr(t.targetId).forEach(function(e){return _this.Jr.add(e.toString())});var n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return _this.Jr.add(e.toString())})}).next(function(){return n.removeTargetData(e,t)})}},{key:"Ur",value:function Ur(){this.jr=new Set}},{key:"Wr",value:function Wr(e){var _this=this;var t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.Jr,function(n){var _$r=DocumentKey.fromPath(n);return _this.Yr(e,_$r).next(function(e){e||t.removeEntry(_$r,SnapshotVersion.min())})}).next(function(){return _this.jr=null,t.apply(e)})}},{key:"updateLimboDocument",value:function updateLimboDocument(e,t){var _this=this;return this.Yr(e,t).next(function(e){e?_this.Jr.delete(t.toString()):_this.Jr.add(t.toString())})}},{key:"Kr",value:function Kr(e){return 0}},{key:"Yr",value:function Yr(e,t){var _this=this;return PersistencePromise.or([function(){return PersistencePromise.resolve(_this.zr.containsKey(t))},function(){return _this.persistence.getTargetCache().containsKey(e,t)},function(){return _this.persistence.Gr(e,t)}])}}],[{key:"Hr",value:function Hr(e){return new __PRIVATE_MemoryEagerDelegate(e)}}]);return __PRIVATE_MemoryEagerDelegate}();var __PRIVATE_MemoryLruDelegate=function(){function __PRIVATE_MemoryLruDelegate(e,t){_class_call_check$1(this,__PRIVATE_MemoryLruDelegate);this.persistence=e,this.Zr=new ObjectMap(function(e){return __PRIVATE_encodeResourcePath(e.path)},function(e,t){return e.isEqual(t)}),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}_create_class$1(__PRIVATE_MemoryLruDelegate,[{key:"Ur",value:function Ur(){}},{key:"Wr",value:function Wr(e){return PersistencePromise.resolve()}},{key:"forEachTarget",value:function forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}},{key:"Hn",value:function Hn(e){var t=this.Zn(e);return this.persistence.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:"Zn",value:function Zn(e){var t=0;return this.Jn(e,function(e){t++}).next(function(){return t})}},{key:"Jn",value:function Jn(e,t){var _this=this;return PersistencePromise.forEach(this.Zr,function(n,r){return _this.er(e,n,r).next(function(e){return e?PersistencePromise.resolve():t(r)})})}},{key:"removeTargets",value:function removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function removeOrphanedDocuments(e,t){var _this=this;var n=0;var _$r=this.persistence.getRemoteDocumentCache(),i=_$r.newChangeBuffer();return _$r.Fr(e,function(r){return _this.er(e,r,t).next(function(e){e||(n++,i.removeEntry(r,SnapshotVersion.min()))})}).next(function(){return i.apply(e)}).next(function(){return n})}},{key:"markPotentiallyOrphaned",value:function markPotentiallyOrphaned(e,t){return this.Zr.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}},{key:"removeTarget",value:function removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}},{key:"addReference",value:function addReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}},{key:"removeReference",value:function removeReference(e,t,n){return this.Zr.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}},{key:"updateLimboDocument",value:function updateLimboDocument(e,t){return this.Zr.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}},{key:"Kr",value:function Kr(e){var t=e.key.toString().length;return e.isFoundDocument()&&(t+=__PRIVATE_estimateByteSize(e.data.value)),t}},{key:"er",value:function er(e,t,n){var _this=this;return PersistencePromise.or([function(){return _this.persistence.Gr(e,t)},function(){return _this.persistence.getTargetCache().containsKey(e,t)},function(){var e=_this.Zr.get(t);return PersistencePromise.resolve(void 0!==e&&e>n)}])}},{key:"getCacheSize",value:function getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}],[{key:"Hr",value:function Hr(e,t){return new __PRIVATE_MemoryLruDelegate(e,t)}}]);return __PRIVATE_MemoryLruDelegate}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_SchemaConverter=function(){function __PRIVATE_SchemaConverter(e){_class_call_check$1(this,__PRIVATE_SchemaConverter);this.serializer=e}_create_class$1(__PRIVATE_SchemaConverter,[{key:"N",value:function N1(e,t,n,r){var _this=this;var i=new __PRIVATE_SimpleDbTransaction("createOrUpgrade",t);n<1&&r>=1&&(!function __PRIVATE_createPrimaryClientStore(e){e.createObjectStore("owner")}(e),function __PRIVATE_createMutationQueue(e){e.createObjectStore("mutationQueues",{keyPath:"userId"});e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",M,{unique:!0}),e.createObjectStore("documentMutations")}(e),__PRIVATE_createQueryCache(e),function __PRIVATE_createLegacyRemoteDocumentCache(e){e.createObjectStore("remoteDocuments")}(e));var s=PersistencePromise.resolve();return n<3&&r>=3&&(0!==n&&(!function __PRIVATE_dropQueryCache(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),__PRIVATE_createQueryCache(e)),s=s.next(function(){return function __PRIVATE_writeEmptyTargetGlobalEntry(e){var _$t=e.store("targetGlobal"),_$n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:SnapshotVersion.min().toTimestamp(),targetCount:0};return _$t.put("targetGlobalKey",_$n)}(i)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function __PRIVATE_upgradeMutationBatchSchemaAndMigrateData(e,t){return t.store("mutations").W().next(function(n){e.deleteObjectStore("mutations");e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",M,{unique:!0});var _$r=t.store("mutations"),i=n.map(function(e){return _$r.put(e)});return PersistencePromise.waitFor(i)})}(e,i)})),s=s.next(function(){!function __PRIVATE_createClientMetadataStore(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(function(){return _this.Xr(i)})),n<6&&r>=6&&(s=s.next(function(){return function __PRIVATE_createDocumentGlobalStore(e){e.createObjectStore("remoteDocumentGlobal")}(e),_this.ei(i)})),n<7&&r>=7&&(s=s.next(function(){return _this.ti(i)})),n<8&&r>=8&&(s=s.next(function(){return _this.ni(e,i)})),n<9&&r>=9&&(s=s.next(function(){!function __PRIVATE_dropRemoteDocumentChangesStore(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(s=s.next(function(){return _this.ri(i)})),n<11&&r>=11&&(s=s.next(function(){!function __PRIVATE_createBundlesStore(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function __PRIVATE_createNamedQueriesStore(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(function(){!function __PRIVATE_createDocumentOverlayStore(e){var _$t=e.createObjectStore("documentOverlays",{keyPath:G});_$t.createIndex("collectionPathOverlayIndex",z,{unique:!1}),_$t.createIndex("collectionGroupOverlayIndex",j,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(function(){return function __PRIVATE_createRemoteDocumentCache(e){var _$t=e.createObjectStore("remoteDocumentsV14",{keyPath:O});_$t.createIndex("documentKeyIndex",N),_$t.createIndex("collectionGroupIndex",B)}(e)}).next(function(){return _this.ii(e,i)}).next(function(){return e.deleteObjectStore("remoteDocuments")})),n<14&&r>=14&&(s=s.next(function(){return _this.si(e,i)})),n<15&&r>=15&&(s=s.next(function(){return function __PRIVATE_createFieldIndex(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1});e.createObjectStore("indexState",{keyPath:K}).createIndex("sequenceNumberIndex",$,{unique:!1});e.createObjectStore("indexEntries",{keyPath:U}).createIndex("documentKeyIndex",W,{unique:!1})}(e)})),s}},{key:"ei",value:function ei(e){var t=0;return e.store("remoteDocuments").Y(function(e,n){t+=__PRIVATE_dbDocumentSize(n)}).next(function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}},{key:"Xr",value:function Xr(e){var _this=this;var t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(function(t){return PersistencePromise.forEach(t,function(t){var _$r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",_$r).next(function(n){return PersistencePromise.forEach(n,function(n){__PRIVATE_hardAssert(n.userId===t.userId);var _$r=__PRIVATE_fromDbMutationBatch(_this.serializer,n);return removeMutationBatch(e,t.userId,_$r).next(function(){})})})})})}},{key:"ti",value:function ti(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(function(e){var _$r=[];return n.Y(function(n,i){var s=new ResourcePath(n),o=function __PRIVATE_sentinelKey(e){return[0,__PRIVATE_encodeResourcePath(e)]}(s);_$r.push(t.get(o).next(function(n){return n?PersistencePromise.resolve():function(n){return t.put({targetId:0,path:__PRIVATE_encodeResourcePath(n),sequenceNumber:e.highestListenSequenceNumber})}(s)}))}).next(function(){return PersistencePromise.waitFor(_$r)})})}},{key:"ni",value:function ni(e,t){e.createObjectStore("collectionParents",{keyPath:Q});var n=t.store("collectionParents"),_$r=new __PRIVATE_MemoryCollectionParentIndex,addEntry=function addEntry(e){if(_$r.add(e)){var _$t=e.lastSegment(),r1=e.popLast();return n.put({collectionId:_$t,parent:__PRIVATE_encodeResourcePath(r1)})}};return t.store("remoteDocuments").Y({J:!0},function(e,t){var n=new ResourcePath(e);return addEntry(n.popLast())}).next(function(){return t.store("documentMutations").Y({J:!0},function(param,r){var _param=_sliced_to_array$1(param,3);_param[0];var _$t=_param[1];_param[2];var i=__PRIVATE_decodeResourcePath(_$t);return addEntry(i.popLast())})})}},{key:"ri",value:function ri(e){var _this=this;var t=e.store("targets");return t.Y(function(e,n){var _$r=__PRIVATE_fromDbTarget(n),i=__PRIVATE_toDbTarget(_this.serializer,_$r);return t.put(i)})}},{key:"ii",value:function ii(e,t){var n=t.store("remoteDocuments"),_$r=[];return n.Y(function(e,n){var i=t.store("remoteDocumentsV14"),s=(function __PRIVATE_extractKey(e){return e.document?new DocumentKey(ResourcePath.fromString(e.document.name).popFirst(5)):e.noDocument?DocumentKey.fromSegments(e.noDocument.path):e.unknownDocument?DocumentKey.fromSegments(e.unknownDocument.path):fail()})(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};_$r.push(i.put(o))}).next(function(){return PersistencePromise.waitFor(_$r)})}},{key:"si",value:function si(e,t){var _this=this;var n=t.store("mutations"),_$r=__PRIVATE_newIndexedDbRemoteDocumentCache(this.serializer),i=new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Hr,this.serializer.ct);return n.W().next(function(e){var n=new Map;return e.forEach(function(e){var _$t;var _$r=null!==(_$t=n.get(e.userId))&&void 0!==_$t?_$t:__PRIVATE_documentKeySet();__PRIVATE_fromDbMutationBatch(_this.serializer,e).keys().forEach(function(e){return _$r=_$r.add(e)}),n.set(e.userId,_$r)}),PersistencePromise.forEach(n,function(e,n){var s=new User(n),o=__PRIVATE_IndexedDbDocumentOverlayCache.lt(_this.serializer,s),_=i.getIndexManager(s),a=__PRIVATE_IndexedDbMutationQueue.lt(s,_this.serializer,_,i.referenceDelegate);return new LocalDocumentsView(_$r,a,o,_).recalculateAndSaveOverlaysForDocumentKeys(new __PRIVATE_IndexedDbTransaction(t,__PRIVATE_ListenSequence._e),e).next()})})}}]);return __PRIVATE_SchemaConverter}();function __PRIVATE_createQueryCache(e){e.createObjectStore("targetDocuments",{keyPath:k}).createIndex("documentTargetsIndex",q,{unique:!0});e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",L,{unique:!0}),e.createObjectStore("targetGlobal")}var de="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";var __PRIVATE_IndexedDbPersistence=function(){function __PRIVATE_IndexedDbPersistence(e,t,n,r,i,s,o,_,a,u){var c=arguments.length>10&&arguments[10]!==void 0?arguments[10]:15;_class_call_check$1(this,__PRIVATE_IndexedDbPersistence);if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=a,this.ai=u,this.ui=c,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=function(e){return Promise.resolve()},!__PRIVATE_IndexedDbPersistence.D())throw new FirestoreError(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new __PRIVATE_IndexedDbLruDelegateImpl(this,r),this.Ti=t+"main",this.serializer=new __PRIVATE_LocalSerializer(_),this.Ei=new __PRIVATE_SimpleDb(this.Ti,this.ui,new __PRIVATE_SchemaConverter(this.serializer)),this.Qr=new __PRIVATE_IndexedDbTargetCache(this.referenceDelegate,this.serializer),this.remoteDocumentCache=__PRIVATE_newIndexedDbRemoteDocumentCache(this.serializer),this.$r=new __PRIVATE_IndexedDbBundleCache,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&__PRIVATE_logError("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}_create_class$1(__PRIVATE_IndexedDbPersistence,[{key:"start",value:function start(){var _this=this;return this.Ai().then(function(){if(!_this.isPrimary&&!_this.allowTabSynchronization)throw new FirestoreError(D.FAILED_PRECONDITION,de);return _this.Ri(),_this.Vi(),_this.mi(),_this.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return _this.Qr.getHighestSequenceNumber(e)})}).then(function(e){_this.kr=new __PRIVATE_ListenSequence(e,_this._i)}).then(function(){_this.qr=!0}).catch(function(e){return _this.Ei&&_this.Ei.close(),Promise.reject(e)})}},{key:"fi",value:function fi(e){var _this=this;return this.Ii=function(){var _ref=_async_to_generator$3(function(t){return _ts_generator$1(this,function(_state){if(_this.started)return[2,e(t)];return[2]})});return function(t){return _ref.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function setDatabaseDeletedListener(e){this.Ei.L(function(){var _ref=_async_to_generator$3(function(t){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=null===t.newVersion;if(!_tmp)return[3,2];return[4,e()];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})});return function(t){return _ref.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function setNetworkEnabled(e){var _this=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(_async_to_generator$3(function(){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=_this.started;if(!_tmp)return[3,2];return[4,_this.Ai()];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})})))}},{key:"Ai",value:function Ai(){var _this=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return __PRIVATE_clientMetadataStore(e).put({clientId:_this.clientId,updateTimeMs:Date.now(),networkEnabled:_this.networkEnabled,inForeground:_this.inForeground}).next(function(){if(_this.isPrimary)return _this.gi(e).next(function(e){e||(_this.isPrimary=!1,_this.oi.enqueueRetryable(function(){return _this.Ii(!1)}))})}).next(function(){return _this.pi(e)}).next(function(t){return _this.isPrimary&&!t?_this.yi(e).next(function(){return!1}):!!t&&_this.wi(e).next(function(){return!0})})}).catch(function(e){if(__PRIVATE_isIndexedDbTransactionError(e))return __PRIVATE_logDebug("IndexedDbPersistence","Failed to extend owner lease: ",e),_this.isPrimary;if(!_this.allowTabSynchronization)throw e;return __PRIVATE_logDebug("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){_this.isPrimary!==e&&_this.oi.enqueueRetryable(function(){return _this.Ii(e)}),_this.isPrimary=e})}},{key:"gi",value:function gi(e){var _this=this;return __PRIVATE_primaryClientStore(e).get("owner").next(function(e){return PersistencePromise.resolve(_this.Si(e))})}},{key:"bi",value:function bi(e){return __PRIVATE_clientMetadataStore(e).delete(this.clientId)}},{key:"Di",value:function Di(){var _this=this;return _async_to_generator$3(function(){var e,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!(_this.isPrimary&&!_this.Ci(_this.Pi,18e5)))return[3,2];_this.Pi=Date.now();return[4,_this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var t=__PRIVATE_getStore(e,"clientMetadata");return t.W().next(function(e){var n=_this.vi(e,18e5),_$r=e.filter(function(e){return-1===n.indexOf(e)});return PersistencePromise.forEach(_$r,function(e){return t.delete(e.clientId)}).next(function(){return _$r})})}).catch(function(){return[]})];case 1:e=_state.sent();_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(_this.di)try{for(_iterator=e[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){t=_step.value;_this.di.removeItem(_this.Fi(t.clientId))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_state.label=2;case 2:return[2]}})})()}},{key:"mi",value:function mi(){var _this=this;this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return _this.Ai().then(function(){return _this.Di()}).then(function(){return _this.mi()})})}},{key:"Si",value:function Si(e){return!!e&&e.ownerId===this.clientId}},{key:"pi",value:function pi(e){var _this=this;if(this.ai)return PersistencePromise.resolve(!0);return __PRIVATE_primaryClientStore(e).get("owner").next(function(t){if(null!==t&&_this.Ci(t.leaseTimestampMs,5e3)&&!_this.Mi(t.ownerId)){if(_this.Si(t)&&_this.networkEnabled)return!0;if(!_this.Si(t)){if(!t.allowTabSynchronization)throw new FirestoreError(D.FAILED_PRECONDITION,de);return!1}}return!(!_this.networkEnabled||!_this.inForeground)||__PRIVATE_clientMetadataStore(e).W().next(function(e){return void 0===_this.vi(e,5e3).find(function(e){if(_this.clientId!==e.clientId){var _$t=!_this.networkEnabled&&e.networkEnabled,n=!_this.inForeground&&e.inForeground,_$r=_this.networkEnabled===e.networkEnabled;if(_$t||n&&_$r)return!0}return!1})})}).next(function(e){return _this.isPrimary!==e&&__PRIVATE_logDebug("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e})}},{key:"shutdown",value:function shutdown(){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_this.qr=!1,_this.xi(),_this.hi&&(_this.hi.cancel(),_this.hi=null),_this.Oi(),_this.Ni();return[4,_this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],function(e){var t=new __PRIVATE_IndexedDbTransaction(e,__PRIVATE_ListenSequence._e);return _this.yi(t).next(function(){return _this.bi(t)})})];case 1:_state.sent(),_this.Ei.close(),_this.Bi();return[2]}})})()}},{key:"vi",value:function vi(e,t){var _this=this;return e.filter(function(e){return _this.Ci(e.updateTimeMs,t)&&!_this.Mi(e.clientId)})}},{key:"Li",value:function Li(){var _this=this;return this.runTransaction("getActiveClients","readonly",function(e){return __PRIVATE_clientMetadataStore(e).W().next(function(e){return _this.vi(e,18e5).map(function(e){return e.clientId})})})}},{key:"started",get:function get(){return this.qr}},{key:"getMutationQueue",value:function getMutationQueue(e,t){return __PRIVATE_IndexedDbMutationQueue.lt(e,this.serializer,t,this.referenceDelegate)}},{key:"getTargetCache",value:function getTargetCache(){return this.Qr}},{key:"getRemoteDocumentCache",value:function getRemoteDocumentCache(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function getIndexManager(e){return new __PRIVATE_IndexedDbIndexManager(e,this.serializer.ct.databaseId)}},{key:"getDocumentOverlayCache",value:function getDocumentOverlayCache(e){return __PRIVATE_IndexedDbDocumentOverlayCache.lt(this.serializer,e)}},{key:"getBundleCache",value:function getBundleCache(){return this.$r}},{key:"runTransaction",value:function runTransaction(e,t,n){var _this=this;__PRIVATE_logDebug("IndexedDbPersistence","Starting transaction:",e);var _$r="readonly"===t?"readonly":"readwrite",i=function __PRIVATE_getObjectStores(e){return 15===e?X:14===e?Z:13===e?Y:12===e?J:11===e?H:void fail()}(this.ui);var s;return this.Ei.runTransaction(e,_$r,i,function(r){return s=new __PRIVATE_IndexedDbTransaction(r,_this.kr?_this.kr.next():__PRIVATE_ListenSequence._e),"readwrite-primary"===t?_this.gi(s).next(function(e){return!!e||_this.pi(s)}).next(function(t){if(!t)throw __PRIVATE_logError("Failed to obtain primary lease for action '".concat(e,"'.")),_this.isPrimary=!1,_this.oi.enqueueRetryable(function(){return _this.Ii(!1)}),new FirestoreError(D.FAILED_PRECONDITION,v);return n(s)}).next(function(e){return _this.wi(s).next(function(){return e})}):_this.ki(s).next(function(){return n(s)})}).then(function(e){return s.raiseOnCommittedEvent(),e})}},{key:"ki",value:function ki(e){var _this=this;return __PRIVATE_primaryClientStore(e).get("owner").next(function(e){if(null!==e&&_this.Ci(e.leaseTimestampMs,5e3)&&!_this.Mi(e.ownerId)&&!_this.Si(e)&&!(_this.ai||_this.allowTabSynchronization&&e.allowTabSynchronization))throw new FirestoreError(D.FAILED_PRECONDITION,de)})}},{key:"wi",value:function wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return __PRIVATE_primaryClientStore(e).put("owner",t)}},{key:"yi",value:function yi(e){var _this=this;var t=__PRIVATE_primaryClientStore(e);return t.get("owner").next(function(e){return _this.Si(e)?(__PRIVATE_logDebug("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):PersistencePromise.resolve()})}},{key:"Ci",value:function Ci(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(__PRIVATE_logError("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"Ri",value:function Ri(){var _this=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=function(){_this.oi.enqueueAndForget(function(){return _this.inForeground="visible"===_this.document.visibilityState,_this.Ai()})},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}},{key:"Oi",value:function Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}},{key:"Vi",value:function Vi(){var _this=this;var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=function(){_this.xi();var e=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&_this.oi.enterRestrictedMode(!0),_this.oi.enqueueAndForget(function(){return _this.shutdown()})},this.window.addEventListener("pagehide",this.ci))}},{key:"Ni",value:function Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}},{key:"Mi",value:function Mi(e){var t;try{var n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return __PRIVATE_logDebug("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return __PRIVATE_logError("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"xi",value:function xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){__PRIVATE_logError("Failed to set zombie client id.",e)}}},{key:"Bi",value:function Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}},{key:"Fi",value:function Fi(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"D",value:function D(){return __PRIVATE_SimpleDb.D()}}]);return __PRIVATE_IndexedDbPersistence}();function __PRIVATE_primaryClientStore(e){return __PRIVATE_getStore(e,"owner")}function __PRIVATE_clientMetadataStore(e){return __PRIVATE_getStore(e,"clientMetadata")}function __PRIVATE_indexedDbStoragePrefix(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_LocalViewChanges=function(){function __PRIVATE_LocalViewChanges(e,t,n,r){_class_call_check$1(this,__PRIVATE_LocalViewChanges);this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}_create_class$1(__PRIVATE_LocalViewChanges,null,[{key:"Ki",value:function Ki(e,t){var n=__PRIVATE_documentKeySet(),_$r=__PRIVATE_documentKeySet();var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t.docChanges[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;switch(_$e.type){case 0:n=n.add(_$e.doc.key);break;case 1:_$r=_$r.add(_$e.doc.key)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new __PRIVATE_LocalViewChanges(e,t.fromCache,n,_$r)}}]);return __PRIVATE_LocalViewChanges}();/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var QueryContext=function(){function QueryContext(){_class_call_check$1(this,QueryContext);this._documentReadCount=0}_create_class$1(QueryContext,[{key:"documentReadCount",get:function get(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function incrementDocumentReadCount(e){this._documentReadCount+=e}}]);return QueryContext}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_QueryEngine=function(){function __PRIVATE_QueryEngine(){_class_call_check$1(this,__PRIVATE_QueryEngine);this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function __PRIVATE_getDefaultRelativeIndexReadCostPerDocument(){return isSafari()?8:__PRIVATE_SimpleDb.v(getUA())>0?6:4}()}_create_class$1(__PRIVATE_QueryEngine,[{key:"initialize",value:function initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}},{key:"getDocumentsMatchingQuery",value:function getDocumentsMatchingQuery(e,t,n,r){var _this=this;var i={result:null};return this.ji(e,t).next(function(e){i.result=e}).next(function(){if(!i.result)return _this.Hi(e,t,r,n).next(function(e){i.result=e})}).next(function(){if(i.result)return;var n=new QueryContext;return _this.Ji(e,t,n).next(function(r){if(i.result=r,_this.Ui)return _this.Yi(e,t,n,r.size)})}).next(function(){return i.result})}},{key:"Yi",value:function Yi(e,t,n,r){return n.documentReadCount<this.Wi?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,__PRIVATE_queryToTarget(t))):PersistencePromise.resolve())}},{key:"ji",value:function ji(e,t){var _this=this;if(__PRIVATE_queryMatchesAllDocuments(t))return PersistencePromise.resolve(null);var n=__PRIVATE_queryToTarget(t);return this.indexManager.getIndexType(e,n).next(function(r){return 0===r?null:(null!==t.limit&&1===r&&(t=__PRIVATE_queryWithLimit(t,null,"F"),n=__PRIVATE_queryToTarget(t)),_this.indexManager.getDocumentsMatchingTarget(e,n).next(function(r){var i=__PRIVATE_documentKeySet.apply(void 0,_to_consumable_array$1(r));return _this.zi.getDocuments(e,i).next(function(r){return _this.indexManager.getMinOffset(e,n).next(function(n){var s=_this.Zi(t,r);return _this.Xi(t,s,i,n.readTime)?_this.ji(e,__PRIVATE_queryWithLimit(t,null,"F")):_this.es(e,s,t,n)})})}))})}},{key:"Hi",value:function Hi(e,t,n,r){var _this=this;return __PRIVATE_queryMatchesAllDocuments(t)||r.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.zi.getDocuments(e,n).next(function(i){var s=_this.Zi(t,i);return _this.Xi(t,s,n,r)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),__PRIVATE_stringifyQuery(t)),_this.es(e,s,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(r,-1)).next(function(e){return e}))})}},{key:"Zi",value:function Zi(e,t){var n=new SortedSet(__PRIVATE_newQueryComparator(e));return t.forEach(function(t,r){__PRIVATE_queryMatches(e,r)&&(n=n.add(r))}),n}},{key:"Xi",value:function Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ji",value:function Ji(e,t,n){return __PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(t)),this.zi.getDocumentsMatchingQuery(e,t,IndexOffset.min(),n)}},{key:"es",value:function es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next(function(e){return t.forEach(function(t){e=e.insert(t.key,t)}),e})}}]);return __PRIVATE_QueryEngine}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_LocalStoreImpl=function(){function __PRIVATE_LocalStoreImpl(e,t,n,r){_class_call_check$1(this,__PRIVATE_LocalStoreImpl);this.persistence=e,this.ts=t,this.serializer=r,this.ns=new SortedMap(__PRIVATE_primitiveComparator),this.rs=new ObjectMap(function(e){return __PRIVATE_canonifyTarget(e)},__PRIVATE_targetEquals),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_create_class$1(__PRIVATE_LocalStoreImpl,[{key:"_s",value:function _s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LocalDocumentsView(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function collectGarbage(e){var _this=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,_this.ns)})}}]);return __PRIVATE_LocalStoreImpl}();function __PRIVATE_newLocalStore(e,t,n,r){return new __PRIVATE_LocalStoreImpl(e,t,n,r)}function __PRIVATE_localStoreHandleUserChange(e,t){return ___PRIVATE_localStoreHandleUserChange.apply(this,arguments)}function ___PRIVATE_localStoreHandleUserChange(){___PRIVATE_localStoreHandleUserChange=_async_to_generator$3(function(e,t){var n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);return[4,n.persistence.runTransaction("Handle user change","readonly",function(e){var _$r;return n.mutationQueue.getAllMutationBatches(e).next(function(i){return _$r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)}).next(function(t){var i=[],s=[];var o=__PRIVATE_documentKeySet();var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_$r[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;i.push(_$e.batchId);var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=_$e.mutations[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var _$t=_step1.value;o=o.add(_$t.key)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true,_didIteratorError2=false,_iteratorError2=undefined;try{for(var _iterator2=t[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _$e1=_step2.value;s.push(_$e1.batchId);var _iteratorNormalCompletion3=true,_didIteratorError3=false,_iteratorError3=undefined;try{for(var _iterator3=_$e1.mutations[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _$t1=_step3.value;o=o.add(_$t1.key)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return!=null){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return!=null){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return n.localDocuments.getDocuments(e,o).next(function(e){return{us:e,removedBatchIds:i,addedBatchIds:s}})})})];case 1:return[2,_state.sent()]}})});return ___PRIVATE_localStoreHandleUserChange.apply(this,arguments)}function __PRIVATE_localStoreAcknowledgeBatch(e,t){var n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var _$r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return(function __PRIVATE_applyWriteToRemoteDocuments(e,t,n,r){var i=n.batch,s=i.keys();var o=PersistencePromise.resolve();return s.forEach(function(e){o=o.next(function(){return r.getEntry(t,e)}).next(function(t){var s=n.docVersions.get(e);__PRIVATE_hardAssert(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(function(){return e.mutationQueue.removeMutationBatch(t,i)})})(n,e,t,i).next(function(){return i.apply(e)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,_$r,t.batch.batchId)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function __PRIVATE_getKeysWithTransformResults(e){var _$t=__PRIVATE_documentKeySet();for(var n=0;n<e.mutationResults.length;++n){e.mutationResults[n].transformResults.length>0&&(_$t=_$t.add(e.batch.mutations[n].key))}return _$t}(t))}).next(function(){return n.localDocuments.getDocuments(e,_$r)})})}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e){var t=__PRIVATE_debugCast(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.Qr.getLastRemoteSnapshotVersion(e)})}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(e,t){var n=__PRIVATE_debugCast(e),_$r=t.snapshotVersion;var i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(e){var s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;var o=[];t.targetChanges.forEach(function(s,_){var a=i.get(_);if(!a)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,_).next(function(){return n.Qr.addMatchingKeys(e,s.addedDocuments,_)}));var u=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(_)?u=u.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,_$r)),i=i.insert(_,u),function __PRIVATE_shouldPersistTargetData(e,t,n){if(0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,s)&&o.push(n.Qr.updateTargetData(e,u))});var _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();if(t.documentUpdates.forEach(function(r){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(__PRIVATE_populateDocumentChangeBuffer(e,s,t.documentUpdates).next(function(e){_=e.cs,a=e.ls})),!_$r.isEqual(SnapshotVersion.min())){var _$t=n.Qr.getLastRemoteSnapshotVersion(e).next(function(t){return n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,_$r)});o.push(_$t)}return PersistencePromise.waitFor(o).next(function(){return s.apply(e)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(e,_,a)}).next(function(){return _})}).then(function(e){return n.ns=i,e})}function __PRIVATE_populateDocumentChangeBuffer(e,t,n){var _$r=__PRIVATE_documentKeySet(),i=__PRIVATE_documentKeySet();return n.forEach(function(e){return _$r=_$r.add(e)}),t.getEntries(e,_$r).next(function(e){var _$r=__PRIVATE_mutableDocumentMap();return n.forEach(function(n,s){var o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(SnapshotVersion.min())?(t.removeEntry(n,s.readTime),_$r=_$r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),_$r=_$r.insert(n,s)):__PRIVATE_logDebug("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{cs:_$r,ls:i}})}function __PRIVATE_localStoreGetNextMutationBatch(e,t){var n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)})}function __PRIVATE_localStoreAllocateTarget(e,t){var n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Allocate target","readwrite",function(e){var _$r;return n.Qr.getTargetData(e,t).next(function(i){return i?(_$r=i,PersistencePromise.resolve(_$r)):n.Qr.allocateTargetId(e).next(function(i){return _$r=new TargetData(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,_$r).next(function(){return _$r})})})}).then(function(e){var _$r=n.ns.get(e.targetId);return(null===_$r||e.snapshotVersion.compareTo(_$r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e})}function __PRIVATE_localStoreReleaseTarget(e,t,n){return ___PRIVATE_localStoreReleaseTarget.apply(this,arguments)}function ___PRIVATE_localStoreReleaseTarget(){___PRIVATE_localStoreReleaseTarget=_async_to_generator$3(function(e,t,n){var _$r,i,s,_tmp,e1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_debugCast(e),i=_$r.ns.get(t),s=n?"readwrite":"readwrite-primary";_state.label=1;case 1:_state.trys.push([1,4,,5]);_tmp=n;if(_tmp)return[3,3];return[4,_$r.persistence.runTransaction("Release target",s,function(e){return _$r.persistence.referenceDelegate.removeTarget(e,i)})];case 2:_tmp=_state.sent();_state.label=3;case 3:return[3,5];case 4:e1=_state.sent();if(!__PRIVATE_isIndexedDbTransactionError(e1))throw e1;__PRIVATE_logDebug("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e1));return[3,5];case 5:_$r.ns=_$r.ns.remove(t),_$r.rs.delete(i.target);return[2]}})});return ___PRIVATE_localStoreReleaseTarget.apply(this,arguments)}function __PRIVATE_localStoreExecuteQuery(e,t,n){var _$r=__PRIVATE_debugCast(e);var i=SnapshotVersion.min(),s=__PRIVATE_documentKeySet();return _$r.persistence.runTransaction("Execute query","readwrite",function(e){return(function __PRIVATE_localStoreGetTargetData(e,t,n){var _$r=__PRIVATE_debugCast(e),i=_$r.rs.get(n);return void 0!==i?PersistencePromise.resolve(_$r.ns.get(i)):_$r.Qr.getTargetData(t,n)})(_$r,e,__PRIVATE_queryToTarget(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,_$r.Qr.getMatchingKeysForTargetId(e,t.targetId).next(function(e){s=e})}).next(function(){return _$r.ts.getDocumentsMatchingQuery(e,t,n?i:SnapshotVersion.min(),n?s:__PRIVATE_documentKeySet())}).next(function(e){return __PRIVATE_setMaxReadTime(_$r,__PRIVATE_queryCollectionGroup(t),e),{documents:e,hs:s}})})}function __PRIVATE_localStoreGetCachedTarget(e,t){var n=__PRIVATE_debugCast(e),_$r=__PRIVATE_debugCast(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(e){return _$r._t(e,t).next(function(e){return e?e.target:null})})}function __PRIVATE_localStoreGetNewDocumentChanges(e,t){var n=__PRIVATE_debugCast(e),_$r=n.ss.get(t)||SnapshotVersion.min();return n.persistence.runTransaction("Get new document changes","readonly",function(e){return n.os.getAllFromCollectionGroup(e,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(_$r,-1),Number.MAX_SAFE_INTEGER)}).then(function(e){return __PRIVATE_setMaxReadTime(n,t,e),e})}function __PRIVATE_setMaxReadTime(e,t,n){var _$r=e.ss.get(t)||SnapshotVersion.min();n.forEach(function(e,t){t.readTime.compareTo(_$r)>0&&(_$r=t.readTime)}),e.ss.set(t,_$r)}function __PRIVATE_localStoreApplyBundledDocuments(e,t,n,r){return ___PRIVATE_localStoreApplyBundledDocuments.apply(this,arguments)}function ___PRIVATE_localStoreApplyBundledDocuments(){___PRIVATE_localStoreApplyBundledDocuments=_async_to_generator$3(function(e,t,n,r){var i,s,o,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$e,_$n,_$r,_,a;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:i=__PRIVATE_debugCast(e);s=__PRIVATE_documentKeySet(),o=__PRIVATE_mutableDocumentMap();_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=n[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_$e=_step.value;_$n=t.Ps(_$e.metadata.name);_$e.document&&(s=s.add(_$n));_$r=t.Is(_$e);_$r.setReadTime(t.Ts(_$e.metadata.readTime)),o=o.insert(_$n,_$r)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_=i.os.newChangeBuffer({trackRemovals:!0});return[4,__PRIVATE_localStoreAllocateTarget(i,function __PRIVATE_umbrellaTarget(e){return __PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(ResourcePath.fromString("__bundle__/docs/".concat(e))))}(r))];case 1:a=_state.sent();return[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return __PRIVATE_populateDocumentChangeBuffer(e,_,o).next(function(t){return _.apply(e),t}).next(function(t){return i.Qr.removeMatchingKeysForTargetId(e,a.targetId).next(function(){return i.Qr.addMatchingKeys(e,s,a.targetId)}).next(function(){return i.localDocuments.getLocalViewOfDocuments(e,t.cs,t.ls)}).next(function(){return t.cs})})})]}})});return ___PRIVATE_localStoreApplyBundledDocuments.apply(this,arguments)}function __PRIVATE_localStoreSaveNamedQuery(e,t){return ___PRIVATE_localStoreSaveNamedQuery.apply(this,arguments)}function ___PRIVATE_localStoreSaveNamedQuery(){___PRIVATE_localStoreSaveNamedQuery=_async_to_generator$3(function(e,t){var n,_$r,i;var _arguments=arguments;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:__PRIVATE_documentKeySet();return[4,__PRIVATE_localStoreAllocateTarget(e,__PRIVATE_queryToTarget(__PRIVATE_fromBundledQuery(t.bundledQuery)))];case 1:_$r=_state.sent(),i=__PRIVATE_debugCast(e);return[2,i.persistence.runTransaction("Save named query","readwrite",function(e){var s=__PRIVATE_fromVersion(t.readTime);if(_$r.snapshotVersion.compareTo(s)>=0)return i.$r.saveNamedQuery(e,t);var o=_$r.withResumeToken(ByteString.EMPTY_BYTE_STRING,s);return i.ns=i.ns.insert(o.targetId,o),i.Qr.updateTargetData(e,o).next(function(){return i.Qr.removeMatchingKeysForTargetId(e,_$r.targetId)}).next(function(){return i.Qr.addMatchingKeys(e,n,_$r.targetId)}).next(function(){return i.$r.saveNamedQuery(e,t)})})]}})});return ___PRIVATE_localStoreSaveNamedQuery.apply(this,arguments)}function createWebStorageClientStateKey(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function createWebStorageMutationBatchKey(e,t,n){var _$r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(_$r+="_".concat(t.uid)),_$r}function createWebStorageQueryTargetMetadataKey(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var __PRIVATE_MutationMetadata=function(){function __PRIVATE_MutationMetadata(e,t,n,r){_class_call_check$1(this,__PRIVATE_MutationMetadata);this.user=e,this.batchId=t,this.state=n,this.error=r}_create_class$1(__PRIVATE_MutationMetadata,[{key:"ds",value:function ds(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Es",value:function Es(e,t,n){var _$r=JSON.parse(n);var i,s="object"==typeof _$r&&-1!==["pending","acknowledged","rejected"].indexOf(_$r.state)&&(void 0===_$r.error||"object"==typeof _$r.error);return s&&_$r.error&&(s="string"==typeof _$r.error.message&&"string"==typeof _$r.error.code,s&&(i=new FirestoreError(_$r.error.code,_$r.error.message))),s?new __PRIVATE_MutationMetadata(e,t,_$r.state,i):(__PRIVATE_logError("SharedClientState","Failed to parse mutation state for ID '".concat(t,"': ").concat(n)),null)}}]);return __PRIVATE_MutationMetadata}();var __PRIVATE_QueryTargetMetadata=function(){function __PRIVATE_QueryTargetMetadata(e,t,n){_class_call_check$1(this,__PRIVATE_QueryTargetMetadata);this.targetId=e,this.state=t,this.error=n}_create_class$1(__PRIVATE_QueryTargetMetadata,[{key:"ds",value:function ds(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Es",value:function Es(e,t){var n=JSON.parse(t);var _$r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(_$r=new FirestoreError(n.error.code,n.error.message))),i?new __PRIVATE_QueryTargetMetadata(e,n.state,_$r):(__PRIVATE_logError("SharedClientState","Failed to parse target state for ID '".concat(e,"': ").concat(t)),null)}}]);return __PRIVATE_QueryTargetMetadata}();var __PRIVATE_RemoteClientState=function(){function __PRIVATE_RemoteClientState(e,t){_class_call_check$1(this,__PRIVATE_RemoteClientState);this.clientId=e,this.activeTargetIds=t}_create_class$1(__PRIVATE_RemoteClientState,null,[{key:"Es",value:function Es(e,t){var n=JSON.parse(t);var _$r="object"==typeof n&&_instanceof$1(n.activeTargetIds,Array),i=__PRIVATE_targetIdSet();for(var _$e=0;_$r&&_$e<n.activeTargetIds.length;++_$e)_$r=isSafeInteger(n.activeTargetIds[_$e]),i=i.add(n.activeTargetIds[_$e]);return _$r?new __PRIVATE_RemoteClientState(e,i):(__PRIVATE_logError("SharedClientState","Failed to parse client data for instance '".concat(e,"': ").concat(t)),null)}}]);return __PRIVATE_RemoteClientState}();var __PRIVATE_SharedOnlineState=function(){function __PRIVATE_SharedOnlineState(e,t){_class_call_check$1(this,__PRIVATE_SharedOnlineState);this.clientId=e,this.onlineState=t}_create_class$1(__PRIVATE_SharedOnlineState,null,[{key:"Es",value:function Es(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new __PRIVATE_SharedOnlineState(t.clientId,t.onlineState):(__PRIVATE_logError("SharedClientState","Failed to parse online state: ".concat(e)),null)}}]);return __PRIVATE_SharedOnlineState}();var __PRIVATE_LocalClientState=function(){function __PRIVATE_LocalClientState(){_class_call_check$1(this,__PRIVATE_LocalClientState);this.activeTargetIds=__PRIVATE_targetIdSet()}_create_class$1(__PRIVATE_LocalClientState,[{key:"As",value:function As(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Rs",value:function Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"ds",value:function ds(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]);return __PRIVATE_LocalClientState}();var __PRIVATE_WebStorageSharedClientState=function(){function __PRIVATE_WebStorageSharedClientState(e,t,n,r,i){_class_call_check$1(this,__PRIVATE_WebStorageSharedClientState);this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new SortedMap(__PRIVATE_primitiveComparator),this.started=!1,this.ys=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=createWebStorageClientStateKey(this.persistenceKey,this.Vs),this.Ss=function createWebStorageSequenceNumberKey(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new __PRIVATE_LocalClientState),this.bs=new RegExp("^firestore_clients_".concat(s,"_([^_]*)$")),this.Ds=new RegExp("^firestore_mutations_".concat(s,"_(\\d+)(?:_(.*))?$")),this.Cs=new RegExp("^firestore_targets_".concat(s,"_(\\d+)$")),this.vs=function createWebStorageOnlineStateKey(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Fs=function createBundleLoadedKey(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}_create_class$1(__PRIVATE_WebStorageSharedClientState,[{key:"start",value:function start(){var _this=this;return _async_to_generator$3(function(){var e,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,t,e1,n,t1,e2,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_iterator1,_step1,e3;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_this.syncEngine.Li()];case 1:e=_state.sent();_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=e[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){t=_step.value;if(t===_this.Vs)continue;e1=_this.getItem(createWebStorageClientStateKey(_this.persistenceKey,t));if(e1){n=__PRIVATE_RemoteClientState.Es(t,e1);n&&(_this.ps=_this.ps.insert(n.clientId,n))}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_this.Ms();t1=_this.storage.getItem(_this.vs);if(t1){e2=_this.xs(t1);e2&&_this.Os(e2)}_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(_iterator1=_this.ys[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){e3=_step1.value;_this.gs(e3)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}_this.ys=[],_this.window.addEventListener("pagehide",function(){return _this.shutdown()}),_this.started=!0;return[2]}})})()}},{key:"writeSequenceNumber",value:function writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function getAllActiveQueryTargets(){return this.Ns(this.ps)}},{key:"isActiveQueryTarget",value:function isActiveQueryTarget(e){var t=!1;return this.ps.forEach(function(n,r){r.activeTargetIds.has(e)&&(t=!0)}),t}},{key:"addPendingMutation",value:function addPendingMutation(e){this.Bs(e,"pending")}},{key:"updateMutationState",value:function updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}},{key:"addLocalQueryTarget",value:function addLocalQueryTarget(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,e));if(n){var _$r=__PRIVATE_QueryTargetMetadata.Es(e,n);_$r&&(t=_$r.state)}}return this.ks.As(e),this.Ms(),t}},{key:"removeLocalQueryTarget",value:function removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}},{key:"isLocalQueryTarget",value:function isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}},{key:"clearQueryState",value:function clearQueryState(e){this.removeItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,e))}},{key:"updateQueryState",value:function updateQueryState(e,t,n){this.qs(e,t,n)}},{key:"handleUserChange",value:function handleUserChange(e,t,n){var _this=this;t.forEach(function(e){_this.Ls(e)}),this.currentUser=e,n.forEach(function(e){_this.addPendingMutation(e)})}},{key:"setOnlineState",value:function setOnlineState(e){this.Qs(e)}},{key:"notifyBundleLoaded",value:function notifyBundleLoaded(e){this.Ks(e)}},{key:"shutdown",value:function shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}},{key:"getItem",value:function getItem(e){var t=this.storage.getItem(e);return __PRIVATE_logDebug("SharedClientState","READ",e,t),t}},{key:"setItem",value:function setItem(e,t){__PRIVATE_logDebug("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function removeItem(e){__PRIVATE_logDebug("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"gs",value:function gs(e){var t=e;if(t.storageArea===this.storage){if(__PRIVATE_logDebug("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void __PRIVATE_logError("Received WebStorage notification for local change. Another client might have garbage-collected our state");var _this=this;this.oi.enqueueRetryable(_async_to_generator$3(function(){var _$e,_$e1,_$e2,_$e3,_$e4,_$e5,_$e6;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!_this.started)return[3,8];if(!(null!==t.key))return[3,7];if(!_this.bs.test(t.key))return[3,1];if(null==t.newValue){_$e=_this.$s(t.key);return[2,_this.Us(_$e,null)]}{_$e1=_this.Ws(t.key,t.newValue);if(_$e1)return[2,_this.Us(_$e1.clientId,_$e1)]}return[3,7];case 1:if(!_this.Ds.test(t.key))return[3,2];if(null!==t.newValue){_$e2=_this.Gs(t.key,t.newValue);if(_$e2)return[2,_this.zs(_$e2)]}return[3,7];case 2:if(!_this.Cs.test(t.key))return[3,3];if(null!==t.newValue){_$e3=_this.js(t.key,t.newValue);if(_$e3)return[2,_this.Hs(_$e3)]}return[3,7];case 3:if(!(t.key===_this.vs))return[3,4];if(null!==t.newValue){_$e4=_this.xs(t.newValue);if(_$e4)return[2,_this.Os(_$e4)]}return[3,7];case 4:if(!(t.key===_this.Ss))return[3,5];_$e5=function __PRIVATE_fromWebStorageSequenceNumber(e){var t=__PRIVATE_ListenSequence._e;if(null!=e)try{var n=JSON.parse(e);__PRIVATE_hardAssert("number"==typeof n),t=n}catch(e){__PRIVATE_logError("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);_$e5!==__PRIVATE_ListenSequence._e&&_this.sequenceNumberHandler(_$e5);return[3,7];case 5:if(!(t.key===_this.Fs))return[3,7];_$e6=_this.Js(t.newValue);return[4,Promise.all(_$e6.map(function(e){return _this.syncEngine.Ys(e)}))];case 6:_state.sent();_state.label=7;case 7:return[3,9];case 8:_this.ys.push(t);_state.label=9;case 9:return[2]}})}))}}},{key:"ks",get:function get(){return this.ps.get(this.Vs)}},{key:"Ms",value:function Ms(){this.setItem(this.ws,this.ks.ds())}},{key:"Bs",value:function Bs(e,t,n){var _$r=new __PRIVATE_MutationMetadata(this.currentUser,e,t,n),i=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,e);this.setItem(i,_$r.ds())}},{key:"Ls",value:function Ls(e){var t=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Qs",value:function Qs(e){var t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}},{key:"qs",value:function qs(e,t,n){var _$r=createWebStorageQueryTargetMetadataKey(this.persistenceKey,e),i=new __PRIVATE_QueryTargetMetadata(e,t,n);this.setItem(_$r,i.ds())}},{key:"Ks",value:function Ks(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}},{key:"$s",value:function $s(e){var t=this.bs.exec(e);return t?t[1]:null}},{key:"Ws",value:function Ws(e,t){var n=this.$s(e);return __PRIVATE_RemoteClientState.Es(n,t)}},{key:"Gs",value:function Gs(e,t){var n=this.Ds.exec(e),_$r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return __PRIVATE_MutationMetadata.Es(new User(i),_$r,t)}},{key:"js",value:function js(e,t){var n=this.Cs.exec(e),_$r=Number(n[1]);return __PRIVATE_QueryTargetMetadata.Es(_$r,t)}},{key:"xs",value:function xs(e){return __PRIVATE_SharedOnlineState.Es(e)}},{key:"Js",value:function Js(e){return JSON.parse(e)}},{key:"zs",value:function zs(e){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){if(e.user.uid===_this.currentUser.uid)return[2,_this.syncEngine.Zs(e.batchId,e.state,e.error)];__PRIVATE_logDebug("SharedClientState","Ignoring mutation for non-active user ".concat(e.user.uid));return[2]})})()}},{key:"Hs",value:function Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}},{key:"Us",value:function Us(e,t){var _this=this;var n=t?this.ps.insert(e,t):this.ps.remove(e),_$r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach(function(e){_$r.has(e)||s.push(e)}),_$r.forEach(function(e){i.has(e)||o.push(e)}),this.syncEngine.eo(s,o).then(function(){_this.ps=n})}},{key:"Os",value:function Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"Ns",value:function Ns(e){var t=__PRIVATE_targetIdSet();return e.forEach(function(e,n){t=t.unionWith(n.activeTargetIds)}),t}}],[{key:"D",value:function D(e){return!(!e||!e.localStorage)}}]);return __PRIVATE_WebStorageSharedClientState}();var __PRIVATE_MemorySharedClientState=function(){function __PRIVATE_MemorySharedClientState(){_class_call_check$1(this,__PRIVATE_MemorySharedClientState);this.no=new __PRIVATE_LocalClientState,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}_create_class$1(__PRIVATE_MemorySharedClientState,[{key:"addPendingMutation",value:function addPendingMutation(e){}},{key:"updateMutationState",value:function updateMutationState(e,t,n){}},{key:"addLocalQueryTarget",value:function addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}},{key:"updateQueryState",value:function updateQueryState(e,t,n){this.ro[e]=t}},{key:"removeLocalQueryTarget",value:function removeLocalQueryTarget(e){this.no.Rs(e)}},{key:"isLocalQueryTarget",value:function isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}},{key:"clearQueryState",value:function clearQueryState(e){delete this.ro[e]}},{key:"getAllActiveQueryTargets",value:function getAllActiveQueryTargets(){return this.no.activeTargetIds}},{key:"isActiveQueryTarget",value:function isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}},{key:"start",value:function start(){return this.no=new __PRIVATE_LocalClientState,Promise.resolve()}},{key:"handleUserChange",value:function handleUserChange(e,t,n){}},{key:"setOnlineState",value:function setOnlineState(e){}},{key:"shutdown",value:function shutdown(){}},{key:"writeSequenceNumber",value:function writeSequenceNumber(e){}},{key:"notifyBundleLoaded",value:function notifyBundleLoaded(e){}}]);return __PRIVATE_MemorySharedClientState}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_NoopConnectivityMonitor=function(){function __PRIVATE_NoopConnectivityMonitor(){_class_call_check$1(this,__PRIVATE_NoopConnectivityMonitor)}_create_class$1(__PRIVATE_NoopConnectivityMonitor,[{key:"io",value:function io(e){}},{key:"shutdown",value:function shutdown(){}}]);return __PRIVATE_NoopConnectivityMonitor}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_BrowserConnectivityMonitor=function(){function __PRIVATE_BrowserConnectivityMonitor(){var _this=this;_class_call_check$1(this,__PRIVATE_BrowserConnectivityMonitor);this.so=function(){return _this.oo()},this._o=function(){return _this.ao()},this.uo=[],this.co()}_create_class$1(__PRIVATE_BrowserConnectivityMonitor,[{key:"io",value:function io(e){this.uo.push(e)}},{key:"shutdown",value:function shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}},{key:"co",value:function co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}},{key:"oo",value:function oo(){__PRIVATE_logDebug("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.uo[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var e=_step.value;e(0)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"ao",value:function ao(){__PRIVATE_logDebug("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.uo[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var e=_step.value;e(1)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}],[{key:"D",value:function D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]);return __PRIVATE_BrowserConnectivityMonitor}();/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ae=null;function __PRIVATE_generateUniqueDebugId(){return null===Ae?Ae=function __PRIVATE_generateInitialUniqueDebugId(){return 268435456+Math.round(2147483648*Math.random())}():Ae++,"0x"+Ae.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Re={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_StreamBridge=function(){function __PRIVATE_StreamBridge(e){_class_call_check$1(this,__PRIVATE_StreamBridge);this.lo=e.lo,this.ho=e.ho}_create_class$1(__PRIVATE_StreamBridge,[{key:"Po",value:function Po(e){this.Io=e}},{key:"To",value:function To(e){this.Eo=e}},{key:"onMessage",value:function onMessage(e){this.Ao=e}},{key:"close",value:function close(){this.ho()}},{key:"send",value:function send(e){this.lo(e)}},{key:"Ro",value:function Ro(){this.Io()}},{key:"Vo",value:function Vo(e){this.Eo(e)}},{key:"mo",value:function mo(e){this.Ao(e)}}]);return __PRIVATE_StreamBridge}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ve="WebChannelConnection";var __PRIVATE_WebChannelConnection=function(__PRIVATE_RestConnection){_inherits$1(__PRIVATE_WebChannelConnection,__PRIVATE_RestConnection);var _super=_create_super$1(__PRIVATE_WebChannelConnection);function __PRIVATE_WebChannelConnection(e){_class_call_check$1(this,__PRIVATE_WebChannelConnection);var _this;_this=_super.call(this,e),_this.forceLongPolling=e.forceLongPolling,_this.autoDetectLongPolling=e.autoDetectLongPolling,_this.useFetchStreams=e.useFetchStreams,_this.longPollingOptions=e.longPollingOptions;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_WebChannelConnection,[{key:"Co",value:function Co(e,t,n,r){var i=__PRIVATE_generateUniqueDebugId();return new Promise(function(s,o){var _=new XhrIo;_.setWithCredentials(!0),_.listenOnce(EventType.COMPLETE,function(){try{switch(_.getLastErrorCode()){case ErrorCode.NO_ERROR:var _$t=_.getResponseJson();__PRIVATE_logDebug(Ve,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(_$t)),s(_$t);break;case ErrorCode.TIMEOUT:__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' ").concat(i," timed out")),o(new FirestoreError(D.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:var _$n=_.getStatus();if(__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' ").concat(i," failed with status:"),_$n,"response text:",_.getResponseText()),_$n>0){var _$e=_.getResponseJson();Array.isArray(_$e)&&(_$e=_$e[0]);var _$t1=null==_$e?void 0:_$e.error;if(_$t1&&_$t1.status&&_$t1.message){var _$e1=function __PRIVATE_mapCodeFromHttpResponseErrorStatus(e){var _$t=e.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(_$t)>=0?_$t:D.UNKNOWN}(_$t1.status);o(new FirestoreError(_$e1,_$t1.message))}else o(new FirestoreError(D.UNKNOWN,"Server responded with status "+_.getStatus()))}else o(new FirestoreError(D.UNAVAILABLE,"Connection failed."));break;default:fail()}}finally{__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' ").concat(i," completed."))}});var a=JSON.stringify(r);__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' ").concat(i," sending request:"),r),_.send(t,"POST",a,n,15)})}},{key:"Fo",value:function Fo(e,t,n){var _$r=__PRIVATE_generateUniqueDebugId(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=createWebChannelTransport(),o=getStatEventTarget(),_={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(_.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(_.useFetchStreams=!0),this.Do(_.initMessageHeaders,t,n),_.encodeInitMessageHeaders=!0;var u=i.join("");__PRIVATE_logDebug(Ve,"Creating RPC '".concat(e,"' stream ").concat(_$r,": ").concat(u),_);var c=s.createWebChannel(u,_);var l=!1,h=!1;var _$P=new __PRIVATE_StreamBridge({lo:function lo(t){h?__PRIVATE_logDebug(Ve,"Not sending because RPC '".concat(e,"' stream ").concat(_$r," is closed:"),t):(l||(__PRIVATE_logDebug(Ve,"Opening RPC '".concat(e,"' stream ").concat(_$r," transport.")),c.open(),l=!0),__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," sending:"),t),c.send(t))},ho:function ho(){return c.close()}}),__PRIVATE_unguardedEventListen=function __PRIVATE_unguardedEventListen(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return __PRIVATE_unguardedEventListen(c,WebChannel.EventType.OPEN,function(){h||__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," transport opened."))}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.CLOSE,function(){h||(h=!0,__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," transport closed")),_$P.Vo())}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.ERROR,function(t){h||(h=!0,__PRIVATE_logWarn(Ve,"RPC '".concat(e,"' stream ").concat(_$r," transport errored:"),t),_$P.Vo(new FirestoreError(D.UNAVAILABLE,"The operation could not be completed")))}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.MESSAGE,function(t){var _$n;if(!h){var i=t.data[0];__PRIVATE_hardAssert(!!i);var s=i,o=s.error||(null===(_$n=s[0])||void 0===_$n?void 0:_$n.error);if(o){__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," received error:"),o);var _$t=o.status;var _$n1=function __PRIVATE_mapCodeFromRpcStatus(e){var _$t=ae[e];if(void 0!==_$t)return __PRIVATE_mapCodeFromRpcCode(_$t)}(_$t),i1=o.message;void 0===_$n1&&(_$n1=D.INTERNAL,i1="Unknown error status: "+_$t+" with message "+o.message),h=!0,_$P.Vo(new FirestoreError(_$n1,i1)),c.close()}else __PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," received:"),i),_$P.mo(i)}}),__PRIVATE_unguardedEventListen(o,Event.STAT_EVENT,function(t){t.stat===Stat.PROXY?__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," detected buffering proxy")):t.stat===Stat.NOPROXY&&__PRIVATE_logDebug(Ve,"RPC '".concat(e,"' stream ").concat(_$r," detected no buffering proxy"))}),setTimeout(function(){_$P.Ro()},0),_$P}}]);return __PRIVATE_WebChannelConnection}(function(){function __PRIVATE_RestConnection(e){_class_call_check$1(this,__PRIVATE_RestConnection);this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),_$r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po="projects/".concat(n,"/databases/").concat(_$r),this.yo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(_$r)}_create_class$1(__PRIVATE_RestConnection,[{key:"wo",get:function get(){return!1}},{key:"So",value:function So(e,t,n,r,i){var s=__PRIVATE_generateUniqueDebugId(),o=this.bo(e,t.toUriEncodedString());__PRIVATE_logDebug("RestConnection","Sending RPC '".concat(e,"' ").concat(s,":"),o,n);var _={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(_,r,i),this.Co(e,o,_,n).then(function(t){return __PRIVATE_logDebug("RestConnection","Received RPC '".concat(e,"' ").concat(s,": "),t),t},function(t){throw __PRIVATE_logWarn("RestConnection","RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",o,"request:",n),t})}},{key:"vo",value:function vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}},{key:"Do",value:function Do(e,t,n){e["X-Goog-Api-Client"]=function __PRIVATE_getGoogApiClientValue(){return"gl-js/ fire/"+S}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(function(t,n){return e[n]=t}),n&&n.headers.forEach(function(t,n){return e[n]=t})}},{key:"bo",value:function bo(e,t){var n=Re[e];return"".concat(this.fo,"/v1/").concat(t,":").concat(n)}},{key:"terminate",value:function terminate(){}}]);return __PRIVATE_RestConnection}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_getWindow(){return"undefined"!=typeof window?window:null}function getDocument(){return"undefined"!=typeof document?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newSerializer(e){return new JsonProtoSerializer(e,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_ExponentialBackoff=function(){function __PRIVATE_ExponentialBackoff(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,_$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1.5,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:6e4;_class_call_check$1(this,__PRIVATE_ExponentialBackoff);this.oi=e,this.timerId=t,this.Mo=n,this.xo=_$r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}_create_class$1(__PRIVATE_ExponentialBackoff,[{key:"reset",value:function reset(){this.No=0}},{key:"ko",value:function ko(){this.No=this.Oo}},{key:"qo",value:function qo(e){var _this=this;this.cancel();var t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),_$r=Math.max(0,t-n);_$r>0&&__PRIVATE_logDebug("ExponentialBackoff","Backing off for ".concat(_$r," ms (base delay: ").concat(this.No," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.Bo=this.oi.enqueueAfterDelay(this.timerId,_$r,function(){return _this.Lo=Date.now(),e()}),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}},{key:"Ko",value:function Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}},{key:"cancel",value:function cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}},{key:"Qo",value:function Qo(){return(Math.random()-.5)*this.No}}]);return __PRIVATE_ExponentialBackoff}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_PersistentStream=function(){function __PRIVATE_PersistentStream(e,t,n,r,i,s,o,_){_class_call_check$1(this,__PRIVATE_PersistentStream);this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=_,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new __PRIVATE_ExponentialBackoff(e,t)}_create_class$1(__PRIVATE_PersistentStream,[{key:"Ho",value:function Ho(){return 1===this.state||5===this.state||this.Jo()}},{key:"Jo",value:function Jo(){return 2===this.state||3===this.state}},{key:"start",value:function start(){4!==this.state?this.auth():this.Yo()}},{key:"stop",value:function stop(){var _this=this;return _async_to_generator$3(function(){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=_this.Ho();if(!_tmp)return[3,2];return[4,_this.close(0)];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})})()}},{key:"Zo",value:function Zo(){this.state=0,this.jo.reset()}},{key:"Xo",value:function Xo(){var _this=this;this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,function(){return _this.e_()}))}},{key:"t_",value:function t_(e){this.n_(),this.stream.send(e)}},{key:"e_",value:function e_(){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){if(_this.Jo())return[2,_this.close(0)];return[2]})})()}},{key:"n_",value:function n_(){this.Go&&(this.Go.cancel(),this.Go=null)}},{key:"r_",value:function r_(){this.zo&&(this.zo.cancel(),this.zo=null)}},{key:"close",value:function close(e,t){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_this.n_(),_this.r_(),_this.jo.cancel(),_this.Wo++,4!==e?_this.jo.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(__PRIVATE_logError(t.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),_this.jo.ko()):t&&t.code===D.UNAUTHENTICATED&&3!==_this.state&&(_this.authCredentialsProvider.invalidateToken(),_this.appCheckCredentialsProvider.invalidateToken()),null!==_this.stream&&(_this.i_(),_this.stream.close(),_this.stream=null),_this.state=e;return[4,_this.listener.To(t)];case 1:_state.sent();return[2]}})})()}},{key:"i_",value:function i_(){}},{key:"auth",value:function auth(){var _this=this;this.state=1;var e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(param){var _param=_sliced_to_array$1(param,2),e=_param[0],n=_param[1];_this.Wo===t&&_this.o_(e,n)},function(t){e(function(){var e=new FirestoreError(D.UNKNOWN,"Fetching auth token failed: "+t.message);return _this.__(e)})})}},{key:"o_",value:function o_(e,t){var _this=this;var n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(function(){n(function(){return _this.state=2,_this.zo=_this.oi.enqueueAfterDelay(_this.Uo,1e4,function(){return _this.Jo()&&(_this.state=3),Promise.resolve()}),_this.listener.Po()})}),this.stream.To(function(e){n(function(){return _this.__(e)})}),this.stream.onMessage(function(e){n(function(){return _this.onMessage(e)})})}},{key:"Yo",value:function Yo(){var _this=this;this.state=5,this.jo.qo(_async_to_generator$3(function(){return _ts_generator$1(this,function(_state){_this.state=0,_this.start();return[2]})}))}},{key:"__",value:function __(e){return __PRIVATE_logDebug("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"s_",value:function s_(e){var _this=this;return function(t){_this.oi.enqueueAndForget(function(){return _this.Wo===e?t():(__PRIVATE_logDebug("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]);return __PRIVATE_PersistentStream}();var __PRIVATE_PersistentListenStream=function(__PRIVATE_PersistentStream){_inherits$1(__PRIVATE_PersistentListenStream,__PRIVATE_PersistentStream);var _super=_create_super$1(__PRIVATE_PersistentListenStream);function __PRIVATE_PersistentListenStream(e,t,n,r,i,s){_class_call_check$1(this,__PRIVATE_PersistentListenStream);var _this;_this=_super.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),_this.serializer=i;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_PersistentListenStream,[{key:"a_",value:function a_(e,t){return this.connection.Fo("Listen",e,t)}},{key:"onMessage",value:function onMessage(e){this.jo.reset();var t=__PRIVATE_fromWatchChange(this.serializer,e),n=function __PRIVATE_versionFromListenResponse(e){if(!("targetChange"in e))return SnapshotVersion.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?SnapshotVersion.min():t.readTime?__PRIVATE_fromVersion(t.readTime):SnapshotVersion.min()}(e);return this.listener.u_(t,n)}},{key:"c_",value:function c_(e){var t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.addTarget=function __PRIVATE_toTarget(e,t){var n;var _$r=t.target;if(n=__PRIVATE_targetIsDocumentTarget(_$r)?{documents:__PRIVATE_toDocumentsTarget(e,_$r)}:{query:__PRIVATE_toQueryTarget(e,_$r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=__PRIVATE_toBytes(e,t.resumeToken);var r1=__PRIVATE_toInt32Proto(e,t.expectedCount);null!==r1&&(n.expectedCount=r1)}else if(t.snapshotVersion.compareTo(SnapshotVersion.min())>0){n.readTime=toTimestamp(e,t.snapshotVersion.toTimestamp());var r2=__PRIVATE_toInt32Proto(e,t.expectedCount);null!==r2&&(n.expectedCount=r2)}return n}(this.serializer,e);var n=__PRIVATE_toListenRequestLabels(this.serializer,e);n&&(t.labels=n),this.t_(t)}},{key:"l_",value:function l_(e){var t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.removeTarget=e,this.t_(t)}}]);return __PRIVATE_PersistentListenStream}(__PRIVATE_PersistentStream);var __PRIVATE_PersistentWriteStream=function(__PRIVATE_PersistentStream){_inherits$1(__PRIVATE_PersistentWriteStream,__PRIVATE_PersistentStream);var _super=_create_super$1(__PRIVATE_PersistentWriteStream);function __PRIVATE_PersistentWriteStream(e,t,n,r,i,s){_class_call_check$1(this,__PRIVATE_PersistentWriteStream);var _this;_this=_super.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),_this.serializer=i,_this.h_=!1;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_PersistentWriteStream,[{key:"P_",get:function get(){return this.h_}},{key:"start",value:function start(){this.h_=!1,this.lastStreamToken=void 0,_get$1(_get_prototype_of$1(__PRIVATE_PersistentWriteStream.prototype),"start",this).call(this)}},{key:"i_",value:function i_(){this.h_&&this.I_([])}},{key:"a_",value:function a_(e,t){return this.connection.Fo("Write",e,t)}},{key:"onMessage",value:function onMessage(e){if(__PRIVATE_hardAssert(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();var t=__PRIVATE_fromWriteResults(e.writeResults,e.commitTime),n=__PRIVATE_fromVersion(e.commitTime);return this.listener.T_(n,t)}return __PRIVATE_hardAssert(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}},{key:"d_",value:function d_(){var e={};e.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.t_(e)}},{key:"I_",value:function I_(e){var _this=this;var t={streamToken:this.lastStreamToken,writes:e.map(function(e){return toMutation(_this.serializer,e)})};this.t_(t)}}]);return __PRIVATE_PersistentWriteStream}(__PRIVATE_PersistentStream);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_DatastoreImpl=function(_Datastore){_inherits$1(__PRIVATE_DatastoreImpl,_Datastore);var _super=_create_super$1(__PRIVATE_DatastoreImpl);function __PRIVATE_DatastoreImpl(e,t,n,r){_class_call_check$1(this,__PRIVATE_DatastoreImpl);var _this;_this=_super.call(this),_this.authCredentials=e,_this.appCheckCredentials=t,_this.connection=n,_this.serializer=r,_this.A_=!1;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_DatastoreImpl,[{key:"R_",value:function R_(){if(this.A_)throw new FirestoreError(D.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"So",value:function So(e,t,n,r){var _this=this;return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(param){var _param=_sliced_to_array$1(param,2),i=_param[0],s=_param[1];return _this.connection.So(e,__PRIVATE_toResourcePath(t,n),r,i,s)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===D.UNAUTHENTICATED&&(_this.authCredentials.invalidateToken(),_this.appCheckCredentials.invalidateToken()),e):new FirestoreError(D.UNKNOWN,e.toString())})}},{key:"vo",value:function vo(e,t,n,r,i){var _this=this;return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(param){var _param=_sliced_to_array$1(param,2),s=_param[0],o=_param[1];return _this.connection.vo(e,__PRIVATE_toResourcePath(t,n),r,s,o,i)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===D.UNAUTHENTICATED&&(_this.authCredentials.invalidateToken(),_this.appCheckCredentials.invalidateToken()),e):new FirestoreError(D.UNKNOWN,e.toString())})}},{key:"terminate",value:function terminate(){this.A_=!0,this.connection.terminate()}}]);return __PRIVATE_DatastoreImpl}(function Datastore(){_class_call_check$1(this,Datastore)});var __PRIVATE_OnlineStateTracker=function(){function __PRIVATE_OnlineStateTracker(e,t){_class_call_check$1(this,__PRIVATE_OnlineStateTracker);this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}_create_class$1(__PRIVATE_OnlineStateTracker,[{key:"p_",value:function p_(){var _this=this;0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return _this.f_=null,_this.w_("Backend didn't respond within 10 seconds."),_this.y_("Offline"),Promise.resolve()}))}},{key:"S_",value:function S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.y_("Offline")))}},{key:"set",value:function set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}},{key:"y_",value:function y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"w_",value:function w_(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.g_?(__PRIVATE_logError(t),this.g_=!1):__PRIVATE_logDebug("OnlineStateTracker",t)}},{key:"b_",value:function b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}]);return __PRIVATE_OnlineStateTracker}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_RemoteStoreImpl=function __PRIVATE_RemoteStoreImpl(e,t,n,r,i){var _this=this;_class_call_check$1(this,__PRIVATE_RemoteStoreImpl);this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(function(e){var _this1=_this;n.enqueueAndForget(_async_to_generator$3(function(){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=__PRIVATE_canUseNetwork(_this1);if(!_tmp)return[3,2];__PRIVATE_logDebug("RemoteStore","Restarting streams for network reachability change.");return[4,(function(){var ___PRIVATE_restartNetwork=_async_to_generator$3(function(e){var _$t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$t=__PRIVATE_debugCast(e);_$t.v_.add(4);return[4,__PRIVATE_disableNetworkInternal(_$t)];case 1:_state.sent(),_$t.x_.set("Unknown"),_$t.v_.delete(4);return[4,__PRIVATE_enableNetworkInternal(_$t)];case 2:_state.sent();return[2]}})});function __PRIVATE_restartNetwork(e){return ___PRIVATE_restartNetwork.apply(this,arguments)}return __PRIVATE_restartNetwork})()(_this1)];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})}))}),this.x_=new __PRIVATE_OnlineStateTracker(n,r)};function __PRIVATE_enableNetworkInternal(e){return ___PRIVATE_enableNetworkInternal.apply(this,arguments)}function ___PRIVATE_enableNetworkInternal(){___PRIVATE_enableNetworkInternal=_async_to_generator$3(function(e){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,t,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(!__PRIVATE_canUseNetwork(e))return[3,8];_state.label=1;case 1:_state.trys.push([1,6,7,8]);_iterator=e.F_[Symbol.iterator]();_state.label=2;case 2:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,5];t=_step.value;return[4,t(!0)];case 3:_state.sent();_state.label=4;case 4:_iteratorNormalCompletion=true;return[3,2];case 5:return[3,8];case 6:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,8];case 7:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 8:return[2]}})});return ___PRIVATE_enableNetworkInternal.apply(this,arguments)}function __PRIVATE_disableNetworkInternal(e){return ___PRIVATE_disableNetworkInternal.apply(this,arguments)}function ___PRIVATE_disableNetworkInternal(){___PRIVATE_disableNetworkInternal=_async_to_generator$3(function(e){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,t,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=1;case 1:_state.trys.push([1,6,7,8]);_iterator=e.F_[Symbol.iterator]();_state.label=2;case 2:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,5];t=_step.value;return[4,t(!1)];case 3:_state.sent();_state.label=4;case 4:_iteratorNormalCompletion=true;return[3,2];case 5:return[3,8];case 6:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,8];case 7:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 8:return[2]}})});return ___PRIVATE_disableNetworkInternal.apply(this,arguments)}function __PRIVATE_remoteStoreListen(e,t){var n=__PRIVATE_debugCast(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),__PRIVATE_shouldStartWatchStream(n)?__PRIVATE_startWatchStream(n):__PRIVATE_ensureWatchStream(n).Jo()&&__PRIVATE_sendWatchRequest(n,t))}function __PRIVATE_remoteStoreUnlisten(e,t){var n=__PRIVATE_debugCast(e),_$r=__PRIVATE_ensureWatchStream(n);n.C_.delete(t),_$r.Jo()&&__PRIVATE_sendUnwatchRequest(n,t),0===n.C_.size&&(_$r.Jo()?_$r.Xo():__PRIVATE_canUseNetwork(n)&&n.x_.set("Unknown"))}function __PRIVATE_sendWatchRequest(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(SnapshotVersion.min())>0){var n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}__PRIVATE_ensureWatchStream(e).c_(t)}function __PRIVATE_sendUnwatchRequest(e,t){e.O_.Oe(t),__PRIVATE_ensureWatchStream(e).l_(t)}function __PRIVATE_startWatchStream(e){e.O_=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:function getRemoteKeysForTarget(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},_t:function _t(t){return e.C_.get(t)||null},nt:function nt(){return e.datastore.serializer.databaseId}}),__PRIVATE_ensureWatchStream(e).start(),e.x_.p_()}function __PRIVATE_shouldStartWatchStream(e){return __PRIVATE_canUseNetwork(e)&&!__PRIVATE_ensureWatchStream(e).Ho()&&e.C_.size>0}function __PRIVATE_canUseNetwork(e){return 0===__PRIVATE_debugCast(e).v_.size}function __PRIVATE_cleanUpWatchStreamState(e){e.O_=void 0}function __PRIVATE_onWatchStreamOpen(e){return ___PRIVATE_onWatchStreamOpen.apply(this,arguments)}function ___PRIVATE_onWatchStreamOpen(){___PRIVATE_onWatchStreamOpen=_async_to_generator$3(function(e){return _ts_generator$1(this,function(_state){e.C_.forEach(function(t,n){__PRIVATE_sendWatchRequest(e,t)});return[2]})});return ___PRIVATE_onWatchStreamOpen.apply(this,arguments)}function __PRIVATE_onWatchStreamClose(e,t){return ___PRIVATE_onWatchStreamClose.apply(this,arguments)}function ___PRIVATE_onWatchStreamClose(){___PRIVATE_onWatchStreamClose=_async_to_generator$3(function(e,t){return _ts_generator$1(this,function(_state){__PRIVATE_cleanUpWatchStreamState(e),__PRIVATE_shouldStartWatchStream(e)?(e.x_.S_(t),__PRIVATE_startWatchStream(e)):e.x_.set("Unknown");return[2]})});return ___PRIVATE_onWatchStreamClose.apply(this,arguments)}function __PRIVATE_onWatchStreamChange(e,t,n){return ___PRIVATE_onWatchStreamChange.apply(this,arguments)}function ___PRIVATE_onWatchStreamChange(){___PRIVATE_onWatchStreamChange=_async_to_generator$3(function(e,t,n){var n1,_$t,_tmp,t1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!(e.x_.set("Online"),_instanceof$1(t,__PRIVATE_WatchTargetChange)&&2===t.state&&t.cause))return[3,6];_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,(function(){var ___PRIVATE_handleTargetError=_async_to_generator$3(function(e,t){var _$n,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$r,_tmp,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$n=t.cause;_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=1;case 1:_state.trys.push([1,7,8,9]);_iterator=t.targetIds[Symbol.iterator]();_state.label=2;case 2:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,6];_$r=_step.value;_tmp=e.C_.has(_$r);if(!_tmp)return[3,4];return[4,e.remoteSyncer.rejectListen(_$r,_$n)];case 3:_tmp=(_state.sent(),e.C_.delete(_$r),e.O_.removeTarget(_$r));_state.label=4;case 4:_state.label=5;case 5:_iteratorNormalCompletion=true;return[3,2];case 6:return[3,9];case 7:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,9];case 8:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 9:return[2]}})});function __PRIVATE_handleTargetError(e,t){return ___PRIVATE_handleTargetError.apply(this,arguments)}return __PRIVATE_handleTargetError})()(e,t)];case 2:_state.sent();return[3,5];case 3:n1=_state.sent();__PRIVATE_logDebug("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n1);return[4,__PRIVATE_disableNetworkUntilRecovery(e,n1)];case 4:_state.sent();return[3,5];case 5:return[3,13];case 6:if(!(_instanceof$1(t,__PRIVATE_DocumentWatchChange)?e.O_.$e(t):_instanceof$1(t,__PRIVATE_ExistenceFilterChange)?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(SnapshotVersion.min())))return[3,13];_state.label=7;case 7:_state.trys.push([7,11,,13]);return[4,__PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore)];case 8:_$t=_state.sent();_tmp=n.compareTo(_$t)>=0;if(!_tmp)return[3,10];return[4,function __PRIVATE_raiseWatchSnapshot(e,t){var _$n=e.O_.it(t);return _$n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}}),_$n.targetMismatches.forEach(function(t,n){var _$r=e.C_.get(t);if(!_$r)return;e.C_.set(t,_$r.withResumeToken(ByteString.EMPTY_BYTE_STRING,_$r.snapshotVersion)),__PRIVATE_sendUnwatchRequest(e,t);var i=new TargetData(_$r.target,t,n,_$r.sequenceNumber);__PRIVATE_sendWatchRequest(e,i)}),e.remoteSyncer.applyRemoteEvent(_$n)}(e,n)];case 9:_tmp=_state.sent();_state.label=10;case 10:return[3,13];case 11:t1=_state.sent();__PRIVATE_logDebug("RemoteStore","Failed to raise snapshot:",t1);return[4,__PRIVATE_disableNetworkUntilRecovery(e,t1)];case 12:_state.sent();return[3,13];case 13:return[2]}})});return ___PRIVATE_onWatchStreamChange.apply(this,arguments)}function __PRIVATE_disableNetworkUntilRecovery(e,t,n){return ___PRIVATE_disableNetworkUntilRecovery.apply(this,arguments)}function ___PRIVATE_disableNetworkUntilRecovery(){___PRIVATE_disableNetworkUntilRecovery=_async_to_generator$3(function(e,t,n){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!__PRIVATE_isIndexedDbTransactionError(t))throw t;e.v_.add(1);return[4,__PRIVATE_disableNetworkInternal(e)];case 1:_state.sent(),e.x_.set("Offline"),n||(n=function n(){return __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore)}),e.asyncQueue.enqueueRetryable(_async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:__PRIVATE_logDebug("RemoteStore","Retrying IndexedDB access");return[4,n()];case 1:_state.sent(),e.v_.delete(1);return[4,__PRIVATE_enableNetworkInternal(e)];case 2:_state.sent();return[2]}})}));return[2]}})});return ___PRIVATE_disableNetworkUntilRecovery.apply(this,arguments)}function __PRIVATE_executeWithRecovery(e,t){return t().catch(function(n){return __PRIVATE_disableNetworkUntilRecovery(e,n,t)})}function __PRIVATE_fillWritePipeline(e){return ___PRIVATE_fillWritePipeline.apply(this,arguments)}function ___PRIVATE_fillWritePipeline(){___PRIVATE_fillWritePipeline=_async_to_generator$3(function(e){var t,n,_$r,_$e,e1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:t=__PRIVATE_debugCast(e),n=__PRIVATE_ensureWriteStream(t);_$r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;_state.label=1;case 1:if(!__PRIVATE_canAddToWritePipeline(t))return[3,7];_state.label=2;case 2:_state.trys.push([2,4,,6]);return[4,__PRIVATE_localStoreGetNextMutationBatch(t.localStore,_$r)];case 3:_$e=_state.sent();if(null===_$e){0===t.D_.length&&n.Xo();return[3,7]}_$r=_$e.batchId,__PRIVATE_addToWritePipeline(t,_$e);return[3,6];case 4:e1=_state.sent();return[4,__PRIVATE_disableNetworkUntilRecovery(t,e1)];case 5:_state.sent();return[3,6];case 6:return[3,1];case 7:__PRIVATE_shouldStartWriteStream(t)&&__PRIVATE_startWriteStream(t);return[2]}})});return ___PRIVATE_fillWritePipeline.apply(this,arguments)}function __PRIVATE_canAddToWritePipeline(e){return __PRIVATE_canUseNetwork(e)&&e.D_.length<10}function __PRIVATE_addToWritePipeline(e,t){e.D_.push(t);var n=__PRIVATE_ensureWriteStream(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function __PRIVATE_shouldStartWriteStream(e){return __PRIVATE_canUseNetwork(e)&&!__PRIVATE_ensureWriteStream(e).Ho()&&e.D_.length>0}function __PRIVATE_startWriteStream(e){__PRIVATE_ensureWriteStream(e).start()}function __PRIVATE_onWriteStreamOpen(e){return ___PRIVATE_onWriteStreamOpen.apply(this,arguments)}function ___PRIVATE_onWriteStreamOpen(){___PRIVATE_onWriteStreamOpen=_async_to_generator$3(function(e){return _ts_generator$1(this,function(_state){__PRIVATE_ensureWriteStream(e).d_();return[2]})});return ___PRIVATE_onWriteStreamOpen.apply(this,arguments)}function __PRIVATE_onWriteHandshakeComplete(e){return ___PRIVATE_onWriteHandshakeComplete.apply(this,arguments)}function ___PRIVATE_onWriteHandshakeComplete(){___PRIVATE_onWriteHandshakeComplete=_async_to_generator$3(function(e){var t,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,n;return _ts_generator$1(this,function(_state){t=__PRIVATE_ensureWriteStream(e);_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=e.D_[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){n=_step.value;t.I_(n.mutations)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return[2]})});return ___PRIVATE_onWriteHandshakeComplete.apply(this,arguments)}function __PRIVATE_onMutationResult(e,t,n){return ___PRIVATE_onMutationResult.apply(this,arguments)}function ___PRIVATE_onMutationResult(){___PRIVATE_onMutationResult=_async_to_generator$3(function(e,t,n){var _$r,i;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=e.D_.shift(),i=MutationBatchResult.from(_$r,t,n);return[4,__PRIVATE_executeWithRecovery(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:_state.sent();return[4,__PRIVATE_fillWritePipeline(e)];case 2:_state.sent();return[2]}})});return ___PRIVATE_onMutationResult.apply(this,arguments)}function __PRIVATE_onWriteStreamClose(e,t){return ___PRIVATE_onWriteStreamClose.apply(this,arguments)}function ___PRIVATE_onWriteStreamClose(){___PRIVATE_onWriteStreamClose=_async_to_generator$3(function(e,t){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=t&&__PRIVATE_ensureWriteStream(e).P_;if(!_tmp)return[3,2];return[4,(function(){var ___PRIVATE_handleWriteError=_async_to_generator$3(function(e,t){var n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!function __PRIVATE_isPermanentWriteError(e){return __PRIVATE_isPermanentError(e)&&e!==D.ABORTED}(t.code))return[3,3];n=e.D_.shift();__PRIVATE_ensureWriteStream(e).Zo();return[4,__PRIVATE_executeWithRecovery(e,function(){return e.remoteSyncer.rejectFailedWrite(n.batchId,t)})];case 1:_state.sent();return[4,__PRIVATE_fillWritePipeline(e)];case 2:_state.sent();_state.label=3;case 3:return[2]}})});function __PRIVATE_handleWriteError(e,t){return ___PRIVATE_handleWriteError.apply(this,arguments)}return __PRIVATE_handleWriteError})()(e,t)];case 1:_tmp=_state.sent();_state.label=2;case 2:__PRIVATE_shouldStartWriteStream(e)&&__PRIVATE_startWriteStream(e);return[2]}})});return ___PRIVATE_onWriteStreamClose.apply(this,arguments)}function __PRIVATE_remoteStoreHandleCredentialChange(e,t){return ___PRIVATE_remoteStoreHandleCredentialChange.apply(this,arguments)}function ___PRIVATE_remoteStoreHandleCredentialChange(){___PRIVATE_remoteStoreHandleCredentialChange=_async_to_generator$3(function(e,t){var n,_$r;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);n.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug("RemoteStore","RemoteStore received new credentials");_$r=__PRIVATE_canUseNetwork(n);n.v_.add(3);return[4,__PRIVATE_disableNetworkInternal(n)];case 1:_state.sent(),_$r&&n.x_.set("Unknown");return[4,n.remoteSyncer.handleCredentialChange(t)];case 2:_state.sent(),n.v_.delete(3);return[4,__PRIVATE_enableNetworkInternal(n)];case 3:_state.sent();return[2]}})});return ___PRIVATE_remoteStoreHandleCredentialChange.apply(this,arguments)}function __PRIVATE_remoteStoreApplyPrimaryState(e,t){return ___PRIVATE_remoteStoreApplyPrimaryState.apply(this,arguments)}function ___PRIVATE_remoteStoreApplyPrimaryState(){___PRIVATE_remoteStoreApplyPrimaryState=_async_to_generator$3(function(e,t){var n,_tmp1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);if(!t)return[3,2];n.v_.delete(2);return[4,__PRIVATE_enableNetworkInternal(n)];case 1:_state.sent();return[3,5];case 2:_tmp1=t;if(_tmp1)return[3,4];n.v_.add(2);return[4,__PRIVATE_disableNetworkInternal(n)];case 3:_tmp1=(_state.sent(),n.x_.set("Unknown"));_state.label=4;case 4:_state.label=5;case 5:return[2]}})});return ___PRIVATE_remoteStoreApplyPrimaryState.apply(this,arguments)}function __PRIVATE_ensureWatchStream(e){return e.N_||(e.N_=function __PRIVATE_newPersistentWatchStream(e,t,n){var _$r=__PRIVATE_debugCast(e);return _$r.R_(),new __PRIVATE_PersistentListenStream(t,_$r.connection,_$r.authCredentials,_$r.appCheckCredentials,_$r.serializer,n)}(e.datastore,e.asyncQueue,{Po:__PRIVATE_onWatchStreamOpen.bind(null,e),To:__PRIVATE_onWatchStreamClose.bind(null,e),u_:__PRIVATE_onWatchStreamChange.bind(null,e)}),e.F_.push(function(){var _ref=_async_to_generator$3(function(t){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!t)return[3,1];e.N_.Zo(),__PRIVATE_shouldStartWatchStream(e)?__PRIVATE_startWatchStream(e):e.x_.set("Unknown");return[3,3];case 1:return[4,e.N_.stop()];case 2:_state.sent(),__PRIVATE_cleanUpWatchStreamState(e);_state.label=3;case 3:return[2]}})});return function(t){return _ref.apply(this,arguments)}}())),e.N_}function __PRIVATE_ensureWriteStream(e){return e.B_||(e.B_=function __PRIVATE_newPersistentWriteStream(e,t,n){var _$r=__PRIVATE_debugCast(e);return _$r.R_(),new __PRIVATE_PersistentWriteStream(t,_$r.connection,_$r.authCredentials,_$r.appCheckCredentials,_$r.serializer,n)}(e.datastore,e.asyncQueue,{Po:__PRIVATE_onWriteStreamOpen.bind(null,e),To:__PRIVATE_onWriteStreamClose.bind(null,e),E_:__PRIVATE_onWriteHandshakeComplete.bind(null,e),T_:__PRIVATE_onMutationResult.bind(null,e)}),e.F_.push(function(){var _ref=_async_to_generator$3(function(t){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!t)return[3,2];e.B_.Zo();return[4,__PRIVATE_fillWritePipeline(e)];case 1:_state.sent();return[3,4];case 2:return[4,e.B_.stop()];case 3:_state.sent(),e.D_.length>0&&(__PRIVATE_logDebug("RemoteStore","Stopping write stream with ".concat(e.D_.length," pending writes")),e.D_=[]);_state.label=4;case 4:return[2]}})});return function(t){return _ref.apply(this,arguments)}}())),e.B_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DelayedOperation=function(){function DelayedOperation(e,t,n,r,i){_class_call_check$1(this,DelayedOperation);this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}_create_class$1(DelayedOperation,[{key:"promise",get:function get(){return this.deferred.promise}},{key:"start",value:function start(e){var _this=this;this.timerHandle=setTimeout(function(){return _this.handleDelayElapsed()},e)}},{key:"skipDelay",value:function skipDelay(){return this.handleDelayElapsed()}},{key:"cancel",value:function cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function handleDelayElapsed(){var _this=this;this.asyncQueue.enqueueAndForget(function(){return null!==_this.timerHandle?(_this.clearTimeout(),_this.op().then(function(e){return _this.deferred.resolve(e)})):Promise.resolve()})}},{key:"clearTimeout",value:function clearTimeout1(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}],[{key:"createAndSchedule",value:function createAndSchedule(e,t,n,r,i){var s=Date.now()+n,o=new DelayedOperation(e,t,s,r,i);return o.start(n),o}}]);return DelayedOperation}();function __PRIVATE_wrapInUserErrorIfRecoverable(e,t){if(__PRIVATE_logError("AsyncQueue","".concat(t,": ").concat(e)),__PRIVATE_isIndexedDbTransactionError(e))return new FirestoreError(D.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DocumentSet=function(){function DocumentSet(e){_class_call_check$1(this,DocumentSet);this.comparator=e?function(t,n){return e(t,n)||DocumentKey.comparator(t.key,n.key)}:function(e,t){return DocumentKey.comparator(e.key,t.key)},this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}_create_class$1(DocumentSet,[{key:"has",value:function has(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function get(e){return this.keyedMap.get(e)}},{key:"first",value:function first(){return this.sortedSet.minKey()}},{key:"last",value:function last(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function isEmpty(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function get(){return this.sortedSet.size}},{key:"forEach",value:function forEach(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:"add",value:function add(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function _delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function isEqual(e){if(!_instanceof$1(e,DocumentSet))return!1;if(this.size!==e.size)return!1;var t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){var _$e=t.getNext().key,_$r=n.getNext().key;if(!_$e.isEqual(_$r))return!1}return!0}},{key:"toString",value:function toString(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function copy(e,t){var n=new DocumentSet;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}],[{key:"emptySet",value:function emptySet(e){return new DocumentSet(e.comparator)}}]);return DocumentSet}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_DocumentChangeSet=function(){function __PRIVATE_DocumentChangeSet(){_class_call_check$1(this,__PRIVATE_DocumentChangeSet);this.L_=new SortedMap(DocumentKey.comparator)}_create_class$1(__PRIVATE_DocumentChangeSet,[{key:"track",value:function track(e){var t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):fail():this.L_=this.L_.insert(t,e)}},{key:"k_",value:function k_(){var e=[];return this.L_.inorderTraversal(function(t,n){e.push(n)}),e}}]);return __PRIVATE_DocumentChangeSet}();var ViewSnapshot=function(){function ViewSnapshot(e,t,n,r,i,s,o,_,a){_class_call_check$1(this,ViewSnapshot);this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=_,this.hasCachedResults=a}_create_class$1(ViewSnapshot,[{key:"hasPendingWrites",get:function get(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&__PRIVATE_queryEquals(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var _$e=0;_$e<t.length;_$e++)if(t[_$e].type!==n[_$e].type||!t[_$e].doc.isEqual(n[_$e].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function fromInitialDocuments(e,t,n,r,i){var s=[];return t.forEach(function(e){s.push({type:0,doc:e})}),new ViewSnapshot(e,t,DocumentSet.emptySet(t),s,n,r,!0,!1,i)}}]);return ViewSnapshot}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_QueryListenersInfo=function __PRIVATE_QueryListenersInfo(){_class_call_check$1(this,__PRIVATE_QueryListenersInfo);this.q_=void 0,this.Q_=[]};var __PRIVATE_EventManagerImpl=function __PRIVATE_EventManagerImpl(){_class_call_check$1(this,__PRIVATE_EventManagerImpl);this.queries=new ObjectMap(function(e){return __PRIVATE_canonifyQuery(e)},__PRIVATE_queryEquals),this.onlineState="Unknown",this.K_=new Set};function __PRIVATE_eventManagerListen(e,t){return ___PRIVATE_eventManagerListen.apply(this,arguments)}function ___PRIVATE_eventManagerListen(){___PRIVATE_eventManagerListen=_async_to_generator$3(function(e,t){var n,_$r,i,s,e1,n1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e),_$r=t.query;i=!1,s=n.queries.get(_$r);if(!(s||(i=!0,s=new __PRIVATE_QueryListenersInfo),i))return[3,4];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,n.onListen(_$r)];case 2:s.q_=_state.sent();return[3,4];case 3:e1=_state.sent();n1=__PRIVATE_wrapInUserErrorIfRecoverable(e1,"Initialization of query '".concat(__PRIVATE_stringifyQuery(t.query),"' failed"));return[2,void t.onError(n1)];case 4:if(n.queries.set(_$r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_){t.W_(s.q_)&&__PRIVATE_raiseSnapshotsInSyncEvent(n)}return[2]}})});return ___PRIVATE_eventManagerListen.apply(this,arguments)}function __PRIVATE_eventManagerUnlisten(e,t){return ___PRIVATE_eventManagerUnlisten.apply(this,arguments)}function ___PRIVATE_eventManagerUnlisten(){___PRIVATE_eventManagerUnlisten=_async_to_generator$3(function(e,t){var n,_$r,i,s,_$e;return _ts_generator$1(this,function(_state){n=__PRIVATE_debugCast(e),_$r=t.query;i=!1;s=n.queries.get(_$r);if(s){_$e=s.Q_.indexOf(t);_$e>=0&&(s.Q_.splice(_$e,1),i=0===s.Q_.length)}if(i)return[2,(n.queries.delete(_$r),n.onUnlisten(_$r))];return[2]})});return ___PRIVATE_eventManagerUnlisten.apply(this,arguments)}function __PRIVATE_eventManagerOnWatchChange(e,t){var n=__PRIVATE_debugCast(e);var _$r=!1;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;var _$t=_$e.query,i=n.queries.get(_$t);if(i){var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=i.Q_[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var _$t1=_step1.value;_$t1.W_(_$e)&&(_$r=!0)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}i.q_=_$e}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_$r&&__PRIVATE_raiseSnapshotsInSyncEvent(n)}function __PRIVATE_eventManagerOnWatchError(e,t,n){var _$r=__PRIVATE_debugCast(e),i=_$r.queries.get(t);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(i)try{for(var _iterator=i.Q_[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;_$e.onError(n)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_$r.queries.delete(t)}function __PRIVATE_raiseSnapshotsInSyncEvent(e){e.K_.forEach(function(e){e.next()})}var __PRIVATE_QueryListener=function(){function __PRIVATE_QueryListener(e,t,n){_class_call_check$1(this,__PRIVATE_QueryListener);this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}_create_class$1(__PRIVATE_QueryListener,[{key:"W_",value:function W_(e){if(!this.options.includeMetadataChanges){var t=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.docChanges[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var n=_step.value;3!==n.type&&t.push(n)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}e=new ViewSnapshot(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var t1=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t1=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t1=!0),this.j_=e,t1}},{key:"onError",value:function onError(e){this.G_.error(e)}},{key:"U_",value:function U_(e){this.onlineState=e;var t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}},{key:"J_",value:function J_(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"H_",value:function H_(e){if(e.docChanges.length>0)return!0;var t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"Y_",value:function Y_(e){e=ViewSnapshot.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}]);return __PRIVATE_QueryListener}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_SizedBundleElement=function(){function __PRIVATE_SizedBundleElement(e,t){_class_call_check$1(this,__PRIVATE_SizedBundleElement);this.X_=e,this.byteLength=t}_create_class$1(__PRIVATE_SizedBundleElement,[{key:"ea",value:function ea(){return"metadata"in this.X_}}]);return __PRIVATE_SizedBundleElement}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_BundleConverterImpl=function(){function __PRIVATE_BundleConverterImpl(e){_class_call_check$1(this,__PRIVATE_BundleConverterImpl);this.serializer=e}_create_class$1(__PRIVATE_BundleConverterImpl,[{key:"Ps",value:function Ps(e){return fromName(this.serializer,e)}},{key:"Is",value:function Is(e){return e.metadata.exists?__PRIVATE_fromDocument(this.serializer,e.document,!1):MutableDocument.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}},{key:"Ts",value:function Ts(e){return __PRIVATE_fromVersion(e)}}]);return __PRIVATE_BundleConverterImpl}();(function(){function __PRIVATE_BundleLoader(e,t,n){_class_call_check$1(this,__PRIVATE_BundleLoader);this.ta=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=__PRIVATE_bundleInitialProgress(e)}_create_class$1(__PRIVATE_BundleLoader,[{key:"na",value:function na(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++t;var n=ResourcePath.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"ra",value:function ra(e){var t=new Map,n=new __PRIVATE_BundleConverterImpl(this.serializer);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;if(_$r.metadata.queries){var _$e=n.Ps(_$r.metadata.name);var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator1=_$r.metadata.queries[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){var n1=_step1.value;var r1=(t.get(n1)||__PRIVATE_documentKeySet()).add(_$e);t.set(n1,r1)}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t}},{key:"complete",value:function complete(){var _this=this;return _async_to_generator$3(function(){var e,t,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,e1,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,__PRIVATE_localStoreApplyBundledDocuments(_this.localStore,new __PRIVATE_BundleConverterImpl(_this.serializer),_this.documents,_this.ta.id)];case 1:e=_state.sent(),t=_this.ra(_this.documents);_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=2;case 2:_state.trys.push([2,7,8,9]);_iterator=_this.queries[Symbol.iterator]();_state.label=3;case 3:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,6];e1=_step.value;return[4,__PRIVATE_localStoreSaveNamedQuery(_this.localStore,e1,t.get(e1.name))];case 4:_state.sent();_state.label=5;case 5:_iteratorNormalCompletion=true;return[3,3];case 6:return[3,9];case 7:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,9];case 8:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 9:return[2,(_this.progress.taskState="Success",{progress:_this.progress,ia:_this.collectionGroups,sa:e})]}})})()}}]);return __PRIVATE_BundleLoader})();function __PRIVATE_bundleInitialProgress(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_AddedLimboDocument=function __PRIVATE_AddedLimboDocument(e){_class_call_check$1(this,__PRIVATE_AddedLimboDocument);this.key=e};var __PRIVATE_RemovedLimboDocument=function __PRIVATE_RemovedLimboDocument(e){_class_call_check$1(this,__PRIVATE_RemovedLimboDocument);this.key=e};var __PRIVATE_View=function(){function __PRIVATE_View(e,t){_class_call_check$1(this,__PRIVATE_View);this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.ua=__PRIVATE_newQueryComparator(e),this.ca=new DocumentSet(this.ua)}_create_class$1(__PRIVATE_View,[{key:"la",get:function get(){return this.oa}},{key:"ha",value:function ha(e,t){var _this=this;var n=t?t.Pa:new __PRIVATE_DocumentChangeSet,_$r=t?t.ca:this.ca;var i=t?t.mutatedKeys:this.mutatedKeys,s=_$r,o=!1;var _="F"===this.query.limitType&&_$r.size===this.query.limit?_$r.last():null,a="L"===this.query.limitType&&_$r.size===this.query.limit?_$r.first():null;if(e.inorderTraversal(function(e,t){var u=_$r.get(e),c=__PRIVATE_queryMatches(_this.query,t)?t:null,l=!!u&&_this.mutatedKeys.has(u.key),h=!!c&&(c.hasLocalMutations||_this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);var _$P=!1;if(u&&c){u.data.isEqual(c.data)?l!==h&&(n.track({type:3,doc:c}),_$P=!0):_this.Ia(u,c)||(n.track({type:2,doc:c}),_$P=!0,(_&&_this.ua(c,_)>0||a&&_this.ua(c,a)<0)&&(o=!0))}else!u&&c?(n.track({type:0,doc:c}),_$P=!0):u&&!c&&(n.track({type:1,doc:u}),_$P=!0,(_||a)&&(o=!0));_$P&&(c?(s=s.add(c),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){var _$e="F"===this.query.limitType?s.last():s.first();s=s.delete(_$e.key),i=i.delete(_$e.key),n.track({type:1,doc:_$e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}},{key:"Ia",value:function Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function applyChanges(e,t,n,r){var _this=this;var i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;var s=e.Pa.k_();s.sort(function(e,t){return function __PRIVATE_compareChangeType(e,t){var order=function order(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail()}};return order(e)-order(t)}(e.type,t.type)||_this.ua(e.doc,t.doc)}),this.Ta(n),r=null!=r&&r;var o=t&&!r?this.Ea():[],_=0===this.aa.size&&this.current&&!r?1:0,a=_!==this._a;if(this._a=_,0!==s.length||a){return{snapshot:new ViewSnapshot(this.query,e.ca,i,s,e.mutatedKeys,0===_,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}}return{da:o}}},{key:"U_",value:function U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}},{key:"Aa",value:function Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}},{key:"Ta",value:function Ta(e){var _this=this;e&&(e.addedDocuments.forEach(function(e){return _this.oa=_this.oa.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return _this.oa=_this.oa.delete(e)}),this.current=e.current)}},{key:"Ea",value:function Ea(){var _this=this;if(!this.current)return[];var e=this.aa;this.aa=__PRIVATE_documentKeySet(),this.ca.forEach(function(e){_this.Aa(e.key)&&(_this.aa=_this.aa.add(e.key))});var t=[];return e.forEach(function(e){_this.aa.has(e)||t.push(new __PRIVATE_RemovedLimboDocument(e))}),this.aa.forEach(function(n){e.has(n)||t.push(new __PRIVATE_AddedLimboDocument(n))}),t}},{key:"Ra",value:function Ra(e){this.oa=e.hs,this.aa=__PRIVATE_documentKeySet();var t=this.ha(e.documents);return this.applyChanges(t,!0)}},{key:"Va",value:function Va(){return ViewSnapshot.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}]);return __PRIVATE_View}();var __PRIVATE_QueryView=function __PRIVATE_QueryView(e,t,n){_class_call_check$1(this,__PRIVATE_QueryView);this.query=e,this.targetId=t,this.view=n};var LimboResolution=function LimboResolution(e){_class_call_check$1(this,LimboResolution);this.key=e,this.ma=!1};var __PRIVATE_SyncEngineImpl=function(){function __PRIVATE_SyncEngineImpl(e,t,n,r,i,s){_class_call_check$1(this,__PRIVATE_SyncEngineImpl);this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new ObjectMap(function(e){return __PRIVATE_canonifyQuery(e)},__PRIVATE_queryEquals),this.pa=new Map,this.ya=new Set,this.wa=new SortedMap(DocumentKey.comparator),this.Sa=new Map,this.ba=new __PRIVATE_ReferenceSet,this.Da={},this.Ca=new Map,this.va=__PRIVATE_TargetIdGenerator.Bn(),this.onlineState="Unknown",this.Fa=void 0}_create_class$1(__PRIVATE_SyncEngineImpl,[{key:"isPrimaryClient",get:function get(){return!0===this.Fa}}]);return __PRIVATE_SyncEngineImpl}();function __PRIVATE_syncEngineListen(e,t){return ___PRIVATE_syncEngineListen.apply(this,arguments)}function ___PRIVATE_syncEngineListen(){___PRIVATE_syncEngineListen=_async_to_generator$3(function(e,t){var n,_$r,i,s,_$e,s1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_ensureWatchCallbacks(e);s=n.ga.get(t);if(!s)return[3,1];_$r=s.targetId,n.sharedClientState.addLocalQueryTarget(_$r),i=s.view.Va();return[3,4];case 1:return[4,__PRIVATE_localStoreAllocateTarget(n.localStore,__PRIVATE_queryToTarget(t))];case 2:_$e=_state.sent(),s1=n.sharedClientState.addLocalQueryTarget(_$e.targetId);_$r=_$e.targetId;return[4,__PRIVATE_initializeViewAndComputeSnapshot(n,t,_$r,"current"===s1,_$e.resumeToken)];case 3:i=_state.sent(),n.isPrimaryClient&&__PRIVATE_remoteStoreListen(n.remoteStore,_$e);_state.label=4;case 4:return[2,i]}})});return ___PRIVATE_syncEngineListen.apply(this,arguments)}function __PRIVATE_initializeViewAndComputeSnapshot(e,t,n,r,i){return ___PRIVATE_initializeViewAndComputeSnapshot.apply(this,arguments)}function ___PRIVATE_initializeViewAndComputeSnapshot(){___PRIVATE_initializeViewAndComputeSnapshot=_async_to_generator$3(function(e,t,n,r,i){var s,o,_,a,u,c;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:e.Ma=function(t,n,r){return(function(){var ___PRIVATE_applyDocChanges=_async_to_generator$3(function(e,t,n,r){var _$i,_tmp,s,o,_;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$i=t.view.ha(n);_tmp=_$i.Xi;if(!_tmp)return[3,2];return[4,__PRIVATE_localStoreExecuteQuery(e.localStore,t.query,!1).then(function(param){var _$e=param.documents;return t.view.ha(_$e,_$i)})];case 1:_tmp=_$i=_state.sent();_state.label=2;case 2:s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),_=t.view.applyChanges(_$i,e.isPrimaryClient,s,o);return[2,(__PRIVATE_updateTrackedLimbos(e,t.targetId,_.da),_.snapshot)]}})});function __PRIVATE_applyDocChanges(e,t,n,r){return ___PRIVATE_applyDocChanges.apply(this,arguments)}return __PRIVATE_applyDocChanges})()(e,t,n,r)};return[4,__PRIVATE_localStoreExecuteQuery(e.localStore,t,!0)];case 1:s=_state.sent(),o=new __PRIVATE_View(t,s.hs),_=o.ha(s.documents),a=TargetChange.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(_,e.isPrimaryClient,a);__PRIVATE_updateTrackedLimbos(e,n,u.da);c=new __PRIVATE_QueryView(t,n,o);return[2,(e.ga.set(t,c),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot)]}})});return ___PRIVATE_initializeViewAndComputeSnapshot.apply(this,arguments)}function __PRIVATE_syncEngineUnlisten(e,t){return ___PRIVATE_syncEngineUnlisten.apply(this,arguments)}function ___PRIVATE_syncEngineUnlisten(){___PRIVATE_syncEngineUnlisten=_async_to_generator$3(function(e,t){var n,_$r,i,_tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e),_$r=n.ga.get(t),i=n.pa.get(_$r.targetId);if(i.length>1)return[2,(n.pa.set(_$r.targetId,i.filter(function(e){return!__PRIVATE_queryEquals(e,t)})),void n.ga.delete(t))];if(!n.isPrimaryClient)return[3,3];n.sharedClientState.removeLocalQueryTarget(_$r.targetId);_tmp=n.sharedClientState.isActiveQueryTarget(_$r.targetId);if(_tmp)return[3,2];return[4,__PRIVATE_localStoreReleaseTarget(n.localStore,_$r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(_$r.targetId),__PRIVATE_remoteStoreUnlisten(n.remoteStore,_$r.targetId),__PRIVATE_removeAndCleanupTarget(n,_$r.targetId)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)];case 1:_tmp=_state.sent();_state.label=2;case 2:return[3,5];case 3:__PRIVATE_removeAndCleanupTarget(n,_$r.targetId);return[4,__PRIVATE_localStoreReleaseTarget(n.localStore,_$r.targetId,!0)];case 4:_state.sent();_state.label=5;case 5:return[2]}})});return ___PRIVATE_syncEngineUnlisten.apply(this,arguments)}function __PRIVATE_syncEngineWrite(e,t,n){return ___PRIVATE_syncEngineWrite.apply(this,arguments)}function ___PRIVATE_syncEngineWrite(){___PRIVATE_syncEngineWrite=_async_to_generator$3(function(e,t,n){var _$r,_$e,e1,_$t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_syncEngineEnsureWriteCallbacks(e);_state.label=1;case 1:_state.trys.push([1,5,,6]);return[4,function __PRIVATE_localStoreWriteLocally(e,t){var _$n=__PRIVATE_debugCast(e),_$r=Timestamp.now(),i=t.reduce(function(e,t){return e.add(t.key)},__PRIVATE_documentKeySet());var s,o;return _$n.persistence.runTransaction("Locally write mutations","readwrite",function(e){var _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();return _$n.os.getEntries(e,i).next(function(e){_=e,_.forEach(function(e,t){t.isValidDocument()||(a=a.add(e))})}).next(function(){return _$n.localDocuments.getOverlayedDocuments(e,_)}).next(function(i){s=i;var o=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=t[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;var _$t=__PRIVATE_mutationExtractBaseValue(_$e,s.get(_$e.key).overlayedDocument);null!=_$t&&o.push(new __PRIVATE_PatchMutation(_$e.key,_$t,__PRIVATE_extractFieldMask(_$t.value.mapValue),Precondition.exists(!0)))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$n.mutationQueue.addMutationBatch(e,_$r,o,t)}).next(function(t){o=t;var _$r=t.applyToLocalDocumentSet(s,a);return _$n.documentOverlayCache.saveOverlays(e,t.batchId,_$r)})}).then(function(){return{batchId:o.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(s)}})}(_$r.localStore,t)];case 2:_$e=_state.sent();_$r.sharedClientState.addPendingMutation(_$e.batchId),function __PRIVATE_addMutationCallback(e,t,n){var _$r=e.Da[e.currentUser.toKey()];_$r||(_$r=new SortedMap(__PRIVATE_primitiveComparator));_$r=_$r.insert(t,n),e.Da[e.currentUser.toKey()]=_$r}(_$r,_$e.batchId,n);return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(_$r,_$e.changes)];case 3:_state.sent();return[4,__PRIVATE_fillWritePipeline(_$r.remoteStore)];case 4:_state.sent();return[3,6];case 5:e1=_state.sent();_$t=__PRIVATE_wrapInUserErrorIfRecoverable(e1,"Failed to persist write");n.reject(_$t);return[3,6];case 6:return[2]}})});return ___PRIVATE_syncEngineWrite.apply(this,arguments)}function __PRIVATE_syncEngineApplyRemoteEvent(e,t){return ___PRIVATE_syncEngineApplyRemoteEvent.apply(this,arguments)}function ___PRIVATE_syncEngineApplyRemoteEvent(){___PRIVATE_syncEngineApplyRemoteEvent=_async_to_generator$3(function(e,t){var n,_$e,e1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);_state.label=1;case 1:_state.trys.push([1,4,,6]);return[4,__PRIVATE_localStoreApplyRemoteEventToLocalCache(n.localStore,t)];case 2:_$e=_state.sent();t.targetChanges.forEach(function(e,t){var _$r=n.Sa.get(t);_$r&&(__PRIVATE_hardAssert(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?_$r.ma=!0:e.modifiedDocuments.size>0?__PRIVATE_hardAssert(_$r.ma):e.removedDocuments.size>0&&(__PRIVATE_hardAssert(_$r.ma),_$r.ma=!1))});return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,_$e,t)];case 3:_state.sent();return[3,6];case 4:e1=_state.sent();return[4,__PRIVATE_ignoreIfPrimaryLeaseLoss(e1)];case 5:_state.sent();return[3,6];case 6:return[2]}})});return ___PRIVATE_syncEngineApplyRemoteEvent.apply(this,arguments)}function __PRIVATE_syncEngineApplyOnlineStateChange(e,t,n){var _$r=__PRIVATE_debugCast(e);if(_$r.isPrimaryClient&&0===n||!_$r.isPrimaryClient&&1===n){var _$e=[];_$r.ga.forEach(function(n,r){var i=r.view.U_(t);i.snapshot&&_$e.push(i.snapshot)}),function __PRIVATE_eventManagerOnOnlineStateChange(e,t){var _$n=__PRIVATE_debugCast(e);_$n.onlineState=t;var _$r=!1;_$n.queries.forEach(function(e,n){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n.Q_[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;_$e.U_(t)&&(_$r=!0)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}),_$r&&__PRIVATE_raiseSnapshotsInSyncEvent(_$n)}(_$r.eventManager,t),_$e.length&&_$r.fa.u_(_$e),_$r.onlineState=t,_$r.isPrimaryClient&&_$r.sharedClientState.setOnlineState(t)}}function __PRIVATE_syncEngineRejectListen(e,t,n){return ___PRIVATE_syncEngineRejectListen.apply(this,arguments)}function ___PRIVATE_syncEngineRejectListen(){___PRIVATE_syncEngineRejectListen=_async_to_generator$3(function(e,t,n){var _$r,i,s,_$e,_$n,i1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_debugCast(e);_$r.sharedClientState.updateQueryState(t,"rejected",n);i=_$r.Sa.get(t),s=i&&i.key;if(!s)return[3,2];_$e=new SortedMap(DocumentKey.comparator);_$e=_$e.insert(s,MutableDocument.newNoDocument(s,SnapshotVersion.min()));_$n=__PRIVATE_documentKeySet().add(s),i1=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),_$e,_$n);return[4,__PRIVATE_syncEngineApplyRemoteEvent(_$r,i1)];case 1:_state.sent(),_$r.wa=_$r.wa.remove(s),_$r.Sa.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(_$r);return[3,4];case 2:return[4,__PRIVATE_localStoreReleaseTarget(_$r.localStore,t,!1).then(function(){return __PRIVATE_removeAndCleanupTarget(_$r,t,n)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)];case 3:_state.sent();_state.label=4;case 4:return[2]}})});return ___PRIVATE_syncEngineRejectListen.apply(this,arguments)}function __PRIVATE_syncEngineApplySuccessfulWrite(e,t){return ___PRIVATE_syncEngineApplySuccessfulWrite.apply(this,arguments)}function ___PRIVATE_syncEngineApplySuccessfulWrite(){___PRIVATE_syncEngineApplySuccessfulWrite=_async_to_generator$3(function(e,t){var n,_$r,_$e,e1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e),_$r=t.batch.batchId;_state.label=1;case 1:_state.trys.push([1,4,,6]);return[4,__PRIVATE_localStoreAcknowledgeBatch(n.localStore,t)];case 2:_$e=_state.sent();__PRIVATE_processUserCallback(n,_$r,null),__PRIVATE_triggerPendingWritesCallbacks(n,_$r),n.sharedClientState.updateMutationState(_$r,"acknowledged");return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,_$e)];case 3:_state.sent();return[3,6];case 4:e1=_state.sent();return[4,__PRIVATE_ignoreIfPrimaryLeaseLoss(e1)];case 5:_state.sent();return[3,6];case 6:return[2]}})});return ___PRIVATE_syncEngineApplySuccessfulWrite.apply(this,arguments)}function __PRIVATE_syncEngineRejectFailedWrite(e,t,n){return ___PRIVATE_syncEngineRejectFailedWrite.apply(this,arguments)}function ___PRIVATE_syncEngineRejectFailedWrite(){___PRIVATE_syncEngineRejectFailedWrite=_async_to_generator$3(function(e,t,n){var _$r,_$e,n1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_debugCast(e);_state.label=1;case 1:_state.trys.push([1,4,,6]);return[4,function __PRIVATE_localStoreRejectBatch(e,t){var _$n=__PRIVATE_debugCast(e);return _$n.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var _$r;return _$n.mutationQueue.lookupMutationBatch(e,t).next(function(t){return __PRIVATE_hardAssert(null!==t),_$r=t.keys(),_$n.mutationQueue.removeMutationBatch(e,t)}).next(function(){return _$n.mutationQueue.performConsistencyCheck(e)}).next(function(){return _$n.documentOverlayCache.removeOverlaysForBatchId(e,_$r,t)}).next(function(){return _$n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,_$r)}).next(function(){return _$n.localDocuments.getDocuments(e,_$r)})})}(_$r.localStore,t)];case 2:_$e=_state.sent();__PRIVATE_processUserCallback(_$r,t,n),__PRIVATE_triggerPendingWritesCallbacks(_$r,t),_$r.sharedClientState.updateMutationState(t,"rejected",n);return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(_$r,_$e)];case 3:_state.sent();return[3,6];case 4:n1=_state.sent();return[4,__PRIVATE_ignoreIfPrimaryLeaseLoss(n1)];case 5:_state.sent();return[3,6];case 6:return[2]}})});return ___PRIVATE_syncEngineRejectFailedWrite.apply(this,arguments)}function __PRIVATE_triggerPendingWritesCallbacks(e,t){(e.Ca.get(t)||[]).forEach(function(e){e.resolve()}),e.Ca.delete(t)}function __PRIVATE_processUserCallback(e,t,n){var _$r=__PRIVATE_debugCast(e);var i=_$r.Da[_$r.currentUser.toKey()];if(i){var _$e=i.get(t);_$e&&(n?_$e.reject(n):_$e.resolve(),i=i.remove(t)),_$r.Da[_$r.currentUser.toKey()]=i}}function __PRIVATE_removeAndCleanupTarget(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e.pa.get(t)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;e.ga.delete(_$r),n&&e.fa.xa(_$r,n)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(e.pa.delete(t),e.isPrimaryClient){e.ba.Vr(t).forEach(function(t){e.ba.containsKey(t)||__PRIVATE_removeLimboTarget(e,t)})}}function __PRIVATE_removeLimboTarget(e,t){e.ya.delete(t.path.canonicalString());var n=e.wa.get(t);null!==n&&(__PRIVATE_remoteStoreUnlisten(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_updateTrackedLimbos(e,t,n){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=n[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;if(_instanceof$1(_$r,__PRIVATE_AddedLimboDocument))e.ba.addReference(_$r.key,t),__PRIVATE_trackLimboChange(e,_$r);else if(_instanceof$1(_$r,__PRIVATE_RemovedLimboDocument)){__PRIVATE_logDebug("SyncEngine","Document no longer in limbo: "+_$r.key),e.ba.removeReference(_$r.key,t);e.ba.containsKey(_$r.key)||__PRIVATE_removeLimboTarget(e,_$r.key)}else fail()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}function __PRIVATE_trackLimboChange(e,t){var n=t.key,_$r=n.path.canonicalString();e.wa.get(n)||e.ya.has(_$r)||(__PRIVATE_logDebug("SyncEngine","New document in limbo: "+n),e.ya.add(_$r),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_pumpEnqueuedLimboResolutions(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){var t=e.ya.values().next().value;e.ya.delete(t);var n=new DocumentKey(ResourcePath.fromString(t)),_$r=e.va.next();e.Sa.set(_$r,new LimboResolution(n)),e.wa=e.wa.insert(n,_$r),__PRIVATE_remoteStoreListen(e.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(n.path)),_$r,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence._e))}}function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(e,t,n){return ___PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore.apply(this,arguments)}function ___PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(){___PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore=_async_to_generator$3(function(e,t,n){var _$r,i,s,o,_tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_debugCast(e),i=[],s=[],o=[];_tmp=_$r.ga.isEmpty();if(_tmp)return[3,3];_$r.ga.forEach(function(e,_){o.push(_$r.Ma(_,t,n).then(function(e){if((e||n)&&_$r.isPrimaryClient&&_$r.sharedClientState.updateQueryState(_.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);var _$t=__PRIVATE_LocalViewChanges.Ki(_.targetId,e);s.push(_$t)}}))});return[4,Promise.all(o)];case 1:_state.sent(),_$r.fa.u_(i);return[4,(function(){var ___PRIVATE_localStoreNotifyLocalViewChanges=_async_to_generator$3(function(e,t){var n,e1,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$e,_$t,_$e1,_$r,i;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return PersistencePromise.forEach(t,function(t){return PersistencePromise.forEach(t.qi,function(r){return n.persistence.referenceDelegate.addReference(e,t.targetId,r)}).next(function(){return PersistencePromise.forEach(t.Qi,function(r){return n.persistence.referenceDelegate.removeReference(e,t.targetId,r)})})})})];case 2:_state.sent();return[3,4];case 3:e1=_state.sent();if(!__PRIVATE_isIndexedDbTransactionError(e1))throw e1;__PRIVATE_logDebug("LocalStore","Failed to update sequence numbers: "+e1);return[3,4];case 4:_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=t[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_$e=_step.value;_$t=_$e.targetId;if(!_$e.fromCache){_$e1=n.ns.get(_$t),_$r=_$e1.snapshotVersion,i=_$e1.withLastLimboFreeSnapshotVersion(_$r);n.ns=n.ns.insert(_$t,i)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return[2]}})});function __PRIVATE_localStoreNotifyLocalViewChanges(e,t){return ___PRIVATE_localStoreNotifyLocalViewChanges.apply(this,arguments)}return __PRIVATE_localStoreNotifyLocalViewChanges})()(_$r.localStore,s)];case 2:_tmp=_state.sent();_state.label=3;case 3:return[2]}})});return ___PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore.apply(this,arguments)}function __PRIVATE_syncEngineHandleCredentialChange(e,t){return ___PRIVATE_syncEngineHandleCredentialChange.apply(this,arguments)}function ___PRIVATE_syncEngineHandleCredentialChange(){___PRIVATE_syncEngineHandleCredentialChange=_async_to_generator$3(function(e,t){var n,_$e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);if(!!n.currentUser.isEqual(t))return[3,3];__PRIVATE_logDebug("SyncEngine","User change. New user:",t.toKey());return[4,__PRIVATE_localStoreHandleUserChange(n.localStore,t)];case 1:_$e=_state.sent();n.currentUser=t,function __PRIVATE_rejectOutstandingPendingWritesCallbacks(e,t){e.Ca.forEach(function(e){e.forEach(function(e){e.reject(new FirestoreError(D.CANCELLED,t))})}),e.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,_$e.removedBatchIds,_$e.addedBatchIds);return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,_$e.us)];case 2:_state.sent();_state.label=3;case 3:return[2]}})});return ___PRIVATE_syncEngineHandleCredentialChange.apply(this,arguments)}function __PRIVATE_syncEngineGetRemoteKeysForTarget(e,t){var n=__PRIVATE_debugCast(e),_$r=n.Sa.get(t);if(_$r&&_$r.ma)return __PRIVATE_documentKeySet().add(_$r.key);{var _$e=__PRIVATE_documentKeySet();var r1=n.pa.get(t);if(!r1)return _$e;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=r1[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;var r2=n.ga.get(_$t);_$e=_$e.unionWith(r2.view.la)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _$e}}function __PRIVATE_synchronizeViewAndComputeSnapshot(e,t){return ___PRIVATE_synchronizeViewAndComputeSnapshot.apply(this,arguments)}function ___PRIVATE_synchronizeViewAndComputeSnapshot(){___PRIVATE_synchronizeViewAndComputeSnapshot=_async_to_generator$3(function(e,t){var n,_$r,i;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);return[4,__PRIVATE_localStoreExecuteQuery(n.localStore,t.query,!0)];case 1:_$r=_state.sent(),i=t.view.Ra(_$r);return[2,(n.isPrimaryClient&&__PRIVATE_updateTrackedLimbos(n,t.targetId,i.da),i)]}})});return ___PRIVATE_synchronizeViewAndComputeSnapshot.apply(this,arguments)}function __PRIVATE_syncEngineSynchronizeWithChangedDocuments(e,t){return ___PRIVATE_syncEngineSynchronizeWithChangedDocuments.apply(this,arguments)}function ___PRIVATE_syncEngineSynchronizeWithChangedDocuments(){___PRIVATE_syncEngineSynchronizeWithChangedDocuments=_async_to_generator$3(function(e,t){var n;return _ts_generator$1(this,function(_state){n=__PRIVATE_debugCast(e);return[2,__PRIVATE_localStoreGetNewDocumentChanges(n.localStore,t).then(function(e){return __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e)})]})});return ___PRIVATE_syncEngineSynchronizeWithChangedDocuments.apply(this,arguments)}function __PRIVATE_syncEngineApplyBatchState(e,t,n,r){return ___PRIVATE_syncEngineApplyBatchState.apply(this,arguments)}function ___PRIVATE_syncEngineApplyBatchState(){___PRIVATE_syncEngineApplyBatchState=_async_to_generator$3(function(e,t,n,r){var i,s;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:i=__PRIVATE_debugCast(e);return[4,function __PRIVATE_localStoreLookupMutationDocuments(e,t){var _$n=__PRIVATE_debugCast(e),_$r=__PRIVATE_debugCast(_$n.mutationQueue);return _$n.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return _$r.vn(e,t).next(function(t){return t?_$n.localDocuments.getDocuments(e,t):PersistencePromise.resolve(null)})})}(i.localStore,t)];case 1:s=_state.sent();if(!(null!==s))return[3,6];if(!("pending"===n))return[3,3];return[4,__PRIVATE_fillWritePipeline(i.remoteStore)];case 2:_state.sent();return[3,4];case 3:"acknowledged"===n||"rejected"===n?(__PRIVATE_processUserCallback(i,t,r||null),__PRIVATE_triggerPendingWritesCallbacks(i,t),function __PRIVATE_localStoreRemoveCachedMutationBatchMetadata(e,t){__PRIVATE_debugCast(__PRIVATE_debugCast(e).mutationQueue).Mn(t)}(i.localStore,t)):fail();_state.label=4;case 4:return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(i,s)];case 5:_state.sent();return[3,7];case 6:__PRIVATE_logDebug("SyncEngine","Cannot apply mutation batch with id: "+t);_state.label=7;case 7:return[2]}})});return ___PRIVATE_syncEngineApplyBatchState.apply(this,arguments)}function __PRIVATE_syncEngineApplyPrimaryState(e,t){return ___PRIVATE_syncEngineApplyPrimaryState.apply(this,arguments)}function ___PRIVATE_syncEngineApplyPrimaryState(){___PRIVATE_syncEngineApplyPrimaryState=_async_to_generator$3(function(e,t){var n,_$e,_$t,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$e1,_$e2,_$t1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e);if(!(__PRIVATE_ensureWatchCallbacks(n),__PRIVATE_syncEngineEnsureWriteCallbacks(n),!0===t&&!0!==n.Fa))return[3,3];_$e=n.sharedClientState.getAllActiveQueryTargets();return[4,__PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(n,_$e.toArray())];case 1:_$t=_state.sent();n.Fa=!0;return[4,__PRIVATE_remoteStoreApplyPrimaryState(n.remoteStore,!0)];case 2:_state.sent();_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=_$t[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_$e1=_step.value;__PRIVATE_remoteStoreListen(n.remoteStore,_$e1)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return[3,7];case 3:if(!(!1===t&&!1!==n.Fa))return[3,7];_$e2=[];_$t1=Promise.resolve();n.pa.forEach(function(r,i){n.sharedClientState.isLocalQueryTarget(i)?_$e2.push(i):_$t1=_$t1.then(function(){return __PRIVATE_removeAndCleanupTarget(n,i),__PRIVATE_localStoreReleaseTarget(n.localStore,i,!0)}),__PRIVATE_remoteStoreUnlisten(n.remoteStore,i)});return[4,_$t1];case 4:_state.sent();return[4,__PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(n,_$e2)];case 5:_state.sent(),function __PRIVATE_resetLimboDocuments(e){var _$t=__PRIVATE_debugCast(e);_$t.Sa.forEach(function(e,n){__PRIVATE_remoteStoreUnlisten(_$t.remoteStore,n)}),_$t.ba.mr(),_$t.Sa=new Map,_$t.wa=new SortedMap(DocumentKey.comparator)}(n),n.Fa=!1;return[4,__PRIVATE_remoteStoreApplyPrimaryState(n.remoteStore,!1)];case 6:_state.sent();_state.label=7;case 7:return[2]}})});return ___PRIVATE_syncEngineApplyPrimaryState.apply(this,arguments)}function __PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(e,t,n){return ___PRIVATE_synchronizeQueryViewsAndRaiseSnapshots.apply(this,arguments)}function ___PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(){___PRIVATE_synchronizeQueryViewsAndRaiseSnapshots=_async_to_generator$3(function(e,t,n){var _$r,i,s,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$e,_$t,n1,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_iterator1,_step1,_$e1,_$t1,n2,err,n3,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_debugCast(e),i=[],s=[];_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=1;case 1:_state.trys.push([1,19,20,21]);_iterator=t[Symbol.iterator]();_state.label=2;case 2:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,18];_$e=_step.value;_$t=void 0;n1=_$r.pa.get(_$e);if(!(n1&&0!==n1.length))return[3,12];return[4,__PRIVATE_localStoreAllocateTarget(_$r.localStore,__PRIVATE_queryToTarget(n1[0]))];case 3:_$t=_state.sent();_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;_state.label=4;case 4:_state.trys.push([4,9,10,11]);_iterator1=n1[Symbol.iterator]();_state.label=5;case 5:if(!!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done))return[3,8];_$e1=_step1.value;_$t1=_$r.ga.get(_$e1);return[4,__PRIVATE_synchronizeViewAndComputeSnapshot(_$r,_$t1)];case 6:n2=_state.sent();n2.snapshot&&s.push(n2.snapshot);_state.label=7;case 7:_iteratorNormalCompletion1=true;return[3,5];case 8:return[3,11];case 9:err=_state.sent();_didIteratorError1=true;_iteratorError1=err;return[3,11];case 10:try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}return[7];case 11:return[3,16];case 12:return[4,__PRIVATE_localStoreGetCachedTarget(_$r.localStore,_$e)];case 13:n3=_state.sent();return[4,__PRIVATE_localStoreAllocateTarget(_$r.localStore,n3)];case 14:_$t=_state.sent();return[4,__PRIVATE_initializeViewAndComputeSnapshot(_$r,__PRIVATE_synthesizeTargetToQuery(n3),_$e,!1,_$t.resumeToken)];case 15:_state.sent();_state.label=16;case 16:i.push(_$t);_state.label=17;case 17:_iteratorNormalCompletion=true;return[3,2];case 18:return[3,21];case 19:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,21];case 20:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 21:return[2,(_$r.fa.u_(s),i)]}})});return ___PRIVATE_synchronizeQueryViewsAndRaiseSnapshots.apply(this,arguments)}function __PRIVATE_synthesizeTargetToQuery(e){return __PRIVATE_newQuery(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function __PRIVATE_syncEngineGetActiveClients(e){return function __PRIVATE_localStoreGetActiveClients(e){return __PRIVATE_debugCast(__PRIVATE_debugCast(e).persistence).Li()}(__PRIVATE_debugCast(e).localStore)}function __PRIVATE_syncEngineApplyTargetState(e,t,n,r){return ___PRIVATE_syncEngineApplyTargetState.apply(this,arguments)}function ___PRIVATE_syncEngineApplyTargetState(){___PRIVATE_syncEngineApplyTargetState=_async_to_generator$3(function(e,t,n,r){var i,s,_$e,_$r;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:i=__PRIVATE_debugCast(e);if(i.Fa)return[2,void __PRIVATE_logDebug("SyncEngine","Ignoring unexpected query state notification.")];s=i.pa.get(t);if(!(s&&s.length>0))return[3,7];switch(n){case"current":return[3,1];case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,__PRIVATE_localStoreGetNewDocumentChanges(i.localStore,__PRIVATE_queryCollectionGroup(s[0]))];case 2:_$e=_state.sent(),_$r=RemoteEvent.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,ByteString.EMPTY_BYTE_STRING);return[4,__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(i,_$e,_$r)];case 3:_state.sent();return[3,7];case 4:return[4,__PRIVATE_localStoreReleaseTarget(i.localStore,t,!0)];case 5:_state.sent(),__PRIVATE_removeAndCleanupTarget(i,t,r);return[3,7];case 6:fail();_state.label=7;case 7:return[2]}})});return ___PRIVATE_syncEngineApplyTargetState.apply(this,arguments)}function __PRIVATE_syncEngineApplyActiveTargetsChange(e,t,n){return ___PRIVATE_syncEngineApplyActiveTargetsChange.apply(this,arguments)}function ___PRIVATE_syncEngineApplyActiveTargetsChange(){___PRIVATE_syncEngineApplyActiveTargetsChange=_async_to_generator$3(function(e,t,n){var _$r,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_$e,_$t,_$n,err,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_loop,_iterator1,_step1,err;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$r=__PRIVATE_ensureWatchCallbacks(e);if(!_$r.Fa)return[3,18];_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=1;case 1:_state.trys.push([1,8,9,10]);_iterator=t[Symbol.iterator]();_state.label=2;case 2:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,7];_$e=_step.value;if(_$r.pa.has(_$e)){__PRIVATE_logDebug("SyncEngine","Adding an already active target "+_$e);return[3,6]}return[4,__PRIVATE_localStoreGetCachedTarget(_$r.localStore,_$e)];case 3:_$t=_state.sent();return[4,__PRIVATE_localStoreAllocateTarget(_$r.localStore,_$t)];case 4:_$n=_state.sent();return[4,__PRIVATE_initializeViewAndComputeSnapshot(_$r,__PRIVATE_synthesizeTargetToQuery(_$t),_$n.targetId,!1,_$n.resumeToken)];case 5:_state.sent(),__PRIVATE_remoteStoreListen(_$r.remoteStore,_$n);_state.label=6;case 6:_iteratorNormalCompletion=true;return[3,2];case 7:return[3,10];case 8:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,10];case 9:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 10:_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;_state.label=11;case 11:_state.trys.push([11,16,17,18]);_loop=function _loop(){var _$e,_tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_$e=_step1.value;_tmp=_$r.pa.has(_$e);if(!_tmp)return[3,2];return[4,__PRIVATE_localStoreReleaseTarget(_$r.localStore,_$e,!1).then(function(){__PRIVATE_remoteStoreUnlisten(_$r.remoteStore,_$e),__PRIVATE_removeAndCleanupTarget(_$r,_$e)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})};_iterator1=n[Symbol.iterator]();_state.label=12;case 12:if(!!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done))return[3,15];return[5,_ts_values(_loop())];case 13:_state.sent();_state.label=14;case 14:_iteratorNormalCompletion1=true;return[3,12];case 15:return[3,18];case 16:err=_state.sent();_didIteratorError1=true;_iteratorError1=err;return[3,18];case 17:try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}return[7];case 18:return[2]}})});return ___PRIVATE_syncEngineApplyActiveTargetsChange.apply(this,arguments)}function __PRIVATE_ensureWatchCallbacks(e){var t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,t),t.fa.u_=__PRIVATE_eventManagerOnWatchChange.bind(null,t.eventManager),t.fa.xa=__PRIVATE_eventManagerOnWatchError.bind(null,t.eventManager),t}function __PRIVATE_syncEngineEnsureWriteCallbacks(e){var t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,t),t}var MemoryOfflineComponentProvider=function(){function MemoryOfflineComponentProvider(){_class_call_check$1(this,MemoryOfflineComponentProvider);this.synchronizeTabs=!1}_create_class$1(MemoryOfflineComponentProvider,[{key:"initialize",value:function initialize(e){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_this.serializer=__PRIVATE_newSerializer(e.databaseInfo.databaseId),_this.sharedClientState=_this.createSharedClientState(e),_this.persistence=_this.createPersistence(e);return[4,_this.persistence.start()];case 1:_state.sent(),_this.localStore=_this.createLocalStore(e),_this.gcScheduler=_this.createGarbageCollectionScheduler(e,_this.localStore),_this.indexBackfillerScheduler=_this.createIndexBackfillerScheduler(e,_this.localStore);return[2]}})})()}},{key:"createGarbageCollectionScheduler",value:function createGarbageCollectionScheduler(e,t){return null}},{key:"createIndexBackfillerScheduler",value:function createIndexBackfillerScheduler(e,t){return null}},{key:"createLocalStore",value:function createLocalStore(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}},{key:"createPersistence",value:function createPersistence(e){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Hr,this.serializer)}},{key:"createSharedClientState",value:function createSharedClientState(e){return new __PRIVATE_MemorySharedClientState}},{key:"terminate",value:function terminate(){var _this=this;return _async_to_generator$3(function(){var e,t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:null===(e=_this.gcScheduler)||void 0===e||e.stop(),null===(t=_this.indexBackfillerScheduler)||void 0===t||t.stop(),_this.sharedClientState.shutdown();return[4,_this.persistence.shutdown()];case 1:_state.sent();return[2]}})})()}}]);return MemoryOfflineComponentProvider}();var __PRIVATE_LruGcMemoryOfflineComponentProvider=function(MemoryOfflineComponentProvider){_inherits$1(__PRIVATE_LruGcMemoryOfflineComponentProvider,MemoryOfflineComponentProvider);var _super=_create_super$1(__PRIVATE_LruGcMemoryOfflineComponentProvider);function __PRIVATE_LruGcMemoryOfflineComponentProvider(e){_class_call_check$1(this,__PRIVATE_LruGcMemoryOfflineComponentProvider);var _this;_this=_super.call(this),_this.cacheSizeBytes=e;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_LruGcMemoryOfflineComponentProvider,[{key:"createGarbageCollectionScheduler",value:function createGarbageCollectionScheduler(e,t){__PRIVATE_hardAssert(_instanceof$1(this.persistence.referenceDelegate,__PRIVATE_MemoryLruDelegate));var n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}},{key:"createPersistence",value:function createPersistence(e){var t=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence(function(e){return __PRIVATE_MemoryLruDelegate.Hr(e,t)},this.serializer)}}]);return __PRIVATE_LruGcMemoryOfflineComponentProvider}(MemoryOfflineComponentProvider);var __PRIVATE_IndexedDbOfflineComponentProvider=function(MemoryOfflineComponentProvider){_inherits$1(__PRIVATE_IndexedDbOfflineComponentProvider,MemoryOfflineComponentProvider);var _super=_create_super$1(__PRIVATE_IndexedDbOfflineComponentProvider);function __PRIVATE_IndexedDbOfflineComponentProvider(e,t,n){_class_call_check$1(this,__PRIVATE_IndexedDbOfflineComponentProvider);var _this;_this=_super.call(this),_this.Na=e,_this.cacheSizeBytes=t,_this.forceOwnership=n,_this.synchronizeTabs=!1;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_IndexedDbOfflineComponentProvider,[{key:"initialize",value:function initialize(e){var _this=this;var _this1=this,_superprop_get_initialize=function _superprop_get_initialize(){return _get$1(_get_prototype_of$1(__PRIVATE_IndexedDbOfflineComponentProvider.prototype),"initialize",_this)};return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_superprop_get_initialize().call(_this1,e)];case 1:_state.sent();return[4,_this1.Na.initialize(_this1,e)];case 2:_state.sent();return[4,__PRIVATE_syncEngineEnsureWriteCallbacks(_this1.Na.syncEngine)];case 3:_state.sent();return[4,__PRIVATE_fillWritePipeline(_this1.Na.remoteStore)];case 4:_state.sent();return[4,_this1.persistence.fi(function(){return _this1.gcScheduler&&!_this1.gcScheduler.started&&_this1.gcScheduler.start(),_this1.indexBackfillerScheduler&&!_this1.indexBackfillerScheduler.started&&_this1.indexBackfillerScheduler.start(),Promise.resolve()})];case 5:_state.sent();return[2]}})})()}},{key:"createLocalStore",value:function createLocalStore(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}},{key:"createGarbageCollectionScheduler",value:function createGarbageCollectionScheduler(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}},{key:"createIndexBackfillerScheduler",value:function createIndexBackfillerScheduler(e,t){var n=new __PRIVATE_IndexBackfiller(t,this.persistence);return new __PRIVATE_IndexBackfillerScheduler(e.asyncQueue,n)}},{key:"createPersistence",value:function createPersistence(e){var t=__PRIVATE_indexedDbStoragePrefix(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_IndexedDbPersistence(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,__PRIVATE_getWindow(),getDocument(),this.serializer,this.sharedClientState,!!this.forceOwnership)}},{key:"createSharedClientState",value:function createSharedClientState(e){return new __PRIVATE_MemorySharedClientState}}]);return __PRIVATE_IndexedDbOfflineComponentProvider}(MemoryOfflineComponentProvider);var __PRIVATE_MultiTabOfflineComponentProvider=function(__PRIVATE_IndexedDbOfflineComponentProvider){_inherits$1(__PRIVATE_MultiTabOfflineComponentProvider,__PRIVATE_IndexedDbOfflineComponentProvider);var _super=_create_super$1(__PRIVATE_MultiTabOfflineComponentProvider);function __PRIVATE_MultiTabOfflineComponentProvider(e,t){_class_call_check$1(this,__PRIVATE_MultiTabOfflineComponentProvider);var _this;_this=_super.call(this,e,t,!1),_this.Na=e,_this.cacheSizeBytes=t,_this.synchronizeTabs=!0;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_MultiTabOfflineComponentProvider,[{key:"initialize",value:function initialize(e){var _this=this;var _this1=this,_superprop_get_initialize=function _superprop_get_initialize(){return _get$1(_get_prototype_of$1(__PRIVATE_MultiTabOfflineComponentProvider.prototype),"initialize",_this)};return _async_to_generator$3(function(){var t,_tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_superprop_get_initialize().call(_this1,e)];case 1:_state.sent();t=_this1.Na.syncEngine;_tmp=_instanceof$1(_this1.sharedClientState,__PRIVATE_WebStorageSharedClientState);if(!_tmp)return[3,3];_this1.sharedClientState.syncEngine={Zs:__PRIVATE_syncEngineApplyBatchState.bind(null,t),Xs:__PRIVATE_syncEngineApplyTargetState.bind(null,t),eo:__PRIVATE_syncEngineApplyActiveTargetsChange.bind(null,t),Li:__PRIVATE_syncEngineGetActiveClients.bind(null,t),Ys:__PRIVATE_syncEngineSynchronizeWithChangedDocuments.bind(null,t)};return[4,_this1.sharedClientState.start()];case 2:_tmp=_state.sent();_state.label=3;case 3:return[4,_this1.persistence.fi(function(){var _ref=_async_to_generator$3(function(e){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,__PRIVATE_syncEngineApplyPrimaryState(_this1.Na.syncEngine,e)];case 1:_state.sent(),_this1.gcScheduler&&(e&&!_this1.gcScheduler.started?_this1.gcScheduler.start():e||_this1.gcScheduler.stop()),_this1.indexBackfillerScheduler&&(e&&!_this1.indexBackfillerScheduler.started?_this1.indexBackfillerScheduler.start():e||_this1.indexBackfillerScheduler.stop());return[2]}})});return function(e){return _ref.apply(this,arguments)}}())];case 4:_state.sent();return[2]}})})()}},{key:"createSharedClientState",value:function createSharedClientState(e){var t=__PRIVATE_getWindow();if(!__PRIVATE_WebStorageSharedClientState.D(t))throw new FirestoreError(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=__PRIVATE_indexedDbStoragePrefix(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new __PRIVATE_WebStorageSharedClientState(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]);return __PRIVATE_MultiTabOfflineComponentProvider}(__PRIVATE_IndexedDbOfflineComponentProvider);var OnlineComponentProvider=function(){function OnlineComponentProvider(){_class_call_check$1(this,OnlineComponentProvider)}_create_class$1(OnlineComponentProvider,[{key:"initialize",value:function initialize(e,t){var _this=this;return _async_to_generator$3(function(){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=_this.localStore;if(_tmp)return[3,2];_this.localStore=e.localStore,_this.sharedClientState=e.sharedClientState,_this.datastore=_this.createDatastore(t),_this.remoteStore=_this.createRemoteStore(t),_this.eventManager=_this.createEventManager(t),_this.syncEngine=_this.createSyncEngine(t,!e.synchronizeTabs),_this.sharedClientState.onlineStateHandler=function(e){return __PRIVATE_syncEngineApplyOnlineStateChange(_this.syncEngine,e,1)},_this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,_this.syncEngine);return[4,__PRIVATE_remoteStoreApplyPrimaryState(_this.remoteStore,_this.syncEngine.isPrimaryClient)];case 1:_tmp=_state.sent();_state.label=2;case 2:return[2]}})})()}},{key:"createEventManager",value:function createEventManager(e){return function __PRIVATE_newEventManager(){return new __PRIVATE_EventManagerImpl}()}},{key:"createDatastore",value:function createDatastore(e){var t=__PRIVATE_newSerializer(e.databaseInfo.databaseId),n=function __PRIVATE_newConnection(e){return new __PRIVATE_WebChannelConnection(e)}(e.databaseInfo);return function __PRIVATE_newDatastore(e,t,n,r){return new __PRIVATE_DatastoreImpl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function createRemoteStore(e){var _this=this;return function __PRIVATE_newRemoteStore(e,t,n,r,i){return new __PRIVATE_RemoteStoreImpl(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,function(e){return __PRIVATE_syncEngineApplyOnlineStateChange(_this.syncEngine,e,0)},function __PRIVATE_newConnectivityMonitor(){return __PRIVATE_BrowserConnectivityMonitor.D()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}},{key:"createSyncEngine",value:function createSyncEngine(e,t){return function __PRIVATE_newSyncEngine(e,t,n,r,i,s,o){var _=new __PRIVATE_SyncEngineImpl(e,t,n,r,i,s);return o&&(_.Fa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function terminate(){var _this=this;return _async_to_generator$3(function(){var e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,(function(){var ___PRIVATE_remoteStoreShutdown=_async_to_generator$3(function(e){var t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:t=__PRIVATE_debugCast(e);__PRIVATE_logDebug("RemoteStore","RemoteStore shutting down."),t.v_.add(5);return[4,__PRIVATE_disableNetworkInternal(t)];case 1:_state.sent(),t.M_.shutdown(),t.x_.set("Unknown");return[2]}})});function __PRIVATE_remoteStoreShutdown(e){return ___PRIVATE_remoteStoreShutdown.apply(this,arguments)}return __PRIVATE_remoteStoreShutdown})()(_this.remoteStore)];case 1:_state.sent(),null===(e=_this.datastore)||void 0===e||e.terminate();return[2]}})})()}}]);return OnlineComponentProvider}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_AsyncObserver=function(){function __PRIVATE_AsyncObserver(e){_class_call_check$1(this,__PRIVATE_AsyncObserver);this.observer=e,this.muted=!1}_create_class$1(__PRIVATE_AsyncObserver,[{key:"next",value:function next(e){this.observer.next&&this.Ba(this.observer.next,e)}},{key:"error",value:function error(e){this.observer.error?this.Ba(this.observer.error,e):__PRIVATE_logError("Uncaught Error in snapshot listener:",e.toString())}},{key:"La",value:function La(){this.muted=!0}},{key:"Ba",value:function Ba(e,t){var _this=this;this.muted||setTimeout(function(){_this.muted||e(t)},0)}}]);return __PRIVATE_AsyncObserver}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function __PRIVATE_BundleReaderImpl(e,t){var _this=this;_class_call_check$1(this,__PRIVATE_BundleReaderImpl);this.ka=e,this.serializer=t,this.metadata=new __PRIVATE_Deferred,this.buffer=new Uint8Array,this.qa=function __PRIVATE_newTextDecoder(){return new TextDecoder("utf-8")}(),this.Qa().then(function(e){e&&e.ea()?_this.metadata.resolve(e.X_.metadata):_this.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.X_))))},function(e){return _this.metadata.reject(e)})}_create_class$1(__PRIVATE_BundleReaderImpl,[{key:"close",value:function close(){return this.ka.cancel()}},{key:"getMetadata",value:function getMetadata(){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){return[2,_this.metadata.promise]})})()}},{key:"Oa",value:function Oa(){var _this=this;return _async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_this.getMetadata()];case 1:return[2,(_state.sent(),_this.Qa())]}})})()}},{key:"Qa",value:function Qa(){var _this=this;return _async_to_generator$3(function(){var e,t,n,_$r;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_this.Ka()];case 1:e=_state.sent();if(null===e)return[2,null];t=_this.qa.decode(e),n=Number(t);isNaN(n)&&_this.$a("length string (".concat(t,") is not valid number"));return[4,_this.Ua(n)];case 2:_$r=_state.sent();return[2,new __PRIVATE_SizedBundleElement(JSON.parse(_$r),e.length+n)]}})})()}},{key:"Wa",value:function Wa(){return this.buffer.findIndex(function(e){return e==="{".charCodeAt(0)})}},{key:"Ka",value:function Ka(){var _this=this;return _async_to_generator$3(function(){var e,t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!(_this.Wa()<0))return[3,3];return[4,_this.Ga()];case 1:if(_state.sent())return[3,3];_state.label=2;case 2:return[3,0];case 3:if(0===_this.buffer.length)return[2,null];e=_this.Wa();e<0&&_this.$a("Reached the end of bundle when a length string is expected.");t=_this.buffer.slice(0,e);return[2,(_this.buffer=_this.buffer.slice(e),t)]}})})()}},{key:"Ua",value:function Ua(e){var _this=this;return _async_to_generator$3(function(){var t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!(_this.buffer.length<e))return[3,3];return[4,_this.Ga()];case 1:_state.sent()&&_this.$a("Reached the end of bundle when more is expected.");_state.label=2;case 2:return[3,0];case 3:t=_this.qa.decode(_this.buffer.slice(0,e));return[2,(_this.buffer=_this.buffer.slice(e),t)]}})})()}},{key:"$a",value:function $a(e){throw this.ka.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"Ga",value:function Ga(){var _this=this;return _async_to_generator$3(function(){var e,t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,_this.ka.read()];case 1:e=_state.sent();if(!e.done){t=new Uint8Array(_this.buffer.length+e.value.length);t.set(_this.buffer),t.set(e.value,_this.buffer.length),_this.buffer=t}return[2,e.done]}})})()}}]);return __PRIVATE_BundleReaderImpl})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Transaction$2=function(){function Transaction$2(e){_class_call_check$1(this,Transaction$2);this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}_create_class$1(Transaction$2,[{key:"lookup",value:function lookup(e){var _this=this;return _async_to_generator$3(function(){var t;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(_this.ensureCommitNotCalled(),_this.mutations.length>0)throw _this.lastTransactionError=new FirestoreError(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),_this.lastTransactionError;return[4,(function(){var ___PRIVATE_invokeBatchGetDocumentsRpc=_async_to_generator$3(function(e,t){var n,_$r,i,s,o;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e),_$r={documents:t.map(function(e){return __PRIVATE_toName(n.serializer,e)})};return[4,n.vo("BatchGetDocuments",n.serializer.databaseId,ResourcePath.emptyPath(),_$r,t.length)];case 1:i=_state.sent(),s=new Map;i.forEach(function(e){var _$t=__PRIVATE_fromBatchGetDocumentsResponse(n.serializer,e);s.set(_$t.key.toString(),_$t)});o=[];return[2,(t.forEach(function(e){var _$t=s.get(e.toString());__PRIVATE_hardAssert(!!_$t),o.push(_$t)}),o)]}})});function __PRIVATE_invokeBatchGetDocumentsRpc(e,t){return ___PRIVATE_invokeBatchGetDocumentsRpc.apply(this,arguments)}return __PRIVATE_invokeBatchGetDocumentsRpc})()(_this.datastore,e)];case 1:t=_state.sent();return[2,(t.forEach(function(e){return _this.recordVersion(e)}),t)]}})})()}},{key:"set",value:function set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function _delete(e){this.write(new __PRIVATE_DeleteMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function commit(){var _this=this;return _async_to_generator$3(function(){var e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(_this.ensureCommitNotCalled(),_this.lastTransactionError)throw _this.lastTransactionError;e=_this.readVersions;_this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(e,t){var n=DocumentKey.fromPath(t);_this.mutations.push(new __PRIVATE_VerifyMutation(n,_this.precondition(n)))});return[4,(function(){var ___PRIVATE_invokeCommitRpc=_async_to_generator$3(function(e,t){var n,_$r;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:n=__PRIVATE_debugCast(e),_$r={writes:t.map(function(e){return toMutation(n.serializer,e)})};return[4,n.So("Commit",n.serializer.databaseId,ResourcePath.emptyPath(),_$r)];case 1:_state.sent();return[2]}})});function __PRIVATE_invokeCommitRpc(e,t){return ___PRIVATE_invokeCommitRpc.apply(this,arguments)}return __PRIVATE_invokeCommitRpc})()(_this.datastore,_this.mutations)];case 1:_state.sent(),_this.committed=!0;return[2]}})})()}},{key:"recordVersion",value:function recordVersion(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw fail();t=SnapshotVersion.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new FirestoreError(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(SnapshotVersion.min())?Precondition.exists(!1):Precondition.updateTime(t):Precondition.none()}},{key:"preconditionForUpdate",value:function preconditionForUpdate(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(SnapshotVersion.min()))throw new FirestoreError(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Precondition.updateTime(t)}return Precondition.exists(!0)}},{key:"write",value:function write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function ensureCommitNotCalled(){}}]);return Transaction$2}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function __PRIVATE_TransactionRunner(e,t,n,r,i){_class_call_check$1(this,__PRIVATE_TransactionRunner);this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.za=n.maxAttempts,this.jo=new __PRIVATE_ExponentialBackoff(this.asyncQueue,"transaction_retry")}_create_class$1(__PRIVATE_TransactionRunner,[{key:"ja",value:function ja(){this.za-=1,this.Ha()}},{key:"Ha",value:function Ha(){var _this=this;this.jo.qo(_async_to_generator$3(function(){var e,t;return _ts_generator$1(this,function(_state){e=new Transaction$2(_this.datastore),t=_this.Ja(e);t&&t.then(function(t){_this.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){_this.deferred.resolve(t)}).catch(function(e){_this.Ya(e)})})}).catch(function(e){_this.Ya(e)});return[2]})}))}},{key:"Ja",value:function Ja(e){try{var t=this.updateFunction(e);return!__PRIVATE_isNullOrUndefined(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Ya",value:function Ya(e){var _this=this;this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget(function(){return _this.Ha(),Promise.resolve()})):this.deferred.reject(e)}},{key:"Za",value:function Za(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!__PRIVATE_isPermanentError(t)}return!1}}]);return __PRIVATE_TransactionRunner})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FirestoreClient=function(){function FirestoreClient(e,t,n,r){var _this=this;_class_call_check$1(this,FirestoreClient);var _this1=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(n,function(){var _ref=_async_to_generator$3(function(e){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:__PRIVATE_logDebug("FirestoreClient","Received user=",e.uid);return[4,_this1.authCredentialListener(e)];case 1:_state.sent(),_this1.user=e;return[2]}})});return function(e){return _ref.apply(this,arguments)}}()),this.appCheckCredentials.start(n,function(e){return __PRIVATE_logDebug("FirestoreClient","Received new app check token=",e),_this.appCheckCredentialListener(e,_this.user)})}_create_class$1(FirestoreClient,[{key:"configuration",get:function get(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}},{key:"setCredentialChangeListener",value:function setCredentialChangeListener(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new FirestoreError(D.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function terminate(){this.asyncQueue.enterRestrictedMode();var e=new __PRIVATE_Deferred;var _this=this;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(_async_to_generator$3(function(){var _tmp,_tmp1,t,n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,5,,6]);_tmp=_this._onlineComponents;if(!_tmp)return[3,2];return[4,_this._onlineComponents.terminate()];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp1=_this._offlineComponents;if(!_tmp1)return[3,4];return[4,_this._offlineComponents.terminate()];case 3:_tmp1=_state.sent();_state.label=4;case 4:_this.authCredentials.shutdown(),_this.appCheckCredentials.shutdown(),e.resolve();return[3,6];case 5:t=_state.sent();n=__PRIVATE_wrapInUserErrorIfRecoverable(t,"Failed to shutdown persistence");e.reject(n);return[3,6];case 6:return[2]}})})),e.promise}}]);return FirestoreClient}();function __PRIVATE_setOfflineComponentProvider(e,t){return ___PRIVATE_setOfflineComponentProvider.apply(this,arguments)}function ___PRIVATE_setOfflineComponentProvider(){___PRIVATE_setOfflineComponentProvider=_async_to_generator$3(function(e,t){var n,_$r;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:e.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug("FirestoreClient","Initializing OfflineComponentProvider");n=e.configuration;return[4,t.initialize(n)];case 1:_state.sent();_$r=n.initialUser;e.setCredentialChangeListener(function(){var _ref=_async_to_generator$3(function(e){var _tmp;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=_$r.isEqual(e);if(_tmp)return[3,2];return[4,__PRIVATE_localStoreHandleUserChange(t.localStore,e)];case 1:_tmp=(_state.sent(),_$r=e);_state.label=2;case 2:return[2]}})});return function(e){return _ref.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e._offlineComponents=t;return[2]}})});return ___PRIVATE_setOfflineComponentProvider.apply(this,arguments)}function __PRIVATE_setOnlineComponentProvider(e,t){return ___PRIVATE_setOnlineComponentProvider.apply(this,arguments)}function ___PRIVATE_setOnlineComponentProvider(){___PRIVATE_setOnlineComponentProvider=_async_to_generator$3(function(e,t){var n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:e.asyncQueue.verifyOperationInProgress();return[4,__PRIVATE_ensureOfflineComponents(e)];case 1:n=_state.sent();__PRIVATE_logDebug("FirestoreClient","Initializing OnlineComponentProvider");return[4,t.initialize(n,e.configuration)];case 2:_state.sent(),e.setCredentialChangeListener(function(e){return __PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,e)}),e.setAppCheckTokenChangeListener(function(e,n){return __PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,n)}),e._onlineComponents=t;return[2]}})});return ___PRIVATE_setOnlineComponentProvider.apply(this,arguments)}function __PRIVATE_canFallbackFromIndexedDbError(e){return"FirebaseError"===e.name?e.code===D.FAILED_PRECONDITION||e.code===D.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&_instanceof$1(e,DOMException))||22===e.code||20===e.code||11===e.code}function __PRIVATE_ensureOfflineComponents(e){return ___PRIVATE_ensureOfflineComponents.apply(this,arguments)}function ___PRIVATE_ensureOfflineComponents(){___PRIVATE_ensureOfflineComponents=_async_to_generator$3(function(e){var t,n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!!e._offlineComponents)return[3,8];if(!e._uninitializedComponentsProvider)return[3,6];__PRIVATE_logDebug("FirestoreClient","Using user provided OfflineComponentProvider");_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,__PRIVATE_setOfflineComponentProvider(e,e._uninitializedComponentsProvider._offline)];case 2:_state.sent();return[3,5];case 3:t=_state.sent();n=t;if(!__PRIVATE_canFallbackFromIndexedDbError(n))throw n;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+n);return[4,__PRIVATE_setOfflineComponentProvider(e,new MemoryOfflineComponentProvider)];case 4:_state.sent();return[3,5];case 5:return[3,8];case 6:__PRIVATE_logDebug("FirestoreClient","Using default OfflineComponentProvider");return[4,__PRIVATE_setOfflineComponentProvider(e,new MemoryOfflineComponentProvider)];case 7:_state.sent();_state.label=8;case 8:return[2,e._offlineComponents]}})});return ___PRIVATE_ensureOfflineComponents.apply(this,arguments)}function __PRIVATE_ensureOnlineComponents(e){return ___PRIVATE_ensureOnlineComponents.apply(this,arguments)}function ___PRIVATE_ensureOnlineComponents(){___PRIVATE_ensureOnlineComponents=_async_to_generator$3(function(e){var _tmp,_tmp1;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_tmp=e._onlineComponents;if(_tmp)return[3,5];if(!e._uninitializedComponentsProvider)return[3,2];__PRIVATE_logDebug("FirestoreClient","Using user provided OnlineComponentProvider");return[4,__PRIVATE_setOnlineComponentProvider(e,e._uninitializedComponentsProvider._online)];case 1:_tmp1=_state.sent();return[3,4];case 2:__PRIVATE_logDebug("FirestoreClient","Using default OnlineComponentProvider");return[4,__PRIVATE_setOnlineComponentProvider(e,new OnlineComponentProvider)];case 3:_tmp1=_state.sent();_state.label=4;case 4:_tmp=_tmp1;_state.label=5;case 5:return[2,e._onlineComponents]}})});return ___PRIVATE_ensureOnlineComponents.apply(this,arguments)}function __PRIVATE_getSyncEngine(e){return __PRIVATE_ensureOnlineComponents(e).then(function(e){return e.syncEngine})}function __PRIVATE_getEventManager(e){return ___PRIVATE_getEventManager.apply(this,arguments)}function ___PRIVATE_getEventManager(){___PRIVATE_getEventManager=_async_to_generator$3(function(e){var t,n;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,__PRIVATE_ensureOnlineComponents(e)];case 1:t=_state.sent(),n=t.eventManager;return[2,(n.onListen=__PRIVATE_syncEngineListen.bind(null,t.syncEngine),n.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,t.syncEngine),n)]}})});return ___PRIVATE_getEventManager.apply(this,arguments)}function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var _$r=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget(_async_to_generator$3(function(){var _;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_=function __PRIVATE_readDocumentViaSnapshotListener(e,t,n,r,i){var s=new __PRIVATE_AsyncObserver({next:function next(s){t.enqueueAndForget(function(){return __PRIVATE_eventManagerUnlisten(e,o)});var _=s.docs.has(n);!_&&s.fromCache?i.reject(new FirestoreError(D.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&s.fromCache&&r&&"server"===r.source?i.reject(new FirestoreError(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:function error(e){return i.reject(e)}}),o=new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(n.path),s,{includeMetadataChanges:!0,Z_:!0});return __PRIVATE_eventManagerListen(e,o)};return[4,__PRIVATE_getEventManager(e)];case 1:return[2,_.apply(void 0,[_state.sent(),e.asyncQueue,t,n,_$r])]}})})),_$r.promise}function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var _$r=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget(_async_to_generator$3(function(){var _;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:_=function __PRIVATE_executeQueryViaSnapshotListener(e,t,n,r,i){var s=new __PRIVATE_AsyncObserver({next:function next(n){t.enqueueAndForget(function(){return __PRIVATE_eventManagerUnlisten(e,o)}),n.fromCache&&"server"===r.source?i.reject(new FirestoreError(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function error(e){return i.reject(e)}}),o=new __PRIVATE_QueryListener(n,s,{includeMetadataChanges:!0,Z_:!0});return __PRIVATE_eventManagerListen(e,o)};return[4,__PRIVATE_getEventManager(e)];case 1:return[2,_.apply(void 0,[_state.sent(),e.asyncQueue,t,n,_$r])]}})})),_$r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_cloneLongPollingOptions(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var me=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateNonEmptyArgument(e,t,n){if(!n)throw new FirestoreError(D.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function __PRIVATE_validateIsNotUsedTogether(e,t,n,r){if(!0===t&&!0===r)throw new FirestoreError(D.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function __PRIVATE_validateDocumentPath(e){if(!DocumentKey.isDocumentKey(e))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function __PRIVATE_validateCollectionPath(e){if(DocumentKey.isDocumentKey(e))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function __PRIVATE_valueDescription(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(_instanceof$1(e,Array))return"an array";{var t=function __PRIVATE_tryGetCustomObjectType(e){if(e.constructor)return e.constructor.name;return null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":fail()}function __PRIVATE_cast(e,t){if("_delegate"in e&&(e=e._delegate),!_instanceof$1(e,t)){if(t.name===e.constructor.name)throw new FirestoreError(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{var n=__PRIVATE_valueDescription(e);throw new FirestoreError(D.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FirestoreSettingsImpl=function(){function FirestoreSettingsImpl(e){_class_call_check$1(this,FirestoreSettingsImpl);var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new FirestoreError(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=true}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new FirestoreError(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=true:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function __PRIVATE_validateLongPollingOptions(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new FirestoreError(D.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new FirestoreError(D.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new FirestoreError(D.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}_create_class$1(FirestoreSettingsImpl,[{key:"isEqual",value:function isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function __PRIVATE_longPollingOptionsEqual(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]);return FirestoreSettingsImpl}();var Firestore$1=function(){function Firestore$1(e,t,n,r){_class_call_check$1(this,Firestore$1);this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1}_create_class$1(Firestore$1,[{key:"app",get:function get(){if(!this._app)throw new FirestoreError(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function get(){return this._settingsFrozen}},{key:"_terminated",get:function get(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function _setSettings(e){if(this._settingsFrozen)throw new FirestoreError(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),void 0!==e.credentials&&(this._authCredentials=function __PRIVATE_makeAuthCredentialsProvider(e){if(!e)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(e.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new FirestoreError(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function _getSettings(){return this._settings}},{key:"_freezeSettings",value:function _freezeSettings(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function _delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function _terminate(){return function __PRIVATE_removeComponents(e){var t=me.get(e);t&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),me.delete(e),t.terminate())}(this),Promise.resolve()}}]);return Firestore$1}();function connectFirestoreEmulator(e,t,n){var _$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};var i;var s=(e=__PRIVATE_cast(e,Firestore$1))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==s.host&&s.host!==o&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),_$r.mockUserToken){var _$t,_$n;if("string"==typeof _$r.mockUserToken)_$t=_$r.mockUserToken,_$n=User.MOCK_USER;else{_$t=createMockUserToken(_$r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);var s1=_$r.mockUserToken.sub||_$r.mockUserToken.user_id;if(!s1)throw new FirestoreError(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_$n=new User(s1)}e._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(_$t,_$n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Query=function(){function Query(e,t,n){_class_call_check$1(this,Query);this.converter=t,this._query=n,this.type="query",this.firestore=e}_create_class$1(Query,[{key:"withConverter",value:function withConverter(e){return new Query(this.firestore,e,this._query)}}]);return Query}();var DocumentReference=function(){function DocumentReference(e,t,n){_class_call_check$1(this,DocumentReference);this.converter=t,this._key=n,this.type="document",this.firestore=e}_create_class$1(DocumentReference,[{key:"_path",get:function get(){return this._key.path}},{key:"id",get:function get(){return this._key.path.lastSegment()}},{key:"path",get:function get(){return this._key.path.canonicalString()}},{key:"parent",get:function get(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function withConverter(e){return new DocumentReference(this.firestore,e,this._key)}}]);return DocumentReference}();var CollectionReference=function(Query){_inherits$1(CollectionReference,Query);var _super=_create_super$1(CollectionReference);function CollectionReference(e,t,n){_class_call_check$1(this,CollectionReference);var _this;_this=_super.call(this,e,t,__PRIVATE_newQueryForPath(n)),_this._path=n,_this.type="collection";return _possible_constructor_return$1(_this)}_create_class$1(CollectionReference,[{key:"id",get:function get(){return this._query.path.lastSegment()}},{key:"path",get:function get(){return this._query.path.canonicalString()}},{key:"parent",get:function get(){var e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}},{key:"withConverter",value:function withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}]);return CollectionReference}(Query);function collection(e,t){for(var _len=arguments.length,n=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){n[_key-2]=arguments[_key]}if(e=getModularInstance(e),__PRIVATE_validateNonEmptyArgument("collection","path",t),_instanceof$1(e,Firestore$1)){var _ResourcePath;var _$r=(_ResourcePath=ResourcePath).fromString.apply(_ResourcePath,[t].concat(_to_consumable_array$1(n)));return __PRIVATE_validateCollectionPath(_$r),new CollectionReference(e,null,_$r)}{var _ResourcePath1;if(!(_instanceof$1(e,DocumentReference)||_instanceof$1(e,CollectionReference)))throw new FirestoreError(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var r1=e._path.child((_ResourcePath1=ResourcePath).fromString.apply(_ResourcePath1,[t].concat(_to_consumable_array$1(n))));return __PRIVATE_validateCollectionPath(r1),new CollectionReference(e.firestore,null,r1)}}function doc(e,t){for(var _len=arguments.length,n=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){n[_key-2]=arguments[_key]}if(e=getModularInstance(e),1===arguments.length&&(t=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",t),_instanceof$1(e,Firestore$1)){var _ResourcePath;var _$r=(_ResourcePath=ResourcePath).fromString.apply(_ResourcePath,[t].concat(_to_consumable_array$1(n)));return __PRIVATE_validateDocumentPath(_$r),new DocumentReference(e,null,new DocumentKey(_$r))}{var _ResourcePath1;if(!(_instanceof$1(e,DocumentReference)||_instanceof$1(e,CollectionReference)))throw new FirestoreError(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var r1=e._path.child((_ResourcePath1=ResourcePath).fromString.apply(_ResourcePath1,[t].concat(_to_consumable_array$1(n))));return __PRIVATE_validateDocumentPath(r1),new DocumentReference(e.firestore,_instanceof$1(e,CollectionReference)?e.converter:null,new DocumentKey(r1))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var __PRIVATE_AsyncQueueImpl=function(){function __PRIVATE_AsyncQueueImpl(){var _this=this;_class_call_check$1(this,__PRIVATE_AsyncQueueImpl);this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this._u=function(){var e=getDocument();e&&__PRIVATE_logDebug("AsyncQueue","Visibility state changed to "+e.visibilityState),_this.jo.Ko()};var e=getDocument();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}_create_class$1(__PRIVATE_AsyncQueueImpl,[{key:"isShuttingDown",get:function get(){return this.tu}},{key:"enqueueAndForget",value:function enqueueAndForget(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}},{key:"enterRestrictedMode",value:function enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;var t=getDocument();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}},{key:"enqueue",value:function enqueue(e){var _this=this;if(this.au(),this.tu)return new Promise(function(){});var t=new __PRIVATE_Deferred;return this.uu(function(){return _this.tu&&_this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)}).then(function(){return t.promise})}},{key:"enqueueRetryable",value:function enqueueRetryable(e){var _this=this;this.enqueueAndForget(function(){return _this.eu.push(e),_this.cu()})}},{key:"cu",value:function cu(){var _this=this;return _async_to_generator$3(function(){var e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:if(!(0!==_this.eu.length))return[3,5];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,_this.eu[0]()];case 2:_state.sent(),_this.eu.shift(),_this.jo.reset();return[3,4];case 3:e=_state.sent();if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug("AsyncQueue","Operation failed with retryable error: "+e);return[3,4];case 4:_this.eu.length>0&&_this.jo.qo(function(){return _this.cu()});_state.label=5;case 5:return[2]}})})()}},{key:"uu",value:function uu(e){var _this=this;var t=this.Xa.then(function(){return _this.iu=!0,e().catch(function(e){_this.ru=e,_this.iu=!1;var t=function __PRIVATE_getMessageOrStack(e){var t=e.message||"";e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack);return t}(e);throw __PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",t),e}).then(function(e){return _this.iu=!1,e})});return this.Xa=t,t}},{key:"enqueueAfterDelay",value:function enqueueAfterDelay(e,t,n){var _this=this;this.au(),this.ou.indexOf(e)>-1&&(t=0);var _$r=DelayedOperation.createAndSchedule(this,e,t,n,function(e){return _this.lu(e)});return this.nu.push(_$r),_$r}},{key:"au",value:function au(){this.ru&&fail()}},{key:"verifyOperationInProgress",value:function verifyOperationInProgress(){}},{key:"hu",value:function hu(){var _this=this;return _async_to_generator$3(function(){var e;return _ts_generator$1(this,function(_state){switch(_state.label){case 0:e=_this.Xa;return[4,e];case 1:_state.sent();_state.label=2;case 2:if(e!==_this.Xa)return[3,0];_state.label=3;case 3:return[2]}})})()}},{key:"Pu",value:function Pu(e){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.nu[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(t.timerId===e)return!0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return!1}},{key:"Iu",value:function Iu(e){var _this=this;return this.hu().then(function(){_this.nu.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_this.nu[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(t.skipDelay(),"all"!==e&&t.timerId===e)break}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _this.hu()})}},{key:"Tu",value:function Tu(e){this.ou.push(e)}},{key:"lu",value:function lu(e){var t=this.nu.indexOf(e);this.nu.splice(t,1)}}]);return __PRIVATE_AsyncQueueImpl}();(function(){function LoadBundleTask(){_class_call_check$1(this,LoadBundleTask);this._progressObserver={},this._taskCompletionResolver=new __PRIVATE_Deferred,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}_create_class$1(LoadBundleTask,[{key:"onProgress",value:function onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function _catch(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function then(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function _completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function _failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function _updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]);return LoadBundleTask})();var Firestore=function(Firestore$1){_inherits$1(Firestore,Firestore$1);var _super=_create_super$1(Firestore);function Firestore(e,t,n,r){_class_call_check$1(this,Firestore);var _this;_this=_super.call(this,e,t,n,r),_this.type="firestore",_this._queue=function __PRIVATE_newAsyncQueue(){return new __PRIVATE_AsyncQueueImpl}(),_this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]";return _possible_constructor_return$1(_this)}_create_class$1(Firestore,[{key:"_terminate",value:function _terminate(){return this._firestoreClient||__PRIVATE_configureFirestore(this),this._firestoreClient.terminate()}}]);return Firestore}(Firestore$1);function getFirestore(t,n){var _$r="object"==typeof t?t:getApp(),i="string"==typeof t?t:n||"(default)",s=_getProvider(_$r,"firestore").getImmediate({identifier:i});if(!s._initialized){var e=getDefaultEmulatorHostnameAndPort("firestore");e&&connectFirestoreEmulator.apply(void 0,[s].concat(_to_consumable_array$1(e)))}return s}function ensureFirestoreConfigured(e){return e._firestoreClient||__PRIVATE_configureFirestore(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function __PRIVATE_configureFirestore(e){var t,n,_$r;var i=e._freezeSettings(),s=function __PRIVATE_makeDatabaseInfo(e,t,n,r){return new DatabaseInfo(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new FirestoreClient(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(_$r=i.localCache)||void 0===_$r?void 0:_$r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}(function(){function AggregateQuerySnapshot(e,t,n){_class_call_check$1(this,AggregateQuerySnapshot);this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}_create_class$1(AggregateQuerySnapshot,[{key:"data",value:function data(){return this._userDataWriter.convertObjectMap(this._data)}}]);return AggregateQuerySnapshot})();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bytes=function(){function Bytes(e){_class_call_check$1(this,Bytes);this._byteString=e}_create_class$1(Bytes,[{key:"toBase64",value:function toBase64(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function toUint8Array(){return this._byteString.toUint8Array()}},{key:"toString",value:function toString(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function isEqual(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(e){throw new FirestoreError(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}},{key:"fromUint8Array",value:function fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}}]);return Bytes}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FieldPath=function(){function FieldPath(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}_class_call_check$1(this,FieldPath);for(var t=0;t<e.length;++t)if(0===e[t].length)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}_create_class$1(FieldPath,[{key:"isEqual",value:function isEqual(e){return this._internalPath.isEqual(e._internalPath)}}]);return FieldPath}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FieldValue=function FieldValue(e){_class_call_check$1(this,FieldValue);this._methodName=e};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var GeoPoint=function(){function GeoPoint(e,t){_class_call_check$1(this,GeoPoint);if(!isFinite(e)||e<-90||e>90)throw new FirestoreError(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new FirestoreError(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}_create_class$1(GeoPoint,[{key:"latitude",get:function get(){return this._lat}},{key:"longitude",get:function get(){return this._long}},{key:"isEqual",value:function isEqual(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function toJSON(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function _compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}}]);return GeoPoint}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge=/^__.*__$/;var ParsedSetData=function(){function ParsedSetData(e,t,n){_class_call_check$1(this,ParsedSetData);this.data=e,this.fieldMask=t,this.fieldTransforms=n}_create_class$1(ParsedSetData,[{key:"toMutation",value:function toMutation(e,t){return null!==this.fieldMask?new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms):new __PRIVATE_SetMutation(e,this.data,t,this.fieldTransforms)}}]);return ParsedSetData}();var ParsedUpdateData=function(){function ParsedUpdateData(e,t,n){_class_call_check$1(this,ParsedUpdateData);this.data=e,this.fieldMask=t,this.fieldTransforms=n}_create_class$1(ParsedUpdateData,[{key:"toMutation",value:function toMutation(e,t){return new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]);return ParsedUpdateData}();function __PRIVATE_isWrite(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail()}}var __PRIVATE_ParseContextImpl=function(){function __PRIVATE_ParseContextImpl(e,t,n,r,i,s){_class_call_check$1(this,__PRIVATE_ParseContextImpl);this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}_create_class$1(__PRIVATE_ParseContextImpl,[{key:"path",get:function get(){return this.settings.path}},{key:"du",get:function get(){return this.settings.du}},{key:"Au",value:function Au(e){return new __PRIVATE_ParseContextImpl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Ru",value:function Ru(e){var t;var n=null===(t=this.path)||void 0===t?void 0:t.child(e),_$r=this.Au({path:n,Vu:!1});return _$r.mu(e),_$r}},{key:"fu",value:function fu(e){var t;var n=null===(t=this.path)||void 0===t?void 0:t.child(e),_$r=this.Au({path:n,Vu:!1});return _$r.Eu(),_$r}},{key:"gu",value:function gu(e){return this.Au({path:void 0,Vu:!0})}},{key:"pu",value:function pu(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}},{key:"contains",value:function contains(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:"Eu",value:function Eu(){if(this.path)for(var e=0;e<this.path.length;e++)this.mu(this.path.get(e))}},{key:"mu",value:function mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(__PRIVATE_isWrite(this.du)&&ge.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}]);return __PRIVATE_ParseContextImpl}();var __PRIVATE_UserDataReader=function(){function __PRIVATE_UserDataReader(e,t,n){_class_call_check$1(this,__PRIVATE_UserDataReader);this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||__PRIVATE_newSerializer(e)}_create_class$1(__PRIVATE_UserDataReader,[{key:"Su",value:function Su(e,t,n){var _$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return new __PRIVATE_ParseContextImpl({du:e,methodName:t,wu:n,path:FieldPath$1.emptyPath(),Vu:!1,yu:_$r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]);return __PRIVATE_UserDataReader}();function __PRIVATE_newUserDataReader(e){var t=e._freezeSettings(),n=__PRIVATE_newSerializer(e._databaseId);return new __PRIVATE_UserDataReader(e._databaseId,!!t.ignoreUndefinedProperties,n)}function __PRIVATE_parseSetData(e,t,n,r,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};var o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);__PRIVATE_validatePlainObject("Data must be an object, but it was:",o,r);var _=__PRIVATE_parseObject(r,o);var a,u;if(s.merge)a=new FieldMask(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){var _$e=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=s.mergeFields[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$r=_step.value;var _$i=__PRIVATE_fieldPathFromArgument$1(t,_$r,n);if(!o.contains(_$i))throw new FirestoreError(D.INVALID_ARGUMENT,"Field '".concat(_$i,"' is specified in your field mask but missing from your input data."));__PRIVATE_fieldMaskContains(_$e,_$i)||_$e.push(_$i)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}a=new FieldMask(_$e),u=o.fieldTransforms.filter(function(e){return a.covers(e.field)})}else a=null,u=o.fieldTransforms;return new ParsedSetData(new ObjectValue(_),a,u)}var __PRIVATE_DeleteFieldValueImpl=function(FieldValue){_inherits$1(__PRIVATE_DeleteFieldValueImpl,FieldValue);var _super=_create_super$1(__PRIVATE_DeleteFieldValueImpl);function __PRIVATE_DeleteFieldValueImpl(){_class_call_check$1(this,__PRIVATE_DeleteFieldValueImpl);return _super.apply(this,arguments)}_create_class$1(__PRIVATE_DeleteFieldValueImpl,[{key:"_toFieldTransform",value:function _toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu("".concat(this._methodName,"() can only appear at the top level of your update data")):e.pu("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,__PRIVATE_DeleteFieldValueImpl)}}]);return __PRIVATE_DeleteFieldValueImpl}(FieldValue);function __PRIVATE_createSentinelChildContext(e,t,n){return new __PRIVATE_ParseContextImpl({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(function(FieldValue){_inherits$1(__PRIVATE_ServerTimestampFieldValueImpl,FieldValue);var _super=_create_super$1(__PRIVATE_ServerTimestampFieldValueImpl);function __PRIVATE_ServerTimestampFieldValueImpl(){_class_call_check$1(this,__PRIVATE_ServerTimestampFieldValueImpl);return _super.apply(this,arguments)}_create_class$1(__PRIVATE_ServerTimestampFieldValueImpl,[{key:"_toFieldTransform",value:function _toFieldTransform(e){return new FieldTransform(e.path,new __PRIVATE_ServerTimestampTransform)}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,__PRIVATE_ServerTimestampFieldValueImpl)}}]);return __PRIVATE_ServerTimestampFieldValueImpl})(FieldValue);(function(FieldValue){_inherits$1(__PRIVATE_ArrayUnionFieldValueImpl,FieldValue);var _super=_create_super$1(__PRIVATE_ArrayUnionFieldValueImpl);function __PRIVATE_ArrayUnionFieldValueImpl(e,t){_class_call_check$1(this,__PRIVATE_ArrayUnionFieldValueImpl);var _this;_this=_super.call(this,e),_this.bu=t;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_ArrayUnionFieldValueImpl,[{key:"_toFieldTransform",value:function _toFieldTransform(e){var t=__PRIVATE_createSentinelChildContext(this,e,!0),n=this.bu.map(function(e){return __PRIVATE_parseData(e,t)}),_$r=new __PRIVATE_ArrayUnionTransformOperation(n);return new FieldTransform(e.path,_$r)}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,__PRIVATE_ArrayUnionFieldValueImpl)&&deepEqual(this.bu,e.bu)}}]);return __PRIVATE_ArrayUnionFieldValueImpl})(FieldValue);(function(FieldValue){_inherits$1(__PRIVATE_ArrayRemoveFieldValueImpl,FieldValue);var _super=_create_super$1(__PRIVATE_ArrayRemoveFieldValueImpl);function __PRIVATE_ArrayRemoveFieldValueImpl(e,t){_class_call_check$1(this,__PRIVATE_ArrayRemoveFieldValueImpl);var _this;_this=_super.call(this,e),_this.bu=t;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_ArrayRemoveFieldValueImpl,[{key:"_toFieldTransform",value:function _toFieldTransform(e){var t=__PRIVATE_createSentinelChildContext(this,e,!0),n=this.bu.map(function(e){return __PRIVATE_parseData(e,t)}),_$r=new __PRIVATE_ArrayRemoveTransformOperation(n);return new FieldTransform(e.path,_$r)}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,__PRIVATE_ArrayRemoveFieldValueImpl)&&deepEqual(this.bu,e.bu)}}]);return __PRIVATE_ArrayRemoveFieldValueImpl})(FieldValue);(function(FieldValue){_inherits$1(__PRIVATE_NumericIncrementFieldValueImpl,FieldValue);var _super=_create_super$1(__PRIVATE_NumericIncrementFieldValueImpl);function __PRIVATE_NumericIncrementFieldValueImpl(e,t){_class_call_check$1(this,__PRIVATE_NumericIncrementFieldValueImpl);var _this;_this=_super.call(this,e),_this.Du=t;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_NumericIncrementFieldValueImpl,[{key:"_toFieldTransform",value:function _toFieldTransform(e){var t=new __PRIVATE_NumericIncrementTransformOperation(e.serializer,toNumber(e.serializer,this.Du));return new FieldTransform(e.path,t)}},{key:"isEqual",value:function isEqual(e){return _instanceof$1(e,__PRIVATE_NumericIncrementFieldValueImpl)&&this.Du===e.Du}}]);return __PRIVATE_NumericIncrementFieldValueImpl})(FieldValue);function __PRIVATE_parseUpdateData(e,t,n,r){var i=e.Su(1,t,n);__PRIVATE_validatePlainObject("Data must be an object, but it was:",i,r);var s=[],o=ObjectValue.empty();forEach(r,function(e,r){var _=__PRIVATE_fieldPathFromDotSeparatedString(t,e,n);r=getModularInstance(r);var a=i.fu(_);if(_instanceof$1(r,__PRIVATE_DeleteFieldValueImpl))s.push(_);else{var _$e=__PRIVATE_parseData(r,a);null!=_$e&&(s.push(_),o.set(_,_$e))}});var _=new FieldMask(s);return new ParsedUpdateData(o,_,i.fieldTransforms)}function __PRIVATE_parseUpdateVarargs(e,t,n,r,i,s){var o=e.Su(1,t,n),_=[__PRIVATE_fieldPathFromArgument$1(t,r,n)],a=[i];if(s.length%2!=0)throw new FirestoreError(D.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var _$e=0;_$e<s.length;_$e+=2)_.push(__PRIVATE_fieldPathFromArgument$1(t,s[_$e])),a.push(s[_$e+1]);var u=[],c=ObjectValue.empty();for(var _$e1=_.length-1;_$e1>=0;--_$e1)if(!__PRIVATE_fieldMaskContains(u,_[_$e1])){var _$t=_[_$e1];var _$n=a[_$e1];_$n=getModularInstance(_$n);var _$r=o.fu(_$t);if(_instanceof$1(_$n,__PRIVATE_DeleteFieldValueImpl))u.push(_$t);else{var _$e2=__PRIVATE_parseData(_$n,_$r);null!=_$e2&&(u.push(_$t),c.set(_$t,_$e2))}}var l=new FieldMask(u);return new ParsedUpdateData(c,l,o.fieldTransforms)}function __PRIVATE_parseQueryValue(e,t,n){var _$r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return __PRIVATE_parseData(n,e.Su(_$r?4:3,t))}function __PRIVATE_parseData(e,t){if(__PRIVATE_looksLikeJsonObject(e=getModularInstance(e)))return __PRIVATE_validatePlainObject("Unsupported field value:",t,e),__PRIVATE_parseObject(e,t);if(_instanceof$1(e,FieldValue))return function __PRIVATE_parseSentinelFieldValue(e,t){if(!__PRIVATE_isWrite(t.du))throw t.pu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.pu("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),_instanceof$1(e,Array)){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function __PRIVATE_parseArray(e,t){var n=[];var _$r=0;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;var _$e=__PRIVATE_parseData(i,t.gu(_$r));null==_$e&&(_$e={nullValue:"NULL_VALUE"}),n.push(_$e),_$r++}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return{arrayValue:{values:n}}}(e,t)}return function __PRIVATE_parseScalarValue(e,t){if(null===(e=getModularInstance(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return toNumber(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(_instanceof$1(e,Date)){var n=Timestamp.fromDate(e);return{timestampValue:toTimestamp(t.serializer,n)}}if(_instanceof$1(e,Timestamp)){var n1=new Timestamp(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:toTimestamp(t.serializer,n1)}}if(_instanceof$1(e,GeoPoint))return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(_instanceof$1(e,Bytes))return{bytesValue:__PRIVATE_toBytes(t.serializer,e._byteString)};if(_instanceof$1(e,DocumentReference)){var n2=t.databaseId,_$r=e.firestore._databaseId;if(!_$r.isEqual(n2))throw t.pu("Document reference is for database ".concat(_$r.projectId,"/").concat(_$r.database," but should be for database ").concat(n2.projectId,"/").concat(n2.database));return{referenceValue:__PRIVATE_toResourceName(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu("Unsupported field value: ".concat(__PRIVATE_valueDescription(e)))}(e,t)}function __PRIVATE_parseObject(e,t){var n={};return isEmpty(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):forEach(e,function(e,r){var i=__PRIVATE_parseData(r,t.Ru(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function __PRIVATE_looksLikeJsonObject(e){return!("object"!=typeof e||null===e||_instanceof$1(e,Array)||_instanceof$1(e,Date)||_instanceof$1(e,Timestamp)||_instanceof$1(e,GeoPoint)||_instanceof$1(e,Bytes)||_instanceof$1(e,DocumentReference)||_instanceof$1(e,FieldValue))}function __PRIVATE_validatePlainObject(e,t,n){if(!__PRIVATE_looksLikeJsonObject(n)||!function __PRIVATE_isPlainObject(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var _$r=__PRIVATE_valueDescription(n);throw"an object"===_$r?t.pu(e+" a custom object"):t.pu(e+" "+_$r)}}function __PRIVATE_fieldPathFromArgument$1(e,t,n){if(_instanceof$1(t=getModularInstance(t),FieldPath))return t._internalPath;if("string"==typeof t)return __PRIVATE_fieldPathFromDotSeparatedString(e,t);throw __PRIVATE_createError("Field path arguments must be of type string or ",e,!1,void 0,n)}var pe=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(e,t,n){if(t.search(pe)>=0)throw __PRIVATE_createError("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return _construct(FieldPath,_to_consumable_array$1(t.split(".")))._internalPath}catch(r){throw __PRIVATE_createError("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function __PRIVATE_createError(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;var _="Function ".concat(t,"() called with invalid data");n&&(_+=" (via `toFirestore()`)"),_+=". ";var a="";return(s||o)&&(a+=" (found",s&&(a+=" in field ".concat(r)),o&&(a+=" in document ".concat(i)),a+=")"),new FirestoreError(D.INVALID_ARGUMENT,_+e+a)}function __PRIVATE_fieldMaskContains(e,t){return e.some(function(e){return e.isEqual(t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DocumentSnapshot$1=function(){function DocumentSnapshot$1(e,t,n,r,i){_class_call_check$1(this,DocumentSnapshot$1);this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}_create_class$1(DocumentSnapshot$1,[{key:"id",get:function get(){return this._key.path.lastSegment()}},{key:"ref",get:function get(){return new DocumentReference(this._firestore,this._converter,this._key)}},{key:"exists",value:function exists(){return null!==this._document}},{key:"data",value:function data(){if(this._document){if(this._converter){var e=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function get(e){if(this._document){var t=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]);return DocumentSnapshot$1}();var QueryDocumentSnapshot$1=function(DocumentSnapshot$1){_inherits$1(QueryDocumentSnapshot$1,DocumentSnapshot$1);var _super=_create_super$1(QueryDocumentSnapshot$1);function QueryDocumentSnapshot$1(){_class_call_check$1(this,QueryDocumentSnapshot$1);return _super.apply(this,arguments)}_create_class$1(QueryDocumentSnapshot$1,[{key:"data",value:function data(){return _get$1(_get_prototype_of$1(QueryDocumentSnapshot$1.prototype),"data",this).call(this)}}]);return QueryDocumentSnapshot$1}(DocumentSnapshot$1);function __PRIVATE_fieldPathFromArgument(e,t){return"string"==typeof t?__PRIVATE_fieldPathFromDotSeparatedString(e,t):_instanceof$1(t,FieldPath)?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateHasExplicitOrderByForLimitToLast(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new FirestoreError(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var AppliableConstraint=function AppliableConstraint(){_class_call_check$1(this,AppliableConstraint)};var QueryConstraint=function(AppliableConstraint){_inherits$1(QueryConstraint,AppliableConstraint);var _super=_create_super$1(QueryConstraint);function QueryConstraint(){_class_call_check$1(this,QueryConstraint);return _super.apply(this,arguments)}return QueryConstraint}(AppliableConstraint);function query(e,t){for(var _len=arguments.length,n=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){n[_key-2]=arguments[_key]}var _$r=[];_instanceof$1(t,AppliableConstraint)&&_$r.push(t),_$r=_$r.concat(n),function __PRIVATE_validateQueryConstraintArray(e){var _$t=e.filter(function(e){return _instanceof$1(e,QueryCompositeFilterConstraint)}).length,n=e.filter(function(e){return _instanceof$1(e,QueryFieldFilterConstraint)}).length;if(_$t>1||_$t>0&&n>0)throw new FirestoreError(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(_$r);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_$r[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$t=_step.value;e=_$t._apply(e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return e}var QueryFieldFilterConstraint=function(QueryConstraint){_inherits$1(QueryFieldFilterConstraint,QueryConstraint);var _super=_create_super$1(QueryFieldFilterConstraint);function QueryFieldFilterConstraint(e,t,n){_class_call_check$1(this,QueryFieldFilterConstraint);var _this;_this=_super.call(this),_this._field=e,_this._op=t,_this._value=n,_this.type="where";return _possible_constructor_return$1(_this)}_create_class$1(QueryFieldFilterConstraint,[{key:"_apply",value:function _apply(e){var t=this._parse(e);return __PRIVATE_validateNewFieldFilter(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t))}},{key:"_parse",value:function _parse(e){var t=__PRIVATE_newUserDataReader(e.firestore),n=function __PRIVATE_newQueryFilter(e,t,n,r,i,s,o){var _;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){__PRIVATE_validateDisjunctiveFilterElements(o,s);var _$t=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=o[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$n=_step.value;_$t.push(__PRIVATE_parseDocumentIdValue(r,e,_$n))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_={arrayValue:{values:_$t}}}else _=__PRIVATE_parseDocumentIdValue(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||__PRIVATE_validateDisjunctiveFilterElements(o,s),_=__PRIVATE_parseQueryValue(n,t,o,"in"===s||"not-in"===s);return FieldFilter.create(i,s,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}],[{key:"_create",value:function _create(e,t,n){return new QueryFieldFilterConstraint(e,t,n)}}]);return QueryFieldFilterConstraint}(QueryConstraint);function where(e,t,n){var _$r=t,i=__PRIVATE_fieldPathFromArgument("where",e);return QueryFieldFilterConstraint._create(i,_$r,n)}var QueryCompositeFilterConstraint=function(AppliableConstraint){_inherits$1(QueryCompositeFilterConstraint,AppliableConstraint);var _super=_create_super$1(QueryCompositeFilterConstraint);function QueryCompositeFilterConstraint(e,t){_class_call_check$1(this,QueryCompositeFilterConstraint);var _this;_this=_super.call(this),_this.type=e,_this._queryConstraints=t;return _possible_constructor_return$1(_this)}_create_class$1(QueryCompositeFilterConstraint,[{key:"_parse",value:function _parse(e){var t=this._queryConstraints.map(function(t){return t._parse(e)}).filter(function(e){return e.getFilters().length>0});return 1===t.length?t[0]:CompositeFilter.create(t,this._getOperator())}},{key:"_apply",value:function _apply(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function __PRIVATE_validateNewFilter(e,t){var n=e;var _$r=t.getFlattenedFilters();var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=_$r[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$e=_step.value;__PRIVATE_validateNewFieldFilter(n,_$e),n=__PRIVATE_queryWithAddedFilter(n,_$e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t)))}},{key:"_getQueryConstraints",value:function _getQueryConstraints(){return this._queryConstraints}},{key:"_getOperator",value:function _getOperator(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function _create(e,t){return new QueryCompositeFilterConstraint(e,t)}}]);return QueryCompositeFilterConstraint}(AppliableConstraint);(function(QueryConstraint){_inherits$1(QueryOrderByConstraint,QueryConstraint);var _super=_create_super$1(QueryOrderByConstraint);function QueryOrderByConstraint(e,t){_class_call_check$1(this,QueryOrderByConstraint);var _this;_this=_super.call(this),_this._field=e,_this._direction=t,_this.type="orderBy";return _possible_constructor_return$1(_this)}_create_class$1(QueryOrderByConstraint,[{key:"_apply",value:function _apply(e){var t=function __PRIVATE_newQueryOrderBy(e,t,n){if(null!==e.startAt)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new OrderBy(t,n)}(e._query,this._field,this._direction);return new Query(e.firestore,e.converter,function __PRIVATE_queryWithAddedOrderBy(e,t){var n=e.explicitOrderBy.concat([t]);return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}],[{key:"_create",value:function _create(e,t){return new QueryOrderByConstraint(e,t)}}]);return QueryOrderByConstraint})(QueryConstraint);(function(QueryConstraint){_inherits$1(QueryLimitConstraint,QueryConstraint);var _super=_create_super$1(QueryLimitConstraint);function QueryLimitConstraint(e,t,n){_class_call_check$1(this,QueryLimitConstraint);var _this;_this=_super.call(this),_this.type=e,_this._limit=t,_this._limitType=n;return _possible_constructor_return$1(_this)}_create_class$1(QueryLimitConstraint,[{key:"_apply",value:function _apply(e){return new Query(e.firestore,e.converter,__PRIVATE_queryWithLimit(e._query,this._limit,this._limitType))}}],[{key:"_create",value:function _create(e,t,n){return new QueryLimitConstraint(e,t,n)}}]);return QueryLimitConstraint})(QueryConstraint);(function(QueryConstraint){_inherits$1(QueryStartAtConstraint,QueryConstraint);var _super=_create_super$1(QueryStartAtConstraint);function QueryStartAtConstraint(e,t,n){_class_call_check$1(this,QueryStartAtConstraint);var _this;_this=_super.call(this),_this.type=e,_this._docOrFields=t,_this._inclusive=n;return _possible_constructor_return$1(_this)}_create_class$1(QueryStartAtConstraint,[{key:"_apply",value:function _apply(e){var t=__PRIVATE_newQueryBoundFromDocOrFields(e,this.type,this._docOrFields,this._inclusive);return new Query(e.firestore,e.converter,function __PRIVATE_queryWithStartAt(e,t){return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}],[{key:"_create",value:function _create(e,t,n){return new QueryStartAtConstraint(e,t,n)}}]);return QueryStartAtConstraint})(QueryConstraint);(function(QueryConstraint){_inherits$1(QueryEndAtConstraint,QueryConstraint);var _super=_create_super$1(QueryEndAtConstraint);function QueryEndAtConstraint(e,t,n){_class_call_check$1(this,QueryEndAtConstraint);var _this;_this=_super.call(this),_this.type=e,_this._docOrFields=t,_this._inclusive=n;return _possible_constructor_return$1(_this)}_create_class$1(QueryEndAtConstraint,[{key:"_apply",value:function _apply(e){var t=__PRIVATE_newQueryBoundFromDocOrFields(e,this.type,this._docOrFields,this._inclusive);return new Query(e.firestore,e.converter,function __PRIVATE_queryWithEndAt(e,t){return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}],[{key:"_create",value:function _create(e,t,n){return new QueryEndAtConstraint(e,t,n)}}]);return QueryEndAtConstraint})(QueryConstraint);function __PRIVATE_newQueryBoundFromDocOrFields(e,t,n,r){if(n[0]=getModularInstance(n[0]),_instanceof$1(n[0],DocumentSnapshot$1))return function __PRIVATE_newQueryBoundFromDocument(e,t,n,r,i){if(!r)throw new FirestoreError(D.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var s=[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=__PRIVATE_queryNormalizedOrderBy(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _$n=_step.value;if(_$n.field.isKeyField())s.push(__PRIVATE_refValue(t,r.key));else{var _$e=r.data.field(_$n.field);if(__PRIVATE_isServerTimestamp(_$e))throw new FirestoreError(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_$n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_$e){var _$e1=_$n.field.canonicalString();throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(_$e1,"' (used as the orderBy) does not exist."))}s.push(_$e)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return new Bound(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{var i=__PRIVATE_newUserDataReader(e.firestore);return function __PRIVATE_newQueryBoundFromFields(e,t,n,r,i,s){var o=e.explicitOrderBy;if(i.length>o.length)throw new FirestoreError(D.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));var _=[];for(var _$s=0;_$s<i.length;_$s++){var a=i[_$s];if(o[_$s].field.isKeyField()){if("string"!=typeof a)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof a==="undefined"?"undefined":_type_of$1(a)));if(!__PRIVATE_isCollectionGroupQuery(e)&&-1!==a.indexOf("/"))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(a,"' contains a slash."));var _$n=e.path.child(ResourcePath.fromString(a));if(!DocumentKey.isDocumentKey(_$n))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(_$n,"' is not because it contains an odd number of segments."));var _$i=new DocumentKey(_$n);_.push(__PRIVATE_refValue(t,_$i))}else{var _$e=__PRIVATE_parseQueryValue(n,r,a);_.push(_$e)}}return new Bound(_,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function __PRIVATE_parseDocumentIdValue(e,t,n){if("string"==typeof(n=getModularInstance(n))){if(""===n)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!__PRIVATE_isCollectionGroupQuery(t)&&-1!==n.indexOf("/"))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var _$r=t.path.child(ResourcePath.fromString(n));if(!DocumentKey.isDocumentKey(_$r))throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(_$r,"' is not because it has an odd number of segments (").concat(_$r.length,")."));return __PRIVATE_refValue(e,new DocumentKey(_$r))}if(_instanceof$1(n,DocumentReference))return __PRIVATE_refValue(e,n._key);throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(__PRIVATE_valueDescription(n),"."))}function __PRIVATE_validateDisjunctiveFilterElements(e,t){if(!Array.isArray(e)||0===e.length)throw new FirestoreError(D.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function __PRIVATE_validateNewFieldFilter(e,t){var n=function __PRIVATE_findOpInsideFilters(e,t){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined,_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(var _iterator=e[Symbol.iterator](),_step;!(_iteratorNormalCompletion1=(_step=_iterator.next()).done);_iteratorNormalCompletion1=true){var n=_step.value;try{for(var _iterator1=n.getFlattenedFilters()[Symbol.iterator](),_step1;!(_iteratorNormalCompletion=(_step1=_iterator1.next()).done);_iteratorNormalCompletion=true){var _$e=_step1.value;if(t.indexOf(_$e.op)>=0)return _$e.op}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return null}(e.filters,function __PRIVATE_conflictingOps(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new FirestoreError(D.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}var AbstractUserDataWriter=function(){function AbstractUserDataWriter(){_class_call_check$1(this,AbstractUserDataWriter)}_create_class$1(AbstractUserDataWriter,[{key:"convertValue",value:function convertValue(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw fail()}}},{key:"convertObject",value:function convertObject(e,t){return this.convertObjectMap(e.fields,t)}},{key:"convertObjectMap",value:function convertObjectMap(e){var _this=this;var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";var n={};return forEach(e,function(e,r){n[e]=_this.convertValue(r,t)}),n}},{key:"convertGeoPoint",value:function convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}},{key:"convertArray",value:function convertArray(e,t){var _this=this;return(e.values||[]).map(function(e){return _this.convertValue(e,t)})}},{key:"convertServerTimestamp",value:function convertServerTimestamp(e,t){switch(t){case"previous":var n=__PRIVATE_getPreviousValue(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}},{key:"convertTimestamp",value:function convertTimestamp(e){var t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function convertDocumentKey(e,t){var n=ResourcePath.fromString(e);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n));var _$r=new DatabaseId(n.get(1),n.get(3)),i=new DocumentKey(n.popFirst(5));return _$r.isEqual(t)||__PRIVATE_logError("Document ".concat(i," contains a document reference within a different database (").concat(_$r.projectId,"/").concat(_$r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]);return AbstractUserDataWriter}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_applyFirestoreDataConverter(e,t,n){var _$r;return _$r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,_$r}var __PRIVATE_LiteUserDataWriter=function(AbstractUserDataWriter){_inherits$1(__PRIVATE_LiteUserDataWriter,AbstractUserDataWriter);var _super=_create_super$1(__PRIVATE_LiteUserDataWriter);function __PRIVATE_LiteUserDataWriter(e){_class_call_check$1(this,__PRIVATE_LiteUserDataWriter);var _this;_this=_super.call(this),_this.firestore=e;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_LiteUserDataWriter,[{key:"convertBytes",value:function convertBytes(e){return new Bytes(e)}},{key:"convertReference",value:function convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}]);return __PRIVATE_LiteUserDataWriter}(AbstractUserDataWriter);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SnapshotMetadata=function(){function SnapshotMetadata(e,t){_class_call_check$1(this,SnapshotMetadata);this.hasPendingWrites=e,this.fromCache=t}_create_class$1(SnapshotMetadata,[{key:"isEqual",value:function isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]);return SnapshotMetadata}();var DocumentSnapshot=function(DocumentSnapshot$1){_inherits$1(DocumentSnapshot,DocumentSnapshot$1);var _super=_create_super$1(DocumentSnapshot);function DocumentSnapshot(e,t,n,r,i,s){_class_call_check$1(this,DocumentSnapshot);var _this;_this=_super.call(this,e,t,n,r,s),_this._firestore=e,_this._firestoreImpl=e,_this.metadata=i;return _possible_constructor_return$1(_this)}_create_class$1(DocumentSnapshot,[{key:"exists",value:function exists(){return _get$1(_get_prototype_of$1(DocumentSnapshot.prototype),"exists",this).call(this)}},{key:"data",value:function data(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._document){if(this._converter){var t=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this._document){var n=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]);return DocumentSnapshot}(DocumentSnapshot$1);var QueryDocumentSnapshot=function(DocumentSnapshot){_inherits$1(QueryDocumentSnapshot,DocumentSnapshot);var _super=_create_super$1(QueryDocumentSnapshot);function QueryDocumentSnapshot(){_class_call_check$1(this,QueryDocumentSnapshot);return _super.apply(this,arguments)}_create_class$1(QueryDocumentSnapshot,[{key:"data",value:function data(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _get$1(_get_prototype_of$1(QueryDocumentSnapshot.prototype),"data",this).call(this,e)}}]);return QueryDocumentSnapshot}(DocumentSnapshot);var QuerySnapshot=function(){function QuerySnapshot(e,t,n,r){_class_call_check$1(this,QuerySnapshot);this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SnapshotMetadata(r.hasPendingWrites,r.fromCache),this.query=n}_create_class$1(QuerySnapshot,[{key:"docs",get:function get(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:"size",get:function get(){return this._snapshot.docs.size}},{key:"empty",get:function get(){return 0===this.size}},{key:"forEach",value:function forEach(e,t){var _this=this;this._snapshot.docs.forEach(function(n){e.call(t,new QueryDocumentSnapshot(_this._firestore,_this._userDataWriter,n.key,n,new SnapshotMetadata(_this._snapshot.mutatedKeys.has(n.key),_this._snapshot.fromCache),_this.query.converter))})}},{key:"docChanges",value:function docChanges(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function __PRIVATE_changesFromSnapshot(e,t){if(e._snapshot.oldDocs.isEmpty()){var t1=0;return e._snapshot.docChanges.map(function(n){var _$r=new QueryDocumentSnapshot(e._firestore,e._userDataWriter,n.doc.key,n.doc,new SnapshotMetadata(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:_$r,oldIndex:-1,newIndex:t1++}})}{var n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var _$r=new QueryDocumentSnapshot(e._firestore,e._userDataWriter,t.doc.key,t.doc,new SnapshotMetadata(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);var i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:__PRIVATE_resultChangeType(t.type),doc:_$r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]);return QuerySnapshot}();function __PRIVATE_resultChangeType(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getDoc(e){e=__PRIVATE_cast(e,DocumentReference);var t=__PRIVATE_cast(e.firestore,Firestore);return __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(ensureFirestoreConfigured(t),e._key).then(function(n){return __PRIVATE_convertToDocSnapshot(t,e,n)})}var __PRIVATE_ExpUserDataWriter=function(AbstractUserDataWriter){_inherits$1(__PRIVATE_ExpUserDataWriter,AbstractUserDataWriter);var _super=_create_super$1(__PRIVATE_ExpUserDataWriter);function __PRIVATE_ExpUserDataWriter(e){_class_call_check$1(this,__PRIVATE_ExpUserDataWriter);var _this;_this=_super.call(this),_this.firestore=e;return _possible_constructor_return$1(_this)}_create_class$1(__PRIVATE_ExpUserDataWriter,[{key:"convertBytes",value:function convertBytes(e){return new Bytes(e)}},{key:"convertReference",value:function convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}]);return __PRIVATE_ExpUserDataWriter}(AbstractUserDataWriter);function getDocs(e){e=__PRIVATE_cast(e,Query);var t=__PRIVATE_cast(e.firestore,Firestore),n=ensureFirestoreConfigured(t),_$r=new __PRIVATE_ExpUserDataWriter(t);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(e._query),__PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(n,e._query).then(function(n){return new QuerySnapshot(t,_$r,e,n)})}function setDoc(e,t,n){e=__PRIVATE_cast(e,DocumentReference);var _$r=__PRIVATE_cast(e.firestore,Firestore),i=__PRIVATE_applyFirestoreDataConverter(e.converter,t,n);return executeWrite(_$r,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(_$r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Precondition.none())])}function updateDoc(e,t,n){for(var _len=arguments.length,_$r=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){_$r[_key-3]=arguments[_key]}e=__PRIVATE_cast(e,DocumentReference);var i=__PRIVATE_cast(e.firestore,Firestore),s=__PRIVATE_newUserDataReader(i);var o;o="string"==typeof(t=getModularInstance(t))||_instanceof$1(t,FieldPath)?__PRIVATE_parseUpdateVarargs(s,"updateDoc",e._key,t,n,_$r):__PRIVATE_parseUpdateData(s,"updateDoc",e._key,t);return executeWrite(i,[o.toMutation(e._key,Precondition.exists(!0))])}function addDoc(e,t){var n=__PRIVATE_cast(e.firestore,Firestore),_$r=doc(e),i=__PRIVATE_applyFirestoreDataConverter(e.converter,t);return executeWrite(n,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(e.firestore),"addDoc",_$r._key,i,null!==e.converter,{}).toMutation(_$r._key,Precondition.exists(!1))]).then(function(){return _$r})}function executeWrite(e,t){return function __PRIVATE_firestoreClientWrite(e,t){var n=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget(_async_to_generator$3(function(){return _ts_generator$1(this,function(_state){switch(_state.label){case 0:return[4,__PRIVATE_getSyncEngine(e)];case 1:return[2,__PRIVATE_syncEngineWrite.apply(void 0,[_state.sent(),t,n])]}})})),n.promise}(ensureFirestoreConfigured(e),t)}function __PRIVATE_convertToDocSnapshot(e,t,n){var _$r=n.docs.get(t._key),i=new __PRIVATE_ExpUserDataWriter(e);return new DocumentSnapshot(e,i,t._key,_$r,new SnapshotMetadata(n.hasPendingWrites,n.fromCache),t.converter)}(function(){function __PRIVATE_MemoryLocalCacheImpl(e){_class_call_check$1(this,__PRIVATE_MemoryLocalCacheImpl);this.kind="memory",this._onlineComponentProvider=new OnlineComponentProvider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=new MemoryOfflineComponentProvider}_create_class$1(__PRIVATE_MemoryLocalCacheImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}}]);return __PRIVATE_MemoryLocalCacheImpl})();(function(){function __PRIVATE_PersistentLocalCacheImpl(e){_class_call_check$1(this,__PRIVATE_PersistentLocalCacheImpl);var t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=persistentSingleTabManager(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}_create_class$1(__PRIVATE_PersistentLocalCacheImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}}]);return __PRIVATE_PersistentLocalCacheImpl})();(function(){function __PRIVATE_MemoryEagerGabageCollectorImpl(){_class_call_check$1(this,__PRIVATE_MemoryEagerGabageCollectorImpl);this.kind="memoryEager",this._offlineComponentProvider=new MemoryOfflineComponentProvider}_create_class$1(__PRIVATE_MemoryEagerGabageCollectorImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}}]);return __PRIVATE_MemoryEagerGabageCollectorImpl})();(function(){function __PRIVATE_MemoryLruGabageCollectorImpl(e){_class_call_check$1(this,__PRIVATE_MemoryLruGabageCollectorImpl);this.kind="memoryLru",this._offlineComponentProvider=new __PRIVATE_LruGcMemoryOfflineComponentProvider(e)}_create_class$1(__PRIVATE_MemoryLruGabageCollectorImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}}]);return __PRIVATE_MemoryLruGabageCollectorImpl})();var __PRIVATE_SingleTabManagerImpl=function(){function __PRIVATE_SingleTabManagerImpl(e){_class_call_check$1(this,__PRIVATE_SingleTabManagerImpl);this.forceOwnership=e,this.kind="persistentSingleTab"}_create_class$1(__PRIVATE_SingleTabManagerImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}},{key:"_initialize",value:function _initialize(e){this._onlineComponentProvider=new OnlineComponentProvider,this._offlineComponentProvider=new __PRIVATE_IndexedDbOfflineComponentProvider(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}]);return __PRIVATE_SingleTabManagerImpl}();(function(){function __PRIVATE_MultiTabManagerImpl(){_class_call_check$1(this,__PRIVATE_MultiTabManagerImpl);this.kind="PersistentMultipleTab"}_create_class$1(__PRIVATE_MultiTabManagerImpl,[{key:"toJSON",value:function toJSON(){return{kind:this.kind}}},{key:"_initialize",value:function _initialize(e){this._onlineComponentProvider=new OnlineComponentProvider,this._offlineComponentProvider=new __PRIVATE_MultiTabOfflineComponentProvider(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes)}}]);return __PRIVATE_MultiTabManagerImpl})();function persistentSingleTabManager(e){return new __PRIVATE_SingleTabManagerImpl(null==e?void 0:e.forceOwnership)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function WriteBatch(e,t){_class_call_check$1(this,WriteBatch);this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=__PRIVATE_newUserDataReader(e)}_create_class$1(WriteBatch,[{key:"set",value:function set(e,t,n){this._verifyNotCommitted();var _$r=__PRIVATE_validateReference(e,this._firestore),i=__PRIVATE_applyFirestoreDataConverter(_$r.converter,t,n),s=__PRIVATE_parseSetData(this._dataReader,"WriteBatch.set",_$r._key,i,null!==_$r.converter,n);return this._mutations.push(s.toMutation(_$r._key,Precondition.none())),this}},{key:"update",value:function update(e,t,n){for(var _len=arguments.length,_$r=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){_$r[_key-3]=arguments[_key]}this._verifyNotCommitted();var i=__PRIVATE_validateReference(e,this._firestore);var s;return s="string"==typeof(t=getModularInstance(t))||_instanceof$1(t,FieldPath)?__PRIVATE_parseUpdateVarargs(this._dataReader,"WriteBatch.update",i._key,t,n,_$r):__PRIVATE_parseUpdateData(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Precondition.exists(!0))),this}},{key:"delete",value:function _delete(e){this._verifyNotCommitted();var t=__PRIVATE_validateReference(e,this._firestore);return this._mutations=this._mutations.concat(new __PRIVATE_DeleteMutation(t._key,Precondition.none())),this}},{key:"commit",value:function commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function _verifyNotCommitted(){if(this._committed)throw new FirestoreError(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]);return WriteBatch})();function __PRIVATE_validateReference(e,t){if((e=getModularInstance(e)).firestore!==t)throw new FirestoreError(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(_Transaction$1){_inherits$1(Transaction,_Transaction$1);var _super=_create_super$1(Transaction);function Transaction(e,t){_class_call_check$1(this,Transaction);var _this;_this=_super.call(this,e,t),_this._firestore=e;return _possible_constructor_return$1(_this)}_create_class$1(Transaction,[{key:"get",value:function get(e){var _this=this;var t=__PRIVATE_validateReference(e,this._firestore),n=new __PRIVATE_ExpUserDataWriter(this._firestore);return _get$1(_get_prototype_of$1(Transaction.prototype),"get",this).call(this,e).then(function(e){return new DocumentSnapshot(_this._firestore,n,t._key,e._document,new SnapshotMetadata(!1,!1),t.converter)})}}]);return Transaction})(function(){function Transaction$1(e,t){_class_call_check$1(this,Transaction$1);this._firestore=e,this._transaction=t,this._dataReader=__PRIVATE_newUserDataReader(e)}_create_class$1(Transaction$1,[{key:"get",value:function get(e){var _this=this;var t=__PRIVATE_validateReference(e,this._firestore),n=new __PRIVATE_LiteUserDataWriter(this._firestore);return this._transaction.lookup([t._key]).then(function(e){if(!e||1!==e.length)return fail();var _$r=e[0];if(_$r.isFoundDocument())return new DocumentSnapshot$1(_this._firestore,n,_$r.key,_$r,t.converter);if(_$r.isNoDocument())return new DocumentSnapshot$1(_this._firestore,n,t._key,null,t.converter);throw fail()})}},{key:"set",value:function set(e,t,n){var _$r=__PRIVATE_validateReference(e,this._firestore),i=__PRIVATE_applyFirestoreDataConverter(_$r.converter,t,n),s=__PRIVATE_parseSetData(this._dataReader,"Transaction.set",_$r._key,i,null!==_$r.converter,n);return this._transaction.set(_$r._key,s),this}},{key:"update",value:function update(e,t,n){for(var _len=arguments.length,_$r=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){_$r[_key-3]=arguments[_key]}var i=__PRIVATE_validateReference(e,this._firestore);var s;return s="string"==typeof(t=getModularInstance(t))||_instanceof$1(t,FieldPath)?__PRIVATE_parseUpdateVarargs(this._dataReader,"Transaction.update",i._key,t,n,_$r):__PRIVATE_parseUpdateData(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}},{key:"delete",value:function _delete(e){var t=__PRIVATE_validateReference(e,this._firestore);return this._transaction.delete(t._key),this}}]);return Transaction$1}());/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function TestingHooks(){_class_call_check$1(this,TestingHooks);throw new Error("instances of this class should not be created")}_create_class$1(TestingHooks,null,[{key:"onExistenceFilterMismatch",value:function onExistenceFilterMismatch(e){return __PRIVATE_TestingHooksSpiImpl.instance.onExistenceFilterMismatch(e)}}]);return TestingHooks})();var __PRIVATE_TestingHooksSpiImpl=function(){function __PRIVATE_TestingHooksSpiImpl(){_class_call_check$1(this,__PRIVATE_TestingHooksSpiImpl);this.Cu=new Map}_create_class$1(__PRIVATE_TestingHooksSpiImpl,[{key:"tt",value:function tt(e){this.Cu.forEach(function(t){return t(e)})}},{key:"onExistenceFilterMismatch",value:function onExistenceFilterMismatch(e){var t=Symbol(),n=this.Cu;return n.set(t,e),function(){return n.delete(t)}}}],[{key:"instance",get:function get(){return Se||(Se=new __PRIVATE_TestingHooksSpiImpl,function __PRIVATE_setTestingHooksSpi(e){if(ce)throw new Error("a TestingHooksSpi instance is already set");ce=e}(Se)),Se}}]);return __PRIVATE_TestingHooksSpiImpl}();var Se=null;!function __PRIVATE_registerFirestore(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;!function __PRIVATE_setSDKVersion(e){S=e}(SDK_VERSION),_registerComponent(new Component("firestore",function(e,param){var n=param.instanceIdentifier,_$r=param.options;var i=e.getProvider("app").getImmediate(),s=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(e.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(e.getProvider("app-check-internal")),function __PRIVATE_databaseIdFromApp(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new FirestoreError(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(e.options.projectId,t)}(i,n),i);return _$r=Object.assign({useFetchStreams:t},_$r),s._setSettings(_$r),s},"PUBLIC").setMultipleInstances(!0)),registerVersion(w,"4.4.2",e),registerVersion(w,"4.4.2","esm2017")}();var firebaseConfig={apiKey:"AIzaSyDvwc5n8vaH9Z9rIawPdHBR_4aCUXOyWLM",authDomain:"e-com-a3034.firebaseapp.com",projectId:"e-com-a3034",storageBucket:"e-com-a3034.appspot.com",messagingSenderId:"259974195186",appId:"1:259974195186:web:f4902169166b4b45fe2d6b",measurementId:"G-R7VN3PX5TS"};var firebaseApp=initializeApp(firebaseConfig);var db=getFirestore();var getRandomValues;var rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){getRandomValues=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto);if(!getRandomValues){throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}}return getRandomValues(rnds8)}var byteToHex=[];for(var i=0;i<256;++i){byteToHex.push((i+256).toString(16).slice(1))}function unsafeStringify(arr){var offset=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]}var randomUUID=typeof crypto!=="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native={randomUUID:randomUUID};function v4(options,buf,offset){if(native.randomUUID&&!buf&&!options){return native.randomUUID()}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){offset=offset||0;for(var i=0;i<16;++i){buf[offset+i]=rnds[i]}return buf}return unsafeStringify(rnds)}function asyncGeneratorStep$2(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$2(fn){return function(){var _$self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(_$self,args);function _next(value){asyncGeneratorStep$2(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$2(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _define_property$2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_define_property$2(target,key,source[key])})}return target}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _object_spread_props(target,source){source=source!=null?source:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}var BaseService=function BaseService(){"use strict";_class_call_check(this,BaseService);_define_property$2(this,"addApiCollection",function(){var _ref=_async_to_generator$2(function(model,path){var docRef;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!model.id)model.id=v4();return[4,addDoc(collection(db,path),model)];case 1:docRef=_state.sent();if(!docRef.id)throw"Bir hata oluştu.";return[2,true]}})});return function(model,path){return _ref.apply(this,arguments)}}());_define_property$2(this,"updateApiData",function(){var _ref=_async_to_generator$2(function(req){var _req_model,id;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!!((_req_model=req.model)===null||_req_model===void 0?void 0:_req_model.id))return[3,2];id=v4();return[4,setDoc(doc(db,req.path,id),_object_spread_props(_object_spread({},req.model),{id:id}))];case 1:return[2,_state.sent()];case 2:return[4,updateDoc(doc(db,req.path,req.model.id),req.model)];case 3:return[2,_state.sent()]}})});return function(req){return _ref.apply(this,arguments)}}());var _this=this;_define_property$2(this,"getDataFromApi",function(){var _ref=_async_to_generator$2(function(req){var _req_model,_req_model_id,res,filters,querySnapshot;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!((_req_model=req.model)===null||_req_model===void 0?void 0:_req_model.id))return[3,2];return[4,getDoc(doc(db,req.path,(_req_model_id=req.model.id)!==null&&_req_model_id!==void 0?_req_model_id:""))];case 1:res=_state.sent();return[2,[res.data()]];case 2:filters=_this.createQueryFilters(req);return[4,getDocs(query.apply(void 0,[collection(db,req.path)].concat(_to_consumable_array(Object.entries(filters).map(function(param){var _param=_sliced_to_array(param,2),key=_param[0],value=_param[1];return where(key,"==",value)})))))];case 3:querySnapshot=_state.sent();return[2,querySnapshot.docs.map(function(doc){return doc.data()})]}})});return function(req){return _ref.apply(this,arguments)}}());_define_property$2(this,"createQueryFilters",function(req){var filters={};for(var prop in req.model){if(Object.prototype.hasOwnProperty.call(req.model,prop)){if(req.model[prop]!==undefined&&req.model[prop]!==null)filters[prop]=req.model[prop]}}return filters})};var baseService=new BaseService;function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]]}return t}typeof SuppressedError==="function"?SuppressedError:function(error,suppressed,message){var e=new Error(message);return e.name="SuppressedError",e.error=error,e.suppressed=suppressed,e};function _array_like_to_array1(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes1(arr){if(Array.isArray(arr))return arr}function _array_without_holes1(arr){if(Array.isArray(arr))return _array_like_to_array1(arr)}function _assert_this_initialized(self1){if(self1===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self1}function asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator$1(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _class_call_check1(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class1(Constructor,protoProps,staticProps){if(protoProps)_defineProperties1(Constructor.prototype,protoProps);if(staticProps)_defineProperties1(Constructor,staticProps);return Constructor}function _define_property$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function get(target,property,receiver){var base=_super_prop_base(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver||target)}return desc.value}}return _get(target,property,receiver||target)}function _get_prototype_of(o){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _get_prototype_of(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_set_prototype_of(subClass,superClass)}function _instanceof1(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return _instanceof(left,right)}}function _iterable_to_array1(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterable_to_array_limit1(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possible_constructor_return(self1,call){if(call&&(_type_of(call)==="object"||typeof call==="function")){return call}return _assert_this_initialized(self1)}function _set_prototype_of(o,p){_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(o,p){o.__proto__=p;return o};return _set_prototype_of(o,p)}function _sliced_to_array1(arr,i){return _array_with_holes1(arr)||_iterable_to_array_limit1(arr,i)||_unsupported_iterable_to_array1(arr,i)||_non_iterable_rest1()}function _super_prop_base(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_get_prototype_of(object);if(object===null)break}return object}function _to_consumable_array1(arr){return _array_without_holes1(arr)||_iterable_to_array1(arr)||_unsupported_iterable_to_array1(arr)||_non_iterable_spread1()}function _type_of(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array1(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array1(o,minLen)}function _is_native_reflect_construct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct();return function _createSuperInternal(){var Super=_get_prototype_of(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possible_constructor_return(this,result)}}function _ts_generator1(thisArg,body){var f,_$y,t,g,_={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,_$y&&(t=op[0]&2?_$y["return"]:op[0]?_$y["throw"]||((t=_$y["return"])&&t.call(_$y),0):_$y.next)&&!(t=t.call(_$y,op[1])).done)return t;if(_$y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;_$y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];_$y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function _prodErrorMap(){return _define_property$1({},"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is "+"initialized. Please be sure to call `initializeAuth` or `getAuth` before "+"starting any other Firebase SDK.")}var prodErrorMap=_prodErrorMap;var _DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var logClient=new Logger("@firebase/auth");function _logWarn(msg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(logClient.logLevel<=LogLevel.WARN){var _logClient;(_logClient=logClient).warn.apply(_logClient,["Auth (".concat(SDK_VERSION,"): ").concat(msg)].concat(_to_consumable_array1(args)))}}function _logError(msg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(logClient.logLevel<=LogLevel.ERROR){var _logClient;(_logClient=logClient).error.apply(_logClient,["Auth (".concat(SDK_VERSION,"): ").concat(msg)].concat(_to_consumable_array1(args)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(authOrCode){for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key]}throw createErrorInternal.apply(void 0,[authOrCode].concat(_to_consumable_array1(rest)))}function _createError(authOrCode){for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key]}return createErrorInternal.apply(void 0,[authOrCode].concat(_to_consumable_array1(rest)))}function _errorWithCustomMessage(auth,code,message){var errorMap=Object.assign(Object.assign({},prodErrorMap()),_define_property$1({},code,message));var factory=new ErrorFactory("auth","Firebase",errorMap);return factory.create(code,{appName:auth.name})}function createErrorInternal(authOrCode){for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key]}var _DEFAULT_AUTH_ERROR_FACTORY1;if(typeof authOrCode!=="string"){var _authOrCode__errorFactory;var code=rest[0];var fullParams=_to_consumable_array1(rest.slice(1));if(fullParams[0]){fullParams[0].appName=authOrCode.name}return(_authOrCode__errorFactory=authOrCode._errorFactory).create.apply(_authOrCode__errorFactory,[code].concat(_to_consumable_array1(fullParams)))}return(_DEFAULT_AUTH_ERROR_FACTORY1=_DEFAULT_AUTH_ERROR_FACTORY).create.apply(_DEFAULT_AUTH_ERROR_FACTORY1,[authOrCode].concat(_to_consumable_array1(rest)))}function _assert(assertion,authOrCode){for(var _len=arguments.length,rest=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){rest[_key-2]=arguments[_key]}if(!assertion){throw createErrorInternal.apply(void 0,[authOrCode].concat(_to_consumable_array1(rest)))}}function debugFail(failure){var message="INTERNAL ASSERTION FAILED: "+failure;_logError(message);throw new Error(message)}function debugAssert(assertion,message){if(!assertion){debugFail(message)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var _a;return typeof self!=="undefined"&&((_a=self.location)===null||_a===void 0?void 0:_a.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var _a;return typeof self!=="undefined"&&((_a=self.location)===null||_a===void 0?void 0:_a.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){if(typeof navigator!=="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine==="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)){return navigator.onLine}return true}function _getUserLanguage(){if(typeof navigator==="undefined"){return null}var navigatorLanguage=navigator;return navigatorLanguage.languages&&navigatorLanguage.languages[0]||navigatorLanguage.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Delay=function(){function Delay(shortDelay,longDelay){_class_call_check1(this,Delay);this.shortDelay=shortDelay;this.longDelay=longDelay;debugAssert(longDelay>shortDelay,"Short delay should be less than long delay!");this.isMobile=isMobileCordova()||isReactNative()}_create_class1(Delay,[{key:"get",value:function get(){if(!_isOnline()){return Math.min(5e3,this.shortDelay)}return this.isMobile?this.longDelay:this.shortDelay}}]);return Delay}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(config,path){debugAssert(config.emulator,"Emulator should always be set here");var url=config.emulator.url;if(!path){return url}return"".concat(url).concat(path.startsWith("/")?path.slice(1):path)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FetchProvider=function(){function FetchProvider(){_class_call_check1(this,FetchProvider)}_create_class1(FetchProvider,null,[{key:"initialize",value:function initialize(fetchImpl,headersImpl,responseImpl){this.fetchImpl=fetchImpl;if(headersImpl){this.headersImpl=headersImpl}if(responseImpl){this.responseImpl=responseImpl}}},{key:"fetch",value:function fetch1(){if(this.fetchImpl){return this.fetchImpl}if(typeof self!=="undefined"&&"fetch"in self){return self.fetch}if(typeof globalThis!=="undefined"&&globalThis.fetch){return globalThis.fetch}if(typeof fetch!=="undefined"){return fetch}debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"headers",value:function headers(){if(this.headersImpl){return this.headersImpl}if(typeof self!=="undefined"&&"Headers"in self){return self.Headers}if(typeof globalThis!=="undefined"&&globalThis.Headers){return globalThis.Headers}if(typeof Headers!=="undefined"){return Headers}debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function response(){if(this.responseImpl){return this.responseImpl}if(typeof self!=="undefined"&&"Response"in self){return self.Response}if(typeof globalThis!=="undefined"&&globalThis.Response){return globalThis.Response}if(typeof Response!=="undefined"){return Response}debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}]);return FetchProvider}();var _obj;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SERVER_ERROR_MAP=(_obj={},_define_property$1(_obj,"CREDENTIAL_MISMATCH","custom-token-mismatch"),_define_property$1(_obj,"MISSING_CUSTOM_TOKEN","internal-error"),_define_property$1(_obj,"INVALID_IDENTIFIER","invalid-email"),_define_property$1(_obj,"MISSING_CONTINUE_URI","internal-error"),_define_property$1(_obj,"INVALID_PASSWORD","wrong-password"),_define_property$1(_obj,"MISSING_PASSWORD","missing-password"),_define_property$1(_obj,"INVALID_LOGIN_CREDENTIALS","invalid-credential"),_define_property$1(_obj,"EMAIL_EXISTS","email-already-in-use"),_define_property$1(_obj,"PASSWORD_LOGIN_DISABLED","operation-not-allowed"),_define_property$1(_obj,"INVALID_IDP_RESPONSE","invalid-credential"),_define_property$1(_obj,"INVALID_PENDING_TOKEN","invalid-credential"),_define_property$1(_obj,"FEDERATED_USER_ID_ALREADY_LINKED","credential-already-in-use"),_define_property$1(_obj,"MISSING_REQ_TYPE","internal-error"),_define_property$1(_obj,"EMAIL_NOT_FOUND","user-not-found"),_define_property$1(_obj,"RESET_PASSWORD_EXCEED_LIMIT","too-many-requests"),_define_property$1(_obj,"EXPIRED_OOB_CODE","expired-action-code"),_define_property$1(_obj,"INVALID_OOB_CODE","invalid-action-code"),_define_property$1(_obj,"MISSING_OOB_CODE","internal-error"),_define_property$1(_obj,"CREDENTIAL_TOO_OLD_LOGIN_AGAIN","requires-recent-login"),_define_property$1(_obj,"INVALID_ID_TOKEN","invalid-user-token"),_define_property$1(_obj,"TOKEN_EXPIRED","user-token-expired"),_define_property$1(_obj,"USER_NOT_FOUND","user-token-expired"),_define_property$1(_obj,"TOO_MANY_ATTEMPTS_TRY_LATER","too-many-requests"),_define_property$1(_obj,"PASSWORD_DOES_NOT_MEET_REQUIREMENTS","password-does-not-meet-requirements"),_define_property$1(_obj,"INVALID_CODE","invalid-verification-code"),_define_property$1(_obj,"INVALID_SESSION_INFO","invalid-verification-id"),_define_property$1(_obj,"INVALID_TEMPORARY_PROOF","invalid-credential"),_define_property$1(_obj,"MISSING_SESSION_INFO","missing-verification-id"),_define_property$1(_obj,"SESSION_EXPIRED","code-expired"),_define_property$1(_obj,"MISSING_ANDROID_PACKAGE_NAME","missing-android-pkg-name"),_define_property$1(_obj,"UNAUTHORIZED_DOMAIN","unauthorized-continue-uri"),_define_property$1(_obj,"INVALID_OAUTH_CLIENT_ID","invalid-oauth-client-id"),_define_property$1(_obj,"ADMIN_ONLY_OPERATION","admin-restricted-operation"),_define_property$1(_obj,"INVALID_MFA_PENDING_CREDENTIAL","invalid-multi-factor-session"),_define_property$1(_obj,"MFA_ENROLLMENT_NOT_FOUND","multi-factor-info-not-found"),_define_property$1(_obj,"MISSING_MFA_ENROLLMENT_ID","missing-multi-factor-info"),_define_property$1(_obj,"MISSING_MFA_PENDING_CREDENTIAL","missing-multi-factor-session"),_define_property$1(_obj,"SECOND_FACTOR_EXISTS","second-factor-already-in-use"),_define_property$1(_obj,"SECOND_FACTOR_LIMIT_EXCEEDED","maximum-second-factor-count-exceeded"),_define_property$1(_obj,"BLOCKING_FUNCTION_ERROR_RESPONSE","internal-error"),_define_property$1(_obj,"RECAPTCHA_NOT_ENABLED","recaptcha-not-enabled"),_define_property$1(_obj,"MISSING_RECAPTCHA_TOKEN","missing-recaptcha-token"),_define_property$1(_obj,"INVALID_RECAPTCHA_TOKEN","invalid-recaptcha-token"),_define_property$1(_obj,"INVALID_RECAPTCHA_ACTION","invalid-recaptcha-action"),_define_property$1(_obj,"MISSING_CLIENT_TYPE","missing-client-type"),_define_property$1(_obj,"MISSING_RECAPTCHA_VERSION","missing-recaptcha-version"),_define_property$1(_obj,"INVALID_RECAPTCHA_VERSION","invalid-recaptcha-version"),_define_property$1(_obj,"INVALID_REQ_TYPE","invalid-req-type"),_obj);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(auth,request){if(auth.tenantId&&!request.tenantId){return Object.assign(Object.assign({},request),{tenantId:auth.tenantId})}return request}function _performApiRequest(auth,method,path,request){return __performApiRequest.apply(this,arguments)}function __performApiRequest(){__performApiRequest=_async_to_generator$1(function(auth,method,path,request){var customErrorMap;var _arguments=arguments;return _ts_generator1(this,function(_state){customErrorMap=_arguments.length>4&&_arguments[4]!==void 0?_arguments[4]:{};return[2,_performFetchWithErrorHandling(auth,customErrorMap,_async_to_generator$1(function(){var body,params,query,headers;return _ts_generator1(this,function(_state){switch(_state.label){case 0:body={};params={};if(request){if(method==="GET"){params=request}else{body={body:JSON.stringify(request)}}}query=querystring(Object.assign({key:auth.config.apiKey},params)).slice(1);return[4,auth._getAdditionalHeaders()];case 1:headers=_state.sent();headers["Content-Type"]="application/json";if(auth.languageCode){headers["X-Firebase-Locale"]=auth.languageCode}return[2,FetchProvider.fetch()(_getFinalTarget(auth,auth.config.apiHost,path,query),Object.assign({method:method,headers:headers,referrerPolicy:"no-referrer"},body))]}})}))]})});return __performApiRequest.apply(this,arguments)}function _performFetchWithErrorHandling(auth,customErrorMap,fetchFn){return __performFetchWithErrorHandling.apply(this,arguments)}function __performFetchWithErrorHandling(){__performFetchWithErrorHandling=_async_to_generator$1(function(auth,customErrorMap,fetchFn){var errorMap,networkTimeout,response,json,errorMessage,_errorMessage_split,serverErrorCode,serverErrorMessage,authError,e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:auth._canInitEmulator=false;errorMap=Object.assign(Object.assign({},SERVER_ERROR_MAP),customErrorMap);_state.label=1;case 1:_state.trys.push([1,4,,5]);networkTimeout=new NetworkTimeout(auth);return[4,Promise.race([fetchFn(),networkTimeout.promise])];case 2:response=_state.sent();networkTimeout.clearNetworkTimeout();return[4,response.json()];case 3:json=_state.sent();if("needConfirmation"in json){throw _makeTaggedError(auth,"account-exists-with-different-credential",json)}if(response.ok&&!("errorMessage"in json)){return[2,json]}else{errorMessage=response.ok?json.errorMessage:json.error.message;_errorMessage_split=_sliced_to_array1(errorMessage.split(" : "),2),serverErrorCode=_errorMessage_split[0],serverErrorMessage=_errorMessage_split[1];if(serverErrorCode==="FEDERATED_USER_ID_ALREADY_LINKED"){throw _makeTaggedError(auth,"credential-already-in-use",json)}else if(serverErrorCode==="EMAIL_EXISTS"){throw _makeTaggedError(auth,"email-already-in-use",json)}else if(serverErrorCode==="USER_DISABLED"){throw _makeTaggedError(auth,"user-disabled",json)}authError=errorMap[serverErrorCode]||serverErrorCode.toLowerCase().replace(/[_\s]+/g,"-");if(serverErrorMessage){throw _errorWithCustomMessage(auth,authError,serverErrorMessage)}else{_fail(auth,authError)}}return[3,5];case 4:e=_state.sent();if(_instanceof1(e,FirebaseError)){throw e}_fail(auth,"network-request-failed",{"message":String(e)});return[3,5];case 5:return[2]}})});return __performFetchWithErrorHandling.apply(this,arguments)}function _performSignInRequest(auth,method,path,request){return __performSignInRequest.apply(this,arguments)}function __performSignInRequest(){__performSignInRequest=_async_to_generator$1(function(auth,method,path,request){var customErrorMap,serverResponse;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:customErrorMap=_arguments.length>4&&_arguments[4]!==void 0?_arguments[4]:{};return[4,_performApiRequest(auth,method,path,request,customErrorMap)];case 1:serverResponse=_state.sent();if("mfaPendingCredential"in serverResponse){_fail(auth,"multi-factor-auth-required",{_serverResponse:serverResponse})}return[2,serverResponse]}})});return __performSignInRequest.apply(this,arguments)}function _getFinalTarget(auth,host,path,query){var base="".concat(host).concat(path,"?").concat(query);if(!auth.config.emulator){return"".concat(auth.config.apiScheme,"://").concat(base)}return _emulatorUrl(auth.config,base)}function _parseEnforcementState(enforcementStateStr){switch(enforcementStateStr){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var NetworkTimeout=function(){function NetworkTimeout(auth){var _this=this;_class_call_check1(this,NetworkTimeout);this.auth=auth;this.timer=null;this.promise=new Promise(function(_,reject){_this.timer=setTimeout(function(){return reject(_createError(_this.auth,"network-request-failed"))},DEFAULT_API_TIMEOUT_MS.get())})}_create_class1(NetworkTimeout,[{key:"clearNetworkTimeout",value:function clearNetworkTimeout(){clearTimeout(this.timer)}}]);return NetworkTimeout}();function _makeTaggedError(auth,code,response){var errorParams={appName:auth.name};if(response.email){errorParams.email=response.email}if(response.phoneNumber){errorParams.phoneNumber=response.phoneNumber}var error=_createError(auth,code,errorParams);error.customData._tokenResponse=response;return error}function isEnterprise(grecaptcha){return grecaptcha!==undefined&&grecaptcha.enterprise!==undefined}var RecaptchaConfig=function(){function RecaptchaConfig(response){_class_call_check1(this,RecaptchaConfig);this.siteKey="";this.recaptchaEnforcementState=[];if(response.recaptchaKey===undefined){throw new Error("recaptchaKey undefined")}this.siteKey=response.recaptchaKey.split("/")[3];this.recaptchaEnforcementState=response.recaptchaEnforcementState}_create_class1(RecaptchaConfig,[{key:"getProviderEnforcementState",value:function getProviderEnforcementState(providerStr){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0){return null}var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.recaptchaEnforcementState[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var recaptchaEnforcementState=_step.value;if(recaptchaEnforcementState.provider&&recaptchaEnforcementState.provider===providerStr){return _parseEnforcementState(recaptchaEnforcementState.enforcementState)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"isProviderEnabled",value:function isProviderEnabled(providerStr){return this.getProviderEnforcementState(providerStr)==="ENFORCE"||this.getProviderEnforcementState(providerStr)==="AUDIT"}}]);return RecaptchaConfig}();function getRecaptchaConfig(auth,request){return _getRecaptchaConfig.apply(this,arguments)}function _getRecaptchaConfig(){_getRecaptchaConfig=_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"GET","/v2/recaptchaConfig",_addTidIfNecessary(auth,request))]})});return _getRecaptchaConfig.apply(this,arguments)}function deleteAccount(auth,request){return _deleteAccount.apply(this,arguments)}function _deleteAccount(){_deleteAccount=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"POST","/v1/accounts:delete",request)]})});return _deleteAccount.apply(this,arguments)}function getAccountInfo(auth,request){return _getAccountInfo.apply(this,arguments)}function _getAccountInfo(){_getAccountInfo=_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"POST","/v1/accounts:lookup",request)]})});return _getAccountInfo.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(utcTimestamp){if(!utcTimestamp){return undefined}try{var date=new Date(Number(utcTimestamp));if(!isNaN(date.getTime())){return date.toUTCString()}}catch(e){}return undefined}function getIdTokenResult(user){return _getIdTokenResult.apply(this,arguments)}function _getIdTokenResult(){_getIdTokenResult=_async_to_generator$1(function(user){var forceRefresh,userInternal,token,claims,firebase,signInProvider;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:forceRefresh=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:false;userInternal=getModularInstance(user);return[4,userInternal.getIdToken(forceRefresh)];case 1:token=_state.sent();claims=_parseToken(token);_assert(claims&&claims.exp&&claims.auth_time&&claims.iat,userInternal.auth,"internal-error");firebase=typeof claims.firebase==="object"?claims.firebase:undefined;signInProvider=firebase===null||firebase===void 0?void 0:firebase["sign_in_provider"];return[2,{claims:claims,token:token,authTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.exp)),signInProvider:signInProvider||null,signInSecondFactor:(firebase===null||firebase===void 0?void 0:firebase["sign_in_second_factor"])||null}]}})});return _getIdTokenResult.apply(this,arguments)}function secondsStringToMilliseconds(seconds){return Number(seconds)*1e3}function _parseToken(token){var _token_split=_sliced_to_array1(token.split("."),3),algorithm=_token_split[0],payload=_token_split[1],signature=_token_split[2];if(algorithm===undefined||payload===undefined||signature===undefined){_logError("JWT malformed, contained fewer than 3 sections");return null}try{var decoded=base64Decode(payload);if(!decoded){_logError("Failed to decode base64 JWT payload");return null}return JSON.parse(decoded)}catch(e){_logError("Caught error parsing JWT payload as JSON",e===null||e===void 0?void 0:e.toString());return null}}function _tokenExpiresIn(token){var parsedToken=_parseToken(token);_assert(parsedToken,"internal-error");_assert(typeof parsedToken.exp!=="undefined","internal-error");_assert(typeof parsedToken.iat!=="undefined","internal-error");return Number(parsedToken.exp)-Number(parsedToken.iat)}function _logoutIfInvalidated(user,promise){return __logoutIfInvalidated.apply(this,arguments)}function __logoutIfInvalidated(){__logoutIfInvalidated=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(user,promise){var bypassAuthState,e;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:bypassAuthState=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:false;if(bypassAuthState){return[2,promise]}_state.label=1;case 1:_state.trys.push([1,3,,6]);return[4,promise];case 2:return[2,_state.sent()];case 3:e=_state.sent();if(!(_instanceof1(e,FirebaseError)&&isUserInvalidated(e)))return[3,5];if(!(user.auth.currentUser===user))return[3,5];return[4,user.auth.signOut()];case 4:_state.sent();_state.label=5;case 5:throw e;case 6:return[2]}})});return __logoutIfInvalidated.apply(this,arguments)}function isUserInvalidated(param){var code=param.code;return code==="auth/user-disabled"||code==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ProactiveRefresh=function(){function ProactiveRefresh(user){_class_call_check1(this,ProactiveRefresh);this.user=user;this.isRunning=false;this.timerId=null;this.errorBackoff=3e4}_create_class1(ProactiveRefresh,[{key:"_start",value:function _start(){if(this.isRunning){return}this.isRunning=true;this.schedule()}},{key:"_stop",value:function _stop(){if(!this.isRunning){return}this.isRunning=false;if(this.timerId!==null){clearTimeout(this.timerId)}}},{key:"getInterval",value:function getInterval(wasError){var _a;if(wasError){var interval=this.errorBackoff;this.errorBackoff=Math.min(this.errorBackoff*2,96e4);return interval}else{this.errorBackoff=3e4;var expTime=(_a=this.user.stsTokenManager.expirationTime)!==null&&_a!==void 0?_a:0;var interval1=expTime-Date.now()-3e5;return Math.max(0,interval1)}}},{key:"schedule",value:function schedule(){var wasError=arguments.length>0&&arguments[0]!==void 0?arguments[0]:false;if(!this.isRunning){return}var interval=this.getInterval(wasError);var _this=this;this.timerId=setTimeout(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.iteration()];case 1:_state.sent();return[2]}})}),interval)}},{key:"iteration",value:function iteration(){var _this=this;return _async_to_generator$1(function(){var e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.user.getIdToken(true)];case 1:_state.sent();return[3,3];case 2:e=_state.sent();if((e===null||e===void 0?void 0:e.code)==="auth/network-request-failed"){_this.schedule(true)}return[2];case 3:_this.schedule();return[2]}})})()}}]);return ProactiveRefresh}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var UserMetadata=function(){function UserMetadata(createdAt,lastLoginAt){_class_call_check1(this,UserMetadata);this.createdAt=createdAt;this.lastLoginAt=lastLoginAt;this._initializeTime()}_create_class1(UserMetadata,[{key:"_initializeTime",value:function _initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt);this.creationTime=utcTimestampToDateString(this.createdAt)}},{key:"_copy",value:function _copy(metadata){this.createdAt=metadata.createdAt;this.lastLoginAt=metadata.lastLoginAt;this._initializeTime()}},{key:"toJSON",value:function toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}]);return UserMetadata}();function _reloadWithoutSaving(user){return __reloadWithoutSaving.apply(this,arguments)}function __reloadWithoutSaving(){__reloadWithoutSaving=/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(user){var _a,auth,idToken,response,coreAccount,newProviderData,providerData,oldIsAnonymous,newIsAnonymous,isAnonymous,updates;return _ts_generator1(this,function(_state){switch(_state.label){case 0:auth=user.auth;return[4,user.getIdToken()];case 1:idToken=_state.sent();return[4,_logoutIfInvalidated(user,getAccountInfo(auth,{idToken:idToken}))];case 2:response=_state.sent();_assert(response===null||response===void 0?void 0:response.users.length,auth,"internal-error");coreAccount=response.users[0];user._notifyReloadListener(coreAccount);newProviderData=((_a=coreAccount.providerUserInfo)===null||_a===void 0?void 0:_a.length)?extractProviderData(coreAccount.providerUserInfo):[];providerData=mergeProviderData(user.providerData,newProviderData);oldIsAnonymous=user.isAnonymous;newIsAnonymous=!(user.email&&coreAccount.passwordHash)&&!(providerData===null||providerData===void 0?void 0:providerData.length);isAnonymous=!oldIsAnonymous?false:newIsAnonymous;updates={uid:coreAccount.localId,displayName:coreAccount.displayName||null,photoURL:coreAccount.photoUrl||null,email:coreAccount.email||null,emailVerified:coreAccount.emailVerified||false,phoneNumber:coreAccount.phoneNumber||null,tenantId:coreAccount.tenantId||null,providerData:providerData,metadata:new UserMetadata(coreAccount.createdAt,coreAccount.lastLoginAt),isAnonymous:isAnonymous};Object.assign(user,updates);return[2]}})});return __reloadWithoutSaving.apply(this,arguments)}function reload(user){return _reload.apply(this,arguments)}function _reload(){_reload=_async_to_generator$1(function(user){var userInternal;return _ts_generator1(this,function(_state){switch(_state.label){case 0:userInternal=getModularInstance(user);return[4,_reloadWithoutSaving(userInternal)];case 1:_state.sent();return[4,userInternal.auth._persistUserIfCurrent(userInternal)];case 2:_state.sent();userInternal.auth._notifyListenersIfCurrent(userInternal);return[2]}})});return _reload.apply(this,arguments)}function mergeProviderData(original,newData){var deduped=original.filter(function(o){return!newData.some(function(n){return n.providerId===o.providerId})});return _to_consumable_array1(deduped).concat(_to_consumable_array1(newData))}function extractProviderData(providers){return providers.map(function(_a){var providerId=_a.providerId,provider=__rest(_a,["providerId"]);return{providerId:providerId,uid:provider.rawId||"",displayName:provider.displayName||null,email:provider.email||null,phoneNumber:provider.phoneNumber||null,photoURL:provider.photoUrl||null}})}function requestStsToken(auth,refreshToken){return _requestStsToken.apply(this,arguments)}function _requestStsToken(){_requestStsToken=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,refreshToken){var response;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_performFetchWithErrorHandling(auth,{},_async_to_generator$1(function(){var body,_auth_config,tokenApiHost,apiKey,url,headers;return _ts_generator1(this,function(_state){switch(_state.label){case 0:body=querystring({"grant_type":"refresh_token","refresh_token":refreshToken}).slice(1);_auth_config=auth.config,tokenApiHost=_auth_config.tokenApiHost,apiKey=_auth_config.apiKey;url=_getFinalTarget(auth,tokenApiHost,"/v1/token","key=".concat(apiKey));return[4,auth._getAdditionalHeaders()];case 1:headers=_state.sent();headers["Content-Type"]="application/x-www-form-urlencoded";return[2,FetchProvider.fetch()(url,{method:"POST",headers:headers,body:body})]}})}))];case 1:response=_state.sent();return[2,{accessToken:response.access_token,expiresIn:response.expires_in,refreshToken:response.refresh_token}]}})});return _requestStsToken.apply(this,arguments)}function revokeToken(auth,request){return _revokeToken.apply(this,arguments)}function _revokeToken(){_revokeToken=_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(auth,request))]})});return _revokeToken.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var StsTokenManager=function(){function StsTokenManager(){_class_call_check1(this,StsTokenManager);this.refreshToken=null;this.accessToken=null;this.expirationTime=null}_create_class1(StsTokenManager,[{key:"isExpired",get:function get(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function updateFromServerResponse(response){_assert(response.idToken,"internal-error");_assert(typeof response.idToken!=="undefined","internal-error");_assert(typeof response.refreshToken!=="undefined","internal-error");var expiresIn="expiresIn"in response&&typeof response.expiresIn!=="undefined"?Number(response.expiresIn):_tokenExpiresIn(response.idToken);this.updateTokensAndExpiration(response.idToken,response.refreshToken,expiresIn)}},{key:"getToken",value:function getToken(auth){var forceRefresh=arguments.length>1&&arguments[1]!==void 0?arguments[1]:false;var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:_assert(!_this.accessToken||_this.refreshToken,auth,"user-token-expired");if(!forceRefresh&&_this.accessToken&&!_this.isExpired){return[2,_this.accessToken]}if(!_this.refreshToken)return[3,2];return[4,_this.refresh(auth,_this.refreshToken)];case 1:_state.sent();return[2,_this.accessToken];case 2:return[2,null]}})})()}},{key:"clearRefreshToken",value:function clearRefreshToken(){this.refreshToken=null}},{key:"refresh",value:function refresh(auth,oldToken){var _this=this;return _async_to_generator$1(function(){var _ref,accessToken,refreshToken,expiresIn;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,requestStsToken(auth,oldToken)];case 1:_ref=_state.sent(),accessToken=_ref.accessToken,refreshToken=_ref.refreshToken,expiresIn=_ref.expiresIn;_this.updateTokensAndExpiration(accessToken,refreshToken,Number(expiresIn));return[2]}})})()}},{key:"updateTokensAndExpiration",value:function updateTokensAndExpiration(accessToken,refreshToken,expiresInSec){this.refreshToken=refreshToken||null;this.accessToken=accessToken||null;this.expirationTime=Date.now()+expiresInSec*1e3}},{key:"toJSON",value:function toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function _assign(stsTokenManager){this.accessToken=stsTokenManager.accessToken;this.refreshToken=stsTokenManager.refreshToken;this.expirationTime=stsTokenManager.expirationTime}},{key:"_clone",value:function _clone(){return Object.assign(new StsTokenManager,this.toJSON())}},{key:"_performRefresh",value:function _performRefresh(){return debugFail("not implemented")}}],[{key:"fromJSON",value:function fromJSON(appName,object){var refreshToken=object.refreshToken,accessToken=object.accessToken,expirationTime=object.expirationTime;var manager=new StsTokenManager;if(refreshToken){_assert(typeof refreshToken==="string","internal-error",{appName:appName});manager.refreshToken=refreshToken}if(accessToken){_assert(typeof accessToken==="string","internal-error",{appName:appName});manager.accessToken=accessToken}if(expirationTime){_assert(typeof expirationTime==="number","internal-error",{appName:appName});manager.expirationTime=expirationTime}return manager}}]);return StsTokenManager}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(assertion,appName){_assert(typeof assertion==="string"||typeof assertion==="undefined","internal-error",{appName:appName})}var UserImpl=function(){function UserImpl(_a){_class_call_check1(this,UserImpl);var uid=_a.uid,auth=_a.auth,stsTokenManager=_a.stsTokenManager,opt=__rest(_a,["uid","auth","stsTokenManager"]);this.providerId="firebase";this.proactiveRefresh=new ProactiveRefresh(this);this.reloadUserInfo=null;this.reloadListener=null;this.uid=uid;this.auth=auth;this.stsTokenManager=stsTokenManager;this.accessToken=stsTokenManager.accessToken;this.displayName=opt.displayName||null;this.email=opt.email||null;this.emailVerified=opt.emailVerified||false;this.phoneNumber=opt.phoneNumber||null;this.photoURL=opt.photoURL||null;this.isAnonymous=opt.isAnonymous||false;this.tenantId=opt.tenantId||null;this.providerData=opt.providerData?_to_consumable_array1(opt.providerData):[];this.metadata=new UserMetadata(opt.createdAt||undefined,opt.lastLoginAt||undefined)}_create_class1(UserImpl,[{key:"getIdToken",value:function getIdToken(forceRefresh){var _this=this;return _async_to_generator$1(function(){var accessToken;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_logoutIfInvalidated(_this,_this.stsTokenManager.getToken(_this.auth,forceRefresh))];case 1:accessToken=_state.sent();_assert(accessToken,_this.auth,"internal-error");if(!(_this.accessToken!==accessToken))return[3,3];_this.accessToken=accessToken;return[4,_this.auth._persistUserIfCurrent(_this)];case 2:_state.sent();_this.auth._notifyListenersIfCurrent(_this);_state.label=3;case 3:return[2,accessToken]}})})()}},{key:"getIdTokenResult",value:function getIdTokenResult1(forceRefresh){return getIdTokenResult(this,forceRefresh)}},{key:"reload",value:function reload1(){return reload(this)}},{key:"_assign",value:function _assign(user){if(this===user){return}_assert(this.uid===user.uid,this.auth,"internal-error");this.displayName=user.displayName;this.photoURL=user.photoURL;this.email=user.email;this.emailVerified=user.emailVerified;this.phoneNumber=user.phoneNumber;this.isAnonymous=user.isAnonymous;this.tenantId=user.tenantId;this.providerData=user.providerData.map(function(userInfo){return Object.assign({},userInfo)});this.metadata._copy(user.metadata);this.stsTokenManager._assign(user.stsTokenManager)}},{key:"_clone",value:function _clone(auth){var newUser=new UserImpl(Object.assign(Object.assign({},this),{auth:auth,stsTokenManager:this.stsTokenManager._clone()}));newUser.metadata._copy(this.metadata);return newUser}},{key:"_onReload",value:function _onReload(callback){_assert(!this.reloadListener,this.auth,"internal-error");this.reloadListener=callback;if(this.reloadUserInfo){this._notifyReloadListener(this.reloadUserInfo);this.reloadUserInfo=null}}},{key:"_notifyReloadListener",value:function _notifyReloadListener(userInfo){if(this.reloadListener){this.reloadListener(userInfo)}else{this.reloadUserInfo=userInfo}}},{key:"_startProactiveRefresh",value:function _startProactiveRefresh(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function _stopProactiveRefresh(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:function _updateTokensIfNecessary(response){var reload=arguments.length>1&&arguments[1]!==void 0?arguments[1]:false;var _this=this;return _async_to_generator$1(function(){var tokensRefreshed;return _ts_generator1(this,function(_state){switch(_state.label){case 0:tokensRefreshed=false;if(response.idToken&&response.idToken!==_this.stsTokenManager.accessToken){_this.stsTokenManager.updateFromServerResponse(response);tokensRefreshed=true}if(!reload)return[3,2];return[4,_reloadWithoutSaving(_this)];case 1:_state.sent();_state.label=2;case 2:return[4,_this.auth._persistUserIfCurrent(_this)];case 3:_state.sent();if(tokensRefreshed){_this.auth._notifyListenersIfCurrent(_this)}return[2]}})})()}},{key:"delete",value:function _delete(){var _this=this;return _async_to_generator$1(function(){var idToken;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.getIdToken()];case 1:idToken=_state.sent();return[4,_logoutIfInvalidated(_this,deleteAccount(_this.auth,{idToken:idToken}))];case 2:_state.sent();_this.stsTokenManager.clearRefreshToken();return[2,_this.auth.signOut()]}})})()}},{key:"toJSON",value:function toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||undefined,emailVerified:this.emailVerified,displayName:this.displayName||undefined,isAnonymous:this.isAnonymous,photoURL:this.photoURL||undefined,phoneNumber:this.phoneNumber||undefined,tenantId:this.tenantId||undefined,providerData:this.providerData.map(function(userInfo){return Object.assign({},userInfo)}),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function get(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function _fromJSON(auth,object){var _a,_b,_c,_d,_e,_f,_g,_h;var displayName=(_a=object.displayName)!==null&&_a!==void 0?_a:undefined;var email=(_b=object.email)!==null&&_b!==void 0?_b:undefined;var phoneNumber=(_c=object.phoneNumber)!==null&&_c!==void 0?_c:undefined;var photoURL=(_d=object.photoURL)!==null&&_d!==void 0?_d:undefined;var tenantId=(_e=object.tenantId)!==null&&_e!==void 0?_e:undefined;var _redirectEventId=(_f=object._redirectEventId)!==null&&_f!==void 0?_f:undefined;var createdAt=(_g=object.createdAt)!==null&&_g!==void 0?_g:undefined;var lastLoginAt=(_h=object.lastLoginAt)!==null&&_h!==void 0?_h:undefined;var uid=object.uid,emailVerified=object.emailVerified,isAnonymous=object.isAnonymous,providerData=object.providerData,plainObjectTokenManager=object.stsTokenManager;_assert(uid&&plainObjectTokenManager,auth,"internal-error");var stsTokenManager=StsTokenManager.fromJSON(this.name,plainObjectTokenManager);_assert(typeof uid==="string",auth,"internal-error");assertStringOrUndefined(displayName,auth.name);assertStringOrUndefined(email,auth.name);_assert(typeof emailVerified==="boolean",auth,"internal-error");_assert(typeof isAnonymous==="boolean",auth,"internal-error");assertStringOrUndefined(phoneNumber,auth.name);assertStringOrUndefined(photoURL,auth.name);assertStringOrUndefined(tenantId,auth.name);assertStringOrUndefined(_redirectEventId,auth.name);assertStringOrUndefined(createdAt,auth.name);assertStringOrUndefined(lastLoginAt,auth.name);var user=new UserImpl({uid:uid,auth:auth,email:email,emailVerified:emailVerified,displayName:displayName,isAnonymous:isAnonymous,photoURL:photoURL,phoneNumber:phoneNumber,tenantId:tenantId,stsTokenManager:stsTokenManager,createdAt:createdAt,lastLoginAt:lastLoginAt});if(providerData&&Array.isArray(providerData)){user.providerData=providerData.map(function(userInfo){return Object.assign({},userInfo)})}if(_redirectEventId){user._redirectEventId=_redirectEventId}return user}},{key:"_fromIdTokenResponse",value:function _fromIdTokenResponse(auth,idTokenResponse){var isAnonymous=arguments.length>2&&arguments[2]!==void 0?arguments[2]:false;return _async_to_generator$1(function(){var stsTokenManager,user;return _ts_generator1(this,function(_state){switch(_state.label){case 0:stsTokenManager=new StsTokenManager;stsTokenManager.updateFromServerResponse(idTokenResponse);user=new UserImpl({uid:idTokenResponse.localId,auth:auth,stsTokenManager:stsTokenManager,isAnonymous:isAnonymous});return[4,_reloadWithoutSaving(user)];case 1:_state.sent();return[2,user]}})})()}}]);return UserImpl}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var instanceCache=new Map;function _getInstance(cls){debugAssert(_instanceof1(cls,Function),"Expected a class definition");var instance=instanceCache.get(cls);if(instance){debugAssert(_instanceof1(instance,cls),"Instance stored in cache mismatched with class");return instance}instance=new cls;instanceCache.set(cls,instance);return instance}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var InMemoryPersistence=function(){function InMemoryPersistence(){_class_call_check1(this,InMemoryPersistence);this.type="NONE";this.storage={}}_create_class1(InMemoryPersistence,[{key:"_isAvailable",value:function _isAvailable(){return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,true]})})()}},{key:"_set",value:function _set(key,value){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){_this.storage[key]=value;return[2]})})()}},{key:"_get",value:function _get(key){var _this=this;return _async_to_generator$1(function(){var value;return _ts_generator1(this,function(_state){value=_this.storage[key];return[2,value===undefined?null:value]})})()}},{key:"_remove",value:function _remove(key){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){delete _this.storage[key];return[2]})})()}},{key:"_addListener",value:function _addListener(_key,_listener){return}},{key:"_removeListener",value:function _removeListener(_key,_listener){return}}]);return InMemoryPersistence}();InMemoryPersistence.type="NONE";var inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(key,apiKey,appName){return"firebase:".concat(key,":").concat(apiKey,":").concat(appName)}var PersistenceUserManager=function(){function PersistenceUserManager(persistence,auth,userKey){_class_call_check1(this,PersistenceUserManager);this.persistence=persistence;this.auth=auth;this.userKey=userKey;var _this_auth=this.auth,config=_this_auth.config,name=_this_auth.name;this.fullUserKey=_persistenceKeyName(this.userKey,config.apiKey,name);this.fullPersistenceKey=_persistenceKeyName("persistence",config.apiKey,name);this.boundEventHandler=auth._onStorageEvent.bind(auth);this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}_create_class1(PersistenceUserManager,[{key:"setCurrentUser",value:function setCurrentUser(user){return this.persistence._set(this.fullUserKey,user.toJSON())}},{key:"getCurrentUser",value:function getCurrentUser(){var _this=this;return _async_to_generator$1(function(){var blob;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.persistence._get(_this.fullUserKey)];case 1:blob=_state.sent();return[2,blob?UserImpl._fromJSON(_this.auth,blob):null]}})})()}},{key:"removeCurrentUser",value:function removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:function setPersistence(newPersistence){var _this=this;return _async_to_generator$1(function(){var currentUser;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this.persistence===newPersistence){return[2]}return[4,_this.getCurrentUser()];case 1:currentUser=_state.sent();return[4,_this.removeCurrentUser()];case 2:_state.sent();_this.persistence=newPersistence;if(currentUser){return[2,_this.setCurrentUser(currentUser)]}return[2]}})})()}},{key:"delete",value:function _delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:function create(auth,persistenceHierarchy){var userKey=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"authUser";return _async_to_generator$1(function(){var availablePersistences,selectedPersistence,key,userToMigrate,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,persistence,blob,user,err,migrationHierarchy;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!persistenceHierarchy.length){return[2,new PersistenceUserManager(_getInstance(inMemoryPersistence),auth,userKey)]}return[4,Promise.all(persistenceHierarchy.map(function(){var _ref=_async_to_generator$1(function(persistence){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,persistence._isAvailable()];case 1:if(_state.sent()){return[2,persistence]}return[2,undefined]}})});return function(persistence){return _ref.apply(this,arguments)}}()))];case 1:availablePersistences=_state.sent().filter(function(persistence){return persistence});selectedPersistence=availablePersistences[0]||_getInstance(inMemoryPersistence);key=_persistenceKeyName(userKey,auth.config.apiKey,auth.name);userToMigrate=null;_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=2;case 2:_state.trys.push([2,9,10,11]);_iterator=persistenceHierarchy[Symbol.iterator]();_state.label=3;case 3:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,8];persistence=_step.value;_state.label=4;case 4:_state.trys.push([4,6,,7]);return[4,persistence._get(key)];case 5:blob=_state.sent();if(blob){user=UserImpl._fromJSON(auth,blob);if(persistence!==selectedPersistence){userToMigrate=user}selectedPersistence=persistence;return[3,8]}return[3,7];case 6:_state.sent();return[3,7];case 7:_iteratorNormalCompletion=true;return[3,3];case 8:return[3,11];case 9:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,11];case 10:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 11:migrationHierarchy=availablePersistences.filter(function(p){return p._shouldAllowMigration});if(!selectedPersistence._shouldAllowMigration||!migrationHierarchy.length){return[2,new PersistenceUserManager(selectedPersistence,auth,userKey)]}selectedPersistence=migrationHierarchy[0];if(!userToMigrate)return[3,13];return[4,selectedPersistence._set(key,userToMigrate.toJSON())];case 12:_state.sent();_state.label=13;case 13:return[4,Promise.all(persistenceHierarchy.map(function(){var _ref=_async_to_generator$1(function(persistence){return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!(persistence!==selectedPersistence))return[3,4];_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,persistence._remove(key)];case 2:_state.sent();return[3,4];case 3:_state.sent();return[3,4];case 4:return[2]}})});return function(persistence){return _ref.apply(this,arguments)}}()))];case 14:_state.sent();return[2,new PersistenceUserManager(selectedPersistence,auth,userKey)]}})})()}}]);return PersistenceUserManager}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(userAgent){var ua=userAgent.toLowerCase();if(ua.includes("opera/")||ua.includes("opr/")||ua.includes("opios/")){return"Opera"}else if(_isIEMobile(ua)){return"IEMobile"}else if(ua.includes("msie")||ua.includes("trident/")){return"IE"}else if(ua.includes("edge/")){return"Edge"}else if(_isFirefox(ua)){return"Firefox"}else if(ua.includes("silk/")){return"Silk"}else if(_isBlackBerry(ua)){return"Blackberry"}else if(_isWebOS(ua)){return"Webos"}else if(_isSafari(ua)){return"Safari"}else if((ua.includes("chrome/")||_isChromeIOS(ua))&&!ua.includes("edge/")){return"Chrome"}else if(_isAndroid(ua)){return"Android"}else{var re=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/;var matches=userAgent.match(re);if((matches===null||matches===void 0?void 0:matches.length)===2){return matches[1]}}return"Other"}function _isFirefox(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/firefox\//i.test(ua)}function _isSafari(){var userAgent=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();var ua=userAgent.toLowerCase();return ua.includes("safari/")&&!ua.includes("chrome/")&&!ua.includes("crios/")&&!ua.includes("android")}function _isChromeIOS(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/crios\//i.test(ua)}function _isIEMobile(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/iemobile/i.test(ua)}function _isAndroid(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/android/i.test(ua)}function _isBlackBerry(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/blackberry/i.test(ua)}function _isWebOS(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/webos/i.test(ua)}function _isIOS(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return/iphone|ipad|ipod/i.test(ua)||/macintosh/i.test(ua)&&/mobile/i.test(ua)}function _isIOSStandalone(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();var _a;return _isIOS(ua)&&!!((_a=window.navigator)===null||_a===void 0?void 0:_a.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(){var ua=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getUA();return _isIOS(ua)||_isAndroid(ua)||_isWebOS(ua)||_isBlackBerry(ua)||/windows phone/i.test(ua)||_isIEMobile(ua)}function _isIframe(){try{return!!(window&&window!==window.top)}catch(e){return false}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(clientPlatform){var frameworks=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];var reportedPlatform;switch(clientPlatform){case"Browser":reportedPlatform=_getBrowserName(getUA());break;case"Worker":reportedPlatform="".concat(_getBrowserName(getUA()),"-").concat(clientPlatform);break;default:reportedPlatform=clientPlatform}var reportedFrameworks=frameworks.length?frameworks.join(","):"FirebaseCore-web";return"".concat(reportedPlatform,"/","JsCore","/").concat(SDK_VERSION,"/").concat(reportedFrameworks)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var AuthMiddlewareQueue=function(){function AuthMiddlewareQueue(auth){_class_call_check1(this,AuthMiddlewareQueue);this.auth=auth;this.queue=[]}_create_class1(AuthMiddlewareQueue,[{key:"pushCallback",value:function pushCallback(callback,onAbort){var _this=this;var wrappedCallback=function wrappedCallback(user){return new Promise(function(resolve,reject){try{var result=callback(user);resolve(result)}catch(e){reject(e)}})};wrappedCallback.onAbort=onAbort;this.queue.push(wrappedCallback);var index=this.queue.length-1;return function(){_this.queue[index]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:function runMiddleware(nextUser){var _this=this;return _async_to_generator$1(function(){var onAbortStack,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,beforeStateCallback,err,e,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_iterator1,_step1,onAbort;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this.auth.currentUser===nextUser){return[2]}onAbortStack=[];_state.label=1;case 1:_state.trys.push([1,10,,11]);_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;_state.label=2;case 2:_state.trys.push([2,7,8,9]);_iterator=_this.queue[Symbol.iterator]();_state.label=3;case 3:if(!!(_iteratorNormalCompletion=(_step=_iterator.next()).done))return[3,6];beforeStateCallback=_step.value;return[4,beforeStateCallback(nextUser)];case 4:_state.sent();if(beforeStateCallback.onAbort){onAbortStack.push(beforeStateCallback.onAbort)}_state.label=5;case 5:_iteratorNormalCompletion=true;return[3,3];case 6:return[3,9];case 7:err=_state.sent();_didIteratorError=true;_iteratorError=err;return[3,9];case 8:try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}return[7];case 9:return[3,11];case 10:e=_state.sent();onAbortStack.reverse();_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(_iterator1=onAbortStack[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){onAbort=_step1.value;try{onAbort()}catch(_){}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}throw _this.auth._errorFactory.create("login-blocked",{originalMessage:e===null||e===void 0?void 0:e.message});case 11:return[2]}})})()}}]);return AuthMiddlewareQueue}();function _getPasswordPolicy(auth){return __getPasswordPolicy.apply(this,arguments)}function __getPasswordPolicy(){__getPasswordPolicy=/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth){var request;var _arguments=arguments;return _ts_generator1(this,function(_state){request=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:{};return[2,_performApiRequest(auth,"GET","/v2/passwordPolicy",_addTidIfNecessary(auth,request))]})});return __getPasswordPolicy.apply(this,arguments)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MINIMUM_MIN_PASSWORD_LENGTH=6;var PasswordPolicyImpl=function(){function PasswordPolicyImpl(response){_class_call_check1(this,PasswordPolicyImpl);var _a,_b,_c,_d;var responseOptions=response.customStrengthOptions;this.customStrengthOptions={};this.customStrengthOptions.minPasswordLength=(_a=responseOptions.minPasswordLength)!==null&&_a!==void 0?_a:MINIMUM_MIN_PASSWORD_LENGTH;if(responseOptions.maxPasswordLength){this.customStrengthOptions.maxPasswordLength=responseOptions.maxPasswordLength}if(responseOptions.containsLowercaseCharacter!==undefined){this.customStrengthOptions.containsLowercaseLetter=responseOptions.containsLowercaseCharacter}if(responseOptions.containsUppercaseCharacter!==undefined){this.customStrengthOptions.containsUppercaseLetter=responseOptions.containsUppercaseCharacter}if(responseOptions.containsNumericCharacter!==undefined){this.customStrengthOptions.containsNumericCharacter=responseOptions.containsNumericCharacter}if(responseOptions.containsNonAlphanumericCharacter!==undefined){this.customStrengthOptions.containsNonAlphanumericCharacter=responseOptions.containsNonAlphanumericCharacter}this.enforcementState=response.enforcementState;if(this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"){this.enforcementState="OFF"}this.allowedNonAlphanumericCharacters=(_c=(_b=response.allowedNonAlphanumericCharacters)===null||_b===void 0?void 0:_b.join(""))!==null&&_c!==void 0?_c:"";this.forceUpgradeOnSignin=(_d=response.forceUpgradeOnSignin)!==null&&_d!==void 0?_d:false;this.schemaVersion=response.schemaVersion}_create_class1(PasswordPolicyImpl,[{key:"validatePassword",value:function validatePassword(password){var _a,_b,_c,_d,_e,_f;var status={isValid:true,passwordPolicy:this};this.validatePasswordLengthOptions(password,status);this.validatePasswordCharacterOptions(password,status);status.isValid&&(status.isValid=(_a=status.meetsMinPasswordLength)!==null&&_a!==void 0?_a:true);status.isValid&&(status.isValid=(_b=status.meetsMaxPasswordLength)!==null&&_b!==void 0?_b:true);status.isValid&&(status.isValid=(_c=status.containsLowercaseLetter)!==null&&_c!==void 0?_c:true);status.isValid&&(status.isValid=(_d=status.containsUppercaseLetter)!==null&&_d!==void 0?_d:true);status.isValid&&(status.isValid=(_e=status.containsNumericCharacter)!==null&&_e!==void 0?_e:true);status.isValid&&(status.isValid=(_f=status.containsNonAlphanumericCharacter)!==null&&_f!==void 0?_f:true);return status}},{key:"validatePasswordLengthOptions",value:function validatePasswordLengthOptions(password,status){var minPasswordLength=this.customStrengthOptions.minPasswordLength;var maxPasswordLength=this.customStrengthOptions.maxPasswordLength;if(minPasswordLength){status.meetsMinPasswordLength=password.length>=minPasswordLength}if(maxPasswordLength){status.meetsMaxPasswordLength=password.length<=maxPasswordLength}}},{key:"validatePasswordCharacterOptions",value:function validatePasswordCharacterOptions(password,status){this.updatePasswordCharacterOptionsStatuses(status,false,false,false,false);var passwordChar;for(var i=0;i<password.length;i++){passwordChar=password.charAt(i);this.updatePasswordCharacterOptionsStatuses(status,passwordChar>="a"&&passwordChar<="z",passwordChar>="A"&&passwordChar<="Z",passwordChar>="0"&&passwordChar<="9",this.allowedNonAlphanumericCharacters.includes(passwordChar))}}},{key:"updatePasswordCharacterOptionsStatuses",value:function updatePasswordCharacterOptionsStatuses(status,containsLowercaseCharacter,containsUppercaseCharacter,containsNumericCharacter,containsNonAlphanumericCharacter){if(this.customStrengthOptions.containsLowercaseLetter){status.containsLowercaseLetter||(status.containsLowercaseLetter=containsLowercaseCharacter)}if(this.customStrengthOptions.containsUppercaseLetter){status.containsUppercaseLetter||(status.containsUppercaseLetter=containsUppercaseCharacter)}if(this.customStrengthOptions.containsNumericCharacter){status.containsNumericCharacter||(status.containsNumericCharacter=containsNumericCharacter)}if(this.customStrengthOptions.containsNonAlphanumericCharacter){status.containsNonAlphanumericCharacter||(status.containsNonAlphanumericCharacter=containsNonAlphanumericCharacter)}}}]);return PasswordPolicyImpl}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var AuthImpl=function(){function AuthImpl(app,heartbeatServiceProvider,appCheckServiceProvider,config){_class_call_check1(this,AuthImpl);this.app=app;this.heartbeatServiceProvider=heartbeatServiceProvider;this.appCheckServiceProvider=appCheckServiceProvider;this.config=config;this.currentUser=null;this.emulatorConfig=null;this.operations=Promise.resolve();this.authStateSubscription=new Subscription(this);this.idTokenSubscription=new Subscription(this);this.beforeStateQueue=new AuthMiddlewareQueue(this);this.redirectUser=null;this.isProactiveRefreshEnabled=false;this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1;this._canInitEmulator=true;this._isInitialized=false;this._deleted=false;this._initializationPromise=null;this._popupRedirectResolver=null;this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY;this._agentRecaptchaConfig=null;this._tenantRecaptchaConfigs={};this._projectPasswordPolicy=null;this._tenantPasswordPolicies={};this.lastNotifiedUid=undefined;this.languageCode=null;this.tenantId=null;this.settings={appVerificationDisabledForTesting:false};this.frameworks=[];this.name=app.name;this.clientVersion=config.sdkClientVersion}_create_class1(AuthImpl,[{key:"_initializeWithPersistence",value:function _initializeWithPersistence(persistenceHierarchy,popupRedirectResolver){if(popupRedirectResolver){this._popupRedirectResolver=_getInstance(popupRedirectResolver)}var _this=this;this._initializationPromise=this.queue(_async_to_generator$1(function(){var _a,_b;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this._deleted){return[2]}return[4,PersistenceUserManager.create(_this,persistenceHierarchy)];case 1:_this.persistenceManager=_state.sent();if(_this._deleted){return[2]}if(!((_a=_this._popupRedirectResolver)===null||_a===void 0?void 0:_a._shouldInitProactively))return[3,5];_state.label=2;case 2:_state.trys.push([2,4,,5]);return[4,_this._popupRedirectResolver._initialize(_this)];case 3:_state.sent();return[3,5];case 4:_state.sent();return[3,5];case 5:return[4,_this.initializeCurrentUser(popupRedirectResolver)];case 6:_state.sent();_this.lastNotifiedUid=((_b=_this.currentUser)===null||_b===void 0?void 0:_b.uid)||null;if(_this._deleted){return[2]}_this._isInitialized=true;return[2]}})}));return this._initializationPromise}},{key:"_onStorageEvent",value:function _onStorageEvent(){var _this=this;return _async_to_generator$1(function(){var user;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this._deleted){return[2]}return[4,_this.assertedPersistence.getCurrentUser()];case 1:user=_state.sent();if(!_this.currentUser&&!user){return[2]}if(!(_this.currentUser&&user&&_this.currentUser.uid===user.uid))return[3,3];_this._currentUser._assign(user);return[4,_this.currentUser.getIdToken()];case 2:_state.sent();return[2];case 3:return[4,_this._updateCurrentUser(user,true)];case 4:_state.sent();return[2]}})})()}},{key:"initializeCurrentUser",value:function initializeCurrentUser(popupRedirectResolver){var _this=this;return _async_to_generator$1(function(){var _a,previouslyStoredUser,futureCurrentUser,needsTocheckMiddleware,redirectUserEventId,storedUserEventId,result,e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.assertedPersistence.getCurrentUser()];case 1:previouslyStoredUser=_state.sent();futureCurrentUser=previouslyStoredUser;needsTocheckMiddleware=false;if(!(popupRedirectResolver&&_this.config.authDomain))return[3,4];return[4,_this.getOrInitRedirectPersistenceManager()];case 2:_state.sent();redirectUserEventId=(_a=_this.redirectUser)===null||_a===void 0?void 0:_a._redirectEventId;storedUserEventId=futureCurrentUser===null||futureCurrentUser===void 0?void 0:futureCurrentUser._redirectEventId;return[4,_this.tryRedirectSignIn(popupRedirectResolver)];case 3:result=_state.sent();if((!redirectUserEventId||redirectUserEventId===storedUserEventId)&&(result===null||result===void 0?void 0:result.user)){futureCurrentUser=result.user;needsTocheckMiddleware=true}_state.label=4;case 4:if(!futureCurrentUser){return[2,_this.directlySetCurrentUser(null)]}if(!!futureCurrentUser._redirectEventId)return[3,9];if(!needsTocheckMiddleware)return[3,8];_state.label=5;case 5:_state.trys.push([5,7,,8]);return[4,_this.beforeStateQueue.runMiddleware(futureCurrentUser)];case 6:_state.sent();return[3,8];case 7:e=_state.sent();futureCurrentUser=previouslyStoredUser;_this._popupRedirectResolver._overrideRedirectResult(_this,function(){return Promise.reject(e)});return[3,8];case 8:if(futureCurrentUser){return[2,_this.reloadAndSetCurrentUserOrClear(futureCurrentUser)]}else{return[2,_this.directlySetCurrentUser(null)]}case 9:_assert(_this._popupRedirectResolver,_this,"argument-error");return[4,_this.getOrInitRedirectPersistenceManager()];case 10:_state.sent();if(_this.redirectUser&&_this.redirectUser._redirectEventId===futureCurrentUser._redirectEventId){return[2,_this.directlySetCurrentUser(futureCurrentUser)]}return[2,_this.reloadAndSetCurrentUserOrClear(futureCurrentUser)]}})})()}},{key:"tryRedirectSignIn",value:function tryRedirectSignIn(redirectResolver){var _this=this;return _async_to_generator$1(function(){var result;return _ts_generator1(this,function(_state){switch(_state.label){case 0:result=null;_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,_this._popupRedirectResolver._completeRedirectFn(_this,redirectResolver,true)];case 2:result=_state.sent();return[3,5];case 3:_state.sent();return[4,_this._setRedirectUser(null)];case 4:_state.sent();return[3,5];case 5:return[2,result]}})})()}},{key:"reloadAndSetCurrentUserOrClear",value:function reloadAndSetCurrentUserOrClear(user){var _this=this;return _async_to_generator$1(function(){var e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_reloadWithoutSaving(user)];case 1:_state.sent();return[3,3];case 2:e=_state.sent();if((e===null||e===void 0?void 0:e.code)!=="auth/network-request-failed"){return[2,_this.directlySetCurrentUser(null)]}return[3,3];case 3:return[2,_this.directlySetCurrentUser(user)]}})})()}},{key:"useDeviceLanguage",value:function useDeviceLanguage(){this.languageCode=_getUserLanguage()}},{key:"_delete",value:function _delete(){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){_this._deleted=true;return[2]})})()}},{key:"updateCurrentUser",value:function updateCurrentUser(userExtern){var _this=this;return _async_to_generator$1(function(){var user;return _ts_generator1(this,function(_state){user=userExtern?getModularInstance(userExtern):null;if(user){_assert(user.auth.config.apiKey===_this.config.apiKey,_this,"invalid-user-token")}return[2,_this._updateCurrentUser(user&&user._clone(_this))]})})()}},{key:"_updateCurrentUser",value:function _updateCurrentUser(user){var skipBeforeStateCallbacks=arguments.length>1&&arguments[1]!==void 0?arguments[1]:false;var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this._deleted){return[2]}if(user){_assert(_this.tenantId===user.tenantId,_this,"tenant-id-mismatch")}if(!!skipBeforeStateCallbacks)return[3,2];return[4,_this.beforeStateQueue.runMiddleware(user)];case 1:_state.sent();_state.label=2;case 2:return[2,_this.queue(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.directlySetCurrentUser(user)];case 1:_state.sent();_this.notifyAuthListeners();return[2]}})}))]}})})()}},{key:"signOut",value:function signOut(){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.beforeStateQueue.runMiddleware(null)];case 1:_state.sent();if(!(_this.redirectPersistenceManager||_this._popupRedirectResolver))return[3,3];return[4,_this._setRedirectUser(null)];case 2:_state.sent();_state.label=3;case 3:return[2,_this._updateCurrentUser(null,true)]}})})()}},{key:"setPersistence",value:function setPersistence(persistence){var _this=this;return this.queue(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.assertedPersistence.setPersistence(_getInstance(persistence))];case 1:_state.sent();return[2]}})}))}},{key:"_getRecaptchaConfig",value:function _getRecaptchaConfig(){if(this.tenantId==null){return this._agentRecaptchaConfig}else{return this._tenantRecaptchaConfigs[this.tenantId]}}},{key:"validatePassword",value:function validatePassword(password){var _this=this;return _async_to_generator$1(function(){var passwordPolicy;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!!_this._getPasswordPolicyInternal())return[3,2];return[4,_this._updatePasswordPolicy()];case 1:_state.sent();_state.label=2;case 2:passwordPolicy=_this._getPasswordPolicyInternal();if(passwordPolicy.schemaVersion!==_this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION){return[2,Promise.reject(_this._errorFactory.create("unsupported-password-policy-schema-version",{}))]}return[2,passwordPolicy.validatePassword(password)]}})})()}},{key:"_getPasswordPolicyInternal",value:function _getPasswordPolicyInternal(){if(this.tenantId===null){return this._projectPasswordPolicy}else{return this._tenantPasswordPolicies[this.tenantId]}}},{key:"_updatePasswordPolicy",value:function _updatePasswordPolicy(){var _this=this;return _async_to_generator$1(function(){var response,passwordPolicy;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_getPasswordPolicy(_this)];case 1:response=_state.sent();passwordPolicy=new PasswordPolicyImpl(response);if(_this.tenantId===null){_this._projectPasswordPolicy=passwordPolicy}else{_this._tenantPasswordPolicies[_this.tenantId]=passwordPolicy}return[2]}})})()}},{key:"_getPersistence",value:function _getPersistence(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function _updateErrorMap(errorMap){this._errorFactory=new ErrorFactory("auth","Firebase",errorMap())}},{key:"onAuthStateChanged",value:function onAuthStateChanged(nextOrObserver,error,completed){return this.registerStateListener(this.authStateSubscription,nextOrObserver,error,completed)}},{key:"beforeAuthStateChanged",value:function beforeAuthStateChanged(callback,onAbort){return this.beforeStateQueue.pushCallback(callback,onAbort)}},{key:"onIdTokenChanged",value:function onIdTokenChanged(nextOrObserver,error,completed){return this.registerStateListener(this.idTokenSubscription,nextOrObserver,error,completed)}},{key:"authStateReady",value:function authStateReady(){var _this=this;return new Promise(function(resolve,reject){if(_this.currentUser){resolve()}else{var unsubscribe=_this.onAuthStateChanged(function(){unsubscribe();resolve()},reject)}})}},{key:"revokeAccessToken",value:function revokeAccessToken(token){var _this=this;return _async_to_generator$1(function(){var idToken,request;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!_this.currentUser)return[3,3];return[4,_this.currentUser.getIdToken()];case 1:idToken=_state.sent();request={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:token,idToken:idToken};if(_this.tenantId!=null){request.tenantId=_this.tenantId}return[4,revokeToken(_this,request)];case 2:_state.sent();_state.label=3;case 3:return[2]}})})()}},{key:"toJSON",value:function toJSON(){var _a;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(_a=this._currentUser)===null||_a===void 0?void 0:_a.toJSON()}}},{key:"_setRedirectUser",value:function _setRedirectUser(user,popupRedirectResolver){var _this=this;return _async_to_generator$1(function(){var redirectManager;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this.getOrInitRedirectPersistenceManager(popupRedirectResolver)];case 1:redirectManager=_state.sent();return[2,user===null?redirectManager.removeCurrentUser():redirectManager.setCurrentUser(user)]}})})()}},{key:"getOrInitRedirectPersistenceManager",value:function getOrInitRedirectPersistenceManager(popupRedirectResolver){var _this=this;return _async_to_generator$1(function(){var resolver;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!!_this.redirectPersistenceManager)return[3,3];resolver=popupRedirectResolver&&_getInstance(popupRedirectResolver)||_this._popupRedirectResolver;_assert(resolver,_this,"argument-error");return[4,PersistenceUserManager.create(_this,[_getInstance(resolver._redirectPersistence)],"redirectUser")];case 1:_this.redirectPersistenceManager=_state.sent();return[4,_this.redirectPersistenceManager.getCurrentUser()];case 2:_this.redirectUser=_state.sent();_state.label=3;case 3:return[2,_this.redirectPersistenceManager]}})})()}},{key:"_redirectUserForId",value:function _redirectUserForId(id){var _this=this;return _async_to_generator$1(function(){var _a,_b;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!_this._isInitialized)return[3,2];return[4,_this.queue(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2]})}))];case 1:_state.sent();_state.label=2;case 2:if(((_a=_this._currentUser)===null||_a===void 0?void 0:_a._redirectEventId)===id){return[2,_this._currentUser]}if(((_b=_this.redirectUser)===null||_b===void 0?void 0:_b._redirectEventId)===id){return[2,_this.redirectUser]}return[2,null]}})})()}},{key:"_persistUserIfCurrent",value:function _persistUserIfCurrent(user){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){if(user===_this.currentUser){return[2,_this.queue(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,_this.directlySetCurrentUser(user)]})}))]}return[2]})})()}},{key:"_notifyListenersIfCurrent",value:function _notifyListenersIfCurrent(user){if(user===this.currentUser){this.notifyAuthListeners()}}},{key:"_key",value:function _key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function _startProactiveRefresh(){this.isProactiveRefreshEnabled=true;if(this.currentUser){this._currentUser._startProactiveRefresh()}}},{key:"_stopProactiveRefresh",value:function _stopProactiveRefresh(){this.isProactiveRefreshEnabled=false;if(this.currentUser){this._currentUser._stopProactiveRefresh()}}},{key:"_currentUser",get:function get(){return this.currentUser}},{key:"notifyAuthListeners",value:function notifyAuthListeners(){var _a,_b;if(!this._isInitialized){return}this.idTokenSubscription.next(this.currentUser);var currentUid=(_b=(_a=this.currentUser)===null||_a===void 0?void 0:_a.uid)!==null&&_b!==void 0?_b:null;if(this.lastNotifiedUid!==currentUid){this.lastNotifiedUid=currentUid;this.authStateSubscription.next(this.currentUser)}}},{key:"registerStateListener",value:function registerStateListener(subscription,nextOrObserver,error,completed){var _this=this;if(this._deleted){return function(){}}var cb=typeof nextOrObserver==="function"?nextOrObserver:nextOrObserver.next.bind(nextOrObserver);var isUnsubscribed=false;var promise=this._isInitialized?Promise.resolve():this._initializationPromise;_assert(promise,this,"internal-error");promise.then(function(){if(isUnsubscribed){return}cb(_this.currentUser)});if(typeof nextOrObserver==="function"){var unsubscribe=subscription.addObserver(nextOrObserver,error,completed);return function(){isUnsubscribed=true;unsubscribe()}}else{var unsubscribe1=subscription.addObserver(nextOrObserver);return function(){isUnsubscribed=true;unsubscribe1()}}}},{key:"directlySetCurrentUser",value:function directlySetCurrentUser(user){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this.currentUser&&_this.currentUser!==user){_this._currentUser._stopProactiveRefresh()}if(user&&_this.isProactiveRefreshEnabled){user._startProactiveRefresh()}_this.currentUser=user;if(!user)return[3,2];return[4,_this.assertedPersistence.setCurrentUser(user)];case 1:_state.sent();return[3,4];case 2:return[4,_this.assertedPersistence.removeCurrentUser()];case 3:_state.sent();_state.label=4;case 4:return[2]}})})()}},{key:"queue",value:function queue(action){this.operations=this.operations.then(action,action);return this.operations}},{key:"assertedPersistence",get:function get(){_assert(this.persistenceManager,this,"internal-error");return this.persistenceManager}},{key:"_logFramework",value:function _logFramework(framework){if(!framework||this.frameworks.includes(framework)){return}this.frameworks.push(framework);this.frameworks.sort();this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks())}},{key:"_getFrameworks",value:function _getFrameworks(){return this.frameworks}},{key:"_getAdditionalHeaders",value:function _getAdditionalHeaders(){var _this=this;return _async_to_generator$1(function(){var _a,headers,heartbeatsHeader,appCheckToken;return _ts_generator1(this,function(_state){switch(_state.label){case 0:headers=_define_property$1({},"X-Client-Version",_this.clientVersion);if(_this.app.options.appId){headers["X-Firebase-gmpid"]=_this.app.options.appId}return[4,(_a=_this.heartbeatServiceProvider.getImmediate({optional:true}))===null||_a===void 0?void 0:_a.getHeartbeatsHeader()];case 1:heartbeatsHeader=_state.sent();if(heartbeatsHeader){headers["X-Firebase-Client"]=heartbeatsHeader}return[4,_this._getAppCheckToken()];case 2:appCheckToken=_state.sent();if(appCheckToken){headers["X-Firebase-AppCheck"]=appCheckToken}return[2,headers]}})})()}},{key:"_getAppCheckToken",value:function _getAppCheckToken(){var _this=this;return _async_to_generator$1(function(){var _a,appCheckTokenResult;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,(_a=_this.appCheckServiceProvider.getImmediate({optional:true}))===null||_a===void 0?void 0:_a.getToken()];case 1:appCheckTokenResult=_state.sent();if(appCheckTokenResult===null||appCheckTokenResult===void 0?void 0:appCheckTokenResult.error){_logWarn("Error while retrieving App Check token: ".concat(appCheckTokenResult.error))}return[2,appCheckTokenResult===null||appCheckTokenResult===void 0?void 0:appCheckTokenResult.token]}})})()}}]);return AuthImpl}();function _castAuth(auth){return getModularInstance(auth)}var Subscription=function(){function Subscription(auth){var _this=this;_class_call_check1(this,Subscription);this.auth=auth;this.observer=null;this.addObserver=createSubscribe(function(observer){return _this.observer=observer})}_create_class1(Subscription,[{key:"next",get:function get(){_assert(this.observer,this.auth,"internal-error");return this.observer.next.bind(this.observer)}}]);return Subscription}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var externalJSProvider={loadJS:function loadJS(){return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){throw new Error("Unable to load external scripts")})})()},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _setExternalJSProvider(p){externalJSProvider=p}function _loadJS(url){return externalJSProvider.loadJS(url)}function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}function _gapiScriptUrl(){return externalJSProvider.gapiScript}function _generateCallbackName(prefix){return"__".concat(prefix).concat(Math.floor(Math.random()*1e6))}var RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise";var FAKE_TOKEN="NO_RECAPTCHA";var RecaptchaEnterpriseVerifier=function(){function RecaptchaEnterpriseVerifier(authExtern){_class_call_check1(this,RecaptchaEnterpriseVerifier);this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE;this.auth=_castAuth(authExtern)}_create_class1(RecaptchaEnterpriseVerifier,[{key:"verify",value:function verify(){var action=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"verify",forceRefresh=arguments.length>1&&arguments[1]!==void 0?arguments[1]:false;var _this=this;return _async_to_generator$1(function(){function retrieveSiteKey(auth){return _retrieveSiteKey.apply(this,arguments)}function _retrieveSiteKey(){_retrieveSiteKey=_async_to_generator$1(function(auth){return _ts_generator1(this,function(_state){if(!forceRefresh){if(auth.tenantId==null&&auth._agentRecaptchaConfig!=null){return[2,auth._agentRecaptchaConfig.siteKey]}if(auth.tenantId!=null&&auth._tenantRecaptchaConfigs[auth.tenantId]!==undefined){return[2,auth._tenantRecaptchaConfigs[auth.tenantId].siteKey]}}return[2,new Promise(function(){var _ref=_async_to_generator$1(function(resolve,reject){return _ts_generator1(this,function(_state){getRecaptchaConfig(auth,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(function(response){if(response.recaptchaKey===undefined){reject(new Error("recaptcha Enterprise site key undefined"))}else{var config=new RecaptchaConfig(response);if(auth.tenantId==null){auth._agentRecaptchaConfig=config}else{auth._tenantRecaptchaConfigs[auth.tenantId]=config}return resolve(config.siteKey)}}).catch(function(error){reject(error)});return[2]})});return function(resolve,reject){return _ref.apply(this,arguments)}}())]})});return _retrieveSiteKey.apply(this,arguments)}function retrieveRecaptchaToken(siteKey,resolve,reject){var grecaptcha=window.grecaptcha;if(isEnterprise(grecaptcha)){grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute(siteKey,{action:action}).then(function(token){resolve(token)}).catch(function(){resolve(FAKE_TOKEN)})})}else{reject(Error("No reCAPTCHA enterprise script loaded."))}}return _ts_generator1(this,function(_state){return[2,new Promise(function(resolve,reject){retrieveSiteKey(_this.auth).then(function(siteKey){if(!forceRefresh&&isEnterprise(window.grecaptcha)){retrieveRecaptchaToken(siteKey,resolve,reject)}else{if(typeof window==="undefined"){reject(new Error("RecaptchaVerifier is only supported in browser"));return}var url=_recaptchaEnterpriseScriptUrl();if(url.length!==0){url+=siteKey}_loadJS(url).then(function(){retrieveRecaptchaToken(siteKey,resolve,reject)}).catch(function(error){reject(error)})}}).catch(function(error){reject(error)})})]})})()}}]);return RecaptchaEnterpriseVerifier}();function injectRecaptchaFields(auth,request,action){return _injectRecaptchaFields.apply(this,arguments)}function _injectRecaptchaFields(){_injectRecaptchaFields=_async_to_generator$1(function(auth,request,action){var captchaResp,verifier,captchaResponse,newRequest;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:captchaResp=_arguments.length>3&&_arguments[3]!==void 0?_arguments[3]:false;verifier=new RecaptchaEnterpriseVerifier(auth);_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,verifier.verify(action)];case 2:captchaResponse=_state.sent();return[3,5];case 3:_state.sent();return[4,verifier.verify(action,true)];case 4:captchaResponse=_state.sent();return[3,5];case 5:newRequest=Object.assign({},request);if(!captchaResp){Object.assign(newRequest,{captchaResponse:captchaResponse})}else{Object.assign(newRequest,{"captchaResp":captchaResponse})}Object.assign(newRequest,{"clientType":"CLIENT_TYPE_WEB"});Object.assign(newRequest,{"recaptchaVersion":"RECAPTCHA_ENTERPRISE"});return[2,newRequest]}})});return _injectRecaptchaFields.apply(this,arguments)}function handleRecaptchaFlow(authInstance,request,actionName,actionMethod){return _handleRecaptchaFlow.apply(this,arguments)}function _handleRecaptchaFlow(){_handleRecaptchaFlow=_async_to_generator$1(function(authInstance,request,actionName,actionMethod){var _a,requestWithRecaptcha;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!((_a=authInstance._getRecaptchaConfig())===null||_a===void 0?void 0:_a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")))return[3,2];return[4,injectRecaptchaFields(authInstance,request,actionName,actionName==="getOobCode")];case 1:requestWithRecaptcha=_state.sent();return[2,actionMethod(authInstance,requestWithRecaptcha)];case 2:return[2,actionMethod(authInstance,request).catch(function(){var _ref=_async_to_generator$1(function(error){var requestWithRecaptcha;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!(error.code==="auth/missing-recaptcha-token"))return[3,2];console.log("".concat(actionName," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));return[4,injectRecaptchaFields(authInstance,request,actionName,actionName==="getOobCode")];case 1:requestWithRecaptcha=_state.sent();return[2,actionMethod(authInstance,requestWithRecaptcha)];case 2:return[2,Promise.reject(error)];case 3:return[2]}})});return function(error){return _ref.apply(this,arguments)}}())];case 3:return[2]}})});return _handleRecaptchaFlow.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(app,deps){var provider=_getProvider(app,"auth");if(provider.isInitialized()){var auth=provider.getImmediate();var initialOptions=provider.getOptions();if(deepEqual(initialOptions,deps!==null&&deps!==void 0?deps:{})){return auth}else{_fail(auth,"already-initialized")}}var auth1=provider.initialize({options:deps});return auth1}function _initializeAuthInstance(auth,deps){var persistence=(deps===null||deps===void 0?void 0:deps.persistence)||[];var hierarchy=(Array.isArray(persistence)?persistence:[persistence]).map(_getInstance);if(deps===null||deps===void 0?void 0:deps.errorMap){auth._updateErrorMap(deps.errorMap)}auth._initializeWithPersistence(hierarchy,deps===null||deps===void 0?void 0:deps.popupRedirectResolver)}function connectAuthEmulator(auth,url,options){var authInternal=_castAuth(auth);_assert(authInternal._canInitEmulator,authInternal,"emulator-config-failed");_assert(/^https?:\/\//.test(url),authInternal,"invalid-emulator-scheme");var disableWarnings=!!(options===null||options===void 0?void 0:options.disableWarnings);var protocol=extractProtocol(url);var _extractHostAndPort=extractHostAndPort(url),host=_extractHostAndPort.host,port=_extractHostAndPort.port;var portStr=port===null?"":":".concat(port);authInternal.config.emulator={url:"".concat(protocol,"//").concat(host).concat(portStr,"/")};authInternal.settings.appVerificationDisabledForTesting=true;authInternal.emulatorConfig=Object.freeze({host:host,port:port,protocol:protocol.replace(":",""),options:Object.freeze({disableWarnings:disableWarnings})});if(!disableWarnings){emitEmulatorWarning()}}function extractProtocol(url){var protocolEnd=url.indexOf(":");return protocolEnd<0?"":url.substr(0,protocolEnd+1)}function extractHostAndPort(url){var protocol=extractProtocol(url);var authority=/(\/\/)?([^?#/]+)/.exec(url.substr(protocol.length));if(!authority){return{host:"",port:null}}var hostAndPort=authority[2].split("@").pop()||"";var bracketedIPv6=/^(\[[^\]]+\])(:|$)/.exec(hostAndPort);if(bracketedIPv6){var host=bracketedIPv6[1];return{host:host,port:parsePort(hostAndPort.substr(host.length+1))}}else{var _hostAndPort_split=_sliced_to_array1(hostAndPort.split(":"),2),host1=_hostAndPort_split[0],port=_hostAndPort_split[1];return{host:host1,port:parsePort(port)}}}function parsePort(portStr){if(!portStr){return null}var port=Number(portStr);if(isNaN(port)){return null}return port}function emitEmulatorWarning(){function attachBanner(){var el=document.createElement("p");var sty=el.style;el.innerText="Running in emulator mode. Do not use with production credentials.";sty.position="fixed";sty.width="100%";sty.backgroundColor="#ffffff";sty.border=".1em solid #000000";sty.color="#b50000";sty.bottom="0px";sty.left="0px";sty.margin="0px";sty.zIndex="10000";sty.textAlign="center";el.classList.add("firebase-emulator-warning");document.body.appendChild(el)}if(typeof console!=="undefined"&&typeof console.info==="function"){console.info("WARNING: You are using the Auth Emulator,"+" which is intended for local testing only.  Do not use with"+" production credentials.")}if(typeof window!=="undefined"&&typeof document!=="undefined"){if(document.readyState==="loading"){window.addEventListener("DOMContentLoaded",attachBanner)}else{attachBanner()}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var AuthCredential=function(){function AuthCredential(providerId,signInMethod){_class_call_check1(this,AuthCredential);this.providerId=providerId;this.signInMethod=signInMethod}_create_class1(AuthCredential,[{key:"toJSON",value:function toJSON(){return debugFail("not implemented")}},{key:"_getIdTokenResponse",value:function _getIdTokenResponse(_auth){return debugFail("not implemented")}},{key:"_linkToIdToken",value:function _linkToIdToken(_auth,_idToken){return debugFail("not implemented")}},{key:"_getReauthenticationResolver",value:function _getReauthenticationResolver(_auth){return debugFail("not implemented")}}]);return AuthCredential}();function linkEmailPassword(auth,request){return _linkEmailPassword.apply(this,arguments)}function _linkEmailPassword(){_linkEmailPassword=_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"POST","/v1/accounts:signUp",request)]})});return _linkEmailPassword.apply(this,arguments)}function signInWithPassword(auth,request){return _signInWithPassword.apply(this,arguments)}function _signInWithPassword(){_signInWithPassword=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performSignInRequest(auth,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(auth,request))]})});return _signInWithPassword.apply(this,arguments)}function signInWithEmailLink$1(auth,request){return _signInWithEmailLink$1.apply(this,arguments)}function _signInWithEmailLink$1(){_signInWithEmailLink$1=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performSignInRequest(auth,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(auth,request))]})});return _signInWithEmailLink$1.apply(this,arguments)}function signInWithEmailLinkForLinking(auth,request){return _signInWithEmailLinkForLinking.apply(this,arguments)}function _signInWithEmailLinkForLinking(){_signInWithEmailLinkForLinking=_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performSignInRequest(auth,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(auth,request))]})});return _signInWithEmailLinkForLinking.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var EmailAuthCredential=function(AuthCredential){_inherits(EmailAuthCredential,AuthCredential);var _super=_create_super(EmailAuthCredential);function EmailAuthCredential(_email,_password,signInMethod){var _tenantId=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;_class_call_check1(this,EmailAuthCredential);var _this;_this=_super.call(this,"password",signInMethod);_this._email=_email;_this._password=_password;_this._tenantId=_tenantId;return _this}_create_class1(EmailAuthCredential,[{key:"toJSON",value:function toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:function _getIdTokenResponse(auth){var _this=this;return _async_to_generator$1(function(){var request;return _ts_generator1(this,function(_state){switch(_this.signInMethod){case"password":request={returnSecureToken:true,email:_this._email,password:_this._password,clientType:"CLIENT_TYPE_WEB"};return[2,handleRecaptchaFlow(auth,request,"signInWithPassword",signInWithPassword)];case"emailLink":return[2,signInWithEmailLink$1(auth,{email:_this._email,oobCode:_this._password})];default:_fail(auth,"internal-error")}return[2]})})()}},{key:"_linkToIdToken",value:function _linkToIdToken(auth,idToken){var _this=this;return _async_to_generator$1(function(){var request;return _ts_generator1(this,function(_state){switch(_this.signInMethod){case"password":request={idToken:idToken,returnSecureToken:true,email:_this._email,password:_this._password,clientType:"CLIENT_TYPE_WEB"};return[2,handleRecaptchaFlow(auth,request,"signUpPassword",linkEmailPassword)];case"emailLink":return[2,signInWithEmailLinkForLinking(auth,{idToken:idToken,email:_this._email,oobCode:_this._password})];default:_fail(auth,"internal-error")}return[2]})})()}},{key:"_getReauthenticationResolver",value:function _getReauthenticationResolver(auth){return this._getIdTokenResponse(auth)}}],[{key:"_fromEmailAndPassword",value:function _fromEmailAndPassword(email,password){return new EmailAuthCredential(email,password,"password")}},{key:"_fromEmailAndCode",value:function _fromEmailAndCode(email,oobCode){var tenantId=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return new EmailAuthCredential(email,oobCode,"emailLink",tenantId)}},{key:"fromJSON",value:function fromJSON(json){var obj=typeof json==="string"?JSON.parse(json):json;if((obj===null||obj===void 0?void 0:obj.email)&&(obj===null||obj===void 0?void 0:obj.password)){if(obj.signInMethod==="password"){return this._fromEmailAndPassword(obj.email,obj.password)}else if(obj.signInMethod==="emailLink"){return this._fromEmailAndCode(obj.email,obj.password,obj.tenantId)}}return null}}]);return EmailAuthCredential}(AuthCredential);function signInWithIdp(auth,request){return _signInWithIdp.apply(this,arguments)}function _signInWithIdp(){_signInWithIdp=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performSignInRequest(auth,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(auth,request))]})});return _signInWithIdp.apply(this,arguments)}_define_property$1({},"USER_NOT_FOUND","user-not-found");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(mode){switch(mode){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(url){var link=querystringDecode(extractQuerystring(url))["link"];var doubleDeepLink=link?querystringDecode(extractQuerystring(link))["deep_link_id"]:null;var iOSDeepLink=querystringDecode(extractQuerystring(url))["deep_link_id"];var iOSDoubleDeepLink=iOSDeepLink?querystringDecode(extractQuerystring(iOSDeepLink))["link"]:null;return iOSDoubleDeepLink||iOSDeepLink||doubleDeepLink||link||url}var ActionCodeURL=function(){function ActionCodeURL(actionLink){_class_call_check1(this,ActionCodeURL);var _a,_b,_c,_d,_e,_f;var searchParams=querystringDecode(extractQuerystring(actionLink));var apiKey=(_a=searchParams["apiKey"])!==null&&_a!==void 0?_a:null;var code=(_b=searchParams["oobCode"])!==null&&_b!==void 0?_b:null;var operation=parseMode((_c=searchParams["mode"])!==null&&_c!==void 0?_c:null);_assert(apiKey&&code&&operation,"argument-error");this.apiKey=apiKey;this.operation=operation;this.code=code;this.continueUrl=(_d=searchParams["continueUrl"])!==null&&_d!==void 0?_d:null;this.languageCode=(_e=searchParams["languageCode"])!==null&&_e!==void 0?_e:null;this.tenantId=(_f=searchParams["tenantId"])!==null&&_f!==void 0?_f:null}_create_class1(ActionCodeURL,null,[{key:"parseLink",value:function parseLink(link){var actionLink=parseDeepLink(link);try{return new ActionCodeURL(actionLink)}catch(_a){return null}}}]);return ActionCodeURL}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var EmailAuthProvider=function(){function EmailAuthProvider(){_class_call_check1(this,EmailAuthProvider);this.providerId=EmailAuthProvider.PROVIDER_ID}_create_class1(EmailAuthProvider,null,[{key:"credential",value:function credential(email,password){return EmailAuthCredential._fromEmailAndPassword(email,password)}},{key:"credentialWithLink",value:function credentialWithLink(email,emailLink){var actionCodeUrl=ActionCodeURL.parseLink(emailLink);_assert(actionCodeUrl,"argument-error");return EmailAuthCredential._fromEmailAndCode(email,actionCodeUrl.code,actionCodeUrl.tenantId)}}]);return EmailAuthProvider}();EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var FederatedAuthProvider=function(){function FederatedAuthProvider(providerId){_class_call_check1(this,FederatedAuthProvider);this.providerId=providerId;this.defaultLanguageCode=null;this.customParameters={}}_create_class1(FederatedAuthProvider,[{key:"setDefaultLanguage",value:function setDefaultLanguage(languageCode){this.defaultLanguageCode=languageCode}},{key:"setCustomParameters",value:function setCustomParameters(customOAuthParameters){this.customParameters=customOAuthParameters;return this}},{key:"getCustomParameters",value:function getCustomParameters(){return this.customParameters}}]);return FederatedAuthProvider}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var BaseOAuthProvider=function(FederatedAuthProvider){_inherits(BaseOAuthProvider,FederatedAuthProvider);var _super=_create_super(BaseOAuthProvider);function BaseOAuthProvider(){_class_call_check1(this,BaseOAuthProvider);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));_this.scopes=[];return _this}_create_class1(BaseOAuthProvider,[{key:"addScope",value:function addScope(scope){if(!this.scopes.includes(scope)){this.scopes.push(scope)}return this}},{key:"getScopes",value:function getScopes(){return _to_consumable_array1(this.scopes)}}]);return BaseOAuthProvider}(FederatedAuthProvider);function signUp(auth,request){return _signUp.apply(this,arguments)}function _signUp(){_signUp=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performSignInRequest(auth,"POST","/v1/accounts:signUp",_addTidIfNecessary(auth,request))]})});return _signUp.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var UserCredentialImpl=function(){function UserCredentialImpl(params){_class_call_check1(this,UserCredentialImpl);this.user=params.user;this.providerId=params.providerId;this._tokenResponse=params._tokenResponse;this.operationType=params.operationType}_create_class1(UserCredentialImpl,null,[{key:"_fromIdTokenResponse",value:function _fromIdTokenResponse(auth,operationType,idTokenResponse){var isAnonymous=arguments.length>3&&arguments[3]!==void 0?arguments[3]:false;return _async_to_generator$1(function(){var user,providerId,userCred;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,UserImpl._fromIdTokenResponse(auth,idTokenResponse,isAnonymous)];case 1:user=_state.sent();providerId=providerIdForResponse(idTokenResponse);userCred=new UserCredentialImpl({user:user,providerId:providerId,_tokenResponse:idTokenResponse,operationType:operationType});return[2,userCred]}})})()}},{key:"_forOperation",value:function _forOperation(user,operationType,response){return _async_to_generator$1(function(){var providerId;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,user._updateTokensIfNecessary(response,true)];case 1:_state.sent();providerId=providerIdForResponse(response);return[2,new UserCredentialImpl({user:user,providerId:providerId,_tokenResponse:response,operationType:operationType})]}})})()}}]);return UserCredentialImpl}();function providerIdForResponse(response){if(response.providerId){return response.providerId}if("phoneNumber"in response){return"phone"}return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MultiFactorError=function(FirebaseError){_inherits(MultiFactorError,FirebaseError);var _super=_create_super(MultiFactorError);function MultiFactorError(auth,error,operationType,user){_class_call_check1(this,MultiFactorError);var _this;var _a;_this=_super.call(this,error.code,error.message);_this.operationType=operationType;_this.user=user;Object.setPrototypeOf(_assert_this_initialized(_this),MultiFactorError.prototype);_this.customData={appName:auth.name,tenantId:(_a=auth.tenantId)!==null&&_a!==void 0?_a:undefined,_serverResponse:error.customData._serverResponse,operationType:operationType};return _this}_create_class1(MultiFactorError,null,[{key:"_fromErrorAndOperation",value:function _fromErrorAndOperation(auth,error,operationType,user){return new MultiFactorError(auth,error,operationType,user)}}]);return MultiFactorError}(FirebaseError);function _processCredentialSavingMfaContextIfNecessary(auth,operationType,credential,user){var idTokenProvider=operationType==="reauthenticate"?credential._getReauthenticationResolver(auth):credential._getIdTokenResponse(auth);return idTokenProvider.catch(function(error){if(error.code==="auth/multi-factor-auth-required"){throw MultiFactorError._fromErrorAndOperation(auth,error,operationType,user)}throw error})}function _link$1(user,credential){return __link$1.apply(this,arguments)}function __link$1(){__link$1=_async_to_generator$1(function(user,credential){var bypassAuthState,response,_tmp,_,_tmp1;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:bypassAuthState=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:false;_tmp=[user];_=credential._linkToIdToken;_tmp1=[user.auth];return[4,user.getIdToken()];case 1:return[4,_logoutIfInvalidated.apply(void 0,_tmp.concat([_.apply(credential,_tmp1.concat([_state.sent()])),bypassAuthState]))];case 2:response=_state.sent();return[2,UserCredentialImpl._forOperation(user,"link",response)]}})});return __link$1.apply(this,arguments)}function _reauthenticate(user,credential){return __reauthenticate.apply(this,arguments)}function __reauthenticate(){__reauthenticate=/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(user,credential){var bypassAuthState,auth,operationType,response,parsed,localId,e;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:bypassAuthState=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:false;auth=user.auth;operationType="reauthenticate";_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,_logoutIfInvalidated(user,_processCredentialSavingMfaContextIfNecessary(auth,operationType,credential,user),bypassAuthState)];case 2:response=_state.sent();_assert(response.idToken,auth,"internal-error");parsed=_parseToken(response.idToken);_assert(parsed,auth,"internal-error");localId=parsed.sub;_assert(user.uid===localId,auth,"user-mismatch");return[2,UserCredentialImpl._forOperation(user,operationType,response)];case 3:e=_state.sent();if((e===null||e===void 0?void 0:e.code)==="auth/user-not-found"){_fail(auth,"user-mismatch")}throw e;case 4:return[2]}})});return __reauthenticate.apply(this,arguments)}function _signInWithCredential(auth,credential){return __signInWithCredential.apply(this,arguments)}function __signInWithCredential(){__signInWithCredential=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,credential){var bypassAuthState,operationType,response,userCredential;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:bypassAuthState=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:false;operationType="signIn";return[4,_processCredentialSavingMfaContextIfNecessary(auth,operationType,credential)];case 1:response=_state.sent();return[4,UserCredentialImpl._fromIdTokenResponse(auth,operationType,response)];case 2:userCredential=_state.sent();if(!!bypassAuthState)return[3,4];return[4,auth._updateCurrentUser(userCredential.user)];case 3:_state.sent();_state.label=4;case 4:return[2,userCredential]}})});return __signInWithCredential.apply(this,arguments)}function signInWithCredential(auth,credential){return _signInWithCredential1.apply(this,arguments)}function _signInWithCredential1(){_signInWithCredential1=_async_to_generator$1(function(auth,credential){return _ts_generator1(this,function(_state){return[2,_signInWithCredential(_castAuth(auth),credential)]})});return _signInWithCredential1.apply(this,arguments)}function recachePasswordPolicy(auth){return _recachePasswordPolicy.apply(this,arguments)}function _recachePasswordPolicy(){_recachePasswordPolicy=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth){var authInternal;return _ts_generator1(this,function(_state){switch(_state.label){case 0:authInternal=_castAuth(auth);if(!authInternal._getPasswordPolicyInternal())return[3,2];return[4,authInternal._updatePasswordPolicy()];case 1:_state.sent();_state.label=2;case 2:return[2]}})});return _recachePasswordPolicy.apply(this,arguments)}function createUserWithEmailAndPassword(auth,email,password){return _createUserWithEmailAndPassword.apply(this,arguments)}function _createUserWithEmailAndPassword(){_createUserWithEmailAndPassword=_async_to_generator$1(function(auth,email,password){var authInternal,request,signUpResponse,response,userCredential;return _ts_generator1(this,function(_state){switch(_state.label){case 0:authInternal=_castAuth(auth);request={returnSecureToken:true,email:email,password:password,clientType:"CLIENT_TYPE_WEB"};signUpResponse=handleRecaptchaFlow(authInternal,request,"signUpPassword",signUp);return[4,signUpResponse.catch(function(error){if(error.code==="auth/password-does-not-meet-requirements"){void recachePasswordPolicy(auth)}throw error})];case 1:response=_state.sent();return[4,UserCredentialImpl._fromIdTokenResponse(authInternal,"signIn",response)];case 2:userCredential=_state.sent();return[4,authInternal._updateCurrentUser(userCredential.user)];case 3:_state.sent();return[2,userCredential]}})});return _createUserWithEmailAndPassword.apply(this,arguments)}function signInWithEmailAndPassword(auth,email,password){return signInWithCredential(getModularInstance(auth),EmailAuthProvider.credential(email,password)).catch(function(){var _ref=_async_to_generator$1(function(error){return _ts_generator1(this,function(_state){if(error.code==="auth/password-does-not-meet-requirements"){void recachePasswordPolicy(auth)}throw error})});return function(error){return _ref.apply(this,arguments)}}())}function updateProfile$1(auth,request){return _updateProfile$1.apply(this,arguments)}function _updateProfile$1(){_updateProfile$1=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth,request){return _ts_generator1(this,function(_state){return[2,_performApiRequest(auth,"POST","/v1/accounts:update",request)]})});return _updateProfile$1.apply(this,arguments)}function updateProfile(user,_){return _updateProfile.apply(this,arguments)}function _updateProfile(){_updateProfile=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(user,param){var displayName,photoUrl,userInternal,idToken,profileRequest,response,passwordProvider;return _ts_generator1(this,function(_state){switch(_state.label){case 0:displayName=param.displayName,photoUrl=param.photoURL;if(displayName===undefined&&photoUrl===undefined){return[2]}userInternal=getModularInstance(user);return[4,userInternal.getIdToken()];case 1:idToken=_state.sent();profileRequest={idToken:idToken,displayName:displayName,photoUrl:photoUrl,returnSecureToken:true};return[4,_logoutIfInvalidated(userInternal,updateProfile$1(userInternal.auth,profileRequest))];case 2:response=_state.sent();userInternal.displayName=response.displayName||null;userInternal.photoURL=response.photoUrl||null;passwordProvider=userInternal.providerData.find(function(param){var providerId=param.providerId;return providerId==="password"});if(passwordProvider){passwordProvider.displayName=userInternal.displayName;passwordProvider.photoURL=userInternal.photoURL}return[4,userInternal._updateTokensIfNecessary(response)];case 3:_state.sent();return[2]}})});return _updateProfile.apply(this,arguments)}function onIdTokenChanged(auth,nextOrObserver,error,completed){return getModularInstance(auth).onIdTokenChanged(nextOrObserver,error,completed)}function beforeAuthStateChanged(auth,callback,onAbort){return getModularInstance(auth).beforeAuthStateChanged(callback,onAbort)}var STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var BrowserPersistenceClass=function(){function BrowserPersistenceClass(storageRetriever,type){_class_call_check1(this,BrowserPersistenceClass);this.storageRetriever=storageRetriever;this.type=type}_create_class1(BrowserPersistenceClass,[{key:"_isAvailable",value:function _isAvailable(){try{if(!this.storage){return Promise.resolve(false)}this.storage.setItem(STORAGE_AVAILABLE_KEY,"1");this.storage.removeItem(STORAGE_AVAILABLE_KEY);return Promise.resolve(true)}catch(_a){return Promise.resolve(false)}}},{key:"_set",value:function _set(key,value){this.storage.setItem(key,JSON.stringify(value));return Promise.resolve()}},{key:"_get",value:function _get(key){var json=this.storage.getItem(key);return Promise.resolve(json?JSON.parse(json):null)}},{key:"_remove",value:function _remove(key){this.storage.removeItem(key);return Promise.resolve()}},{key:"storage",get:function get(){return this.storageRetriever()}}]);return BrowserPersistenceClass}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _iframeCannotSyncWebStorage(){var ua=getUA();return _isSafari(ua)||_isIOS(ua)}var _POLLING_INTERVAL_MS$1=1e3;var IE10_LOCAL_STORAGE_SYNC_DELAY=10;var BrowserLocalPersistence=function(BrowserPersistenceClass){_inherits(BrowserLocalPersistence,BrowserPersistenceClass);var _super=_create_super(BrowserLocalPersistence);function BrowserLocalPersistence(){_class_call_check1(this,BrowserLocalPersistence);var _this;_this=_super.call(this,function(){return window.localStorage},"LOCAL");_this.boundEventHandler=function(event,poll){return _this.onStorageEvent(event,poll)};_this.listeners={};_this.localCache={};_this.pollTimer=null;_this.safariLocalStorageNotSynced=_iframeCannotSyncWebStorage()&&_isIframe();_this.fallbackToPolling=_isMobileBrowser();_this._shouldAllowMigration=true;return _this}_create_class1(BrowserLocalPersistence,[{key:"forAllChangedKeys",value:function forAllChangedKeys(cb){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=Object.keys(this.listeners)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var newValue=this.storage.getItem(key);var oldValue=this.localCache[key];if(newValue!==oldValue){cb(key,oldValue,newValue)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"onStorageEvent",value:function onStorageEvent(event){var _this=this;var poll=arguments.length>1&&arguments[1]!==void 0?arguments[1]:false;if(!event.key){this.forAllChangedKeys(function(key,_oldValue,newValue){_this.notifyListeners(key,newValue)});return}var key=event.key;if(poll){this.detachListener()}else{this.stopPolling()}if(this.safariLocalStorageNotSynced){var storedValue=this.storage.getItem(key);if(event.newValue!==storedValue){if(event.newValue!==null){this.storage.setItem(key,event.newValue)}else{this.storage.removeItem(key)}}else if(this.localCache[key]===event.newValue&&!poll){return}}var triggerListeners=function triggerListeners(){var storedValue=_this.storage.getItem(key);if(!poll&&_this.localCache[key]===storedValue){return}_this.notifyListeners(key,storedValue)};var storedValue1=this.storage.getItem(key);if(_isIE10()&&storedValue1!==event.newValue&&event.newValue!==event.oldValue){setTimeout(triggerListeners,IE10_LOCAL_STORAGE_SYNC_DELAY)}else{triggerListeners()}}},{key:"notifyListeners",value:function notifyListeners(key,value){this.localCache[key]=value;var listeners=this.listeners[key];if(listeners){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=Array.from(listeners)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var listener=_step.value;listener(value?JSON.parse(value):value)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}},{key:"startPolling",value:function startPolling(){var _this=this;this.stopPolling();this.pollTimer=setInterval(function(){_this.forAllChangedKeys(function(key,oldValue,newValue){_this.onStorageEvent(new StorageEvent("storage",{key:key,oldValue:oldValue,newValue:newValue}),true)})},_POLLING_INTERVAL_MS$1)}},{key:"stopPolling",value:function stopPolling(){if(this.pollTimer){clearInterval(this.pollTimer);this.pollTimer=null}}},{key:"attachListener",value:function attachListener(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function detachListener(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function _addListener(key,listener){if(Object.keys(this.listeners).length===0){if(this.fallbackToPolling){this.startPolling()}else{this.attachListener()}}if(!this.listeners[key]){this.listeners[key]=new Set;this.localCache[key]=this.storage.getItem(key)}this.listeners[key].add(listener)}},{key:"_removeListener",value:function _removeListener(key,listener){if(this.listeners[key]){this.listeners[key].delete(listener);if(this.listeners[key].size===0){delete this.listeners[key]}}if(Object.keys(this.listeners).length===0){this.detachListener();this.stopPolling()}}},{key:"_set",value:function _set(key,value){var _this=this;var _this1=this,_superprop_get__set=function _superprop_get__set(){return _get(_get_prototype_of(BrowserLocalPersistence.prototype),"_set",_this)};return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_superprop_get__set().call(_this1,key,value)];case 1:_state.sent();_this1.localCache[key]=JSON.stringify(value);return[2]}})})()}},{key:"_get",value:function _get1(key){var _this=this;var _this1=this,_superprop_get__get=function _superprop_get__get(){return _get(_get_prototype_of(BrowserLocalPersistence.prototype),"_get",_this)};return _async_to_generator$1(function(){var value;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_superprop_get__get().call(_this1,key)];case 1:value=_state.sent();_this1.localCache[key]=JSON.stringify(value);return[2,value]}})})()}},{key:"_remove",value:function _remove(key){var _this=this;var _this1=this,_superprop_get__remove=function _superprop_get__remove(){return _get(_get_prototype_of(BrowserLocalPersistence.prototype),"_remove",_this)};return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_superprop_get__remove().call(_this1,key)];case 1:_state.sent();delete _this1.localCache[key];return[2]}})})()}}]);return BrowserLocalPersistence}(BrowserPersistenceClass);BrowserLocalPersistence.type="LOCAL";var browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var BrowserSessionPersistence=function(BrowserPersistenceClass){_inherits(BrowserSessionPersistence,BrowserPersistenceClass);var _super=_create_super(BrowserSessionPersistence);function BrowserSessionPersistence(){_class_call_check1(this,BrowserSessionPersistence);return _super.call(this,function(){return window.sessionStorage},"SESSION")}_create_class1(BrowserSessionPersistence,[{key:"_addListener",value:function _addListener(_key,_listener){return}},{key:"_removeListener",value:function _removeListener(_key,_listener){return}}]);return BrowserSessionPersistence}(BrowserPersistenceClass);BrowserSessionPersistence.type="SESSION";var browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(promises){return Promise.all(promises.map(function(){var _ref=_async_to_generator$1(function(promise){var value,reason;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,promise];case 1:value=_state.sent();return[2,{fulfilled:true,value:value}];case 2:reason=_state.sent();return[2,{fulfilled:false,reason:reason}];case 3:return[2]}})});return function(promise){return _ref.apply(this,arguments)}}()))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Receiver=function(){function Receiver(eventTarget){_class_call_check1(this,Receiver);this.eventTarget=eventTarget;this.handlersMap={};this.boundEventHandler=this.handleEvent.bind(this)}_create_class1(Receiver,[{key:"isListeningto",value:function isListeningto(eventTarget){return this.eventTarget===eventTarget}},{key:"handleEvent",value:function handleEvent(event){var _this=this;return _async_to_generator$1(function(){var messageEvent,_messageEvent_data,eventId,eventType,data,handlers,promises,response;return _ts_generator1(this,function(_state){switch(_state.label){case 0:messageEvent=event;_messageEvent_data=messageEvent.data,eventId=_messageEvent_data.eventId,eventType=_messageEvent_data.eventType,data=_messageEvent_data.data;handlers=_this.handlersMap[eventType];if(!(handlers===null||handlers===void 0?void 0:handlers.size)){return[2]}messageEvent.ports[0].postMessage({status:"ack",eventId:eventId,eventType:eventType});promises=Array.from(handlers).map(function(){var _ref=_async_to_generator$1(function(handler){return _ts_generator1(this,function(_state){return[2,handler(messageEvent.origin,data)]})});return function(handler){return _ref.apply(this,arguments)}}());return[4,_allSettled(promises)];case 1:response=_state.sent();messageEvent.ports[0].postMessage({status:"done",eventId:eventId,eventType:eventType,response:response});return[2]}})})()}},{key:"_subscribe",value:function _subscribe(eventType,eventHandler){if(Object.keys(this.handlersMap).length===0){this.eventTarget.addEventListener("message",this.boundEventHandler)}if(!this.handlersMap[eventType]){this.handlersMap[eventType]=new Set}this.handlersMap[eventType].add(eventHandler)}},{key:"_unsubscribe",value:function _unsubscribe(eventType,eventHandler){if(this.handlersMap[eventType]&&eventHandler){this.handlersMap[eventType].delete(eventHandler)}if(!eventHandler||this.handlersMap[eventType].size===0){delete this.handlersMap[eventType]}if(Object.keys(this.handlersMap).length===0){this.eventTarget.removeEventListener("message",this.boundEventHandler)}}}],[{key:"_getInstance",value:function _getInstance(eventTarget){var existingInstance=this.receivers.find(function(receiver){return receiver.isListeningto(eventTarget)});if(existingInstance){return existingInstance}var newInstance=new Receiver(eventTarget);this.receivers.push(newInstance);return newInstance}}]);return Receiver}();Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(){var prefix=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",digits=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;var random="";for(var i=0;i<digits;i++){random+=Math.floor(Math.random()*10)}return prefix+random}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sender=function(){function Sender(target){_class_call_check1(this,Sender);this.target=target;this.handlers=new Set}_create_class1(Sender,[{key:"removeMessageHandler",value:function removeMessageHandler(handler){if(handler.messageChannel){handler.messageChannel.port1.removeEventListener("message",handler.onMessage);handler.messageChannel.port1.close()}this.handlers.delete(handler)}},{key:"_send",value:function _send(eventType,data){var timeout=arguments.length>2&&arguments[2]!==void 0?arguments[2]:50;var _this=this;return _async_to_generator$1(function(){var messageChannel,completionTimer,handler;return _ts_generator1(this,function(_state){messageChannel=typeof MessageChannel!=="undefined"?new MessageChannel:null;if(!messageChannel){throw new Error("connection_unavailable")}return[2,new Promise(function(resolve,reject){var eventId=_generateEventId("",20);messageChannel.port1.start();var ackTimer=setTimeout(function(){reject(new Error("unsupported_event"))},timeout);handler={messageChannel:messageChannel,onMessage:function onMessage(event){var messageEvent=event;if(messageEvent.data.eventId!==eventId){return}switch(messageEvent.data.status){case"ack":clearTimeout(ackTimer);completionTimer=setTimeout(function(){reject(new Error("timeout"))},3e3);break;case"done":clearTimeout(completionTimer);resolve(messageEvent.data.response);break;default:clearTimeout(ackTimer);clearTimeout(completionTimer);reject(new Error("invalid_response"));break}}};_this.handlers.add(handler);messageChannel.port1.addEventListener("message",handler.onMessage);_this.target.postMessage({eventType:eventType,eventId:eventId,data:data},[messageChannel.port2])}).finally(function(){if(handler){_this.removeMessageHandler(handler)}})]})})()}}]);return Sender}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(url){_window().location.href=url}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window()["WorkerGlobalScope"]!=="undefined"&&typeof _window()["importScripts"]==="function"}function _getActiveServiceWorker(){return __getActiveServiceWorker.apply(this,arguments)}function __getActiveServiceWorker(){__getActiveServiceWorker=_async_to_generator$1(function(){var registration;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!(navigator===null||navigator===void 0?void 0:navigator.serviceWorker)){return[2,null]}_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,navigator.serviceWorker.ready];case 2:registration=_state.sent();return[2,registration.active];case 3:_state.sent();return[2,null];case 4:return[2]}})});return __getActiveServiceWorker.apply(this,arguments)}function _getServiceWorkerController(){var _a;return((_a=navigator===null||navigator===void 0?void 0:navigator.serviceWorker)===null||_a===void 0?void 0:_a.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DB_NAME="firebaseLocalStorageDb";var DB_VERSION=1;var DB_OBJECTSTORE_NAME="firebaseLocalStorage";var DB_DATA_KEYPATH="fbase_key";var DBPromise=function(){function DBPromise(request){_class_call_check1(this,DBPromise);this.request=request}_create_class1(DBPromise,[{key:"toPromise",value:function toPromise(){var _this=this;return new Promise(function(resolve,reject){_this.request.addEventListener("success",function(){resolve(_this.request.result)});_this.request.addEventListener("error",function(){reject(_this.request.error)})})}}]);return DBPromise}();function getObjectStore(db,isReadWrite){return db.transaction([DB_OBJECTSTORE_NAME],isReadWrite?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){var request=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(request).toPromise()}function _openDatabase(){var request=indexedDB.open(DB_NAME,DB_VERSION);return new Promise(function(resolve,reject){request.addEventListener("error",function(){reject(request.error)});request.addEventListener("upgradeneeded",function(){var db=request.result;try{db.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(e){reject(e)}});request.addEventListener("success",_async_to_generator$1(function(){var db;return _ts_generator1(this,function(_state){switch(_state.label){case 0:db=request.result;if(!!db.objectStoreNames.contains(DB_OBJECTSTORE_NAME))return[3,3];db.close();return[4,_deleteDatabase()];case 1:_state.sent();return[4,_openDatabase()];case 2:resolve.apply(void 0,[_state.sent()]);return[3,4];case 3:resolve(db);_state.label=4;case 4:return[2]}})}))})}function _putObject(db,key,value){return __putObject.apply(this,arguments)}function __putObject(){__putObject=_async_to_generator$1(function(db,key,value){var _obj,request;return _ts_generator1(this,function(_state){request=getObjectStore(db,true).put((_obj={},_define_property$1(_obj,DB_DATA_KEYPATH,key),_define_property$1(_obj,"value",value),_obj));return[2,new DBPromise(request).toPromise()]})});return __putObject.apply(this,arguments)}function getObject(db,key){return _getObject.apply(this,arguments)}function _getObject(){_getObject=_async_to_generator$1(function(db,key){var request,data;return _ts_generator1(this,function(_state){switch(_state.label){case 0:request=getObjectStore(db,false).get(key);return[4,new DBPromise(request).toPromise()];case 1:data=_state.sent();return[2,data===undefined?null:data.value]}})});return _getObject.apply(this,arguments)}function _deleteObject(db,key){var request=getObjectStore(db,true).delete(key);return new DBPromise(request).toPromise()}var _POLLING_INTERVAL_MS=800;var _TRANSACTION_RETRY_COUNT=3;var IndexedDBLocalPersistence=function(){function IndexedDBLocalPersistence(){_class_call_check1(this,IndexedDBLocalPersistence);this.type="LOCAL";this._shouldAllowMigration=true;this.listeners={};this.localCache={};this.pollTimer=null;this.pendingWrites=0;this.receiver=null;this.sender=null;this.serviceWorkerReceiverAvailable=false;this.activeServiceWorker=null;this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(function(){},function(){})}_create_class1(IndexedDBLocalPersistence,[{key:"_openDb",value:function _openDb(){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(_this.db){return[2,_this.db]}return[4,_openDatabase()];case 1:_this.db=_state.sent();return[2,_this.db]}})})()}},{key:"_withRetries",value:function _withRetries(op){var _this=this;return _async_to_generator$1(function(){var numAttempts,db,e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:numAttempts=0;_state.label=1;case 1:_state.label=2;case 2:_state.trys.push([2,5,,6]);return[4,_this._openDb()];case 3:db=_state.sent();return[4,op(db)];case 4:return[2,_state.sent()];case 5:e=_state.sent();if(numAttempts++>_TRANSACTION_RETRY_COUNT){throw e}if(_this.db){_this.db.close();_this.db=undefined}return[3,6];case 6:return[3,1];case 7:return[2]}})})()}},{key:"initializeServiceWorkerMessaging",value:function initializeServiceWorkerMessaging(){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,_isWorker()?_this.initializeReceiver():_this.initializeSender()]})})()}},{key:"initializeReceiver",value:function initializeReceiver(){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){_this.receiver=Receiver._getInstance(_getWorkerGlobalScope());_this.receiver._subscribe("keyChanged",function(){var _ref=_async_to_generator$1(function(_origin,data){var keys;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._poll()];case 1:keys=_state.sent();return[2,{keyProcessed:keys.includes(data.key)}]}})});return function(_origin,data){return _ref.apply(this,arguments)}}());_this.receiver._subscribe("ping",function(){var _ref=_async_to_generator$1(function(_origin,_data){return _ts_generator1(this,function(_state){return[2,["keyChanged"]]})});return function(_origin,_data){return _ref.apply(this,arguments)}}());return[2]})})()}},{key:"initializeSender",value:function initializeSender(){var _this=this;return _async_to_generator$1(function(){var _a,_b,results;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_getActiveServiceWorker()];case 1:_this.activeServiceWorker=_state.sent();if(!_this.activeServiceWorker){return[2]}_this.sender=new Sender(_this.activeServiceWorker);return[4,_this.sender._send("ping",{},800)];case 2:results=_state.sent();if(!results){return[2]}if(((_a=results[0])===null||_a===void 0?void 0:_a.fulfilled)&&((_b=results[0])===null||_b===void 0?void 0:_b.value.includes("keyChanged"))){_this.serviceWorkerReceiverAvailable=true}return[2]}})})()}},{key:"notifyServiceWorker",value:function notifyServiceWorker(key){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(!_this.sender||!_this.activeServiceWorker||_getServiceWorkerController()!==_this.activeServiceWorker){return[2]}_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,_this.sender._send("keyChanged",{key:key},_this.serviceWorkerReceiverAvailable?800:50)];case 2:_state.sent();return[3,4];case 3:_state.sent();return[3,4];case 4:return[2]}})})()}},{key:"_isAvailable",value:function _isAvailable(){return _async_to_generator$1(function(){var db;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);if(!indexedDB){return[2,false]}return[4,_openDatabase()];case 1:db=_state.sent();return[4,_putObject(db,STORAGE_AVAILABLE_KEY,"1")];case 2:_state.sent();return[4,_deleteObject(db,STORAGE_AVAILABLE_KEY)];case 3:_state.sent();return[2,true];case 4:_state.sent();return[3,5];case 5:return[2,false]}})})()}},{key:"_withPendingWrite",value:function _withPendingWrite(write){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:_this.pendingWrites++;_state.label=1;case 1:_state.trys.push([1,,3,4]);return[4,write()];case 2:_state.sent();return[3,4];case 3:_this.pendingWrites--;return[7];case 4:return[2]}})})()}},{key:"_set",value:function _set(key,value){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,_this._withPendingWrite(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._withRetries(function(db){return _putObject(db,key,value)})];case 1:_state.sent();_this.localCache[key]=value;return[2,_this.notifyServiceWorker(key)]}})}))]})})()}},{key:"_get",value:function _get(key){var _this=this;return _async_to_generator$1(function(){var obj;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._withRetries(function(db){return getObject(db,key)})];case 1:obj=_state.sent();_this.localCache[key]=obj;return[2,obj]}})})()}},{key:"_remove",value:function _remove(key){var _this=this;return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,_this._withPendingWrite(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._withRetries(function(db){return _deleteObject(db,key)})];case 1:_state.sent();delete _this.localCache[key];return[2,_this.notifyServiceWorker(key)]}})}))]})})()}},{key:"_poll",value:function _poll(){var _this=this;return _async_to_generator$1(function(){var result,keys,keysInResult,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_step_value,key,value,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_iterator1,_step1,localKey;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._withRetries(function(db){var getAllRequest=getObjectStore(db,false).getAll();return new DBPromise(getAllRequest).toPromise()})];case 1:result=_state.sent();if(!result){return[2,[]]}if(_this.pendingWrites!==0){return[2,[]]}keys=[];keysInResult=new Set;if(result.length!==0){_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=result[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_step_value=_step.value,key=_step_value.fbase_key,value=_step_value.value;keysInResult.add(key);if(JSON.stringify(_this.localCache[key])!==JSON.stringify(value)){_this.notifyListeners(key,value);keys.push(key)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(_iterator1=Object.keys(_this.localCache)[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){localKey=_step1.value;if(_this.localCache[localKey]&&!keysInResult.has(localKey)){_this.notifyListeners(localKey,null);keys.push(localKey)}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return[2,keys]}})})()}},{key:"notifyListeners",value:function notifyListeners(key,newValue){this.localCache[key]=newValue;var listeners=this.listeners[key];if(listeners){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=Array.from(listeners)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var listener=_step.value;listener(newValue)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}},{key:"startPolling",value:function startPolling(){this.stopPolling();var _this=this;this.pollTimer=setInterval(_async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2,_this._poll()]})}),_POLLING_INTERVAL_MS)}},{key:"stopPolling",value:function stopPolling(){if(this.pollTimer){clearInterval(this.pollTimer);this.pollTimer=null}}},{key:"_addListener",value:function _addListener(key,listener){if(Object.keys(this.listeners).length===0){this.startPolling()}if(!this.listeners[key]){this.listeners[key]=new Set;void this._get(key)}this.listeners[key].add(listener)}},{key:"_removeListener",value:function _removeListener(key,listener){if(this.listeners[key]){this.listeners[key].delete(listener);if(this.listeners[key].size===0){delete this.listeners[key]}}if(Object.keys(this.listeners).length===0){this.stopPolling()}}}]);return IndexedDBLocalPersistence}();IndexedDBLocalPersistence.type="LOCAL";var indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(auth,resolverOverride){if(resolverOverride){return _getInstance(resolverOverride)}_assert(auth._popupRedirectResolver,auth,"argument-error");return auth._popupRedirectResolver}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var IdpCredential=function(AuthCredential){_inherits(IdpCredential,AuthCredential);var _super=_create_super(IdpCredential);function IdpCredential(params){_class_call_check1(this,IdpCredential);var _this;_this=_super.call(this,"custom","custom");_this.params=params;return _this}_create_class1(IdpCredential,[{key:"_getIdTokenResponse",value:function _getIdTokenResponse(auth){return signInWithIdp(auth,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function _linkToIdToken(auth,idToken){return signInWithIdp(auth,this._buildIdpRequest(idToken))}},{key:"_getReauthenticationResolver",value:function _getReauthenticationResolver(auth){return signInWithIdp(auth,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function _buildIdpRequest(idToken){var request={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:true,returnIdpCredential:true};if(idToken){request.idToken=idToken}return request}}]);return IdpCredential}(AuthCredential);function _signIn(params){return _signInWithCredential(params.auth,new IdpCredential(params),params.bypassAuthState)}function _reauth(params){var auth=params.auth,user=params.user;_assert(user,auth,"internal-error");return _reauthenticate(user,new IdpCredential(params),params.bypassAuthState)}function _link(params){return __link.apply(this,arguments)}function __link(){__link=_async_to_generator$1(function(params){var auth,user;return _ts_generator1(this,function(_state){auth=params.auth,user=params.user;_assert(user,auth,"internal-error");return[2,_link$1(user,new IdpCredential(params),params.bypassAuthState)]})});return __link.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var AbstractPopupRedirectOperation=function(){function AbstractPopupRedirectOperation(auth,filter,resolver,user){var bypassAuthState=arguments.length>4&&arguments[4]!==void 0?arguments[4]:false;_class_call_check1(this,AbstractPopupRedirectOperation);this.auth=auth;this.resolver=resolver;this.user=user;this.bypassAuthState=bypassAuthState;this.pendingPromise=null;this.eventManager=null;this.filter=Array.isArray(filter)?filter:[filter]}_create_class1(AbstractPopupRedirectOperation,[{key:"execute",value:function execute(){var _this=this;return new Promise(function(){var _ref=_async_to_generator$1(function(resolve,reject){var e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_this.pendingPromise={resolve:resolve,reject:reject};_state.label=1;case 1:_state.trys.push([1,4,,5]);return[4,_this.resolver._initialize(_this.auth)];case 2:_this.eventManager=_state.sent();return[4,_this.onExecution()];case 3:_state.sent();_this.eventManager.registerConsumer(_this);return[3,5];case 4:e=_state.sent();_this.reject(e);return[3,5];case 5:return[2]}})});return function(resolve,reject){return _ref.apply(this,arguments)}}())}},{key:"onAuthEvent",value:function onAuthEvent(event){var _this=this;return _async_to_generator$1(function(){var urlResponse,sessionId,postBody,tenantId,error,type,params,_,e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:urlResponse=event.urlResponse,sessionId=event.sessionId,postBody=event.postBody,tenantId=event.tenantId,error=event.error,type=event.type;if(error){_this.reject(error);return[2]}params={auth:_this.auth,requestUri:urlResponse,sessionId:sessionId,tenantId:tenantId||undefined,postBody:postBody||undefined,user:_this.user,bypassAuthState:_this.bypassAuthState};_state.label=1;case 1:_state.trys.push([1,3,,4]);_=_this.resolve;return[4,_this.getIdpTask(type)(params)];case 2:_.apply(_this,[_state.sent()]);return[3,4];case 3:e=_state.sent();_this.reject(e);return[3,4];case 4:return[2]}})})()}},{key:"onError",value:function onError(error){this.reject(error)}},{key:"getIdpTask",value:function getIdpTask(type){switch(type){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}},{key:"resolve",value:function resolve(cred){debugAssert(this.pendingPromise,"Pending promise was never set");this.pendingPromise.resolve(cred);this.unregisterAndCleanUp()}},{key:"reject",value:function reject(error){debugAssert(this.pendingPromise,"Pending promise was never set");this.pendingPromise.reject(error);this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function unregisterAndCleanUp(){if(this.eventManager){this.eventManager.unregisterConsumer(this)}this.pendingPromise=null;this.cleanUp()}}]);return AbstractPopupRedirectOperation}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Delay(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var PENDING_REDIRECT_KEY="pendingRedirect";var redirectOutcomeMap=new Map;var RedirectAction=function(AbstractPopupRedirectOperation){_inherits(RedirectAction,AbstractPopupRedirectOperation);var _super=_create_super(RedirectAction);function RedirectAction(auth,resolver){var bypassAuthState=arguments.length>2&&arguments[2]!==void 0?arguments[2]:false;_class_call_check1(this,RedirectAction);var _this;_this=_super.call(this,auth,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],resolver,undefined,bypassAuthState);_this.eventId=null;return _this}_create_class1(RedirectAction,[{key:"execute",value:function execute(){var _this=this;var _this1=this,_superprop_get_execute=function _superprop_get_execute(){return _get(_get_prototype_of(RedirectAction.prototype),"execute",_this)};return _async_to_generator$1(function(){var readyOutcome,hasPendingRedirect,result,_tmp,e;return _ts_generator1(this,function(_state){switch(_state.label){case 0:readyOutcome=redirectOutcomeMap.get(_this1.auth._key());if(!!readyOutcome)return[3,8];_state.label=1;case 1:_state.trys.push([1,6,,7]);return[4,_getAndClearPendingRedirectStatus(_this1.resolver,_this1.auth)];case 2:hasPendingRedirect=_state.sent();if(!hasPendingRedirect)return[3,4];return[4,_superprop_get_execute().call(_this1)];case 3:_tmp=_state.sent();return[3,5];case 4:_tmp=null;_state.label=5;case 5:result=_tmp;readyOutcome=function readyOutcome(){return Promise.resolve(result)};return[3,7];case 6:e=_state.sent();readyOutcome=function readyOutcome(){return Promise.reject(e)};return[3,7];case 7:redirectOutcomeMap.set(_this1.auth._key(),readyOutcome);_state.label=8;case 8:if(!_this1.bypassAuthState){redirectOutcomeMap.set(_this1.auth._key(),function(){return Promise.resolve(null)})}return[2,readyOutcome()]}})})()}},{key:"onAuthEvent",value:function onAuthEvent(event){var _this=this;var _this1=this,_superprop_get_onAuthEvent=function _superprop_get_onAuthEvent(){return _get(_get_prototype_of(RedirectAction.prototype),"onAuthEvent",_this)};return _async_to_generator$1(function(){var user;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(event.type==="signInViaRedirect"){return[2,_superprop_get_onAuthEvent().call(_this1,event)]}else if(event.type==="unknown"){_this1.resolve(null);return[2]}if(!event.eventId)return[3,2];return[4,_this1.auth._redirectUserForId(event.eventId)];case 1:user=_state.sent();if(user){_this1.user=user;return[2,_superprop_get_onAuthEvent().call(_this1,event)]}else{_this1.resolve(null)}_state.label=2;case 2:return[2]}})})()}},{key:"onExecution",value:function onExecution(){return _async_to_generator$1(function(){return _ts_generator1(this,function(_state){return[2]})})()}},{key:"cleanUp",value:function cleanUp(){}}]);return RedirectAction}(AbstractPopupRedirectOperation);function _getAndClearPendingRedirectStatus(resolver,auth){return __getAndClearPendingRedirectStatus.apply(this,arguments)}function __getAndClearPendingRedirectStatus(){__getAndClearPendingRedirectStatus=_async_to_generator$1(function(resolver,auth){var key,persistence,hasPendingRedirect;return _ts_generator1(this,function(_state){switch(_state.label){case 0:key=pendingRedirectKey(auth);persistence=resolverPersistence(resolver);return[4,persistence._isAvailable()];case 1:if(!_state.sent()){return[2,false]}return[4,persistence._get(key)];case 2:hasPendingRedirect=_state.sent()==="true";return[4,persistence._remove(key)];case 3:_state.sent();return[2,hasPendingRedirect]}})});return __getAndClearPendingRedirectStatus.apply(this,arguments)}function _overrideRedirectResult(auth,result){redirectOutcomeMap.set(auth._key(),result)}function resolverPersistence(resolver){return _getInstance(resolver._redirectPersistence)}function pendingRedirectKey(auth){return _persistenceKeyName(PENDING_REDIRECT_KEY,auth.config.apiKey,auth.name)}function _getRedirectResult1(auth,resolverExtern){return __getRedirectResult.apply(this,arguments)}function __getRedirectResult(){__getRedirectResult=_async_to_generator$1(function(auth,resolverExtern){var bypassAuthState,authInternal,resolver,action,result;var _arguments=arguments;return _ts_generator1(this,function(_state){switch(_state.label){case 0:bypassAuthState=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:false;authInternal=_castAuth(auth);resolver=_withDefaultResolver(authInternal,resolverExtern);action=new RedirectAction(authInternal,resolver,bypassAuthState);return[4,action.execute()];case 1:result=_state.sent();if(!(result&&!bypassAuthState))return[3,4];delete result.user._redirectEventId;return[4,authInternal._persistUserIfCurrent(result.user)];case 2:_state.sent();return[4,authInternal._setRedirectUser(null,resolverExtern)];case 3:_state.sent();_state.label=4;case 4:return[2,result]}})});return __getRedirectResult.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;var AuthEventManager=function(){function AuthEventManager(auth){_class_call_check1(this,AuthEventManager);this.auth=auth;this.cachedEventUids=new Set;this.consumers=new Set;this.queuedRedirectEvent=null;this.hasHandledPotentialRedirect=false;this.lastProcessedEventTime=Date.now()}_create_class1(AuthEventManager,[{key:"registerConsumer",value:function registerConsumer(authEventConsumer){this.consumers.add(authEventConsumer);if(this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,authEventConsumer)){this.sendToConsumer(this.queuedRedirectEvent,authEventConsumer);this.saveEventToCache(this.queuedRedirectEvent);this.queuedRedirectEvent=null}}},{key:"unregisterConsumer",value:function unregisterConsumer(authEventConsumer){this.consumers.delete(authEventConsumer)}},{key:"onEvent",value:function onEvent(event){var _this=this;if(this.hasEventBeenHandled(event)){return false}var handled=false;this.consumers.forEach(function(consumer){if(_this.isEventForConsumer(event,consumer)){handled=true;_this.sendToConsumer(event,consumer);_this.saveEventToCache(event)}});if(this.hasHandledPotentialRedirect||!isRedirectEvent(event)){return handled}this.hasHandledPotentialRedirect=true;if(!handled){this.queuedRedirectEvent=event;handled=true}return handled}},{key:"sendToConsumer",value:function sendToConsumer(event,consumer){var _a;if(event.error&&!isNullRedirectEvent(event)){var code=((_a=event.error.code)===null||_a===void 0?void 0:_a.split("auth/")[1])||"internal-error";consumer.onError(_createError(this.auth,code))}else{consumer.onAuthEvent(event)}}},{key:"isEventForConsumer",value:function isEventForConsumer(event,consumer){var eventIdMatches=consumer.eventId===null||!!event.eventId&&event.eventId===consumer.eventId;return consumer.filter.includes(event.type)&&eventIdMatches}},{key:"hasEventBeenHandled",value:function hasEventBeenHandled(event){if(Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS){this.cachedEventUids.clear()}return this.cachedEventUids.has(eventUid(event))}},{key:"saveEventToCache",value:function saveEventToCache(event){this.cachedEventUids.add(eventUid(event));this.lastProcessedEventTime=Date.now()}}]);return AuthEventManager}();function eventUid(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(function(v){return v}).join("-")}function isNullRedirectEvent(param){var type=param.type,error=param.error;return type==="unknown"&&(error===null||error===void 0?void 0:error.code)==="auth/no-auth-event"}function isRedirectEvent(event){switch(event.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return true;case"unknown":return isNullRedirectEvent(event);default:return false}}function _getProjectConfig(auth){return __getProjectConfig.apply(this,arguments)}function __getProjectConfig(){__getProjectConfig=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_async_to_generator$1(function(auth){var request;var _arguments=arguments;return _ts_generator1(this,function(_state){request=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:{};return[2,_performApiRequest(auth,"GET","/v1/projects",request)]})});return __getProjectConfig.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;var HTTP_REGEX=/^https?/;function _validateOrigin(auth){return __validateOrigin.apply(this,arguments)}function __validateOrigin(){__validateOrigin=_async_to_generator$1(function(auth){var authorizedDomains,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,domain;return _ts_generator1(this,function(_state){switch(_state.label){case 0:if(auth.config.emulator){return[2]}return[4,_getProjectConfig(auth)];case 1:authorizedDomains=_state.sent().authorizedDomains;_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=authorizedDomains[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){domain=_step.value;try{if(matchDomain(domain)){return[2]}}catch(_a){}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}_fail(auth,"unauthorized-domain");return[2]}})});return __validateOrigin.apply(this,arguments)}function matchDomain(expected){var currentUrl=_getCurrentUrl();var _ref=new URL(currentUrl),protocol=_ref.protocol,hostname=_ref.hostname;if(expected.startsWith("chrome-extension://")){var ceUrl=new URL(expected);if(ceUrl.hostname===""&&hostname===""){return protocol==="chrome-extension:"&&expected.replace("chrome-extension://","")===currentUrl.replace("chrome-extension://","")}return protocol==="chrome-extension:"&&ceUrl.hostname===hostname}if(!HTTP_REGEX.test(protocol)){return false}if(IP_ADDRESS_REGEX.test(expected)){return hostname===expected}var escapedDomainPattern=expected.replace(/\./g,"\\.");var re=new RegExp("^(.+\\."+escapedDomainPattern+"|"+escapedDomainPattern+")$","i");return re.test(hostname)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){var beacon=_window().___jsl;if(beacon===null||beacon===void 0?void 0:beacon.H){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=Object.keys(beacon.H)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var hint=_step.value;beacon.H[hint].r=beacon.H[hint].r||[];beacon.H[hint].L=beacon.H[hint].L||[];beacon.H[hint].r=_to_consumable_array1(beacon.H[hint].L);if(beacon.CP){for(var i=0;i<beacon.CP.length;i++){beacon.CP[i]=null}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}function loadGapi(auth){return new Promise(function(resolve,reject){var loadGapiIframe=function loadGapiIframe(){resetUnloadedGapiModules();gapi.load("gapi.iframes",{callback:function callback(){resolve(gapi.iframes.getContext())},ontimeout:function ontimeout(){resetUnloadedGapiModules();reject(_createError(auth,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})};var _a,_b,_c;if((_b=(_a=_window().gapi)===null||_a===void 0?void 0:_a.iframes)===null||_b===void 0?void 0:_b.Iframe){resolve(gapi.iframes.getContext())}else if(!!((_c=_window().gapi)===null||_c===void 0?void 0:_c.load)){loadGapiIframe()}else{var cbName=_generateCallbackName("iframefcb");_window()[cbName]=function(){if(!!gapi.load){loadGapiIframe()}else{reject(_createError(auth,"network-request-failed"))}};return _loadJS("".concat(_gapiScriptUrl(),"?onload=").concat(cbName)).catch(function(e){return reject(e)})}}).catch(function(error){cachedGApiLoader=null;throw error})}var cachedGApiLoader=null;function _loadGapi(auth){cachedGApiLoader=cachedGApiLoader||loadGapi(auth);return cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var PING_TIMEOUT=new Delay(5e3,15e3);var IFRAME_PATH="__/auth/iframe";var EMULATED_IFRAME_PATH="emulator/auth/iframe";var IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"};var EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(auth){var config=auth.config;_assert(config.authDomain,auth,"auth-domain-config-required");var url=config.emulator?_emulatorUrl(config,EMULATED_IFRAME_PATH):"https://".concat(auth.config.authDomain,"/").concat(IFRAME_PATH);var params={apiKey:config.apiKey,appName:auth.name,v:SDK_VERSION};var eid=EID_FROM_APIHOST.get(auth.config.apiHost);if(eid){params.eid=eid}var frameworks=auth._getFrameworks();if(frameworks.length){params.fw=frameworks.join(",")}return"".concat(url,"?").concat(querystring(params).slice(1))}function _openIframe(auth){return __openIframe.apply(this,arguments)}function __openIframe(){__openIframe=_async_to_generator$1(function(auth){var context,gapi1;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_loadGapi(auth)];case 1:context=_state.sent();gapi1=_window().gapi;_assert(gapi1,auth,"internal-error");return[2,context.open({where:document.body,url:getIframeUrl(auth),messageHandlersFilter:gapi1.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:true},function(iframe){return new Promise(function(){var _ref=_async_to_generator$1(function(resolve,reject){var networkError,networkErrorTimer;function clearTimerAndResolve(){_window().clearTimeout(networkErrorTimer);resolve(iframe)}return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,iframe.restyle({setHideOnLeave:false})];case 1:_state.sent();networkError=_createError(auth,"network-request-failed");networkErrorTimer=_window().setTimeout(function(){reject(networkError)},PING_TIMEOUT.get());iframe.ping(clearTimerAndResolve).then(clearTimerAndResolve,function(){reject(networkError)});return[2]}})});return function(resolve,reject){return _ref.apply(this,arguments)}}())})]}})});return __openIframe.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};var DEFAULT_WIDTH=500;var DEFAULT_HEIGHT=600;var TARGET_BLANK="_blank";var FIREFOX_EMPTY_URL="http://localhost";var AuthPopup=function(){function AuthPopup(window1){_class_call_check1(this,AuthPopup);this.window=window1;this.associatedEvent=null}_create_class1(AuthPopup,[{key:"close",value:function close(){if(this.window){try{this.window.close()}catch(e){}}}}]);return AuthPopup}();function _open(auth,url,name){var width=arguments.length>3&&arguments[3]!==void 0?arguments[3]:DEFAULT_WIDTH,height=arguments.length>4&&arguments[4]!==void 0?arguments[4]:DEFAULT_HEIGHT;var top=Math.max((window.screen.availHeight-height)/2,0).toString();var left=Math.max((window.screen.availWidth-width)/2,0).toString();var target="";var options=Object.assign(Object.assign({},BASE_POPUP_OPTIONS),{width:width.toString(),height:height.toString(),top:top,left:left});var ua=getUA().toLowerCase();if(name){target=_isChromeIOS(ua)?TARGET_BLANK:name}if(_isFirefox(ua)){url=url||FIREFOX_EMPTY_URL;options.scrollbars="yes"}var optionsString=Object.entries(options).reduce(function(accum,param){var _param=_sliced_to_array1(param,2),key=_param[0],value=_param[1];return"".concat(accum).concat(key,"=").concat(value,",")},"");if(_isIOSStandalone(ua)&&target!=="_self"){openAsNewWindowIOS(url||"",target);return new AuthPopup(null)}var newWin=window.open(url||"",target,optionsString);_assert(newWin,auth,"popup-blocked");try{newWin.focus()}catch(e){}return new AuthPopup(newWin)}function openAsNewWindowIOS(url,target){var el=document.createElement("a");el.href=url;el.target=target;var click=document.createEvent("MouseEvent");click.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,1,null);el.dispatchEvent(click)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var WIDGET_PATH="__/auth/handler";var EMULATOR_WIDGET_PATH="emulator/auth/handler";var FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");function _getRedirectUrl(auth,provider,authType,redirectUrl,eventId,additionalParams){return __getRedirectUrl.apply(this,arguments)}function __getRedirectUrl(){__getRedirectUrl=_async_to_generator$1(function(auth,provider,authType,redirectUrl,eventId,additionalParams){var params,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_step_value,key,value,scopes,paramsDict,_iteratorNormalCompletion1,_didIteratorError1,_iteratorError1,_iterator1,_step1,key1,appCheckToken,appCheckTokenFragment;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_assert(auth.config.authDomain,auth,"auth-domain-config-required");_assert(auth.config.apiKey,auth,"invalid-api-key");params={apiKey:auth.config.apiKey,appName:auth.name,authType:authType,redirectUrl:redirectUrl,v:SDK_VERSION,eventId:eventId};if(_instanceof1(provider,FederatedAuthProvider)){provider.setDefaultLanguage(auth.languageCode);params.providerId=provider.providerId||"";if(!isEmpty$1(provider.getCustomParameters())){params.customParameters=JSON.stringify(provider.getCustomParameters())}_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(_iterator=Object.entries(additionalParams||{})[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_step_value=_sliced_to_array1(_step.value,2),key=_step_value[0],value=_step_value[1];params[key]=value}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}if(_instanceof1(provider,BaseOAuthProvider)){scopes=provider.getScopes().filter(function(scope){return scope!==""});if(scopes.length>0){params.scopes=scopes.join(",")}}if(auth.tenantId){params.tid=auth.tenantId}paramsDict=params;_iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{for(_iterator1=Object.keys(paramsDict)[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true){key1=_step1.value;if(paramsDict[key1]===undefined){delete paramsDict[key1]}}}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}return[4,auth._getAppCheckToken()];case 1:appCheckToken=_state.sent();appCheckTokenFragment=appCheckToken?"#".concat(FIREBASE_APP_CHECK_FRAGMENT_ID,"=").concat(encodeURIComponent(appCheckToken)):"";return[2,"".concat(getHandlerBase(auth),"?").concat(querystring(paramsDict).slice(1)).concat(appCheckTokenFragment)]}})});return __getRedirectUrl.apply(this,arguments)}function getHandlerBase(param){var config=param.config;if(!config.emulator){return"https://".concat(config.authDomain,"/").concat(WIDGET_PATH)}return _emulatorUrl(config,EMULATOR_WIDGET_PATH)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var WEB_STORAGE_SUPPORT_KEY="webStorageSupport";var BrowserPopupRedirectResolver=function(){function BrowserPopupRedirectResolver(){_class_call_check1(this,BrowserPopupRedirectResolver);this.eventManagers={};this.iframes={};this.originValidationPromises={};this._redirectPersistence=browserSessionPersistence;this._completeRedirectFn=_getRedirectResult1;this._overrideRedirectResult=_overrideRedirectResult}_create_class1(BrowserPopupRedirectResolver,[{key:"_openPopup",value:function _openPopup(auth,provider,authType,eventId){var _this=this;return _async_to_generator$1(function(){var _a,url;return _ts_generator1(this,function(_state){switch(_state.label){case 0:debugAssert((_a=_this.eventManagers[auth._key()])===null||_a===void 0?void 0:_a.manager,"_initialize() not called before _openPopup()");return[4,_getRedirectUrl(auth,provider,authType,_getCurrentUrl(),eventId)];case 1:url=_state.sent();return[2,_open(auth,url,_generateEventId())]}})})()}},{key:"_openRedirect",value:function _openRedirect(auth,provider,authType,eventId){var _this=this;return _async_to_generator$1(function(){var url;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_this._originValidation(auth)];case 1:_state.sent();return[4,_getRedirectUrl(auth,provider,authType,_getCurrentUrl(),eventId)];case 2:url=_state.sent();_setWindowLocation(url);return[2,new Promise(function(){})]}})})()}},{key:"_initialize",value:function _initialize(auth){var _this=this;var key=auth._key();if(this.eventManagers[key]){var _this_eventManagers_key=this.eventManagers[key],manager=_this_eventManagers_key.manager,promise=_this_eventManagers_key.promise;if(manager){return Promise.resolve(manager)}else{debugAssert(promise,"If manager is not set, promise should be");return promise}}var promise1=this.initAndGetManager(auth);this.eventManagers[key]={promise:promise1};promise1.catch(function(){delete _this.eventManagers[key]});return promise1}},{key:"initAndGetManager",value:function initAndGetManager(auth){var _this=this;return _async_to_generator$1(function(){var iframe,manager;return _ts_generator1(this,function(_state){switch(_state.label){case 0:return[4,_openIframe(auth)];case 1:iframe=_state.sent();manager=new AuthEventManager(auth);iframe.register("authEvent",function(iframeEvent){_assert(iframeEvent===null||iframeEvent===void 0?void 0:iframeEvent.authEvent,auth,"invalid-auth-event");var handled=manager.onEvent(iframeEvent.authEvent);return{status:handled?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER);_this.eventManagers[auth._key()]={manager:manager};_this.iframes[auth._key()]=iframe;return[2,manager]}})})()}},{key:"_isIframeWebStorageSupported",value:function _isIframeWebStorageSupported(auth,cb){var iframe=this.iframes[auth._key()];iframe.send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},function(result){var _a;var isSupported=(_a=result===null||result===void 0?void 0:result[0])===null||_a===void 0?void 0:_a[WEB_STORAGE_SUPPORT_KEY];if(isSupported!==undefined){cb(!!isSupported)}_fail(auth,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function _originValidation(auth){var key=auth._key();if(!this.originValidationPromises[key]){this.originValidationPromises[key]=_validateOrigin(auth)}return this.originValidationPromises[key]}},{key:"_shouldInitProactively",get:function get(){return _isMobileBrowser()||_isSafari()||_isIOS()}}]);return BrowserPopupRedirectResolver}();var browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name="@firebase/auth";var version="1.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var AuthInterop=function(){function AuthInterop(auth){_class_call_check1(this,AuthInterop);this.auth=auth;this.internalListeners=new Map}_create_class1(AuthInterop,[{key:"getUid",value:function getUid(){var _a;this.assertAuthConfigured();return((_a=this.auth.currentUser)===null||_a===void 0?void 0:_a.uid)||null}},{key:"getToken",value:function getToken(forceRefresh){var _this=this;return _async_to_generator$1(function(){var accessToken;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_this.assertAuthConfigured();return[4,_this.auth._initializationPromise];case 1:_state.sent();if(!_this.auth.currentUser){return[2,null]}return[4,_this.auth.currentUser.getIdToken(forceRefresh)];case 2:accessToken=_state.sent();return[2,{accessToken:accessToken}]}})})()}},{key:"addAuthTokenListener",value:function addAuthTokenListener(listener){this.assertAuthConfigured();if(this.internalListeners.has(listener)){return}var unsubscribe=this.auth.onIdTokenChanged(function(user){listener((user===null||user===void 0?void 0:user.stsTokenManager.accessToken)||null)});this.internalListeners.set(listener,unsubscribe);this.updateProactiveRefresh()}},{key:"removeAuthTokenListener",value:function removeAuthTokenListener(listener){this.assertAuthConfigured();var unsubscribe=this.internalListeners.get(listener);if(!unsubscribe){return}this.internalListeners.delete(listener);unsubscribe();this.updateProactiveRefresh()}},{key:"assertAuthConfigured",value:function assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function updateProactiveRefresh(){if(this.internalListeners.size>0){this.auth._startProactiveRefresh()}else{this.auth._stopProactiveRefresh()}}}]);return AuthInterop}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(clientPlatform){switch(clientPlatform){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return undefined}}function registerAuth(clientPlatform){_registerComponent(new Component("auth",function(container,param){var deps=param.options;var app=container.getProvider("app").getImmediate();var heartbeatServiceProvider=container.getProvider("heartbeat");var appCheckServiceProvider=container.getProvider("app-check-internal");var _app_options=app.options,apiKey=_app_options.apiKey,authDomain=_app_options.authDomain;_assert(apiKey&&!apiKey.includes(":"),"invalid-api-key",{appName:app.name});var config={apiKey:apiKey,authDomain:authDomain,clientPlatform:clientPlatform,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(clientPlatform)};var authInstance=new AuthImpl(app,heartbeatServiceProvider,appCheckServiceProvider,config);_initializeAuthInstance(authInstance,deps);return authInstance},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(container,_instanceIdentifier,_instance){var authInternalProvider=container.getProvider("auth-internal");authInternalProvider.initialize()}));_registerComponent(new Component("auth-internal",function(container){var auth=_castAuth(container.getProvider("auth").getImmediate());return function(auth){return new AuthInterop(auth)}(auth)},"PRIVATE").setInstantiationMode("EXPLICIT"));registerVersion(name,version,getVersionForPlatform(clientPlatform));registerVersion(name,version,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DEFAULT_ID_TOKEN_MAX_AGE=5*60;var authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;var lastPostedIdToken=null;var mintCookieFactory=function mintCookieFactory(url){return function(){var _ref=_async_to_generator$1(function(user){var idTokenResult,_tmp,idTokenAge,idToken;return _ts_generator1(this,function(_state){switch(_state.label){case 0:_tmp=user;if(!_tmp)return[3,2];return[4,user.getIdTokenResult()];case 1:_tmp=_state.sent();_state.label=2;case 2:idTokenResult=_tmp;idTokenAge=idTokenResult&&(new Date().getTime()-Date.parse(idTokenResult.issuedAtTime))/1e3;if(idTokenAge&&idTokenAge>authIdTokenMaxAge){return[2]}idToken=idTokenResult===null||idTokenResult===void 0?void 0:idTokenResult.token;if(lastPostedIdToken===idToken){return[2]}lastPostedIdToken=idToken;return[4,fetch(url,{method:idToken?"POST":"DELETE",headers:idToken?{"Authorization":"Bearer ".concat(idToken)}:{}})];case 3:_state.sent();return[2]}})});return function(user){return _ref.apply(this,arguments)}}()};function getAuth(){var app=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getApp();var provider=_getProvider(app,"auth");if(provider.isInitialized()){return provider.getImmediate()}var auth=initializeAuth(app,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]});var authTokenSyncUrl=getExperimentalSetting("authTokenSyncURL");if(authTokenSyncUrl){var mintCookie=mintCookieFactory(authTokenSyncUrl);beforeAuthStateChanged(auth,mintCookie,function(){return mintCookie(auth.currentUser)});onIdTokenChanged(auth,function(user){return mintCookie(user)})}var authEmulatorHost=getDefaultEmulatorHost("auth");if(authEmulatorHost){connectAuthEmulator(auth,"http://".concat(authEmulatorHost))}return auth}function getScriptParentElement(){var _a,_b;return(_b=(_a=document.getElementsByTagName("head"))===null||_a===void 0?void 0:_a[0])!==null&&_b!==void 0?_b:document}_setExternalJSProvider({loadJS:function loadJS(url){return new Promise(function(resolve,reject){var el=document.createElement("script");el.setAttribute("src",url);el.onload=resolve;el.onerror=function(e){var error=_createError("internal-error");error.customData=e;reject(error)};el.type="text/javascript";el.charset="UTF-8";getScriptParentElement().appendChild(el)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});registerAuth("Browser");function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator(fn){return function(){var _$self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(_$self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _define_property(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var AuthService=function(){"use strict";function AuthService(){_class_call_check(this,AuthService);_define_property(this,"currentAuth",function(){return getAuth(firebaseApp)})}_create_class(AuthService,[{key:"createUser",value:function createUser(model){var _this=this;return _async_to_generator(function(){var userCredential,user,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);return[4,createUserWithEmailAndPassword(_this.currentAuth(),model.email,model.password)];case 1:userCredential=_state.sent();user=userCredential.user;if(!user)return[3,3];return[4,_this.updateProfileDetail({user:user,displayName:model.userName})];case 2:_state.sent();_state.label=3;case 3:return[2,user];case 4:e=_state.sent();return[2,e.message];case 5:return[2]}})})()}},{key:"updateProfileDetail",value:function updateProfileDetail(req){return _async_to_generator(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,updateProfile(req.user,{displayName:req.displayName,photoURL:req.photoUrl})];case 1:_state.sent();return[3,3];case 2:e=_state.sent();return[2,e.message];case 3:return[2]}})})()}},{key:"signIn",value:function signIn(model){var _this=this;return _async_to_generator(function(){var e,error;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,signInWithEmailAndPassword(_this.currentAuth(),model.email,model.password)];case 1:return[2,_state.sent()];case 2:e=_state.sent();error=e;switch(error.code){case"auth/invalid-email":return[2,"Invalid Email"];case"auth/user-not-found":return[2,"No account with this email"];case"auth/wrong-password":return[2,"Incorrect password"];default:return[2,"Email or password was incorrect"]}return[3,3];case 3:return[2]}})})()}}]);return AuthService}();var authService=new AuthService;var EnumToastSeverity;(function(EnumToastSeverity){EnumToastSeverity["Success"]="success";EnumToastSeverity["Info"]="info";EnumToastSeverity["Warn"]="warn";EnumToastSeverity["Error"]="error"})(EnumToastSeverity||(EnumToastSeverity={}));export{EnumToastSeverity,authService,baseService,db,firebaseApp};
//# sourceMappingURL=index.js.map
